<dom-module id="x-comprobante">
<template>
<meta content="no-cache"/>
<paper-dialog id="dialog_cotent_comprobante" class="xDialogContentFa" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
<div>
<div class="xMiBoton_icon_lateral xDerecha" id="btn_facturacion" onclick="xGuardarFactura()"><img src="../../../images/_imprimir.png"><p>Imprimir</p></div>
<h3 id="titulo">Facturacion</h3>
<div class="xLinea2"></div>
<div class="xContentDivs xFlex">
<div class="xdiv_content div_iz xBordeDe">
<table class="xtable1 xfont10x xCursor" width="100%" id="tb_habitacion">
<thead>
<th width="85%"></th>
<th></th>
</thead>
<tr class="row" onclick="xSelectRow(this)">
<td width="70%">qqq HAB. 103 MATRIMONIAL aaa</td>
<td align="right">360.00</td>
</tr>
</table>
<br>
<h3 class="xCursor" onclick="xAddQuitarAllItem(this)">Consumos</h3>
<table class="xtable1 xfont9x xRowPading5 xCursor" id="tb_consumo" width="100%">
<thead>
<th width="85%"></th>
<th></th>
</thead>
<tr class="row" onclick="xSelectRow(this)" data-id="1" data-i="0">
<td>aa</td>
<td align="right">360.00</td>
</tr>
<tr class="row" onclick="xSelectRow(this)" data-id="2" data-i="1">
<td>3 FANTA INGLESA</td>
<td align="right">10.00</td>
</tr>
</table>
</div>
<div class="xdiv_content div_de">
<form method="post" id="frm_encabezado">
<div>
<select id="SelTipoPersona">
<option value="0">PERSONA NATURAL</option>
<option value="1">PERSONA JURIDICA</option>
</select>
<select id="SelComprobante">
<option>FACTURA</option>
<option>BOLETA</option>
</select>
<input type="number" pattern="[0-9]+([\.,][0-9]+)?" step="any" id="comp_serie" name="comp_serie" onkeyup="xValidarSerie()" onchange="xValidarSerie()" class="xMiInput xAlinearDerecha xPasarEnter2" placeholder="Serie" inline>
<input type="number" pattern="[0-9]+([\.,][0-9]+)?" step="any" id="comp_num" name="comp_num" onchange="xValidarNumComp(this)" class="xMiInput xAlinearDerecha" placeholder="Numero" inline>
</div>
<div id="info_cliente">
<span class="xfont11 xColorRow_Azul xDerecha xCursor" onclick="xDatosClienteIni()">Datos del cliente de origne</span>
<input type="text" class="xMiInput xPasarEnter2" placeholder="Nombre/Razon Social" id="txt_clie_emp" name="txt_clie_emp">
<input type="text" class="xMiInput xPasarEnter2" placeholder="Direccion" id="txt_clie_direccion" name="txt_clie_direccion">
<input type="text" class="xMiInput" placeholder="DNI/RUC" id="txt_clie_dni" name="txt_clie_dni">
</div>
<div class="xInvisible">
<input type="text" id="idorg" name="idorg" value="[[xt_org]]">
<input type="text" id="idsede" name="idsede" value="[[xt_idsede]]">
<input type="text" id="idusuario" name="idusuario" value="[[xt_idus]]">
<input type="text" id="idcomprobante_tipo" name="idcomprobante_tipo">
<input type="text" id="fecha" name="fecha">
<input type="text" id="hora" name="hora">
<input type="text" id="idcliente_pn_pj" name="idcliente_pn_pj">
<input type="text" id="tipo_p" name="tipo_p">
<input type="text" id="total" name="total">
</div>
</form>
<br>
<div>
<table class="xtable3 _xfont11x xfont12x xRowPading3" width="100%" id="tb_pro_facturar" data-TablaName="comprobante_detalle">
<thead>
<th width="60%" align="left">DESCRIPCION <span class="xbtnRowAll xfont11 xpadingLateralIz xColorRow_Azul" onclick="xQuitarTodoConsumoGrid()">No detallar consumo</span></th>
<th align="right">P.UNITARIO</th>
<th align="right">IMPORTE</th>
</thead>
</table>
</div>
</div>
</div>
</div>
<div class="xdiv_pie">
<div class="xLinea2"></div>
<p class="x_total">IMPORTE A FACTURAR: <span id="total_tb">----</span></p>
</div>
</paper-dialog>
</template>
</dom-module>
<style>.xContentDivs{position:absolute;width:calc(100% - 4em);top:67px;bottom:65px}.xdiv_content{display:inline;position:relative;top:0;overflow-y:auto}.div_iz{width:25%;background:#f5f5f5}.div_de{left:0;width:100%;padding:10px}.xdiv_pie{position:absolute;bottom:0;right:0;left:0;height:40px;margin-top:40px;clear:both;padding-top:-10px;text-align:right}._xfont10x tr td{font-size:10px}._xfont10x thead th{font-size:10px}._xfont11x tr td{font-size:11px}._xfont11x thead th{font-size:11px}.xDialogContentFa{border-radius:5px;padding:5px;width:95%;height:95%}table tr.xselected_row{background:#fff9c4}table tr.xselected_row:hover{background:#fff9c4}.x_total{font-size:18px;font-weight:500;color:#616161;padding:15px}</style>
<script>/*<![CDATA[*/var xThis;var xIdcomprobante;var xSerie_comprobante;var xNum_comprobante;var xValIdSelCom=0;var xIdClienteComprobante;var xidcliente_pn_pj;var xTipo_P="";var xImporteTotalFacturar;function xIiniComprobante(){xValIdSelCom=0;xLoadComprobante();xLoadCliente();xAddItemNoRow();$(".xPasarEnter2").on("keyup",function(g){var f=g.which;if(f==13||f==186){var c=$("input");var b=c.index(document.activeElement);if(c[b+1]!==null){var d=c[b+1];if(d.disabled){d=c[b+2]}d.focus();d.select()}return false}});$("#txt_norow_importe").on("keyup",function(b){var a=b.which;if(a==13||a==186){xAddContenItemNoRow()}});$("#SelComprobante").on("change",function(a){xValIdSelCom=$(this).val();xSelectComprobanteOption()});$("#SelTipoPersona").on("change",function(a){xParametroBuscar();xDatosClienteMostrar()})}function xGuardarFactura(){xGuardarComprobante();$("#frm_encabezado #idcomprobante_tipo").val(xIdcomprobante);$("#frm_encabezado #fecha").val(xDevolverFecha());$("#frm_encabezado #hora").val(xDevolverHora());$("#frm_encabezado #idcliente_pn_pj").val(xidcliente_pn_pj);$("#frm_encabezado #tipo_p").val(xTipo_P);$("#frm_encabezado #total").val(xImporteTotalFacturar);xPopupLoad.xopen();$.post("../../bdphp/ManejoBD_IUD.php?tb=comprobante",$("#frm_encabezado").serialize(),function(a){var b=xArmarInsertDetalle($("#tb_pro_facturar"),"idcomprobante",a,"","")})}function xLoadCliente(){$.ajax({type:"POST",url:"../../bdphp/log.php?op=8014"}).done(function(b){var a=$.parseJSON(b);xThis.dataCliente=a.datos;xParametroBuscar()})}function xDatosClienteMostrar(){if(xIdClienteComprobante==""){return}var a=xThis.dataCliente.filter(function(b){return b.idcliente==xIdClienteComprobante});a=a[0];$("#txt_clie_emp").attr("data-idcliente",a.idcliente);$("#txt_clie_emp").attr("data-idempresa",a.idcliente_empresa);switch($("#SelTipoPersona").val()){case"0":xidcliente_pn_pj=a.idcliente;xTipo_P="PN";$("#txt_clie_emp").val(a.nombre);$("#txt_clie_direccion").val(a.procedencia);$("#txt_clie_dni").val(a.dni);break;case"1":xidcliente_pn_pj=a.idcliente_empresa;xTipo_P="PJ";$("#txt_clie_emp").val(a.empresa);$("#txt_clie_direccion").val(a.direccion);$("#txt_clie_dni").val(a.ruc);break}}function xDatosClienteIni(){xIdClienteComprobante=xThis.dtIdCliente;xDatosClienteMostrar()}function xParametroBuscar(){var xParamBuscar="";var xdttCliente;switch($("#SelTipoPersona").val()){case"0":xdttCliente=eval((JSON.stringify(xThis.dataCliente).replace(/nombre/g,"label")));break;case"1":var result=xThis.dataCliente.reduce(function(res,obj){if(!(obj.empresa in res)){res.__array.push(res[obj.empresa]=obj)}else{res[obj.empresa].hits+=obj.hits;res[obj.empresa].bytes+=obj.bytes}return res},{__array:[]}).__array.sort(function(a,b){return a.empresa});xdttCliente=eval(((JSON.stringify(result).replace(/empresa/g,"label")).replace(/ruc/g,"dni")).replace(/direccion/g,"procedencia"));break}$("#txt_clie_emp").autocomplete({autoFocus:true,source:xdttCliente,select:function(event,ui){$("#txt_clie_emp").val(ui.item.label);$("#txt_clie_emp").attr("data-idcliente",ui.item.idcliente);$("#txt_clie_emp").attr("data-idempresa",ui.item.idcliente_empresa);$("#txt_clie_direccion").val(ui.item.procedencia);$("#txt_clie_dni").val(ui.item.dni);xIdClienteComprobante=ui.item.idcliente;return false},focus:function(event,ui){return false},change:function(event,ui){if(ui.item===null){$("#txt_clie_emp").attr("data-idcliente","");$("#txt_clie_emp").attr("data-idempresa","");xIdClienteComprobante==""}return false}})}function xGuardarComprobante(){xSerie_comprobante=$("#comp_serie").val();xNum_comprobante=$("#comp_num").val();$.ajax({type:"POST",url:"../../bdphp/log.php?op=8013",data:{i:xIdcomprobante,serie:xSerie_comprobante,num:xNum_comprobante}}).done(function(a){xNum_comprobante++;$("#comp_num").val(xNum_comprobante);$("#comp_num").attr("min",xNum_comprobante);xLoadComprobante()})}function xValidarSerie(){var a=$("#comp_serie").val();if(parseFloat(a)!=parseFloat(xThis.dataComprobante[xValIdSelCom].serie)){xNum_comprobante=0;xNum_comprobante=parseFloat(xNum_comprobante)+1}else{if(parseFloat(xThis.dataComprobante[xValIdSelCom].serie)==0){return}$("#comp_serie").val(xThis.dataComprobante[xValIdSelCom].serie);xNum_comprobante=xThis.dataComprobante[xValIdSelCom].num;xNum_comprobante=parseFloat(xNum_comprobante)+1}$("#comp_num").val(xNum_comprobante);$("#comp_num").attr("min",xNum_comprobante)}function xValidarNumComp(b){var a=parseFloat($(b).attr("min"));var c=parseFloat($(b).val());if(isNaN(c)){c=0}if(c<a){$(b).val(a)}}function xSelectComprobanteOption(){var a=xValIdSelCom;xIdcomprobante=xThis.dataComprobante[a].idcomprobante_tipo;xSerie_comprobante=xThis.dataComprobante[a].serie;xNum_comprobante=xThis.dataComprobante[a].num;xNum_comprobante=parseFloat(xNum_comprobante)+1;$("#comp_serie").val(xSerie_comprobante);$("#comp_num").val(xNum_comprobante);$("#comp_num").attr("min",xNum_comprobante)}function xLoadComprobante(){$.ajax({type:"POST",url:"../../bdphp/log.php?op=8012"}).done(function(c){var b="";var a=$.parseJSON(c);xThis.dataComprobante=a.datos;for(var d=0;d<a.datos.length;d++){b=b+'<option value="'+d+'">'+a.datos[d].descripcion+"</option>"}$("#SelComprobante option").remove();$("#SelComprobante").append(b).trigger("create");$("#SelComprobante").val(xValIdSelCom);xSelectComprobanteOption()})}function xload_Data_Consumo(){var f="";var g=xThis.dataconsumo;var d="";var c=0;for(var e=0;e<g.length;e++){d=xThis.dataconsumo[e].descripcion;if(d.indexOf("|")!=-1){d=d.split("|");d=d[1]}if(xThis.dataconsumo[e].escuenta_otrahab==0){c=parseFloat(c)+parseFloat(g[e].total);f=String(f+'<tr onclick="xSelectRow(this)" class="row" data-id="'+g[e].idservicio_registro+'" data-i="'+e+'"><td>'+xCeroIzq(g[e].cantidad,2)+" "+d+'</td><td class="total" align="right">'+parseFloat(g[e].total).toFixed(2)+"</td></tr>")}else{if(xThis.datahabitacion.map(function(h){return h.descripcion}).indexOf(d)!=-1){continue}var b={descripcion:d,total:parseFloat(g[e].total).toFixed(2)};xThis.datahabitacion.push(b)}}c=parseFloat(c).toFixed(2);f=f+'<tr class="total xSinBorde"><td colspan="2" align="right">'+c+"</td></tr>";$("#tb_pro_facturar .row").remove();$("#tb_consumo .row").remove();$("#tb_consumo .total").remove();$("#tb_consumo").append(f).trigger("create");c=0;var a="";for(var e=0;e<xThis.datahabitacion.length;e++){c=parseFloat(c)+parseFloat(xThis.datahabitacion[e].total);a=String(a+'<tr class="row" data-i="HAB'+e+'" onclick="xSelectRowHab(this)"><td>'+xThis.datahabitacion[e].descripcion+'</td><td class="total" align="right">'+xThis.datahabitacion[e].total+"</td></tr>")}c=parseFloat(c).toFixed(2);a=a+'<tr class="total xSinBorde"><td colspan="2" align="right">'+c+"</td></tr>";$("#tb_habitacion .row").remove();$("#tb_habitacion .total").remove();$("#tb_habitacion").append(a).trigger("create")}function xSelectRowHab(b){var a=$(b).attr("data-i");if(b.className.indexOf("xselected_row")!=-1){$(b).removeClass("xselected_row");xQuitarItemHab(a)}else{$(b).addClass("xselected_row");xAddItemHab(a)}}function xSelectRow(b){var a=$(b).attr("data-i");if(b.className.indexOf("xselected_row")!=-1){$(b).removeClass("xselected_row");xQuitarItem(a)}else{$(b).addClass("xselected_row");xAddItem(a)}}function xSumarTotal(){xImporteTotalFacturar=xMoneda(xSumaCantRow($("#tb_pro_facturar"),".total"));$("#total_tb").text(xImporteTotalFacturar)}function xAddContenItemNoRow(){if($("#txt_norow_des").val()==""){$("#txt_norow_des").attr("requerid");return}var a='<tr class="row"><td><span class="xDeleteRowNeutro" title="Borrar" onclick="xxBorrarItemLocal(this);"></span>'+$("#txt_norow_des").val()+'</td><td align="right" data-ColumName="pu">'+$("#txt_norow_cant").val()+'</td><td align="right" data-ColumName="pt" class="total">'+xMoneda($("#txt_norow_importe").val())+'</td><td align="right" data-ColumName="item" class="xInvisible">'+$("#txt_norow_des").val()+"</td></tr>";$("#tb_pro_facturar tr:last").before(a).trigger("create");xNewItemNoRow()}function xNewItemNoRow(){$("#txt_norow_des").val("");$("#txt_norow_cant").val("");$("#txt_norow_importe").val("");$("#txt_norow_des").focus();xSumarTotal()}function xAddItemNoRow(){$("#tb_pro_facturar").append('<tr class="row_add xSinBorde"><td><input id="txt_norow_des" type="text" class="xMiInput xPasarEnter2" onChange="conMayusculas(this)" placeholder="Descripcion"></td><td><input id="txt_norow_cant"Â´type="text" class="xMiInput xAlinearDerecha xPasarEnter2" onblur="xRetornaMoneda(this)" placeholder="P.Unitario"></td><td><input type="text" class="xMiInput xAlinearDerecha" onblur="xRetornaMoneda(this)" placeholder="Importe" id="txt_norow_importe"></td></tr>').trigger("create");$("#txt_norow_des").focus()}function xAddItemHab(c){var b=xBuscarAttrTbData($("#tb_pro_facturar"),"data-i",c);if(b!=false){return}var a="";c=c.replace("HAB","");a='<tr class="row" data-i="HAB'+c+'"><td><span class="xDeleteRowNeutro" title="Borrar" onclick="xxBorrarItemLocal(this);"></span>'+xThis.datahabitacion[c].descripcion+'</td><td align="right" data-ColumName="pu"></td><td align="right" data-ColumName="pt" class="total">'+parseFloat(xThis.datahabitacion[c].total).toFixed(2)+'</td><td align="right" data-ColumName="item" class="xInvisible">'+xThis.datahabitacion[c].descripcion+"</td>"+ +"</tr>";$("#tb_pro_facturar tr:last").before(a).trigger("create");xNewItemNoRow()}function xAddItem(d){var c=xBuscarAttrTbData($("#tb_pro_facturar"),"data-id",d);if(c!=false){return}var a="";var b=xThis.dataconsumo[d].descripcion;if(b.indexOf("|")!=-1){b=b.split("|");b=b[1]}a='<tr class="row" data-id="'+d+'"><td><span class="xDeleteRowNeutro" title="Borrar" onclick="xxBorrarItemLocal(this);"></span>'+xCeroIzq(xThis.dataconsumo[d].cantidad,2)+" "+b+'</td><td align="right">'+xThis.dataconsumo[d].punitario+'</td><td align="right" class="total">'+parseFloat(xThis.dataconsumo[d].total).toFixed(2)+"</td>"+ +"</tr>";$("#tb_pro_facturar tr:last").before(a).trigger("create");xNewItemNoRow()}function xAddItemALL(){for(var a=0;a<xThis.dataconsumo.length;a++){xAddItem(a)}$("#tb_consumo .row").addClass("xselected_row")}function xQuitarItemHab(b){var a=xBuscarAttrTbData($("#tb_pro_facturar"),"data-i",b);$(a).remove();xNewItemNoRow()}function xQuitarItem(b){var a=xBuscarAttrTbData($("#tb_pro_facturar"),"data-id",b);$(a).remove();xNewItemNoRow()}function xQuitarItemAll(){for(var a=0;a<xThis.dataconsumo.length;a++){xQuitarItem(a)}$("#tb_consumo .row").removeClass("xselected_row")}function xQuitarTodoConsumoGrid(){for(var a=0;a<xThis.dataconsumo.length;a++){xQuitarItem(a)}}function xAddQuitarAllItem(a){if($(a).text()=="Consumos"){xAddItemALL();$(a).text("x Consumos")}else{xQuitarItemAll();$(a).text("Consumos")}}function xxBorrarItemLocal(a){$(a).parent().parent().fadeTo(100,0,function(){$(this).remove();xNewItemNoRow()})}var xdialog_comprobante;Polymer({is:"x-comprobante",properties:{dataconsumo:{type:Object,value:""},datahabitacion:{type:Object,value:""},dataComprobante:Object,dataCliente:Object,dtIdCliente:{type:Number,value:33},xt_org:{type:Number},xt_idsede:{type:Number},xt_idus:{type:Number}},attached:function(){xThis=this;xdialog_comprobante=document.getElementById("dialog_cotent_comprobante");xdialog_comprobante.close();xIiniComprobante()},open:function(a){xdialog_comprobante.open()},xopen:function(){xload_Data_Consumo();xIdClienteComprobante=xThis.dtIdCliente;xDatosClienteIni();xdialog_comprobante.open()},xclose:function(){xdialog_comprobante.close()}});/*]]>*/</script>