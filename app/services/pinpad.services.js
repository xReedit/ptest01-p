const httpClient=new httpFecht,checkPinPad=async e=>{var a=URL_PINPAD+"/check",e={pinPadSN:e,xIdSede:xIdSede};return httpClient.postJson(a,e)},setUserPinPad=async e=>{var a=URL_PINPAD+"/setuser",e={pinPadSN:e,xIdSede:xIdSede};return httpClient.postJson(a,e)},loginPinPad=async e=>{var a=URL_PINPAD+"/login",e={pinPadSN:e,xIdSede:xIdSede};return httpClient.postJson(a,e)},testConnectionPinPad=async e=>{var a=URL_PINPAD+"/test",n={pinPadSN:e,xIdSede:xIdSede},t=await httpClient.postJson(a,n);return t.success||(await setUserPinPad(e),await loginPinPad(e),t=await httpClient.postJson(a,n)),t},sendTransactionPinPad=async(e,a)=>{e.currency=a||"PEN";var a=localStorage.getItem("::app3_pinpad_sn"),n=URL_PINPAD+"/transaccion",a={pinPadSN:a,xIdSede:xIdSede,transaction:e},e=await httpClient.postJson(n,a);return e.success&&sendPrinterPinPad(e.data.print_data),e},getReportePinPad=async e=>{e={operation:{detallado:"09",totales:"10",lote:"12"}[e]||"09"},e=await sendTransactionPinPad(e);return printRptTransaccionPinPad(e),e},runPorcesoCierreLotePinPad=async()=>{try{var e,a,n=await getReportePinPad("detallado");return n.success?(e=await getReportePinPad("totales")).success?(a=await getReportePinPad("lote")).success?{success:!0,message:"Pinpad - Cierre de lote realizado correctamente"}:{success:!1,message:"Pinpad - Error en cierre de lote",error:a}:{success:!1,message:"Pinpad - Error en reporte de totales",error:e}:{success:!1,message:"Pinpad - Error en reporte detallado",error:n}}catch(e){return{success:!1,message:"Pinpad - Error inesperado",error:e}}},sendReimpresionLotePinPad=async e=>{e={operation:"25",ecr_data_adicional2:e},e=await sendTransactionPinPad(e);return printRptTransaccionPinPad(e),e},saveTransactionPinPad=async(e,a,n)=>{12==a[0].id&&$.ajax({url:"../../bdphp/log_010.php?op=save-transaccion-pinpad",type:"POST",data:JSON.stringify({idregistro_pago:e,response_pinpad:n})}).done(function(e){})},sendRemovePinPad=async(e,a)=>{var e={...e,operation:"06",currency:a||"PEN"},a=URL_PINPAD+"/remove",n={pinPadSN:localStorage.getItem("::app3_pinpad_sn"),xIdSede:xIdSede,transaction:e},a=await httpClient.postJson(a,n);return a.success&&saveRemovePinPad(e),a},saveRemovePinPad=async e=>{e={idregistro_pago:e.idregistro_pago,motivo:e.motivo_anular};$.ajax({url:"../../bdphp/log_010.php?op=save-remove-pinpad",type:"POST",data:JSON.stringify(e)}).done(function(e){})},reemprimirVoucherPinPad=async e=>{var e={operation:"11",data_adicional:e},a=localStorage.getItem("::app3_pinpad_sn"),n=URL_PINPAD+"/transaccion",a={pinPadSN:a,xIdSede:xIdSede,transaction:e},e=await httpClient.postJson(n,a);return e.success&&sendPrinterPinPad(e.data.print_data),e},extractRefFromPrintData=e=>{e=e.match(/REF:(\d+)/);return e?e[1]:null},printRptTransaccionPinPad=async e=>{e.success&&sendPrinterPinPad(e.data.print_data)},sendPrinterPinPad=async e=>{var a;e&&(a=xgetImpresora(-2),xImprimirCualquierLista({impresora:a,lista:e,subtotales:[],encabezado:[]},11,"pos"))};