const httpClient=new httpFecht,checkPinPad=async a=>{var e=URL_PINPAD+"/check",n={pinPadSN:a,xIdSede:xIdSede},t=await httpClient.postJson(e,n);return t.success?t:(await setUserPinPad(a),await loginPinPad(a),httpClient.postJson(e,n))},setUserPinPad=async a=>{var e=URL_PINPAD+"/setuser",a={pinPadSN:a,xIdSede:xIdSede};return httpClient.postJson(e,a)},loginPinPad=async a=>{var e=URL_PINPAD+"/login",a={pinPadSN:a,xIdSede:xIdSede};return httpClient.postJson(e,a)},testConnectionPinPad=async a=>{var e=URL_PINPAD+"/test",n={pinPadSN:a,xIdSede:xIdSede},t=await httpClient.postJson(e,n);return t.success||(await setUserPinPad(a),await loginPinPad(a),t=await httpClient.postJson(e,n)),t},sendTransactionPinPad=async(a,e)=>{a.currency=e||"PEN";var e=localStorage.getItem("::app3_pinpad_sn"),n=URL_PINPAD+"/transaccion",e={pinPadSN:e,xIdSede:xIdSede,transaction:a},a=await httpClient.postJson(n,e);return a.success&&sendPrinterPinPad(a.data.print_data),a},getReportePinPad=async a=>{a={operation:{detallado:"09",totales:"10",lote:"12"}[a]||"09"},a=await sendTransactionPinPad(a);return printRptTransaccionPinPad(a),a},runPorcesoCierreLotePinPad=async()=>{try{var a,e,n=await getReportePinPad("detallado");return n.success?(a=await getReportePinPad("totales")).success?(e=await getReportePinPad("lote")).success?{success:!0,message:"Pinpad - Cierre de lote realizado correctamente"}:{success:!1,message:"Pinpad - Error en cierre de lote",error:e}:{success:!1,message:"Pinpad - Error en reporte de totales",error:a}:{success:!1,message:"Pinpad - Error en reporte detallado",error:n}}catch(a){return{success:!1,message:"Pinpad - Error inesperado",error:a}}},sendReimpresionLotePinPad=async a=>{a={operation:"25",ecr_data_adicional2:a},a=await sendTransactionPinPad(a);return printRptTransaccionPinPad(a),a},saveTransactionPinPad=async(a,e,n)=>{12==e[0].id&&$.ajax({url:"../../bdphp/log_010.php?op=save-transaccion-pinpad",type:"POST",data:JSON.stringify({idregistro_pago:a,response_pinpad:n})}).done(function(a){})},sendRemovePinPad=async(a,e)=>{var a={...a,operation:"06",currency:e||"PEN"},e=URL_PINPAD+"/remove",n={pinPadSN:localStorage.getItem("::app3_pinpad_sn"),xIdSede:xIdSede,transaction:a},e=await httpClient.postJson(e,n);return e.success&&(sendPrinterPinPad(e.data.print_data),saveRemovePinPad(a)),e},saveRemovePinPad=async a=>{a={idregistro_pago:a.idregistro_pago,motivo:a.motivo_anular};$.ajax({url:"../../bdphp/log_010.php?op=save-remove-pinpad",type:"POST",data:JSON.stringify(a)}).done(function(a){})},reemprimirVoucherPinPad=async a=>{var a={operation:"11",data_adicional:a},e=localStorage.getItem("::app3_pinpad_sn"),n=URL_PINPAD+"/transaccion",e={pinPadSN:e,xIdSede:xIdSede,transaction:a},a=await httpClient.postJson(n,e);return a.success&&sendPrinterPinPad(a.data.print_data),a},extractRefFromPrintData=a=>{a=a.match(/REF:(\d+)/);return a?a[1]:null},printRptTransaccionPinPad=async a=>{a.success&&sendPrinterPinPad(a.data.print_data)},sendPrinterPinPad=async a=>{var e;a&&(e=xgetImpresora(-2),xImprimirCualquierLista({impresora:e,lista:a,subtotales:[],encabezado:{nom_us:""}},11,"pos"))};