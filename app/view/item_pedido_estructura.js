function xCargarDatosAEstructuraImpresion(t,o=!1){var i,e=xm_log_get("estructura_pedido"),a=[];for(b in e.forEach(t=>{a[t.idtipo_consumo]=t}),a=JSON.parse(JSON.stringify(a).replace(/descripcion/g,"des")),e)for(var r in t)e[b].idtipo_consumo==t[r].idtipo_consumo&&1!=t[r].visible&&null!=e[b]&&(t[r].precio_print=t[r].ptotal,t[r].precio_total=t[r].ptotal,t[r].des=t[r].descripcion,o&&(-1<(i=t[r].cantidad).toString().indexOf(",")&&(i=(__cantidad=i.split(",")).reduce((t,o)=>parseFloat(t)+parseFloat(o))),t[r].cantidad=i),a[e[b].idtipo_consumo][r]=t[r]);return a.filter(t=>t)}function xEstructuraItemsJsonComprobante(t,o,i=!1,e=!1){let a=[],r=(t.filter(t=>null!==t).map(o=>{Object.keys(o).map(t=>{"object"==typeof o[t]&&((t=o[t]).grupo=e?t.des:t.iditem,a.push(t))})}),a.filter(t=>t.grupo).reduce((t,o)=>(t[grupo=o.grupo]?(t[grupo].cantidad=parseFloat(t[grupo].cantidad)+parseFloat(o.cantidad),t[grupo].precio_total=parseFloat(parseFloat(t[grupo].precio_total)+parseFloat(o.precio_total)).toFixed(2),t[grupo].precio_print=t[grupo].precio_total):(_total=!(_total=o.precio_total_calc||o.total)||-1<_total.toString().indexOf(",")?o.precio_total:_total,_total=parseFloat(_total).toFixed(2),-1<(_cantidad=o.cantidad).toString().indexOf(",")&&(_cantidad=(__cantidad=_cantidad.split(",")).reduce((t,o)=>parseFloat(t)+parseFloat(o))),t[grupo]={id:o.iditem,cantidad:parseFloat(_cantidad),des:e?o.des:o.des.split("(")[0],punitario:o.precio,precio_total:_total,precio_print:0!=parseInt(o.precio_print)?_total:o.precio_print,seccion:o.des_seccion,tipo_consumo:o.idtipo_consumo,procede:o.procede,idprocede:o.idprocede,stock_actual:o.stock_actual}),t),[])),p=(r.sort((t,o)=>(t.des>o.des)-(t.des<o.des)).sort((t,o)=>(t.seccion>o.seccion)-(t.seccion<o.seccion)),r=Object.values(r),0);return e||o.map(t=>{var o,i,e;void 0!==t.id&&0!==t.id&&!0!==t.tachado&&"1"!==t.esImpuesto.toString()&&(o=0<=t.id.toString().indexOf("a")?"ADICIONALES":"SERVICIOS",i=t.punitario?parseFloat(t.punitario):parseFloat(t.importe),i=parseInt(parseFloat(t.importe)/i),e=r.length+1,p=t.importe,r.push({id:e.toString(),cantidad:i,des:t.descripcion.toUpperCase(),punitario:t.punitario,precio_total:t.importe,seccion:o}))}),i&&(p=parseFloat(o[0].importe)+parseFloat(p),o[0].importe=xMoneda(p)),r}function xEstructuraItemsJsonPedidoDelivery(t,a=!0){var r=xm_log_get("estructura_pedido"),p=[];r.forEach(t=>{p[t.idtipo_consumo]=t}),p=JSON.parse(JSON.stringify(p).replace(/descripcion/g,"des"));let i=[];return t.tipoconsumo.map(o=>{o.secciones.map(t=>t.items.map(t=>{t.id=t.iditem,t.des_seccion=t.seccion,t.punitario=t.precio_unitario,t.cantidad=t.cantidad_seleccionada,t.idtipo_consumo=o.idtipo_consumo,i.push(t)}))}),i.filter(t=>t.visible).map((o,t)=>{var i,e=r.find(t=>t.idtipo_consumo==o.idtipo_consumo);e&&(a&&(-1<(i=o.cantidad).toString().indexOf(",")&&(i=(__cantidad=i.split(",")).reduce((t,o)=>parseFloat(t)+parseFloat(o))),o.cantidad=i),p[e.idtipo_consumo][o.id]=o)}),p.filter(t=>t)}function xEstructuraItemsAgruparPrintJsonComprobante(t){return xEstructuraItemsGroupFormatoImpresion(t,"seccion")}function xEstructuraItemsGroupFormatoImpresion(t,o){t.des="**";var i={};return i[0]=t,i}