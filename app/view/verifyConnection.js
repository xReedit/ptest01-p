var connection,type,comprobantdoConexion=!1,restaurandoConexion=!1;try{type=(connection=navigator.connection||navigator.mozConnection||navigator.webkitConnection).effectiveType,connection.addEventListener("change",activarChangeConection)}catch(o){}var _num_intentos_conexion=0;async function updateConnectionStatusFocus(){await comprobarConexion();var o=xm_log_get("app3_us")._sys_sessid;await restoreConexion(o)&&(resotreLocalSotrage(),xm_all_xToastOpen("Verificando conexion",2e3))}async function updateConnectionStatus(){var o,n;1<_num_intentos_conexion?_num_intentos_conexion=0:comprobantdoConexion||(o=getLocalStorage("::app3_sys_no_conex")||!1,(n=await comprobarConexion())||setTimeout(()=>{_num_intentos_conexion++,updateConnectionStatus()},2500),n?o&&(removeLocalStorage("::app3_sys_no_conex"),n=xm_log_get("app3_us")._sys_sessid,xm_all_xToastOpen("Recuperando conexion",3e3),await restoreConexion(n))&&(resotreLocalSotrage(),removeLocalStorage("::app3_sys_no_conex")):(setLocalSotrage("::app3_sys_no_conex",!0),bkLocalStorage()))}function activarChangeConection(){setTimeout(()=>{updateConnectionStatus()},3e3)}async function comprobarConexion(){let n=!1;return comprobantdoConexion=!0,await fetch("../../bdphp/log_run.php?op=3").then(function(o){return o.json()}).then(o=>{n=0!==o.id}).catch(function(o){n=!1}),comprobantdoConexion=!1,n}async function restoreConexion(o){return restaurandoConexion=!1,await $.ajax({type:"POST",url:"../../bdphp/log.php?op=-1",data:{sys_data:o}}).done(function(o){restaurandoConexion=!0}),restaurandoConexion}window.addEventListener("focus",function(o){var n=new Date,e=new Date(getLocalStorage("::app3_sys_backup_time"));Math.round((n.getTime()-e.getTime())/6e4)<3||setTimeout(()=>{updateConnectionStatusFocus()},300)}),$(window).blur(function(){bkLocalStorage()});