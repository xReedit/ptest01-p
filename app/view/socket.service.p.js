var socketCP=socketService.getInstance();function _cpSocketOpen(){this.socketCP._socket?this.socketCP._socket.connected||(this.socketCP.disconnectSocket(),setTimeout(()=>{this.socketCP.connectSocket(),this.listenSocketP()},2e3)):(this.socketCP.connectSocket(),this.listenSocketP())}function listenSocketP(){setTimeout(()=>{$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=14",data:{socketId:this.socketCP._socket.id}})},1200),this.socketCP.listen("nuevoPedido").subscribe(e=>{try{_cpSocketPintarPedido(e),"1"==e.p_header.delivery.toString()&&xCDAddItemRow(e)}catch(e){}}),this.socketCP.listen("itemModificado").subscribe(e=>{try{_cpStockItemModificado(e)}catch(e){}}),this.socketCP.listen("itemResetCant").subscribe(e=>{try{_cpStockItemModificado(e)}catch(e){}}),this.socketCP.listen("printerOnly").subscribe(e=>{try{_cpSocketPintarPedido(e),"1"==e.delivery.toString()&&xCDAddItemRow(e)}catch(e){}}),this.socketCP.listen("notificar-pago-pwa").subscribe(e=>{try{e.isdelivery||_cpSocketPintarPedido(null),_cpSocketPintarNumerosPagosNotificados(),pNotificaPago(e)}catch(e){}}),this.socketCP.listen("notificar-cliente-llamado").subscribe(e=>{try{pNotificaPersonal(e)}catch(e){}}),this.socketCP.listen("notifica-impresion-precuenta").subscribe(e=>{try{_cpSocketPintarPedido(null)}catch(e){}}),this.socketCP.listen("notifica-impresion-comanda").subscribe(e=>{}),this.socketCP.listen("restobar-notifica-pay-pedido-res").subscribe(e=>{try{xRefreshPedidoPaySocket(e)}catch(e){}}),this.socketCP.listen("restobar-permiso-cierre-remoto-respuesta").subscribe(e=>{try{xCajaResPermisoRemoto(e)}catch(e){}}),this.socketCP.listen("restobar-venta-registrada-res").subscribe(e=>{this.socketCP.isRegistroVentaSource.next(!0)}),this.socketCP.listen("repartidor-notifica-cliente-acepto-pedido-res").subscribe(e=>{xCDUpdateViewItem("repartidor",e)}),this.socketCP.listen("repartidor-notifica-fin-pedido").subscribe(e=>{xCDUpdateViewItem("repartidor-entregado",{idpedido:e})}),this.socketCP._listen("restobar-permiso-remove-producto-mesa",e=>{xCPAddClassItemPermissionDelete(e.idpedido_detalle),pNotificaSolicitudAceptada(e),saveStorageSolicitudPermisoRemota(e)}),this.socketCP._listen("restobar-permiso-remove-pedido-mesa",e=>{xCPAddClassItemPermissionAnularPedido(e.idpedido),pNotificaSolicitudAceptada(e),saveStorageSolicitudPermisoRemota(e)}),this.socketCP._listen("restobar-permiso-change-metodo-pago",e=>{xRPRemoverPuntoFlotanteVerde(e.data.data.idregistro_pago_detalle),pNotificaSolicitudAceptada(e),saveStorageSolicitudPermisoRemota(e)}),this.socketCP._listen("restobar-permiso-cerrar-caja",e=>{pNotificaSolicitudAceptada(e),e.idusuario_solicita=e.data.idusuario_solicita,e.importe_sistema=e.data.data.importe_2,e.diferencia=(parseFloat(e.data.data.importe_1)-parseFloat(e.data.data.importe_2)).toFixed(2),e.diferecia_color=e.diferencia<0?"red":"green",xCajaResPermisoRemoto(e)})}function _cpSocketprinterOnly(e){this.socketCP.emit("printerOnly",e)}function _cpSocketEmitItemModificado(e){getVariableSede("update_stock_after")?"ND"!=e.isporcion&&_cpStockItemModificado(e):this.socketCP.emit("itemModificado",e)}function _cpSocketEmitItemAllModificado(e){this.socketCP.emit("itemAllModificado",e)}function _cpSocketEmitPrinterOnly(e){this.socketCP.emit("printerOnly",e)}function _cpSocketEmitPrinterPrecuenta(e){this.socketCP.emit("notificar-impresion-precuenta",e)}function _cpSocketClose(){try{if(!isSocket)return}catch(e){}try{this.socketCP.disconnectSocket()}catch(e){}}function _cpSocketNoiticaRepartidorFromComercio(e){this.socketCP.emit("set-repartidor-pedido-asigna-comercio",e)}function _cpSocketNoiticaClienteRepartidorAsignado(e){this.socketCP.emit("repartidor-notifica-cliente-acepto-pedido",e)}function _cpSocketComercioLLamaRepartidorPapaya(){this.socketCP.emit("set-solicitar-repartidor-papaya",null)}function _cpSocketEmitPedidoPagoCliente(e){this.socketCP.emit("pedido-pagado-cliente",e)}function _cpSocketSavePedidoStorage(e){isSocket&&localStorage.setItem("::app3_sys_dta_pe_sk",JSON.stringify(e))}function _cpSocketComprobanteWhatApp(e){this.socketCP.emit("restobar-send-comprobante-url-ws",e)}function _cpSocketCuponWhatsApp(e){this.socketCP.emit("restobar-send-cupones-ws",e)}function _cpSocketSendWhatAppPermisoAdmin(e){this.socketCP.emit("restobar-send-msj-ws-solicitud-permiso",e)}function _cpSocketRestoreFromPedidoStorage(){var e,t;getVariableSede("update_stock_after")||isSocket&&(e=localStorage.getItem("::app3_sys_dta_pe_sk")?JSON.parse(localStorage.getItem("::app3_sys_dta_pe_sk")):null,t=[],e&&e.filter(e=>null!==e).map(e=>{Object.values(e).filter(e=>"object"==typeof e).map(e=>{"ND"!=e.isporcion&&(e.idcarta_lista=e.iditem,e.cantidad_seleccionada=e.cantidad,e.isalmacen="0"===e.procede.toString()?1:0,e.isporcion="SP"!=e.isporcion?e.cantidad:e.isporcion,e.subitems_view=JSON.parse(JSON.stringify(e.subitems_view)),t.push(e))})}),0<t.length&&this.socketCP.emit("resetPedido",t),localStorage.removeItem("::app3_sys_dta_pe_sk"),t=[])}function _cpSocketClearStorage(){isSocket&&localStorage.removeItem("::app3_sys_dta_pe_sk")}function _cpASocketNotifyPayPedido(e){this.socketCP.emit("restobar-notifica-pay-pedido",e),e.idpedido=e.num_pedido,xCDRemoveItemRow(e)}function _cpSocketPermisoCierreRemotoEnviarRpt(e){this.socketCP.emit("restobar-permiso-cierre-remoto-respuesta",e)}function _cpSocketVentaRegistrado(){this.socketCP.emit("restobar-venta-registrada"),this.socketCP.isRegistroVentaSource.next(!0)}