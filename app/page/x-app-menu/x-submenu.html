<link rel="import"href="x-mipedido.html"><link rel="import"href="x-menu.html"><dom-module id="x-submenu"><script src="../../view/item_pedidos.js"></script><template><div id="contenedor-x"class="dis-flex"><div class="xBordeDe2 xNoVisibleMenos720 posLinePedido"><x-menu small-page="true"></x-menu><div class="xNoVisibleMenos920"><br><br><br></div></div><div class="div_submenu_p"><div class="xSubMenu_body"id="_xSubMenu_body"><div class="xAlinearCentro spinner"><paper-spinner active></paper-spinner></div></div><div class="xNoVisibleMenos920"><br><br><br></div></div><div class="xBordeIz2 xNoVisibleMenos720 xNoVisibleMenos920 posLinePedido"><x-mipedido id="mipedido-view"></x-mipedido></div></div></template><style>.posLinePedido{position:relative;width:41%;height:calc(100vh - 60px);overflow-y:auto}</style></dom-module><script>var xThis,xTituloDet,xArrayPedidoObj,xidItem_selected,xreloj_update_subItem_sel,xobj_row_selected,xCadenaTC="",xdt_sub_Item=[],isSocket=!1;function xxaa(){}function xCallMiPedidoSize(){}function xIniSubMenu(){xArrayPedidoObj=$.parseJSON(window.localStorage.getItem("::app3_sys_dta_pe")),xArmarMenuLateral(2),xCadenaTC=xArmarTipoConsumo(),setTimeout(()=>{xLoadItems()},100),$(document.body).on("click","#_xSubMenu_body div.xmenu_item_2",function(e){var a,d,t=(xobj_row_selected=$(this)).data("index");return(itemPedidos_objItemSelected=xdt_sub_Item[t]).stock_actual=itemPedidos_objItemSelected.cantidad,1==xobj_row_selected.find("input:radio")[0].disabled?(e.stopPropagation(),e.stopImmediatePropagation()):(a=((objOptionItemSelect=xobj_row_selected.find("input:radio")[0]).checked=!0,xVerificarCheckItem(),""),xTituloDet=itemPedidos_objItemSelected.des_seccion,xidItem=itemPedidos_objItemSelected.idcarta_lista,_xcantidad=itemPedidos_objItemSelected.cantidad,xidItem_selected=xidItem,xobj_row_selected.find(".xpedir_row").each(function(e,t){d=$(t).attr("data-id"),null!=xArrayPedidoObj[d][xidItem]&&(xidTipoConsumo=d,d=xArrayPedidoObj[xidTipoConsumo][xidItem].cantidad,a=xArrayPedidoObj[xidTipoConsumo][xidItem].indicaciones||"",itemPedidos_objItemSelected.xCant_item=xCeroIzq(d,2),itemPedidos_objItemSelected.xindicaciones=a,$(t).find(".xCant_item").text(xCeroIzq(d,2)))}),xobj_row_selected.find("#txt_referencia").val(a),e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault(),"ND"!==_xcantidad&&xUpdateStockSubItem_selected()),!1})}function xVerificarCheckItem(){$("#_xSubMenu_body div.xmenu_item_2 .xcheck_item").each(function(e,t){$(t).is(":checked")?$(this).parent().addClass("xitem_seleccionado"):$(this).parent().removeClass("xitem_seleccionado")})}async function xLoadItems(){$("#_xSubMenu_body").html('<div class="xAlinearCentro spinner"><paper-spinner active></paper-spinner></div>').trigger("create"),xTituloDet=window.localStorage.getItem("::app3_sys_dt_c"),$("#xtitulo_bar").text(xTituloDet);var e=JSON.parse(window.localStorage.getItem("::app3_sys_dt_back"));xidCatProcedencia=e.p,$.ajax({type:"POST",url:"../../bdphp/log.php?op=2042",data:e}).done(function(e){xdt_sub_Item=JSON.parse(e),xCadenaItem="",xCadenaItem_encabezado="",xCadenaItem_des_foto="",xCadena_foto="",xCadena_des="",xCadenaItem_Detalle="",xCantItem=0,xCheck_desactivado="",xClassEstadoStock="",xdt_sub_Item=xdt_sub_Item.datos,xCadenaTC=xArmarTipoConsumo();for(var t=0;t<xdt_sub_Item.length;t++)xCheck_desactivado="",xCantItem=xdt_sub_Item[t].cantidad,xClassEstadoStock=xClassEstadoItem(xCantItem),xClassEstado=xClassEstadoStock.split("|")[0],xClassEstadoStock=xClassEstadoStock.split("|")[1],xCantItem<=0&&(xCheck_desactivado="disabled"),xCadenaItem_encabezado='<input class="xcheck_item" type="radio" name="option" data-index='+t+' value="other" '+xCheck_desactivado+'><p class="xprecio_item xEnLinea">'+xdt_sub_Item[t].precio+'</p><div id class="xstock_item '+xClassEstadoStock+'"><span>stock</span><p class="num_stock">'+xCeroIzq(xCantItem,2)+'</p></div><p class="xtitulo_item xEnLinea">'+xdt_sub_Item[t].des_item+"</p>",(xCadenaItem_des_foto="")!=xdt_sub_Item[t].img&&(xCadena_foto='<img src="../img/'+xdt_sub_Item[t].img+'">',xCadenaItem_des_foto="1"),""!=xdt_sub_Item[t].detalle&&(xCadena_des='<div class="xsub_titulo_item">'+xMayusculaPrimera(xdt_sub_Item[t].detalle)+"</div>",xCadenaItem_des_foto="1"),xCadenaItem_des_foto="1"==xCadenaItem_des_foto?'<div class="xdescripcion_foto">'+xCadena_des+xCadena_foto+"</div>":"",xCadenaItem_Detalle='<div class="xdetalle_item">'+xCadenaItem_des_foto+'<div class="xreferencia_item"><input type="text" autocomplete="on" placeholder="Escribe aqui las especificaciones..." class="xMiTextReferencia" id="txt_referencia"></div>'+xCadenaTC+"</div></div>",xCadenaItem=String(xCadenaItem+'<div onclick="xxaa();" class="xmenu_item_2 xPading10 '+xClassEstado+'" data-id="'+xdt_sub_Item[t].idcarta_lista+'" data-index='+t+' data-item="'+xdt_sub_Item[t].iditem+'" data-idseccion="'+xdt_sub_Item[t].idseccion+'" data-idseccionindex="'+xdt_sub_Item[t].idseccion_index+'" data-desseccion="'+xdt_sub_Item[t].des_seccion+'" data-cantidad="'+xdt_sub_Item[t].cantidad+'"  data-idimpresora="'+xdt_sub_Item[t].idimpresora+'" data-idprocede="'+xdt_sub_Item[t].idprocede+'" data-procede="'+xdt_sub_Item[t].procede+'" data-procedeindex="'+xdt_sub_Item[t].procede_index+'" data-imprimircomanda="'+xdt_sub_Item[t].imprimir_comanda+'" data-iddescontar="'+xdt_sub_Item[t].idprocede+'" data-cant_descontar="'+xdt_sub_Item[t].cant_descontar+'" data-idalmacen_items="'+xdt_sub_Item[t].idalmacen_items+'">'+xCadenaItem_encabezado+xCadenaItem_Detalle);$("#_xSubMenu_body div").remove(),$("#_xSubMenu_body .spinner").remove(),$("#_xSubMenu_body").append(xCadenaItem).trigger("create"),$(window).scrollTop(window.localStorage.getItem("::app3_sys_scroll_pos")||0)})}function xUpdateStockSubItem_selected(){"almacen_items"==xidCatProcedencia&&(xidItem_selected=$(xobj_row_selected).attr("data-idalmacen_items")),$.ajax({type:"POST",url:"../../bdphp/log.php?op=2043",data:{i:xidItem_selected,p:xidCatProcedencia}}).done(function(e){xClassEstadoStock=xClassEstadoItem(e),xClassEstado=xClassEstadoStock.split("|")[0],xClassEstadoStock=xClassEstadoStock.split("|")[1],$(xobj_row_selected).addClass(xClassEstado),$(xobj_row_selected).find(".xstock_item").addClass(xClassEstadoStock),$(xobj_row_selected).find(".num_stock").text(xCeroIzq(e,2))})}Polymer({is:"x-submenu",properties:{xt_org:Number,xt_idsede:Number,xt_idus:Number},attached:function(){xThis=this,xIniSubMenu()},detached:function(){}})</script>