<dom-module id="x-buscar.submenu"><script src="../../view/item_pedidos.js"></script><template><div id="contenedor-x"class="dis-flex"><div class="xBordeDe2 posLinePedido xNoVisibleMenos720"><x-menu small-page="true"></x-menu><div class="xNoVisibleMenos920"><br><br><br></div></div><div class="div_submenu_p"><div><input class="xMiInput xfont18 xBold"style="padding:10px"placeholder="Buscar"id="txt_parametro"onclick="this.select()"><div class="xLinea7"></div><div class="xLineaSombra"></div></div><div class="xMenu_body_buscar"id="_xSubMenu_body"><div class="xAlinearCentro spinner"><paper-spinner active></paper-spinner></div></div></div><div class="xBordeIz2 xNoVisibleMenos720 xNoVisibleMenos920 posLinePedido"><x-mipedido id="mipedido-view"></x-mipedido></div></div></template></dom-module><style>.posLinePedido{position:relative;width:41%;height:calc(100vh - 60px);overflow-y:auto}</style><script>var xThisBuscarSubMenu,xTituloDet,xArrayPedidoObj,xidItem_selected,xreloj_update_subItem_sel,xobj_row_selected,xidCatProcedencia,xdt_sub_Item,xCadenaTC="",isSocket=!1;function xxaa2(){}function xIniBuscarSubMenu(){xArrayPedidoObj=$.parseJSON(window.localStorage.getItem("::app3_sys_dta_pe")),xArmarMenuLateral(2),xCadenaTC=xArmarTipoConsumo(),xLoadItemsBusquedaSubMenu(),$("#txt_parametro").keyup(delay(function(e){xLoadItemsBusquedaSubMenu()},600)),$(document.body).on("click","#_xSubMenu_body div.xmenu_item_2",function(e){var t=(xobj_row_selected=$(this)).data("index");if((itemPedidos_objItemSelected=xdt_sub_Item[t]).stock_actual=itemPedidos_objItemSelected.cantidad,1==xobj_row_selected.find("input:radio")[0].disabled)return e.stopPropagation(),e.stopImmediatePropagation(),!1;xobj_row_selected.find("input:radio")[0].checked=!0,_busqueda_xVerificarCheckItem();var d,a="";return xTituloDet=itemPedidos_objItemSelected.des_seccion,xidItem=itemPedidos_objItemSelected.idcarta_lista,_xcantidad=itemPedidos_objItemSelected.cantidad,xidItem_selected=xidItem,xobj_row_selected.find(".xpedir_row").each(function(e,t){d=$(t).attr("data-id"),null!=xArrayPedidoObj[d][xidItem]&&(xidTipoConsumo=d,d=xArrayPedidoObj[xidTipoConsumo][xidItem].cantidad,a=xArrayPedidoObj[xidTipoConsumo][xidItem].indicaciones,$(t).find(".xCant_item").text(xCeroIzq(d,2)))}),xobj_row_selected.find("#txt_referencia").val(a),e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault(),"ND"!==_xcantidad?(clearInterval(xreloj_update_subItem_sel),_Busqueda_xUpdateStockSubItem_selected(),xreloj_update_subItem_sel=setInterval(function(){_Busqueda_xUpdateStockSubItem_selected()},5e3),!1):void 0})}function _busqueda_xVerificarCheckItem(){$(".xmenu_item_2 .xcheck_item").each(function(e,t){$(t).is(":checked")?$(this).parent().addClass("xitem_seleccionado"):$(this).parent().removeClass("xitem_seleccionado")})}function xLoadItemsBusquedaSubMenu(){$(".xMenu_body_buscar").html('<div class="xAlinearCentro spinner"><paper-spinner active></paper-spinner></div>').trigger("create"),$("#xtitulo_bar").text("Buscar");var e=txt_parametro.value;$.ajax({type:"POST",url:"../../bdphp/log.php?op=2053",data:{i:xidCategoria,parametro:e}}).done(function(e){var t,d,a="",i="",s="",o="",c="",_="";xdt_sub_Item=(xdt_sub_Item=$.parseJSON(e)).datos;for(var n=0;n<xdt_sub_Item.length;n++)c="",d=xdt_sub_Item[n].cantidad,_=xClassEstadoItem(d),xClassEstado=_.split("|")[0],_=_.split("|")[1],d='<input class="xcheck_item" type="radio" name="option" data-index='+n+' value="other" '+(c=d<=0?"disabled":c)+'><p class="xprecio_item xEnLinea">'+xdt_sub_Item[n].precio+'</p><div id class="xstock_item '+_+'"><span>stock</span><p class="num_stock">'+xCeroIzq(d,2)+'</p></div><p class="xtitulo_item xEnLinea">'+xdt_sub_Item[n].des_item+"</p>",(i="")!=xdt_sub_Item[n].img&&(s='<img src="../img/'+xdt_sub_Item[n].img+'">',i="1"),""!=xdt_sub_Item[n].detalle&&(o='<div class="xsub_titulo_item">'+xMayusculaPrimera(xdt_sub_Item[n].detalle)+"</div>",i="1"),t='<div class="xdetalle_item">'+(i="1"==i?'<div class="xdescripcion_foto">'+o+s+"</div>":"")+'<div class="xreferencia_item"><input type="text" autocomplete="on" placeholder="Escribe aqui las especificaciones..." class="xMiTextReferencia" id="txt_referencia"></div>'+xCadenaTC+"</div></div>",a=String(a+'<div onclick="xxaa2();" class="xmenu_item_2 xPading10 '+xClassEstado+'" data-index='+n+' data-id="'+xdt_sub_Item[n].idcarta_lista+'" data-item="'+xdt_sub_Item[n].iditem+'" data-idseccion="'+xdt_sub_Item[n].idseccion+'" data-idseccionindex="'+xdt_sub_Item[n].idseccion_index+'" data-desseccion="'+xdt_sub_Item[n].des_seccion+'" data-cantidad="'+xdt_sub_Item[n].cantidad+'" data-idimpresora="'+xdt_sub_Item[n].idimpresora+'" data-idprocede="'+xdt_sub_Item[n].idprocede+'" data-procede="'+xdt_sub_Item[n].procede+'" data-procedeindex="'+xdt_sub_Item[n].procede_index+'" data-imprimircomanda="'+xdt_sub_Item[n].imprimir_comanda+'" data-iddescontar="'+xdt_sub_Item[n].idprocede+'" data-cant_descontar="'+xdt_sub_Item[n].cant_descontar+'" data-idalmacen_items="'+xdt_sub_Item[n].idalmacen_items+'">'+d+t);$("#_xSubMenu_body div").remove(),$("#_xSubMenu_body .spinner").remove(),$("#_xSubMenu_body").append(a).trigger("create"),$(window).scrollTop(window.localStorage.getItem("::app3_sys_scroll_pos")||0)})}function _Busqueda_xUpdateStockSubItem_selected(){"1"!==(xidCatProcedencia=$(xobj_row_selected).attr("data-procede"))&&(xidItem_selected=$(xobj_row_selected).attr("data-idalmacen_items")),$.ajax({type:"POST",url:"../../bdphp/log.php?op=2043",data:{i:xidItem_selected,p:xidCatProcedencia}}).done(function(e){xClassEstadoStock=xClassEstadoItem(e),xClassEstado=xClassEstadoStock.split("|")[0],xClassEstadoStock=xClassEstadoStock.split("|")[1],$(xobj_row_selected).addClass(xClassEstado),$(xobj_row_selected).find(".xstock_item").addClass(xClassEstadoStock),$(xobj_row_selected).find(".num_stock").text(xCeroIzq(e,2))})}Polymer({is:"x-buscar.submenu",properties:{xt_org:Number,xt_idsede:Number,xt_idus:Number},attached:function(){xThisBuscarSubMenu=this,xIniBuscarSubMenu()},detached:function(){clearInterval(xreloj_update_subItem_sel)}})</script>