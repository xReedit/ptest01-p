<dom-module id="x-promociones"><template><br><div class="xMiCard xradius"style="width:85%"><div class="xEncanezadoCard xFondoRowAmarillo4"><p><strong>Combos y promociones.</strong><br>Seleccione un item de la carta e indique los item, productos o porciones que contiene.<p>Luego indique los dias la hora y el precio.</div><div class="xContentCard"><div class="x_div_linea"><div class="xitem1 xBordeDe"><p><strong>Item de la Carta</strong><form id="frm_item"><input id="item_des_carta"class="xMiInput xPasarEnter2 xDesItem"style="width:90%"placeholder="item de carta"onchange="conMayusculas(this)"required id="des_item_porcionar"espaciar> <input type="number"class="xMiInput _xcant"style="width:50%"placeholder="Cantidad"onchange="conMayusculas(this)"required id="txt_precio_item"espaciar><br><br></form></div><div class="xitem2"><p><strong>Lo que contiene</strong><table class="xtable4"width="100%"id="tb_contiene"data-tablaname="porcion"><thead><th class="xSinBorde"width="60%"><th class="xSinBorde"width="10px"><th class="xSinBorde"width="10px"></thead><tr class="xSinBorde"data-id=""><td><input id="des_all_item"class="xMiInput xPasarEnter2 xDesItem"placeholder="Descripcion"onchange="conMayusculas(this)"required><td><input type="number"class="xMiInput _xcant"placeholder="Cantidad"onchange="conMayusculas(this)"id="cant_all_item"required><td><paper-fab icon="add"onclick="addItemContiene()"title="Agregar item"class="xmini"></paper-fab></tr><template is="dom-repeat"items="{{listItemContiene}}"as="item"><tr data-index="[[index]]"><td>{{item.descripcion}}<td>{{item.cantidad}}<td><span class="xDeleteRowNeutro"title="Borrar"onclick="xBorrarItemAllLocal(this)"></span></template></table><br><br><div class="xLinea2"></div><br><p><strong>Tiempo y precio</strong></p><br><paper-checkbox data-index="1"data-dia="LUN"class="check-d">LUN</paper-checkbox><paper-checkbox data-index="2"data-dia="MAR"class="check-d">MAR</paper-checkbox><paper-checkbox data-index="3"data-dia="MIE"class="check-d">MIE</paper-checkbox><paper-checkbox data-index="4"data-dia="JUE"class="check-d">JUE</paper-checkbox><paper-checkbox data-index="5"data-dia="VIE"class="check-d">VIE</paper-checkbox><paper-checkbox data-index="6"data-dia="SAB"class="check-d">SAB</paper-checkbox><paper-checkbox data-index="7"data-dia="DOM"class="check-d">DOM</paper-checkbox><br><br><div id="div-hora"><input style="width:100px"class="xMiInput xPasarEnter2"placeholder="Hora Inicio"id="h_ini"required> <input style="width:100px"class="xMiInput xPasarEnter2"placeholder="Hora Fin"id="h_fin"required> <input style="width:100px"class="xMiInput xPasarEnter2"placeholder="Precio"id="precio"required><paper-fab icon="add"onclick="xAddTiempoPrecio()"title="Agregar item"class="xmini"></paper-fab></div><br><br><table class="xtable4"width="100%"id="tb_precio"data-tablaname="porcion"><thead><th class="xSinBorde"width="40%">Dias<th class="xSinBorde"width="20px">H.Ini<th class="xSinBorde"width="20px">H.Fin<th class="xSinBorde"width="20px">Precio<th class="xSinBorde"width="10px">.</thead><template is="dom-repeat"items="{{listDayPrecio}}"as="item"><tr data-index="[[index]]"><td>{{item.dias}}<td>{{item.h_ini}}<td>{{item.h_fin}}<td>{{item.precio}}<td><span class="xDeleteRowNeutro"title="Borrar"onclick="xBorrarItemAllLocal(this)"></span></template></table></div></div><br><br><br><div class="xInvisible"><table id="tb_almacen_items"data-tablaname="almacen_items"></table></div></div><div class="xPieCard"><br><div class="xBoton2 xAzul xDerecha">Listo, guardar</div><br><br></div></div></template></dom-module><script>var xThisProm,_listItemContiene,_listDayPrecio,xidproducto_porcionado=0,xtt_ingredientes=0,xes_nuevo_item=0,xid_item="";function xIniPromociones(){xPopupLoad=document.getElementById("xLoad"),xm_LogChequea(function(){xm_log_get("ini_us"),$("body").addClass("loaded"),$("#Titulo_page").text("Ofertas y Combos"),xLoadItemsCategoria(),_listItemContiene=[],_listDayPrecio=[],xThisProm.listItemContiene=[],xThisProm.listDayPrecio=[]}),$(".xPasarEnter2").on("keyup",function(e){var t=e.which;if(13==t||186==t){var t=$("input"),i=t.index(document.activeElement);if(null!==t[i+1]){var a=t[i+1];if(void 0===a)return;if(null==(a=a.disabled?t[i+2]:a))return;a.focus(),a.select()}return event.stopPropagation(),e.stopPropagation(),e.stopImmediatePropagation(),!1}}),$("#costo_item").on("keyup",function(e){e=e.which;13!=e&&186!=e||xAddItemIngrediente()}),$("#txt_bus").on("keyup",function(){xBuscarTbData($("#tb_platos"),$(this).val())}),$("#txt_precio").on("keyup",function(e){xRefreshImportes();e=e.which;13!=e&&186!=e||$("#des_porcion").focus()}),$("#cant_all_item").on("keyup",function(e){e=e.which;13!=e&&186!=e||addItemContiene()})}function xLoadItemsCategoria(){xPopupLoad.titulo="Cargando...",xPopupLoad.xopen(),$.ajax({type:"POST",url:"../../bdphp/log.php?op=2"}).done(function(e){var t=$.parseJSON(e);xThisProm.dt_item=t.datos,xCargarEnInputItem(),$.ajax({type:"POST",url:"../../bdphp/log.php?op=2021"}).done(function(e){t=$.parseJSON(e),xThisProm.dt_all_item=t.datos,xCargarEnInputAllItem()}),xPopupLoad.xclose()})}function xCargarEnInputItem(){var e=xThisProm.dt_item,i=$("#item_des_carta");i.autocomplete({autoFocus:!0,source:e,select:function(e,t){return i.val(t.item.label),i.attr("data-value",t.item.value),i.parents().find("#txt_precio_item").val(t.item.precio),!1},focus:function(e,t){return!1},change:function(e,t){return null===t.item&&(i.attr("data-value",""),i.parents().find("#txt_precio_item").val(t.item.precio)),!1}})}function xCargarEnInputAllItem(){var e=xThisProm.dt_all_item,i=$("#des_all_item");i.autocomplete({autoFocus:!0,source:e,select:function(e,t){return i.val(t.item.label),i.attr("data-value",t.item.value),i.attr("data-procede_tabla",t.item.procede_tabla),!1},focus:function(e,t){return!1},change:function(e,t){return null===t.item&&i.attr("data-value",""),!1}})}function addItemContiene(){var e;""!==cant_all_item.value&&""!==des_all_item.value&&(e=cant_all_item.value,e={id:des_all_item.dataset.value,procede:des_all_item.dataset.procede_tabla,descripcion:des_all_item.value,cantidad:e},_listItemContiene.push(e),xThisProm.listItemContiene=JSON.parse(JSON.stringify(_listItemContiene)),cant_all_item.value="",des_all_item.value="")}function xBorrarItemAllLocal(e){var t=e.parentElement.parentElement.dataIndex;delete(_listItemContiene=xThisProm.listItemContiene)[t],xThisProm.listItemContiene=JSON.parse(JSON.stringify(_listItemContiene)),xBorrarItem(e)}function xAddTiempoPrecio(){var i=[],a=[],e=($(".check-d").each((e,t)=>{t.checked&&(a.push(t.dataset.dia),i.push(t.dataset.index))}),{idDias:i.join(","),dias:a.join(","),h_ini:h_ini.value,h_fin:h_fin.value,precio:xMoneda(precio.value)});_listDayPrecio.push(e),xThisProm.listDayPrecio=JSON.parse(JSON.stringify(_listDayPrecio))}Polymer({is:"x-promociones",properties:{dt_item:Object,dt_all_item:Object,dtProItem_porcion:Object,listItemContiene:[],listDayPrecio:[]},attached:function(){xThisProm=this,xIniPromociones()}})</script>