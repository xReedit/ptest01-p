<dom-module id="x-compras-list"><template><h4>Seleccione Mes</h4><input type="month"class="selected-template-1 xCursor"id="txt_list_compra_fecha_compra"placeholder="Elige fecha"><br><br><div class="xLinea2"></div><br><div class="grid-container"><div class="column1"><div class="column-title"><p>Compras</div><table class="w-100 fs-12"><thead><th>#<th>Fecha<th align="right">Improte<tbody><template is="dom-repeat"items="{{listComprasByMonth}}"as="item"><tr class$="{{item.classRow}}"onclick="listComprasByMonthDetalle(this)"data-id="{{item.idcompra}}"><td>{{displayIndex(index)}}<td><p class="fw-600">{{ item.nom_proveedor }}<p class="fw-100 fs-10 text-secondary">{{item.f_compra}} | {{item.nom_tipo_pago}}<td align="right">{{item.total}}</template><tr><td colspan="3"align="right"><p class="fw-600 fs-15">{{totalCompras}}</table></div><div class="column2"><div class="column-title d-flexx justify-content-between align-items-center"><p>Productos</div><div><div class="fs-12"style="padding:12px"><p><strong>Proveedor:</strong> {{objCompraSeleted.nom_proveedor}}<div class="d-flexx"><div class="mr-2"><p><strong>F. Compra:</strong> {{objCompraSeleted.f_compra}}<p><strong>Forma de pago:</strong> {{objCompraSeleted.nom_tipo_pago}}</div><div><p><strong>Almacen que ingresa:</strong> {{objCompraSeleted.nom_almacen}}<p><strong>Usuario:</strong> {{objCompraSeleted.nom_usuario}}</div></div><p><strong>Anotaciones:</strong> {{objCompraSeleted.nota_de_compra}}</div><table class="w-100 fs-12"><thead><th>Producto<th align="right">Cantidad<th align="right">P.Unitario<th align="right">Total<tbody><template is="dom-repeat"items="{{listProductosByCompra}}"as="item"><tr><td>{{item.nom_producto}}<td align="right">{{item.cantidad}}<td align="right">{{item.punitario}}<td align="right">{{item.total}}</template><tr><td colspan="4"align="right"><p class="fw-600 fs-15">{{totalProductos}}</table></div></div></div></template><style>.grid-container{display:grid;grid-template-columns:minmax(270px,350px) auto;gap:10px}.column1{border:1px solid #ccc;border-radius:5px}.column2{border:1px solid #ccc;border-radius:5px}.column-title{border-radius:5px 5px 0 0;color:#fff!important;padding:5px 10px 5px 10px;background:#424242;height:30px;justify-content:space-between;display:flex;align-items:center}@media (max-width:767px){.grid-container{grid-template-columns:1fr}.column2{margin-top:10px}}</style><script>var xThisComprasList,valDateMonthShowListCompras="";async function xInitComprasList(){xLoadListComprasByMonth(null),xPopupLoad.xopen(),$("#txt_list_compra_fecha_compra").on("change",function(){valDateMonthShowListCompras!=$(this).val()&&xLoadListComprasByMonth(valDateMonthShowListCompras=$(this).val())})}async function xLoadListComprasByMonth(o=null){xPopupLoad.xopen();var s=new Date,s=(o=null===o?s.getFullYear()+"-"+("0"+(s.getMonth()+1)).slice(-2):o,txt_list_compra_fecha_compra.value=o,valDateMonthShowListCompras=$("#txt_list_compra_fecha_compra").val(),{mm:o.split("-")[1],yy:o.split("-")[0]}),o=await(new httpFecht).postJson("../../bdphp/log_009.php?op=22",s);o.success&&(xThisComprasList.listComprasByMonth=o.datos.map(o=>(o.selected=!1,o.classRow="xCursor",o)),xThisComprasList.totalCompras=xThisComprasList.listComprasByMonth.map(o=>parseFloat(removeComas(o.total))).reduce((o,s)=>o+s,0),xThisComprasList.totalCompras=xThisComprasList.totalCompras.toFixed(2)),0<xThisComprasList.listComprasByMonth.length&&(xThisComprasList.objCompraSeleted=xThisComprasList.listComprasByMonth[0],rowListCompraSelected(xThisComprasList.objCompraSeleted),showDetalleListCompraByMont()),xPopupLoad.xclose()}async function listComprasByMonthDetalle(o){const s=o.dataId;xThisComprasList.objCompraSeleted=xThisComprasList.listComprasByMonth.find(o=>o.idcompra==s),rowListCompraSelected(xThisComprasList.objCompraSeleted),showDetalleListCompraByMont()}async function showDetalleListCompraByMont(){xPopupLoad.xopen();var o=new httpFecht,s={idcompra:xThisComprasList.objCompraSeleted.idcompra},o=await o.postJson("../../bdphp/log_009.php?op=2103",s);o.success&&(xThisComprasList.listProductosByCompra=o.datos,xThisComprasList.totalProductos=o.datos.map(o=>parseFloat(removeComas(o.total))).reduce((o,s)=>o+s,0),xThisComprasList.totalProductos=xThisComprasList.totalProductos.toFixed(2)),xPopupLoad.xclose()}function rowListCompraSelected(s){xThisComprasList.listComprasByMonth.forEach(o=>{o.idcompra==s.idcompra?(o.selected=!0,o.classRow="xCursor selected"):(o.selected=!1,o.classRow="xCursor")}),xThisComprasList.listComprasByMonth=JSON.parse(JSON.stringify(xThisComprasList.listComprasByMonth))}Polymer({is:"x-compras-list",properties:{objproveedor:{type:Object,notify:!0,reflectToAttribute:!0,observer:"proveedorChanged"},listCompras:[],listProductosByCompra:[],totalCompras:Number,totalProductos:Number,objCompraSeleted:[]},refresh:function(){xLoadListComprasByMonth(null)},attached:function(){xThisComprasList=this,xInitComprasList()},displayIndex:function(o){return xCeroIzq(o+1,1)}})</script></dom-module>