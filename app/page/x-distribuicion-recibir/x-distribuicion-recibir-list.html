<dom-module id="x-distribuicion-recibir-list"><link rel="import"href="../../x-componentes/x-comp-find-almacen/x-comp-find-almacen.html"><template><br><div class="xMiCard xradius"style="width:90%;max-width:1250px"><div class="xEncanezadoCard"style="background:#fff0f5;color:#424242"><div class="div-content-head-op"><p class="fw-600 fs-18">Recibir Productos<p class="text-secondary">Recibir productos enviados desde otro almacen.</div></div><div class="p-3 mb-5"><div><div hidden$="[[ showDetalleDistribuicionRecibe ]]"class="d-flexx justify-content-between align-items-center"><div><h4>Seleccione Mes</h4><input type="month"class="selected-template-1 xCursor"id="txt_list_fecha_distribuicion_recibe"placeholder="Elige fecha"></div></div><div hidden$="[[ !showDetalleDistribuicionRecibe ]]"><div><div class="d-flexx justify-content-between"style="align-items:flex-start"><p class="fs-15 fw-600 mb-2">Detalle de Distribuici√≥n</p><button hidden$="[[!showDetalleDistribuicionRecibe]]"class="btn btn-sm btn-secondary"onclick="golistDistribuicionRecibe()"><i class="fa fa-arrow-left"></i> Atras</button></div><hr><div class="d-flexx justify-content-between mt-3"><div class="d-flexx justify-content"><div class="mr-3"><p class="fw-600">Envio Desde<p>Local: <span class="fw-600">{{objDistribuicionSeleted.sede_de}}</span><p>Almacen: <span class="fw-600">{{objDistribuicionSeleted.almacen_de}}</span><p>Usuario: <span class="fw-600">{{objDistribuicionSeleted.usuario_de}}</span></div><div><p>Fecha: <span class="fw-600">{{objDistribuicionSeleted._fecha}}</span><p>Hora: <span class="fw-600">{{objDistribuicionSeleted._hora}}</span><p>Observaciones: <span class="fw-600">{{objDistribuicionSeleted.detalle}}</span></div></div><div class="text-right"><p class="fw-600">Estos productos ingrensan A:</p><x-comp-find-almacen clasecss="selected-template-1"id="sel_almacen_recibe"></x-comp-find-almacen></div></div></div></div></div><div hidden$="[[ showDetalleDistribuicionRecibe ]]"><br><p class="fs-15 fw-600">Listado de Distribuicion</p><br><table width="100%"><thead><th>#<th>Fecha<th>Desde<th>A<th>Recibido<th><tbody><template is="dom-repeat"items="{{listDistribuicionRecibe}}"as="item"><tr data-id="[[item.iddistribuicion]]"><td data-id="{{index}}"><p>{{ displayIndex(index) }}<td><p>{{ item._fecha }}<p>{{ item._hora }}<td><p>{{ item.sede_de }}<p class="fs-12 fw-600">{{ item.almacen_de }}<p class="text-secondary fs-10">{{ item.usuario_de }}<td><p>{{ item.sede_a }}<p class="text-secondary fs-10">{{item.detalle}}<td><div hidden$="[[!item.aceptado]]"><p><i class="fa fa-check text-success"></i><p class="fs-12">{{item.idusuario_recibe}}<p class="fs-10 text-secondary">{{item.fecha_recibe}}</div><div hidden$="[[item.aceptado]]"><p><i class="fa fa-times text-secondary"></i></div><td align="right"><button data-id="[[item.iddistribuicion]]"class="btn btn-sm btn-xsm xBoton_flat_2"onclick="xloadDetalleDistribuicionRecibe(this)">Ver Detalle</button></template></table></div><div hidden$="[[ !showDetalleDistribuicionRecibe ]]"><br><p class="fs-15 fw-600">Productos<hr><table width="100%"><thead><td>#<td width="60%">Producto<td align="right">Cantidad<td>Recibido<tbody><template is="dom-repeat"items="{{listDistribuicionDetalleRecibe}}"as="item"><tr data-id="[[item.idproducto_stock]]"><td data-id="{{index}}"><p>{{ displayIndex(index) }}<td>{{ item.nom_producto }}<td align="right">{{ item.cantidad }}<td><div hidden$="[[!item.is_recibido]]"><p><i class="fa fa-check text-success"></i></div><div hidden$="[[item.is_recibido]]"><button data-id="[[item.iddistribuicion_detalle]]"class="btn btn-sm btn-xsm xBoton_flat_2"onclick="recibirProductoDistribuicion(this)">Recibir</button></div></template></table></div></div></div></template><script>var xThisDisttribucionRecibe,valDateMonthShowListDistribuicion="";function xIniDistribuicionRecibe(){xPopupLoad.xopen(),xLoadListDistribuicionRecibeByMonth(null),$("#txt_list_fecha_distribuicion_recibe").on("change",function(){valDateMonthShowListDistribuicion!=$(this).val()&&xLoadListDistribuicionRecibeByMonth(valDateMonthShowListDistribuicion=$(this).val())}),$("#sel_almacen_recibe").on("change",function(i){xThisDisttribucionRecibe.idalmacen_recibe=sel_almacen_recibe.getAlmacen().idalmacen}),setTimeout(()=>{xThisDisttribucionRecibe.idalmacen_recibe=sel_almacen_recibe.getAlmacen().idalmacen},2500)}async function xLoadListDistribuicionRecibeByMonth(i=null){xPopupLoad.xopen();var e=new Date,e=(i=null===i?e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2):i,txt_list_fecha_distribuicion_recibe.value=i,valDateMonthShowListDistribuicion=$("#txt_list_fecha_distribuicion_recibe").val(),{mm:i.split("-")[1],yy:i.split("-")[0]}),i=await(new httpFecht).postJson("../../bdphp/log_009.php?op=24",e);i.success?xThisDisttribucionRecibe.listDistribuicionRecibe=i.datos.map(i=>(i._fecha=i.fecha.split(" ")[0],i._hora=i.fecha.split(" ")[1],i.aceptado=1==i.recibido,i)):xThisDisttribucionRecibe.listDistribuicionRecibe=[],xThisDisttribucionRecibe.showDetalleDistribuicionRecibe=!1,xPopupLoad.xclose()}function xloadDetalleDistribuicionRecibe(i){const e=i.dataId;xThisDisttribucionRecibe.objDistribuicionSeleted=xThisDisttribucionRecibe.listDistribuicionRecibe.find(i=>i.iddistribuicion==e),xShowDetalleDistribuicionRecibe()}async function xShowDetalleDistribuicionRecibe(){xPopupLoad.xopen();var i=new httpFecht,e={iddistribuicion:xThisDisttribucionRecibe.objDistribuicionSeleted.iddistribuicion},i=await i.postJson("../../bdphp/log_009.php?op=2401",e);i.success&&(xThisDisttribucionRecibe.showDetalleDistribuicionRecibe=!0,xThisDisttribucionRecibe.listDistribuicionDetalleRecibe=i.datos.map(i=>(i.is_recibido="1"==i.recibido,i.is_registrado="1"==i.registrado,i))),xThisDisttribucionRecibe.showDetalleDistribuicionRecibe=!0,xPopupLoad.xclose()}function golistDistribuicionRecibe(){xThisDisttribucionRecibe.showDetalleDistribuicionRecibe=!1}async function recibirProductoDistribuicion(i){const e=i.dataId;var i=xThisDisttribucionRecibe.listDistribuicionDetalleRecibe.find(i=>i.iddistribuicion_detalle==e),t={...i,idalmacen_ingresa:xThisDisttribucionRecibe.idalmacen_recibe},c=(xPopupLoad.xopen(),new httpFecht),t=((await c.postJson("../../bdphp/log_009.php?op=2402",t)).success&&(i.is_recibido=!0,i.is_registrado=!0,xThisDisttribucionRecibe.listDistribuicionDetalleRecibe=JSON.parse(JSON.stringify(xThisDisttribucionRecibe.listDistribuicionDetalleRecibe))),xPopupLoad.xclose(),xThisDisttribucionRecibe.listDistribuicionDetalleRecibe.every(i=>1==i.is_recibido));t&&(t={iddistribuicion:i.iddistribuicion},(await c.postJson("../../bdphp/log_009.php?op=2403",t)).success)&&(xThisDisttribucionRecibe.objDistribuicionSeleted.aceptado=!0,xThisDisttribucionRecibe.listDistribuicionRecibe=JSON.parse(JSON.stringify(xThisDisttribucionRecibe.listDistribuicionRecibe)))}Polymer({is:"x-distribuicion-recibir-list",properties:{listDistribuicionRecibe:[],listDistribuicionDetalleRecibe:[],showDetalleDistribuicion:Boolean,showDetalleDistribuicionRecibe:Boolean,objDistribuicionSeleted:[],idalmacen_recibe:Number},attached:function(){this.showDetalleDistribuicion=!1,this.showDetalleDistribuicionRecibe=!1,xThisDisttribucionRecibe=this,xIniDistribuicionRecibe()},displayIndex:function(i){return xCeroIzq(i+1,1)}})</script></dom-module>