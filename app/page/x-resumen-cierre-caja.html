<dom-module id="x-resumen-cierre-caja"><template><div class="xContent"id="xContentDiv"><br><paper-button class="xDerecha xverde"raised>Regresar</paper-button><h3><strong>Resumen de movimientos en caja</strong></h3><br><div class="xLinea2"></div><br><div id="div_us"><p inline>Todos los movimientos de caja que aun no estan cerrados por el usuario actual.</div><div id="div_filtros"class="xInvisible"><label for="sel_usuario">Usurio:</label> <select id="sel_usuario"inline><option>mramirez</select> <label for="fecha_cierre">Fecha de cierre:</label> <input type="date"id="fecha_cierre"inline></div><br><div class="xLinea2"></div><br><div id="div_datos"style="max-width:700px"></div></div></template></dom-module><script>var xThisResumenCaja,xArrayCierrePrint,xArraySumT=[];function xResumenCaja(){xPopupLoad=document.getElementById("xLoad"),xm_log_get("ini_us"),$("#Titulo_page").text("Movimientos de Caja"),xLoadDataCierre()}function xLoadDataCierre(){xPopupLoad.xopen(),xPopupLoad.titulo="Obteniendo Datos...",(xArrayCierrePrint=[]).push({des:"VENTAS",t1:"",t2:"",t3:"importe"}),xArmarDataItems(0,7,function(){xArrayCierrePrint.push({des:"TOTAL EFECTIVO EN CAJA",t1:"",t2:"",t3:"importe"}),xArmarDataItems(0,700101,function(){xArrayCierrePrint.push({des:"INGRESOS VARIOS",t1:"",t2:"",t3:"importe"}),xArmarDataItems(0,7003,function(){xArrayCierrePrint.push({des:"PAGOS DESDE APP",t1:"",t2:"cant",t3:"importe"}),xArmarDataItems(2,70021,function(){xArrayCierrePrint.push({des:"MOZO VIRTUAL",t1:"",t2:"cant",t3:"importe"}),xArmarDataItems(2,70022,function(){xArrayCierrePrint.push({des:"VENTAS AL CREDITO",t1:"Pedido",t2:"",t3:""}),xArmarDataItems(3,702,function(){xArrayCierrePrint.push({des:"PEDIDOS ATENDIDOS",t1:"",t2:"cant",t3:"importe"}),xArmarDataItems(5,703,function(){xArrayCierrePrint.push({des:"ITEMS ANULADOS",t1:"",t2:"cant",t3:"importe"}),xArmarDataItems(5,7091,function(){xArrayCierrePrint.push({des:"PEDIDOS ANULADOS - MOTIVO",t1:"",t2:"",t3:"importe"}),xArmarDataItems(5,7092,function(){xArrayCierrePrint.push({des:"CANTIDAD POR SECCION",t1:"",t2:"cant",t3:"importe"}),xArmarDataItems(5,70010,function(){xArrayCierrePrint.push({des:"PORCIONES",t1:"",t2:"ven",t3:"queda"}),xArmarDataItems(5,707,function(){xArrayCierrePrint.push({des:"PRODUCTOS VENDIDOS",t1:"ven",t2:"qda",t3:"importe"}),xArmarDataItems(5,705,function(){xArrayCierrePrint.push({des:"VENDIDO X BODEGA",t1:"vend",t2:"queda",t3:"importe"}),xArmarDataItems(5,706,function(){xEscribirDatos()})})})})})})})})})})})})})}function xArmarDataItems(r,s,o){$.ajax({type:"POST",url:"../../bdphp/log.php?op="+s}).done(function(r){if(indexAr=xArrayCierrePrint.length-1,7001==s)indexAr=xArrayCierrePrint.length-1,xArrayCierrePrint[indexAr][0]={des:"EFECTIVO EN CAJA",t1:"",t2:"",t3:xMoneda(r)},xArraySumT[indexAr]={t1:"",t2:"",t3:xMoneda(r)};else{for(var t=0,e=0,a=0,i=(i=$.parseJSON(r)).datos,n=(xArrayCierrePrint[indexAr].t3,0);n<i.length;n++)t+=isNaN(parseFloat(i[n].t1))?0:parseFloat(i[n].t1.replace(",","")),e+=isNaN(parseFloat(i[n].t2))?0:parseFloat(i[n].t2.replace(",","")),a+=isNaN(parseFloat(i[n].t3))?0:parseFloat(i[n].t3.replace(",","")),xArrayCierrePrint[indexAr][n]={des:i[n].descripcion,t1:i[n].t1,t2:i[n].t2,t3:i[n].t3};t=0===t?"":"importe"===xArrayCierrePrint[indexAr].t1?xMoneda(t):xCeroIzq(t,2),e=0===e?"":"importe"===xArrayCierrePrint[indexAr].t2?xMoneda(e):xCeroIzq(e,2),a=0===a?"":"importe"===xArrayCierrePrint[indexAr].t3?xMoneda(a):xCeroIzq(a,2),xArraySumT[indexAr]={t1:t,t2:e,t3:a},0==i.length?xArrayCierrePrint[indexAr].visible=1:xArrayCierrePrint[indexAr].visible=0}o(!0)})}function xEscribirDatos(){var r,t,e="",i=0;for(a in xArrayCierrePrint)i=0,e="",r='<thead><th align="left">'+xArrayCierrePrint[a].des+'</th><th align="right">'+xArrayCierrePrint[a].t1+'</th><th align="right">'+xArrayCierrePrint[a].t2+'</th><th align="right">'+xArrayCierrePrint[a].t3+"</th></thead>",$.map(xArrayCierrePrint[a],function(r,t){"object"==typeof r&&(i++,e=String(e+"<tr><td>"+r.des+'</td><td align="right" class="t1">'+r.t1+'</td><td class="t2" align="right">'+r.t2+'</td><td class="t3" align="right">'+r.t3+"</td><tr>"))}),t=String('<tr><td></td><td align="right"><strong>'+xArraySumT[a].t1+'</strong></td><td align="right"><strong>'+xArraySumT[a].t2+'</strong></td><td align="right"><strong>'+xArraySumT[a].t3+"</strong></td></tr>"),0!==i&&(r=String('<table class="xtable2 xMarginTop" width="100%">'+r+e+t+"</table><br><br>"),$("#div_datos").append(r).trigger("create"));xPopupLoad.xclose()}Polymer({is:"x-resumen-cierre-caja",properties:{},attached:function(){this.selected=0,xThisResumenCaja=this,xResumenCaja()}})</script>