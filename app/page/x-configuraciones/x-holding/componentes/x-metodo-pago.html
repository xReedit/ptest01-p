<dom-module id="x-metodo-pago"><link rel="import"href="../../../../x-componentes/x-comp-find-tipo-pago/x-comp-find-tipo-pago.html"><template><style>:host{display:inline-block}</style><h3>Metodos de Pago</h3><p>En este se configuran los tipos de pago y comisiones<br>aceptados en la aplicacion del mesero</p><br><div><table><thead><th>Tipo Pago<th>Comision<th><tbody><tr><td><x-comp-find-tipo-pago id="findTipoPago"class="xMiInput"></x-comp-find-tipo-pago><td><input class="xMiInput"id="textComision"type="number"placeholder="Comision"value="0"required><td><button class="btn btn-sm btn-primary"on-click="addTipoPago">Agregar</button></tr><template is="dom-repeat"items="[[listTipoPago]]"><tr><td>{{item.nom_tipo_pago}}<td>{{item.comision}}%<td><button class="btn btn-sm btn-danger"on-click="removeTipoPago"><i class="fa fa-trash"></i></button></template></table><br></div></template><script>Polymer({is:"x-metodo-pago",properties:{listTipoPago:{type:Array,value:function(){return[]}},holding:{type:Object,value:function(){return{}}}},ready:function(){$.ajax({type:"POST",url:"../../bdphp/log_010.php",data:JSON.stringify({op:"get-holding"})}).done(o=>{o=JSON.parse(o).datos[0];this.holding.idsede_holding=o.idsede_holding,this.holding.idsede=o.idsede,this.holding.nombre=o.nombre,this.holding.ciudad=o.ciudad,this.loadTipoPagoHolding()})},loadTipoPagoHolding:function(){$.ajax({type:"POST",url:"../../bdphp/log_010.php",data:JSON.stringify({op:"get-holding-metodo-pago",idsede_holding:this.holding.idsede_holding})}).done(o=>{o=JSON.parse(o);this.listTipoPago=o.datos||[]})},addTipoPago:function(){const i=this.$.findTipoPago.list_tipo_pago;var o=this.$.textComision.value;i&&o?this.listTipoPago.find(o=>o.idtipo_pago===i.idtipo_pago)?alert("Este tipo de pago ya ha sido agregado"):(xPopupLoad.xopen(),o={op:"set-holding-metodo-pago",idtipo_pago:i.idtipo_pago,comision:o,idsede_holding:this.holding.idsede_holding,estado:0},$.ajax({type:"POST",url:"../../bdphp/log_010.php",data:JSON.stringify(o)}).done(o=>{xPopupLoad.xclose(),this.$.textComision.value="0",this.loadTipoPagoHolding()}).fail(o=>{xPopupLoad.xclose(),alert("Error al agregar el tipo de pago")})):alert("Debe seleccionar un tipo de pago y especificar una comisión")},removeTipoPago:async function(o){var i=paramsSwalAlert,i=(i.title="Eliminar Tipo de Pago",i.text="¿Está seguro de eliminar este tipo de pago?",i.type="warning",i.showCancelButton=!0,i.confirmButtonText="Si, eliminar",i.cancelButtonText="Cancelar",i.html="",await showAlertSwalHtmlDecision(i));i.isConfirmed&&(i=o.model.index,o=this.listTipoPago[i],xPopupLoad.xopen(),i={op:"set-holding-metodo-pago",id:o.idsede_holding_metodo_pago,idtipo_pago:o.idtipo_pago,comision:o.comision,estado:1},$.ajax({type:"POST",url:"../../bdphp/log_010.php",data:JSON.stringify(i)}).done(o=>{xPopupLoad.xclose(),this.loadTipoPagoHolding()}).fail(o=>{xPopupLoad.xclose(),alert("Error al eliminar el tipo de pago")}))},saveTiposPago:function(){var o;this.listTipoPago&&0!==this.listTipoPago.length&&(xPopupLoad.xopen(),o=this.listTipoPago.map(o=>{var i={op:"set-holding-metodo-pago",idtipo_pago:o.idtipo_pago,comision:o.comision,estado:o.estado||0};return o.idsede_holding_metodo_pago&&0<o.idsede_holding_metodo_pago&&(i.id=o.idsede_holding_metodo_pago),$.ajax({type:"POST",url:"../../bdphp/log_010.php",data:JSON.stringify(i)})}),Promise.all(o).then(o=>{xPopupLoad.xclose(),this.loadTipoPagoHolding()}).catch(o=>{xPopupLoad.xclose(),alert("Error al guardar los tipos de pago")}))}})</script></dom-module>