<dom-module id="x-areas-mesas-alfanumericas"><template is="dom"><h3>Areas y Mesas Alfanuméricas</h3><p class="text-secondary">Las mesas alfanuméricas utilizan un prefijo personalizado seguido de un número. Por ejemplo: Área "Salón 1" con prefijo "S1-" y mesas S1-01 al S1-20, Área "Piso 2" con prefijo "P2-" y mesas P2-01 al P2-15.<div class="xLinea2"></div><br><table><thead><th class="text-left">Area<th class="text-center">Prefijo<th class="text-center">Desde<th class="text-center">Hasta<th class="text-center">Vista Previa<th class="text-center"><tbody><tr><td><input class="selected-template-1"placeholder="Titulo del Area"id="tituloarea"onchange="conMayusculas(this)"><td class="text-center"><input class="selected-template-1 text-center"placeholder="S1-"id="prefijo"style="width:80px"on-input="actualizarVistaPrevia"><td class="text-center"><input class="selected-template-1 text-center"type="number"placeholder="01"id="desde"min="1"style="width:70px"on-input="actualizarVistaPrevia"><td class="text-center"><input class="selected-template-1 text-center"type="number"placeholder="20"id="hasta"min="1"style="width:70px"on-input="actualizarVistaPrevia"><td class="text-center"><span id="vistaPrevia"class="text-muted fs-12">--</span><td class="text-center"><button class="btn btn-sm btn-primary"on-click="agregarArea">+ Agregar</button><tr><td colspan="6"class="text-right text-danger fw-600 animated"id="alertMessage"style="display:none"></tr><template is="dom-repeat"items="{{listAreas}}"as="item"><tr><td>{{item.titulo}}<td class="text-center">{{item.prefijo}}<td class="text-center">{{item.desde}}<td class="text-center">{{item.hasta}}<td class="text-center text-muted fs-12">{{item.ejemplo}}<td class="text-center"><span class="xDeleteRow"on-click="eliminarArea"></span></template></table><br><button class="btn btn-success"disabled$="{{!isShowBtnGuardar}}"on-click="guardarCambios"><i class="fa fa-save"></i> Guardar Cambios</button></template><script>var xThisAreasMesasAlfa;Polymer({is:"x-areas-mesas-alfanumericas",properties:{listAreas:{type:Array,value:[]},isShowBtnGuardar:{type:Boolean,value:!1}},attached:function(){(xThisAreasMesasAlfa=this).loadAreas()},actualizarVistaPrevia:function(){var e=this.$.prefijo.value.trim(),a=this.$.desde.value,s=this.$.hasta.value;e&&a&&s?(a=this.formatearNumero(parseInt(a)),s=this.formatearNumero(parseInt(s)),this.$.vistaPrevia.textContent=""+e+a+" al "+e+s):this.$.vistaPrevia.textContent="--"},formatearNumero:function(e){return e<10?"0"+e:e.toString()},agregarArea:function(){var e=this.$.tituloarea.value.trim(),a=this.$.prefijo.value.trim(),s=parseInt(this.$.desde.value),t=parseInt(this.$.hasta.value);if(e)if(a)if(s&&t)if(s<1||t<1)this.showAlert("Los números de mesa deben ser mayores a 0.");else if(t<s)this.showAlert('El número "hasta" no puede ser menor que "desde".');else{for(var r=0;r<this.listAreas.length;r++){var i=this.listAreas[r];if(i.prefijo===a&&(s>=i.desde&&s<=i.hasta||t>=i.desde&&t<=i.hasta||s<=i.desde&&t>=i.hasta))return void this.showAlert("El rango de mesas se superpone con un área existente que usa el mismo prefijo.")}var o=this.formatearNumero(s),l=this.formatearNumero(t);this.push("listAreas",{titulo:e,prefijo:a,desde:s,hasta:t,ejemplo:""+a+o+" al "+a+l,tipo_mesa:"alfanumerica"}),this.isShowBtnGuardar=!0,this.$.tituloarea.value="",this.$.prefijo.value="",this.$.desde.value="",this.$.hasta.value="",this.$.vistaPrevia.textContent="--",this.$.tituloarea.focus()}else this.showAlert("Debe ingresar los números desde y hasta.");else this.showAlert("Debe ingresar un prefijo (ej: S1-, PISO1-, etc).");else this.showAlert("Debe ingresar el título del área.")},eliminarArea:async function(e){var a=paramsSwalAlert,a=(a.html=`<div class="p-1" style="overflow: hidden;"><i class="fa fa-trash-o fa-2x text-danger" aria-hidden="true"></i>
                                <p class="mt-1 fs-18">¿Está seguro de borrar este registro?</p>
                                </div>`,a.confirmButtonText="Si, borrar",a.cancelButtonText="Cancelar",a.showCancelButton=!0,await showAlertSwalHtmlDecision(a));a.isConfirmed&&(a=e.model.index,this.splice("listAreas",a,1),this.isShowBtnGuardar=!0)},guardarCambios:async function(){xPopupLoad.xopen();var e={listAreas:this.listAreas,op:51};(await(new httpFecht).axiosExecute({type:"POST",url:"../../bdphp/log_009.php",data:e},!0,!1)).success?(xPopupLoad.xclose(),this.isShowBtnGuardar=!1,this.showAlert("Cambios guardados correctamente.","success")):(xPopupLoad.xclose(),this.showAlert("Ocurrió un error al guardar los cambios."))},showAlert:function(e,a="danger"){let s=this.$.alertMessage;s.textContent=e,s.className=`text-right text-${a} fw-600 animated`,s.classList.add("animate__flash"),$(s).fadeIn().delay(3e3).fadeOut(function(){s.classList.remove("animate__flash")})},loadAreas:async function(){var e=await(new httpFecht).axiosExecute({type:"POST",url:"../../bdphp/log_009.php",data:{op:5101}},!0,!1);e.success?this.listAreas=e.datos.map(e=>{var a=this.formatearNumero(e.desde),s=this.formatearNumero(e.hasta);return e.ejemplo=""+e.prefijo+a+" al "+e.prefijo+s,e}):this.showAlert("Ocurrió un error al cargar las áreas.")},volverAtras:function(){this.isShowBtnGuardar?this.showAlert("Tiene cambios sin guardar. Por favor guarde antes de salir."):this.fire("volver-mesas-numericas")}})</script></dom-module>