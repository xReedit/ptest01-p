<dom-module id="x-carta-virtual-mesas"><script src="../../../../js/qrious.js"></script><link rel="import"href="../../../x-componentes/x-comp-img-upload/x-comp-img-upload-2.html"><template is="dom"><paper-dialog oncontextmenu=""id="dialog_qr"modal class="dialog-redondo"entry-animation="scale-up-animation"exit-animation="fade-out-animation"><p>{{ objQrSelected.titulo }}</p><canvas id="qr-download"></canvas><br><div style="display:flex"><div class="xBoton2 xVerde"onclick="copiarQr()">Copiar</div><div class="xBoton2 xPlomo"dialog-dismiss>Cerrar</div></div></paper-dialog><div><h3>Logo</h3><p>Logo que va en el diseño impreso.<div class="xLinea2"></div><div><x-comp-img-upload-2 id="compImgLogo"medidasimg="[[medidaLogo]]"></x-comp-img-upload-2></div><br><div class="xLinea2"></div><br><h3>Codigos QR para las mesas</h3><p>Toca para descargar.</p><br><div class="content-qr"style="background:#fff;width:1600px"><paper-tabs selected="{{selectedTab}}"><paper-tab>Centro de Mesa</paper-tab><paper-tab>Solo Qr</paper-tab><paper-tab>Stiker</paper-tab></paper-tabs><div class="xLinea2"></div><br><br><iron-pages selected="{{selectedTab}}"style="background:#fff"><div id="template-1"><div class="div-copy-all"style="background:#fff;max-width:1600px"id="div-pdf-qr"><template is="dom-repeat"items="{{listQrPagesSelected}}"as="item"><div class="codigo-qr content-bg-qr xCursor"onclick="xCopyQrCarta(this)"data-index="[[index]]"><div class="bg-qr-mesa"><div class="content-logo-qr"><img src$="[[imgLogoQr]]"alt="logo-qr"></div><p class="fw-900 fs-25 num-mesa">{{item.nummesa}}</p><img class="img-qr"src="{{item.codigo_d1}}"alt="qr"></div></div></template></div><div class="d-flexx p-3"><h2>Paginas</h2><template is="dom-repeat"items="{{objArrPagination}}"as="page"><p data-id="[[index]]"selected$="{{page.selected}}"class$="{{page.xclass}}"onclick="selectPageQr(this)">{{page.page}}</template></div><button class="btn btn-primary"onclick="xCopyAllQrCarta(this)"><i class="fa fa-copy"></i> Descargar Todo</button></div><div id="template-2"><template is="dom-repeat"items="{{objListMesasQr}}"as="item"><div class="codigo-qr xCursor"onclick="generateQRCode(this,1)"data-index="[[index]]"><img src="{{item.codigo}}"alt=""> <span>{{item.nummesa}}</span></div></template></div><div id="template-3"><div class="div-copy-all"style="background:#fff;max-width:1600px"><template is="dom-repeat"items="{{listQrPagesSelected}}"as="item"><div class="div-sticker m-2 xCursor"onclick="xCopyQrCarta(this)"data-index="[[index]]"><div class="text-center"><h3 class="fw-900">PIDE AQUí</h3><p class="m-0 fs-15 fw-600">Atención sin esperas. Escanea el QR con la camara de tu celular.</div><div class="codigo-qr"><div class="d-flexx align-items-center"><div><img src="{{item.codigo_d1}}"alt="codigo-qr"></div><div class="text-center"><p class="fs-15 fw-600 mb-2">Mesa #<p class="fs-50 fw-600">{{item.nummesa}}</div></div></div><div style="margin-top:-20px"><p class="m-0 fs-12 fw-600">papaya.com.pe</div></div></template></div><br><div class="d-flexx p-3"><h2>Paginas</h2><template is="dom-repeat"items="{{objArrPagination}}"as="page"><p data-id="[[index]]"selected$="{{page.selected}}"class$="{{page.xclass}}"onclick="selectPageQr(this)">{{page.page}}</template></div><button class="btn btn-primary"onclick="xCopyAllQrCarta(this)"><i class="fa fa-copy"></i> Descargar Todo</button></div></iron-pages></div><br><br><h3>Otros Codigos QR</h3><p>Toca para descargar.<div class="xLinea2"></div><div class="content-qr"><template is="dom-repeat"items="{{objListOtherQr}}"as="item_o"><div class="codigo-qr xCursor"onclick="generateQRCode(this,0)"data-index="[[index]]"><img src="{{item_o.codigo}}"alt=""> <span>{{item_o.titulo}}</span></div></template></div><br><br><br><div class="xLinea2"></div><br><h4>LINK DELIVERY para compartir.</h4><span>De clic en este link para copiarlo y compartirlo con sus clientes por sus redes sociales, los llevara directo a visualizar su carta desde donde podrá realizar su pedido</span><p class="text-info xCursor"title="Copiar"onclick="copiarUrl()"id="urlcopy">{{url_delivery}}</p><br><span>Además puede acortar el enlaze con este servicio: <a href="https://bitly.com/"target="_blank"class="text-info">Short URL</a></span><br><br><div class="xLinea2"></div><br><br><br></div></template></dom-module><style>.content-qr{display:inline-block}.codigo-qr{display:inline-grid;text-align:center}.bg-qr-mesa{background-image:url(plano_qr.png);background-repeat:no-repeat;background-size:contain}.content-bg-qr{width:312px;height:480PX;margin-bottom:6px;background:#fff}.bg-qr-mesa .num-mesa{position:relative;left:110px;top:-65px;color:#fff;font-size:70px}.bg-qr-mesa .img-qr{top:10px;position:relative}.content-logo-qr{width:81px;height:81px;border-radius:50%;overflow:hidden;position:relative;left:12px;top:5px;background:#fff;border:.04em solid}.content-logo-qr>img{width:84px;text-align:center;position:relative;left:-2px}.div-sticker{width:250px;text-align:center;background:#fff;border:1px solid;border-radius:5px;padding:20px;display:inline-block}.numPaginationQr{font-size:20px;font-weight:900;background:#e0e0e0;padding:10px;border-radius:5px;margin:10px;cursor:pointer;color:#000}.numPaginationQr[selected]{background:#2979ff;color:#fff}</style><script>var xThisCartaVMesas,compImgLogo,_keyUrlLogoQr="";function xIniCartaVirtualMesas(){xThisCartaVMesas.medidaLogo={width:200,height:200};var a=xm_log_get("datos_org_sede")[0];_keyUrlLogoQr=a.idorg+""+a.idsede+"logoqr.png",(compImgLogo=document.getElementById("compImgLogo")).addEventListener("setImg",a=>{uploadImgLogo(a.detail,"logoqr")}),xThisCartaVMesas.imgAfiche=URL_IMG_CARTA+"afiche_qr_modelo.jpg",loadDatosCartaMesas()}function loadDatosCartaMesas(){$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=903"}).done(function(e){e=JSON.parse(e),xThisCartaVMesas.objListMesasQr=JSON.parse(e.datos[0].mesas);var a=xThisCartaVMesas.objListMesasQr.length;let t=a<=20?0:parseInt(a/20),s=0,o=new Object,r=[],i=0,c=[];c.push({page:1,xclass:"numPaginationQr selected",selected:!0}),xThisCartaVMesas.objListMesasQr.map(a=>{19<i&&(o[s]=r,t--,s++,r=[],i=0,c.push({page:s+1,xclass:"numPaginationQr",selected:!1})),i++;var e=a.codigo.replace("/#","");return a.codigoDownload="https://chart.apis.google.com/chart?cht=qr&chs=400x400&chl="+e,a.codigo="https://chart.apis.google.com/chart?cht=qr&chs=75x75&chl="+e,a.codigo_d1="https://chart.apis.google.com/chart?cht=qr&chs=185x185&chl="+e,a.titulo="Mesa "+a.nummesa,a.codigo_qr=e,r.push(a),a}),o[s]=r,xThisCartaVMesas.objListMesasCount=o,xThisCartaVMesas.listQrPagesSelected=o[0],xThisCartaVMesas.objArrPagination=c,xThisCartaVMesas.objListOtherQr=[];var a=[],n=(xThisCartaVMesas.qrLLevar={},e.datos[0].qr_para_llevar),e=(xThisCartaVMesas.qrLLevar.codigoDownload="https://chart.apis.google.com/chart?cht=qr&chs=400x400&chl="+n,xThisCartaVMesas.qrLLevar.codigo="https://chart.apis.google.com/chart?cht=qr&chs=50x50&chl="+n,xThisCartaVMesas.qrLLevar.titulo="Solo para llevar",xThisCartaVMesas.qrLLevar.codigo_qr=n,xThisCartaVMesas.qrDelivery={},n=e.datos[0].qr_delivery,xThisCartaVMesas.qrDelivery.codigoDownload="https://chart.apis.google.com/chart?cht=qr&chs=400x400&chl="+n,xThisCartaVMesas.qrDelivery.codigo="https://chart.apis.google.com/chart?cht=qr&chs=50x50&chl="+n,xThisCartaVMesas.qrDelivery.titulo="Delivery",xThisCartaVMesas.qrDelivery.codigo_qr=n,xThisCartaVMesas.url_delivery=n,a.push(xThisCartaVMesas.qrLLevar),a.push(xThisCartaVMesas.qrDelivery),xThisCartaVMesas.objListOtherQr=JSON.parse(JSON.stringify(a)),URL_IMG_PROMO+_keyUrlLogoQr);try{compImgLogo.setImgPathFile(e),xThisCartaVMesas.imgLogoQr=e}catch(a){compImgLogo.resetControl(e),xThisCartaVMesas.imgLogoQr=""}})}function selectPageQr(a){a=a.dataId;xThisCartaVMesas.objArrPagination.map(a=>{a.xclass="numPaginationQr",a.selected=!1}),xThisCartaVMesas.objArrPagination[a].xclass="numPaginationQr selected",xThisCartaVMesas.objArrPagination[a].selected=!0,xThisCartaVMesas.objArrPagination=JSON.parse(JSON.stringify(xThisCartaVMesas.objArrPagination)),xThisCartaVMesas.pageSelected=a,xThisCartaVMesas.listQrPagesSelected=xThisCartaVMesas.objListMesasCount[a]}function descargarAfiche(){window.open(xThisCartaVMesas.imgAfiche,"Afiche","width=500,height=500")}function descargarOtroQR(a){a=a.dataIndex,a=xThisCartaVMesas.objListOtherQr[a].codigoDownload;window.open(a,"CodigoQR","width=500,height=500")}function descarGarQR(a){a=a.dataIndex,a=xThisCartaVMesas.objListMesasQr[a].codigoDownload;window.open(a,"CodigoQR","width=500,height=500")}function generateQRCode(a,e){a=a.dataIndex,e=(0===e?xThisCartaVMesas.objListOtherQr:xThisCartaVMesas.objListMesasQr)[a];xThisCartaVMesas.objQrSelected=e,new QRious({foreground:"black",element:document.getElementById("qr-download"),size:350,value:e.codigo_qr});dialog_qr.open()}async function copiarQr(){var a=(a=document.getElementById("qr-download")).toDataURL("image/png");await setToClipboard(await(await fetch(a)).blob())}async function xCopyQrCarta(a){domtoimage.toPng(a,{quality:1,width:8.5*a.clientWidth,height:8.5*a.clientHeight,style:{transform:"scale(8.5)",transformOrigin:"top left"}}).then(function(a){var e=document.createElement("a");e.download="ImageQr.png",e.href=a,e.click()}).then(function(){console.log("download Done")})}function xConvertToPDF(a){var e=document.querySelector("#div-pdf-qr"),t=new jsPDF;t.fromHTML(e.innerHTML,15,15,{width:170,elementHandlers:{"#editor":function(a,e){return!0}}}),t.save("sample-file.pdf")}async function xCopyAllQrCarta(a){xCopyQrCarta($(a).parent().find(".div-copy-all")[0])}async function setToClipboard(a){showToastSwal("success","Copiado!");a=[new ClipboardItem({[a.type]:a})];return navigator.clipboard.write(a)}function copiarUrl(){var a=document.getElementById("urlcopy").innerText,e=document.createElement("textarea");document.body.appendChild(e),e.value=a,e.select(),document.execCommand("copy"),document.body.removeChild(e)}function uploadImgLogo(a,e){$.ajax({type:"POST",url:"upload_base64.php?op=6",data:{nomfile:e,img:a}}).done(a=>{console.log("ok")})}Polymer({is:"x-carta-virtual-mesas",properties:{xt_org:Number,xt_idsede:Number,objListMesasQr:Object,objListMesasCount:[],objArrPagination:[],listQrPagesSelected:[],pageSelected:Number,qrLLevar:Object,qrDelivery:Object,objListOtherQr:Object,objQrSelected:Object,url_delivery:String,imgAfiche:String,medidaLogo:Object,imgLogoQr:String,selectedTab:Number},attached:function(){this.selectedTab=0,this.pageSelected=0,xThisCartaVMesas=this,xIniCartaVirtualMesas()}})</script>