<dom-module id="x-zona_despacho_theme_2"><link href="../../js/c3.min.css"rel="stylesheet"><script src="../../js/d3.min.js"></script><script src="../../js/c3.min.js"></script><script src="../view/socket.service.z.js"></script><script rel="preload"src="../../js/isotope.pkgd.min.js"async></script><script rel="preload"src="../view/xm_all.js"></script><script rel="preload"src="../view/config.const.js"></script><script src="../view/httpFech.js"></script><template><paper-dialog id="dialog_despachar"style="max-width:350px;z-index:500"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="xtxtCentro"><img src="../../images/_dlg_remove.gif"alt=""width="150px"></div><p>Se marcara todos los pedidos hasta este momento como despachados. Si tiene pedidos pendientes, no se mostraran en ninguna zona de despacho.</p><br><div class="buttons"><button class="xBoton2 xPlomo"dialog-dismiss>Cancelar</button> <button class="xBoton2 xRojo"onclick="xDespacharTodos()">Si, seguro</button></div></paper-dialog><paper-dialog id="dialog_detalle_pd"style="border-radius:5px;padding:0;width:320px"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><paper-dialog-scrollable style="padding:0;top:0;left:0;overflow-y:auto"><div id="div_pd_detalle"></div><br><div class="xtxtCentro"hidden$="isPedidoDespachado"><button class="xBoton2 xPlomo"dialog-dismiss onclick="pedidoDeliveryEntregado()">Listo</button></div></paper-dialog-scrollable></paper-dialog><paper-dialog id="dialog_marcar"class="dialog_redondo dialog_color"entry-animation="scale-up-animation"exit-animation="fade-out-animation"><div class="xContent"><div class="xIndicadorPedido morado xCursor noselect"onclick="xRefreshMarcador(this)"data-color="xMorado"><div><p></p><span>__________</span></div></div><br><div class="xIndicadorPedido naranja xCursor noselect"onclick="xRefreshMarcador(this)"data-color="xNaranja"><div><p></p><span>__________</span></div></div><br><div class="xIndicadorPedido rojo xCursor noselect"onclick="xRefreshMarcador(this)"data-color="xRojo"><div><p></p><span>__________</span></div></div></div></paper-dialog><div class="xHeaderPersiste xcolor1"><div id="des_zona_despacho"class="xEnLineaTable"><div class="xEnLineaTable xCursor"onclick="xOpenLateralIzq()"><img src="../../images/_config_despacho.png"></div><div class="xEnLineaTable xpadingLateralIz"><p class="xfont18">Zona de despacho</p><span class="xfont11"id="des_titulo_despacho">Seleccione la zona y los canales de consumo.</span></div><div class="xIndicaTiempoDespacho"><p id="min_max_pedido">-<span class="xfont9">min x pedido</span></div><div class="xContent_Indicador_pedido_de"><div class="xIndicadorPedido dark xCursor noselect"onclick="changeModeViewZD1(this)"><i class="fa fa-paint-brush"aria-hidden="true"></i><p class="fs-10">Claro</div><div class="xIndicadorPedido dark xCursor noselect"onclick="changeOderItemsZD(this)"><i hidden$="[[orderItemsVerticalZD]]"class="fa fa-arrow-right"></i> <i hidden$="[[!orderItemsVerticalZD]]"class="fa fa-arrow-down"></i><p class="fs-10">Orden</div><div class="xIndicadorPedido dark xCursor noselect"onclick="window.location.reload()"><div><i class="fa fa-refresh"></i><p class="fs-10">Actualizar</div></div><div class="xIndicadorPedido fuccia xCursor noselect xInvisible xFondoRowAmarillo3"id="btn_ver_reserva"onclick="xVerReservas()"><div><p id="tt_pedidos_reserva">0</p><span>Reservas</span></div></div><div class="xIndicadorPedido dark xCursor noselect"onclick="dialog_marcar.open()"><div><img src="../../images/_marcar.png"></div></div><div class="xIndicadorPedido dark xCursor noselect"onclick="xOpenLateralDe()"><div><p id="tt_pedidos_cola">0</p><span>pedidos</span></div></div></div></div></div><div class="xdrawerIzq"id="xdrawerIzq"><div class="xBtnCloseDrawer noselect xCursor"id="close_drawer_izq"onclick="closeDrawer_izq()"><p>CERRAR</div><div class="xLinea"></div><p class="xpading_10">Seleccione las zonas de despacho y el tipo de consumo a trabajar.<div class="xLinea"></div><div class="xContent xpading_15"id="div_zona_despacho"><h4>Zona de despacho</h4><div class="xLinea"></div><br><paper-checkbox>...</paper-checkbox><br><br><h4>Tipo de consumo</h4><div class="xLinea"></div><br><paper-checkbox>...</paper-checkbox><br><br><br></div><br><div class="xLinea"></div><br><div class="xpading_15"><div class="xMarginIz xBoton2 xVerde"onclick="xEstablecerFiltroDespachos()">Listo Aplicar</div><div class="xMarginIz xBoton2 xRojo"onclick="dialog_despachar.open()">Despachar todos</div></div><br><div class="xLinea"></div><div class="xpading_15"><div class="xMiBoton_icon_lateral"onclick="xVerPedidosDespachados()"><img src="../../images/_despachado.png"><p>Ver pedidos despachados</div><div class="xMiBoton_icon_lateral"onclick="xCargarChartDespacho()"><img src="../../images/_estadistica_despacho.png"><p>Estadisticas</div></div></div><div class="xdrawerDe"id="xdrawerDe"><div class="xBtnCloseDrawer noselect xCursor"id="close_drawer_de"onclick="closeDrawer_de()"><p>CERRAR</div><h3 class="xpading_10">RESUMEN DE PEDIDOS</h3><div class="xLinea"></div><div class="xContent xpading_15"><table class="xtable4"width="100%"id="tb_resumen_pedido"></table></div></div><iron-pages selected="{{select_div}}"><div id="div_pedidos_on"><br><div class="xContent_zd_pedido-t1"id="xContent_zd_pedido-t1"></div></div><div id="div_pedidos_despachados"><br><h3 class="xBold">Pedidos Despachados <span class="xCursor xDerecha"><a onclick="xVerDepacho()">Regresar</a></span></h3><div class="xLinea"></div><br><div class="grid_pedidos_despachados"></div></div><div id="div_pedidos_reserva"><br><h3 class="xBold">Reservas <span class="xCursor xDerecha"><a onclick="xVerDepacho()">Regresar</a></span></h3><div class="xLinea"></div><br><div class="xContent_zd_pedido"id="div_reserva"></div></div><div id="id_charts_despacho"class="xContent"><br><br><h3 class="xBold"><span class="xCursor xDerecha"><a onclick="xVerDepacho()">Regresar</a></span></h3><div style="text-align:center"class="xfont18"><h3>Últimos 2 dias</h3><p>Tiempo maximo establecido: <span id="tt_max_p"class="xBold"></span> <span>Pedidos despachados: <span id="tt_pd"class="xBold"></span> <span class="xColorRow_Rojo">Pedidos Retirados: <span id="tt_an"class="xBold"></span></span></span></div><br><div class="xLinea"></div><br><div style="text-align:center"class="xfont18"><p>Tiempo de despacho en minutos por pedido.<p></div><div id="chart_linea_tiempo_pedido"style="margin:auto 0;width:100%;height:400px"></div><br><br><div class="xLinea"></div><br><div style="text-align:center"><div class="xdiv_promedio xEnLinearTop"><div class="xdiv_promedio_show"style="border-radius:5px;display:inline-block;padding:10px"><h2 class="xBold"id="val_tt_p">50'</h2><p>Minutos, en promedio se tomo en despachar un pedido</div></div><div class="xEnLinearTop"><div id="chart_indicador"style="margin:auto 0;width:500px;height:250px"></div></div></div><br><div class="xLinea"></div><br></div></iron-pages></template><style type="text/css">.dialog_color{border-radius:5px;position:fixed;top:10px;right:10px}.xdiv_promedio{padding:20px;text-align:center;width:90px;border-radius:10px;color:#fff}.xEnLinearTop{display:inline-block;vertical-align:middle}.xContent_zd_pedido_vertical{width:100%!important}.body-zona-theme-2{background-color:#344465!important}</style></dom-module><script>var xThisZonaDespacho,xObjPedido,xRefresh_tiempo,xelem_tt_p_cola,xhora_actual_serv,element_sonido,isSocket,$grid,itemPedidoEntregar,xdes_mesa_pedido="",xdata_zona=[],xIdZonaSeccion="",xIdTp="",des_despacho="",xValCountPedidosDespacho=0,xUltimoIdPedidoEnZona=0,xColorMarcado="xNaranja",xtiempo_maximo=0,tiempo_medio=0,xNumReservas=0;function pruebaAddPedido(){$(".xContent_zd_pedido-t1").append('<div class="xmarco_zd_pedido ini"><h3>pedido</h3><h3>pedido</h3><h3>pedido</h3><h3>pedido</h3><h3>pedido</h3></div>').trigger("create"),setTimeout(function(){xTransicionPedido()},100)}function xIniZonaDespacho(){xm_LogChequea(function(){xm_log_get("ini_us"),xPopupLoad=document.getElementById("xLoad"),$("#Titulo_page").text("Zona de despacho"),$("#panel_toolbar").hide(),xLoadZonaDespacho(),$("body").addClass("loaded"),xelem_tt_p_cola=$("#tt_pedidos_cola"),(element_sonido=document.getElementById("sonido_notifica_despacho")).autobuffer=!0,element_sonido.load();try{element_sonido.play()}catch(e){}}),$(document.body).on("click",".xtabla_pedido_despacho-t1 tr td",function(e){$(this).hasClass("des_seccion")||($(this).hasClass("xmarcado")?$(this).removeClass():$(this).addClass(xColorMarcado+" xmarcado"),e.stopPropagation(),e.stopImmediatePropagation())}),$(document.body).on("click",".xBtnDespacho",function(e){"Enviar a despacho"===$(this).text()?$(this).text("Confirmar envio"):"Listo"===$(this).text()?$(this).text("Confirmar"):("Confirmar"===$(this).text()&&xDespachado_retirado(xObjPedido=$(this).parents(".xmarco_zd_pedido"),0),"Confirmar envio"===$(this).text()&&(xObjPedido=$(this).parents(".xmarco_zd_pedido"),$(xObjPedido).addClass("retirada"),xEnviarReservaDespacho(xObjPedido))),e.stopPropagation(),e.stopImmediatePropagation()}),$(document.body).on("click",".xBtnDespacho_retirar",function(e){"Retirar"===$(this).text()?$(this).text("Confirma"):xDespachado_retirado(xObjPedido=$(this).parents(".xmarco_zd_pedido"),1),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}),disableScrollRefresh()}function xCheckStorageChecksZD(){var e=window.localStorage.getItem("::app3_woZD"),o=window.localStorage.getItem("::app3_woZD_TP"),a=window.localStorage.getItem("::app3_woZD_orderItemVerticalZD");a&&(xThisZonaDespacho.orderItemsVerticalZD="true"===a,xThisZonaDespacho.orderItemsVerticalZD)&&xZD_listVertical(),null==e||""==e.trim()?(xOpenLateralIzq(),xPopupLoad.xclose()):(e=e.split(","),o=o.split(","),0<e.length&&e.forEach(function(a,e){$(".check_zona").each(function(e,o){o.dataset.ids==a&&(o.checked=!0)})}),0<o.length&&(o.forEach(function(a,e){$(".check_tp").each(function(e,o){o.dataset.tp==a&&(o.checked=!0)})}),xUltimoIdPedidoEnZona=xValCountPedidosDespacho=0,xEstablecerFiltroDespachos()))}function xCargarChartDespacho(){closeDrawer_izq(),xThisZonaDespacho.select_div=3,$.ajax({type:"POST",url:"../../bdphp/log_chart.php?op=1",data:{arr_filtro:xdata_zona}}).done(function(e){var o,e=$.parseJSON(e),a=1,t=0,d=0,i=0,n=0,s=0,r="",c=(e=e.datos).length,p=e.filter(({estado:e})=>"4"!==e);e.forEach(function(e){"4"===e.estado?s++:(o=parseInt(e.minutos),t+=o,xtiempo_maximo<=o?n++:tiempo_medio<=o?i++:d++,a++)}),t=parseInt(t/a),r=xtiempo_maximo<=t?"#E53935":tiempo_medio<=t?"#ffa000":"#43a047",$("#val_tt_p").text(t+"'"),$(".xdiv_promedio_show").css("background",r),$("#tt_max_p").text(xtiempo_maximo+" minutos |"),$("#tt_pd").text(xCeroIzq(a-1,2)+" | "),$("#tt_an").text(xCeroIzq(s,2)),c3.generate({bindto:"#chart_linea_tiempo_pedido",data:{json:p,keys:{x:"despachado_hora",value:["minutos"]},type:"area-spline"},grid:{y:{lines:[{value:xtiempo_maximo,text:"Tiempo maximo establecido",position:"start"}]}},axis:{x:{type:"category"}},legend:{show:!1},color:{pattern:[r]}}),c3.generate({bindto:"#chart_indicador",data:{columns:[["Total",c],["A tiempo",d],["Medio tiempo",i],["Fuera de tiempo",n],["Retirados",s]],type:"bar",labels:!0},color:{pattern:["#1976d2","#43a047","#ffa000","#E53935","#6d4c41"]}})})}function xTransicionPedido(){$(element_sonido).trigger("play"),$(".xmarco_zd_pedido.ini").each(function(e,o){$(o).removeClass("ini"),element_sonido.pause(),element_sonido.currentTime=0,element_sonido.play(),xResumenPedidosItem()})}function xVerPedidosDespachados(){closeDrawer_izq(),xThisZonaDespacho.select_div=1,clearInterval(xRefresh_tiempo);var c=$(".grid_pedidos_despachados");try{$(c).empty(),$(c).isotope()&&$(c).isotope("destroy")}catch(e){}$(c).html('<paper-spinner active class="xCentradoVerticalHorizontal"></paper-spinner>').trigger("create"),$.ajax({type:"POST",url:"../../bdphp/log.php?op=2103",data:{idzona:xdata_zona.idseccion}}).done(function(e){for(var o,a,t="",d="",i="",n="xFondoRowverde_estado_pedido",s=$.parseJSON(e).datos,r=0;r<s.length;r++)i="Mesa",d=""===s[xindex=r].nummesa||"0"===s[xindex].nummesa?(i="Pedido",xCeroIzq(s[xindex].correlativo_dia,4)):xCeroIzq(s[xindex].nummesa,2),n="xFondoRowverde_estado_pedido",a=(o=s[xindex].despachado_tiempo).split(":")[0],xtiempo_maximo<=a?n="xFondoRowRojo_estado_pedido":tiempo_medio<=a&&(n="xFondoRowAmarillo_estado_pedido"),t=String(t+'<div class="xMiCardPedido xCursor '+n+'" data-hora="'+s[xindex].despacho_tiempo+'" data-color="'+n+'" data-p="'+s[xindex].idpedido+'" data-nummesa="'+s[xindex].nummesa+'" data-correlativo="'+s[xindex].correlativo_dia+'"  data-numpedido="'+s[xindex].numpedido+'" onclick="xVerDetallePD(this)"><p class="tipo">'+i+'</p><h3 class="numero xBold">'+d+'</h3><p class="referencia xfont9">'+s[xindex].idpedido+'</p><p class="referencia xfont12">'+s[xindex].referencia+'</p><p class="tiempo xBold">'+o+"</p></div>");$(c).html($(t)).trigger("create").isotope({itemSelector:".xMiCardPedido"})})}function xVerDetallePD(o){var a=$(o).attr("data-p"),t=$(o).attr("data-color");xPopupLoad.titulo="Cargando...",xPopupLoad.xopen(),$.ajax({type:"POST",url:"../../bdphp/log.php?op=2104",data:{id:a}}).done(function(o){var d,o=$.parseJSON(o),i="",n="",s="",o=o.datos;for(e in d=xElaborarArray(o))itemPedidoEntregar=d[e],xThisZonaDespacho.isPedidoDespachado="0"!==d[e].pwa_delivery_status,""===d[e].nummesa||"0"===d[e].nummesa?(xdes_mesa_pedido="Pedido",xcont_mesa=xCeroIzq(d[e].correlativo_dia,4)):(xcont_mesa=xCeroIzq(d[e].nummesa,2),xdes_mesa_pedido="Mesa"),n="",a=e,xcadena_enca='<div class="xmarco_zd_pedidox" data-id="'+a+'"><div class="encabezado '+t+'" data-id="'+a+'" id="enca_'+a+'" data-tiempo="'+d[e].hora+'"><table width="100%" class="xtable4"><tr class="xSinBorde_tr"><td><div class="xEncabezado_zd_pedido"><p class="xfont30">'+xcont_mesa+"</p><span>"+xdes_mesa_pedido+'</span></div></td><td><div class="xEncabezado_zd_pedido"><p id="val_num_cola">-</p><span># en cola</span></div></td><td><div class="xEncabezado_zd_pedido"><p id="val_minutos">'+d[e].despachado_tiempo+"</p><span>minutos</span></div></td></tr></table></div>",null!==d[e]&&($.map(d[e],function(o,a){const t=d[e].referencia;"object"==typeof o&&($.map(o,function(a,e){xcadena_tp_c='<div id="ref_pedido" class="referencia xFondoRowIndigo"><p>'+o.des_tipo_consumo+'<br><span class="xBold">'+t+'</span></p></div><div id="body_pedido"><table width="100%" class="xtabla_pedido_despacho">',"object"==typeof a&&($.map(a,function(e,o){"object"==typeof e&&(i=String(i+'<tr class="row row_item" data-id="'+e.idpedido_detalle+'" data-iditem="'+e.iditem+'" data-idseccion="'+a.idseccion+'"><td>'+xCeroIzq(e.cantidad_r,2)+" | "+e.descripcion+"</td></tr>"))}),n=String(n+'<tr><td class="xSinBorde xBold des_seccion" data-id="'+a.idseccion+'">'+a.des_seccion+"</td></tr>"+i),i="")}),""!==n)&&(n=String(xcadena_tp_c+n),s=String(s+n+"</table>"),n="")}),s=String(xcadena_enca+s+"</div></div></div>"));$("#div_pd_detalle").html(s).trigger("create"),xPopupLoad.xclose(),dialog_detalle_pd.open()})}function xDespachado_retirado(e,o){var a="",t=$(e).attr("data-id"),d=$(e).find("#val_minutos").text(),e=(xPopupLoad.xopen(),$(e).find(".row_item").each(function(e,o){a=a+$(o).attr("data-id")+","}),a=t,$(e).find(".encabezado")),i=e.hasClass("xFondoRowverde")?1:0;i=e.hasClass("xFondoRowAmarillo_estado_pedido")?2:i,i=e.hasClass("xFondoRowRojo_estado_pedido")?3:i,$.ajax({type:"POST",url:"../../bdphp/log.php?op=2102",data:{idp:t,id_pd:a,op:o,td:d,valEstado:i}}).done(function(e){e=$.parseJSON(e),xThisZonaDespacho.orderItemsVerticalZD?($("#xContent_zd_pedido-t1").isotope("remove",$(xObjPedido)).isotope("layout"),$("#xContent_zd_pedido-t1").isotope("updateSortData"),xResumenPedidosItem()):($(xObjPedido).addClass("retirada"),setTimeout(function(){$(xObjPedido).remove(),xObjPedido.empty(),xResumenPedidosItem()},1500)),xPopupLoad.xclose(),_zonaSocketprinterOnly(xObjPedido)})}function xVerSiPedidos_logrun(){var o;isSocket||"undefined"!=typeof EventSource&&((xsourceEvent=new EventSource("../../bdphp/log_run.php?op=2&tp="+xdata_zona.tipo_consumo+"&ids="+xdata_zona.idseccion)).onmessage=function(e){o=e.data.split(","),xhora_actual_serv=o[1],o[0]!==xValCountPedidosDespacho&&(xValCountPedidosDespacho=o[0],xActualizarPedidosZona())})}function xVerSiPedidos_logrun_socket(){let o="";var e="../../bdphp/log_run.php?op=201&tp="+xdata_zona.tipo_consumo+"&ids="+xdata_zona.idseccion;(new httpFecht).axiosExecute({type:"GET",url:e,isShowPreload:!1}).then(e=>{o=e.split(","),xhora_actual_serv=o[1];e=o[0].trim(),e=parseInt(e.replace(/\D/g,""));e!==parseInt(xValCountPedidosDespacho)&&(xValCountPedidosDespacho=e,xActualizarPedidosZona())})}function _zonaSocketPintarPedido(e){xVerSiPedidos_logrun_socket()}function xActualizarPedidosZona(){var h,u=parseInt($(".xmarco_zd_pedido").length);let v={icon_pedido:"x-icon-mesa.png",mozo:"",nummesa:"",n_cola:0};$.ajax({type:"POST",url:"../../bdphp/log.php?op=2101",data:{id:xUltimoIdPedidoEnZona,num_pedidos_cola:u,arr_filtro:xdata_zona}}).done(function(o){var o=$.parseJSON(o),s="",r="",c="",p="",l="",x="",a="",_=0,o=o.datos;for(e in h=xElaborarArray(o)){c="",u++;var m=e,_=xCeroIzq(h[e].nummesa,2),t=xCeroIzq(h[e].correlativo_dia,3),d=convertirHoraFormat12Hrs(h[e].hora);if("00"===_&&(_=t),null!==h[e]){let n=0;$.map(h[e],function(o,a){var t,d,i=""===(i=h[e].referencia)?"":`<div class="referencia-t1">REF: ${i}</div>`;"object"==typeof o&&null!==o&&(d="MESA"==(t=-1<o.des_tipo_consumo.indexOf("LOCAL")?"MESA":-1<o.des_tipo_consumo.indexOf("LLEVAR")?"LLEVAR":"DELIVERY")?"x-icon-mesa.png":"LLEVAR"==t?"x-icon-llevar.png":"x-icon-delivery.png",0===n?(v.icon_pedido="../../images/"+d,v.nummesa=t+" "+_,v.n_cola=xCeroIzq(u,2),v.mozo=h[e].mozo,s=`<div class="xmarco_zd_pedido ini noselect" data-id="${m}">
                                                    <div class="encabezado xFondoRowverde" data-id="${m}" id="enca_'${m}" data-reserva="${h[e].reserva}" data-tiempo="${h[e].hora}">
                                                        <div class="d-flexx align-items-center">
                                                            <img src="${v.icon_pedido}" alt="icon-${t}" class="mr-2">
                                                            <div>
                                                                <p class="tpc">${v.nummesa}</p>
                                                                <p>Atendió: <strong>${v.mozo}</strong></p>
                                                            </div>
                                                        </div>
                                                        <div class="text-right">
                                                            <p class="fs-15 fw-600" id="val_minutos">00:00</p>                                                            
                                                            <p>#Cola: <span id="val_num_cola"><strong>${v.n_cola}</strong></span></p>
                                                        </div>
                                                    </div>
                                                    `+i):r=`<div class="tpc-secondary referencia-t1">${t}</div>`,n++,$.map(o,function(t,e){p=r+'<table width="100%" class="xtabla_pedido_despacho-t1 w-100 mb-3">',"object"==typeof t&&($.map(t,function(a,e){if("object"==typeof a){let e=a.descripcion,o="";if(-1<e.search(/\(([^)]+)\)/)){o=e.match(/\((.*)\)/)[1],e=e.replace(/\((.*)\)/,"").trim();let a=o.split(","),t=(a=a.filter(e=>""!==e.trim()),"<ul class='list-indicaciones'>"),d=!1;for(let o=0;o<a.length;o++){let e=a[o].trim();""!==e&&(e.startsWith("(")?(d=!0,e=e.substring(1),t=(t+="<ul>")+"<li>"+e):e.endsWith(")")?(d=!1,0!==(e=e.substring(0,e.length-1)).trim().length&&(t+="<li>"+e+"</li>"),t+="</ul>"):(d,t+="<li>"+e+"</li>"))}t+="</ul>",o=t}else o="";l=String(l+'<tr class="row row_item" data-id="'+a.idpedido_detalle+'" data-iditem="'+a.iditem+'" data-idseccion="'+t.idseccion+'"><td>'+xCeroIzq(a.cantidad_r,2)+" | "+e+o+"</td></tr>")}}),c=String(c+'<tr class="des_seccion"><td class="xSinBorde xBold des_seccion" data-id="'+t.idseccion+'">- '+t.des_seccion+" -</td></tr>"+l),l="")}),""!==c)&&(c=String(p+c),x=String(x+c+"</table>"),c="")});t=`<div class="footer-pedido">
                            <p>#${t}</p>
                            <p>${d}</p>
                        </div>`;"1"===h[e].reserva?(xNumReservas++,a='<div class="xFlex xpie_zd_btn_pedido" id="btn_pedido"><div id="bt_retirar" class="xAlinearce xBtnDespacho_retirar noselect xCursor" style="width:60px">Retirar</div><div id="bt_despachado" class="xAlinearce xBtnDespacho noselect xCursor" style="width:240px">Enviar a despacho</div></div>',x=String(s+x+t+a+"</div>"),$("#div_reserva").append(x).trigger("create"),$("#tt_pedidos_reserva").parent().parent().removeClass("xInvisible"),xCuentaReservas()):(a='<div class="xFlex xpie_zd_btn_pedido" id="btn_pedido"><div id="bt_retirar" class="xAlinearce xBtnDespacho_retirar noselect xCursor" style="width:60px">Retirar</div><div id="bt_despachado" class="xAlinearce xBtnDespacho noselect xCursor" style="width:240px">Listo</div></div>',x=String(s+x+t+a+"</div>"),d=$(x),xThisZonaDespacho.orderItemsVerticalZD?(d.css("animation-name","none"),$("#xContent_zd_pedido-t1").append(d).isotope("appended",d)):($("#xContent_zd_pedido-t1").append(x).trigger("create"),d.css("animation-name","ini_pedido"))),setTimeout(function(){xTransicionPedido(),xThisZonaDespacho.orderItemsVerticalZD&&($("#xContent_zd_pedido-t1").isotope("layout"),$("#xContent_zd_pedido-t1").isotope("updateSortData"))},100),element_sonido.play(),x=""}}xThisZonaDespacho.orderItemsVerticalZD&&setTimeout(()=>{$("#xContent_zd_pedido-t1").isotope("layout")},1500),xUltimoIdPedidoEnZona=xValCountPedidosDespacho})}function xResumenPedidosItem(){var t,d,i,e,n=[],o="",s="",r=0;for(a in $(".xtabla_pedido_despacho-t1 .des_seccion").each(function(e,o){t=o.dataset.id,void 0===n[t]&&(n[t]={id:t,des_seccion:o.textContent})}),n)$(".xtabla_pedido_despacho-t1 .row_item").each(function(e,o){t=o.dataset.idseccion,d=o.dataset.iditem,xtxt_item=o.textContent.split("|"),t===a&&(i=void 0!==n[a][d]?parseInt(n[a][d].cantidad_r)+parseInt(xtxt_item[0]):parseInt(xtxt_item[0]),n[a][d]={iditem:d,des_item:xtxt_item[1],cantidad_r:i})});var o="",c=Object.keys(n).sort();for(x in c)x=c[x],e='<tr><td colspan="2" class="xBold">'+n[x].des_seccion+"</td></tr>",r=0,s="",$.map(n[x],function(e,o){"object"==typeof e&&(r=parseInt(r)+parseInt(e.cantidad_r),s=String(s+"<tr><td>"+e.des_item.toUpperCase()+'</td><td align="right">'+xCeroIzq(e.cantidad_r,2)+"</td></tr>"))}),o=String(o+e+s+'<tr class="xSinBorde_tr"><td colspan="2" class="xBold" align="right">'+xCeroIzq(r,2)+"</td></tr>");$("#tb_resumen_pedido").html(o).trigger("create")}function xRefrecarTiempoMinutos(){var d,o,i=0;$(".xmarco_zd_pedido .encabezado").each(function(e,t){"1"!==t.dataset.reserva&&(o=t.dataset.tiempo,xTiempoTranscurridos_2(o,function(e,o,a){i++,d=o+":"+a,$(t).find("#val_minutos").text(d),$(t).find("#val_num_cola").text(xCeroIzq(i,2)),xCalcularEstadoSegunTiempo($(t),d)}))}),xelem_tt_p_cola.text(xCeroIzq(i,2))}function xCalcularEstadoSegunTiempo(e,o){o=o.split(":")[0];xtiempo_maximo<=o?(e.removeClass("xFondoRowverde_estado_pedido"),e.removeClass("xFondoRowAmarillo_estado_pedido"),e.addClass("xFondoRowRojo_estado_pedido")):tiempo_medio<=o&&(e.removeClass("xFondoRowverde_estado_pedido"),e.addClass("xFondoRowAmarillo_estado_pedido"))}function xLoadZonaDespacho(){$.ajax({type:"POST",url:"../../bdphp/log.php?op=21"}).done(function(e){for(var o=$.parseJSON(e),t="",o=o.datos,t='<br><h4>Zonas de despacho</h4><div class="xLinea"></div><br>',a=0;a<o.length;a++)t=String(t+'<paper-checkbox class="check_zona" data-ids="'+o[a].idimpresora+'" data-tiempo="'+o[a].minutos_pedido+'">'+o[a].descripcion+"</paper-checkbox><br>");xPopupLoad.xopen(),$.ajax({type:"POST",url:"../../bdphp/log.php?op=3"}).done(function(e){var o=$.parseJSON(e).datos;t+='<br><br><h4>Tipos de consumo</h4><div class="xLinea"></div><br>';for(var a=0;a<o.length;a++)t=String(t+'<paper-checkbox class="check_tp" data-tp="'+o[a].idtipo_consumo+'">'+o[a].descripcion+"</paper-checkbox><br>");$("#div_zona_despacho").html(t),setTimeout(()=>{xCheckStorageChecksZD()},1500)})})}function xCalcularMinutosDespacho(e){xtiempo_maximo=e,tiempo_medio=parseInt(.6*xtiempo_maximo),$("#min_max_pedido").html(xCeroIzq(xtiempo_maximo,2)+'<span class="xfont9">min x pedido</span>').trigger("create")}function xEstablecerFiltroDespachos(){element_sonido.play(),xIdTp=des_despacho=xIdZonaSeccion="",xmin_pedido=0,xmin_pedido_ultimo=0,$(".check_zona").each(function(e,o){o.checked&&(xIdZonaSeccion=xIdZonaSeccion+$(o).attr("data-ids")+",",xmin_pedido_ultimo=parseInt($(o).attr("data-tiempo")),isNaN(xmin_pedido_ultimo)&&(xmin_pedido_ultimo=0),des_despacho=des_despacho+xMayusculaPrimera(xSoloMinuscula($(o).text().trim()))+",",xmin_pedido_ultimo>xmin_pedido)&&(xmin_pedido=xmin_pedido_ultimo)}),xCalcularMinutosDespacho(xmin_pedido),des_despacho=des_despacho.slice(0,-1)+" | ",$(".check_tp").each(function(e,o){o.checked&&(xIdTp=xIdTp+$(o).attr("data-tp")+",",des_despacho=des_despacho+xMayusculaPrimera(xSoloMinuscula($(o).text().trim()))+",")}),des_despacho=des_despacho.slice(0,-1),xIdZonaSeccion=xIdZonaSeccion.slice(0,-1),xIdTp=xIdTp.slice(0,-1),window.localStorage.setItem("::app3_woZD",xIdZonaSeccion),window.localStorage.setItem("::app3_woZD_TP",xIdTp),window.localStorage.setItem("::app3_woZD_orderItemVerticalZD",xThisZonaDespacho.orderItemsVerticalZD),xdata_zona=[],xdata_zona={tipo_consumo:xIdTp,idseccion:xIdZonaSeccion},$("#des_titulo_despacho").text(des_despacho),closeDrawer_izq(),"undefined"!=typeof xsourceEvent&&xsourceEvent.close(),$("#xContent_zd_pedido-t1").html("").trigger("create"),xUltimoIdPedidoEnZona=xValCountPedidosDespacho=0,xThisZonaDespacho.select_div=0,xVerSiPedidos_logrun(),xVerSiPedidos_logrun_socket(),xRefresh_tiempo=setInterval(function(){xRefrecarTiempoMinutos(),xPopupLoad.xclose()},1e3)}function xElaborarArray(e){for(var o,t,d=e,i=[],n="",s=0;s<d.length;s++)void 0===i[r=d[s].idpedido]&&(i[r]={id:r,fecha_hora:d[s].fecha_hora,hora:d[s].hora,nummesa:d[s].nummesa,correlativo_dia:d[s].correlativo_dia,referencia:d[s].referencia,reserva:d[s].reserva,des_tipo_consumo:d[s].des_tipo_consumo,idtipo_consumo:d[s].idtipo_consumo,despachado_tiempo:d[s].despachado_tiempo,reserva:d[s].reserva,pwa_delivery_status:d[s].pwa_delivery_status,idcliente:d[s].idcliente,mozo:d[s].mozo.split(" ")[0]});for(a in i)for(var r=i[a].id,s=0;s<d.length;s++)r===d[s].idpedido&&(n=d[s].idtipo_consumo,void 0===i[r][n])&&(i[r][n]={idtipo_consumo:n,des_tipo_consumo:d[s].des_tipo_consumo});for(a in i){r=i[a].id;for(s=0;s<d.length;s++)if(r===d[s].idpedido&&(n=d[s].idtipo_consumo,o=d[s].idseccion_index,void 0===i[r][n][o])){i[r][n][o]={idseccion:o,des_seccion:d[s].des_seccion};for(var c=0;c<d.length;c++)r===d[c].idpedido&&n===d[c].idtipo_consumo&&o===d[c].idseccion_index&&(t=d[c].idpedido_detalle,i[r][n][o][t]={idpedido_detalle:d[c].idpedido_detalle,iditem:d[c].iditem,cantidad_r:d[c].cantidad_r,descripcion:d[c].descripcion})}}return i}function xEnviarReservaDespacho(e){var o=$(e).attr("data-id");xObjPedido.find(".encabezado").attr("data-reserva",0),setTimeout(function(){$(xObjPedido).remove(),$.ajax({type:"POST",url:"../../bdphp/log.php?op=2105",data:{i:o}}).done(function(e){0===xCuentaReservas()&&(xThisZonaDespacho.select_div=0,$("#btn_ver_reserva").addClass("xInvisible")),xActualizarPedidosZona()})},2e3)}function xCuentaReservas(){var e=parseInt($("#div_reserva .xmarco_zd_pedido").length);return $("#tt_pedidos_reserva").text(xCeroIzq(e,2)),e}function xVerReservas(){xThisZonaDespacho.select_div=2}function xVerDepacho(){clearInterval(xRefresh_tiempo),xRefresh_tiempo=setInterval(function(){xRefrecarTiempoMinutos()},1e3),xThisZonaDespacho.select_div=0}function xOpenLateralIzq(){document.getElementById("xdrawerIzq").style.width="280px"}function xOpenLateralDe(){document.getElementById("xdrawerDe").style.width="380px"}function closeDrawer_izq(){try{document.getElementById("xdrawerIzq").style.width="0"}catch(e){}}function closeDrawer_de(){document.getElementById("xdrawerDe").style.width="0"}function xRefreshMarcador(e){xColorMarcado=$(e).attr("data-color"),dialog_marcar.close()}function xDespacharTodos(){$.ajax({type:"POST",url:"../../bdphp/log.php?op=2109"}).done(function(e){dialog_despachar.close()})}function pedidoDeliveryEntregado(){try{"0"===itemPedidoEntregar.pwa_delivery_status&&$.ajax({type:"POST",url:"../../bdphp/log.php?op=2202",data:{i:itemPedidoEntregar.id}}).done(function(e){_zonaSocketPedidoEntregado(itemPedidoEntregar.idcliente),dialog_detalle_pd.close()})}catch(e){}}function changeOderItemsZD(e){xThisZonaDespacho.orderItemsVerticalZD=!xThisZonaDespacho.orderItemsVerticalZD,window.localStorage.setItem("::app3_woZD_orderItemVerticalZD",xThisZonaDespacho.orderItemsVerticalZD),xThisZonaDespacho.orderItemsVerticalZD?xZD_listVertical():($("#xContent_zd_pedido-t1").isotope("destroy"),$("#xContent_zd_pedido-t1").removeClass("xContent_zd_pedido_vertical"))}function changeModeViewZD1(){xOpenPage(2301)}function xZD_listVertical(){$("#xContent_zd_pedido-t1").addClass("xContent_zd_pedido_vertical"),$("#xContent_zd_pedido-t1").isotope({itemSelector:".xmarco_zd_pedido",layoutMode:"masonry",percentPosition:!0,getSortData:{numero:"[data-id]"},sortBy:["numero"],masonry:{horizontalOrder:!0}}),setTimeout(()=>{$("#xContent_zd_pedido-t1").isotope("layout")},1500)}Polymer({is:"x-zona_despacho_theme_2",properties:{isPedidoDespachado:Boolean,orderItemsVerticalZD:Boolean},attached:function(){this.select_div=0,this.orderItemsVerticalZD=!1,xThisZonaDespacho=this,setTimeout(()=>{_zonaSocketConnect()},1e3),xIniZonaDespacho(),setTimeout(()=>{document.body.style.backgroundColor="#424158"},1500)},detached:function(){document.body.style.backgroundColor="#FAFAFA",_zonaSocketClose(),clearInterval(xRefresh_tiempo),enableScrollRefresh()}})</script>