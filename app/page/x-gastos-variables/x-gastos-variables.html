<link rel="import"href="../../x-componentes/x-comp-find-tipo-gasto/x-comp-find-tipo-gasto.html"><dom-module id="x-gastos-variables"><template is="dom"><paper-dialog class="dialog_redondo"id="dialog_borrar"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="xtxtCentro"><img src="../../../images/_dlg_remove.gif"alt=""width="150px"></div><p>Esta seguro de querer borrar este registro?</p><br><div class="buttons"><button class="xBoton2 xPlomo"dialog-dismiss>Cancelar</button> <button class="xBoton2 xRojo"onclick="xDlgBorrar()">Si, borrar</button></div></paper-dialog><paper-dialog class="dialog_redondo"id="dialog_new_gasto_v"style="width:345px"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"><div><h4>Registrar nuevo gasto varialbe.</h4><br><form id="form_new_gasto_v"method="POST"><x-comp-find-tipo-gasto id="compTpGasto"id-tipo-gasto="2"onchange="_getTipoGastoDetalle(list_tipo_gasto)"></x-comp-find-tipo-gasto><input type="date"class="xMiInput xPasarEnter2"id="date_fecha_pago"espaciar> <input class="xMiInput xPasarEnter2"placeholder="DESCRIPCION"onchange="conMayusculas(this)"id="descripcion"name="descripcion"espaciar required> <input type="number"class="xMiInput xPasarEnter2"placeholder="IMPORTE"onchange="conMayusculas(this)"id="importe"name="importe"espaciar required><div class="xInvisible"><input id="idsede"name="idsede"value$="[[xt_idsede]]"> <input id="idorg"name="idorg"value$="[[xt_org]]"> <input id="idtipo_gasto"name="idtipo_gasto"> <input id="idtipo_gasto_detalle"name="idtipo_gasto_detalle"> <input id="fecha_registro"name="fecha_registro"> <input id="fecha_pago"name="fecha_pago"></div></form><br><br><button dialog-dismiss id="dlg_sunat_btn"onclick="newGasto()"class="xBoton2 xVerde">Listo Guardar</button> <button dialog-dismiss class="xBoton2 xRojo">Cerrar</button></div></paper-dialog><br><br><div class="xMiCard xradius"style="width:90%"><div class="xEncanezadoCard xFondoRowAmarillo2"><h3>Gastos Variables.</h3><p>Registra los gastos variables, por ejemplo: Compras no registradas, gastos administrativos, gastos de servicios ocacionales, etc.</div><div class="xContentCard"style="height:100%"><div style="width:200px"class="xIzquierda"><input type="month"class="xMiInput xPasarEnter2 xfont18"id="f_filtro"onchange="_changeDateFiltro(this)"></div><paper-fab icon="add"onclick="dialog_new_gasto_v.open()"title="Agregar"tabindex="0"class="xDerecha"></paper-fab><table width="100%"><thead><th>#<th>Tipo Gasto<th>Descripcion<th>F. Registro<th>F. Pago<th>Importe<th><tbody><template is="dom-repeat"items="{{ListGastosVariables}}"as="item"><tr data-t="contable_gasto_variable"data-id="{{item.idcontable_gasto_variable}}"class="animated fadeIn fast"id="{{index}}"onclick="_selItemGastoFijo(this)"><td data-id="{{index}}"><span>{{displayIndex(index)}}</span><td>{{item.tp_gasto}}<td>{{item.descripcion}}<td>{{item.fecha_registro}}<td>{{item.fecha_pago}}<td>{{item.total}}<td><span class="xDeleteRow2"title="Anular"onclick="xDialogBorrarObj(this)"></span></template><tr><td><td colspan="4"><p class="xfont15 xBold">Total<td><p class="xfont15 xBold">{{sumList}}<td></table></div></div></template></dom-module><script>var xThisGV,sel_idTipoGastoDetalle,xObjBorrar,_mm,_yy,dateNow,fecha_filtrar=new Date;function xIniGastosVariables(){$("body").addClass("loaded");var a=xm_log_get("app3_us"),a=(xThisGV.xt_org=a.ido,xThisGV.xt_idsede=a.idsede,xThisGV.xt_idus=a.idus,(dateNow=new Date).toISOString().split("T")[0]),a=(date_fecha_pago.max=a,date_fecha_pago.value=a,dateNow.getFullYear()+"-"+xCeroIzq(dateNow.getMonth()+1,2));f_filtro.max=a,f_filtro.value=a,_mm=fecha_filtrar.getMonth()+1,_yy=fecha_filtrar.getFullYear(),getAllListGastosVariables(),$(".xPasarEnter2").on("keyup",function(a){a=a.which;if(13==a||186==a){var a=$("input"),e=a.index(document.activeElement);if(null!==a[e+1]){var t=a[e+1];if(void 0===t)return;if(null==(t=t.disabled?a[e+2]:t))return;t.focus(),t.select()}return!1}}),setTimeout(()=>{sel_idTipoGastoDetalle=compTpGasto.__data__.list_tipo_gasto.idtipo_gasto_detalle},1e3)}function getAllListGastosVariables(){$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=103",data:{mm:_mm,yy:_yy}}).done(a=>{var a=JSON.parse(a),e=0;xThisGV.ListGastosVariables=a.datos.map(a=>(e+=parseFloat(a.importe),a)),xThisGV.sumList=numeroConComas(e.toFixed(2))})}function newGasto(){xPopupLoad.xopen();var a=$("#form_new_gasto_v");a.find("#idsede").val(xThisGV.xt_idsede),a.find("#idorg").val(xThisGV.xt_org),a.find("#idtipo_gasto").val(1),a.find("#idtipo_gasto_detalle").val(sel_idTipoGastoDetalle),a.find("#fecha_pago").val(xDevolverFechaFormatInputDate(date_fecha_pago.value)),a.find("#fecha_registro").val(xDevolverFecha()),xvalidateForm("form_new_gasto_v",function(a){!1!==a&&$.post("../../bdphp/ManejoBD_IUD.php?tb=contable_gasto_variable",$("#form_new_gasto_v").serialize(),function(a){xPopupLoad.xclose(),$("#form_new_gasto_v").reset(),xPopupLoad.xclose(),date_fecha_pago.value=dateNow.toISOString().split("T")[0],getAllListGastosVariables(),dialog_new_gasto_v.close()})})}function _changeDateFiltro(a){a=a.value.split("-");_mm=a[1],_yy=a[0],getAllListGastosVariables()}function xDialogBorrarObj(a,e){xObjBorrar=a,dialog_borrar.open(),e.stopPropagation()}function xDlgBorrar(){xBorrarItem(xObjBorrar),dialog_borrar.close()}function _getTipoGastoDetalle(a){sel_idTipoGastoDetalle=a.idtipo_gasto_detalle}Polymer({is:"x-gastos-variables",properties:{xt_org:Number,xt_idsede:Number,sumList:String,ListGastosVariables:[],selItemGastoVariable:[]},attached:function(){this.selected=0,xThisGV=this,xIniGastosVariables()},displayIndex:function(a){return xCeroIzq(a+1,1)}})</script>