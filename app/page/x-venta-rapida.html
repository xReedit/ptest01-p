<dom-module id="x-venta-rapida"><script src="../view/httpFech.js"></script><script src="../view/cupon_manager.js"></script><link rel="import"href="../web_components/x-pago/x-pago.html"><link rel="import"href="../x-componentes/x-comp-find-categoria/x-comp-find-categoria.html"><link rel="import"href="../web_components/paper-progress/paper-progress.html"><link rel="import"href="../x-componentes/x-comp-datos-delivery/x-comp-datos-delivery.html"><link rel="import"href="../x-componentes/x-comp-item-subitems/x-comp-item-subitems.html"><link rel="import"href="../x-componentes/x-comp-canal-consumo/x-comp-canal-consumo.html"><link rel="import"href="../x-componentes/x-pedidos-por-pagar/x-pedidos-por-pagar.html"><link rel="import"href="../x-componentes/x-comp-descuento/x-comp-descuento.html"><script rel="preload"src="../../js/isotope.pkgd.min.js"async></script><link rel="import"href="../x-componentes/x-comp-find-card/x-comp-find-card.html"><template><paper-dialog id="dialog_nuevo_pedido"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><h2>Nuevo Pedido</h2><p>Si tiene un pededido pendiente de confirmacion se borrara para generar uno nuevo.</p><br><div class="buttons"><button class="xBoton2 xPlomo"dialog-dismiss>Cancelar</button> <button class="xBoton2 xRojo"onclick="xNuevoPedidoDialogVR()">Nuevo pedido.</button></div></paper-dialog><paper-dialog id="dialog_opciones_adcionales"class="xDlgItem_mipedido"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div><h4>Opciones Adicionales</h4></div><br><div><div><paper-toggle-button id="toogleFullscreen"class="x-toogle"onclick="xActivarFullSreen(this)"></paper-toggle-button><span class="fs-13">Fullscreen</span><p class="fs-12 text-secondary">Activar pantalla completa.</div><br><div><paper-toggle-button id="toogleShowOpciones"class="x-toogle"onclick="xActivarFirstOptionsItem(this)"></paper-toggle-button><span class="fs-13">Ver opciones primero</span><p class="fs-12 text-secondary">Si el producto tiene opciones por escoger, escoger antes de agregar.</div><br><div><paper-toggle-button id="toogleTouch"onclick="xActivarTouch(this)"checked="true"></paper-toggle-button><span class="fs-13">Touch?</span><p class="fs-12 text-secondary">Al tocar el producto o item se agrega sin necesidad de dar clic en el signo "+"</div><br><br><button class="btn btn-sm btn-secondary"dialog-dismiss>Cerrar</button></div><br><br></paper-dialog><div class="tool-bar-vr"><paper-icon-button paper-drawer-toggle icon="menu"onclick="xOpenPanelDeVR()"></paper-icon-button><span onclick="xOpenPedidosCuentaPendientes()"class="xCursor fs-15 fw-600 pr-2"title="Pedidos por Cobrar"><i class="fa fa-files-o"></i> </span><span class="title xtitulo_bar xfont18">Punto de Venta</span><div class="xDerecha"style="display:flex;align-items:center;padding-top:7px;margin-right:10px"><div class="mr-2"><x-comp-find-card id="compFindCategoria"onchange="_getCategoria(categorias)"></x-comp-find-card></div><div style="display:grid;text-align:center;cursor:pointer"onclick="dialog_opciones_adcionales.open()"><span class="fs-15"title="Opciones Adicionales"><i class="fa fa-cog"></i></span></div></div></div><x-comp-datos-delivery id="component_datos_delivery"></x-comp-datos-delivery><x-comp-item-subitems id="comp_subitems"></x-comp-item-subitems><paper-dialog id="dialog_pagar_vr"class="dialog_redondo"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"><div id="div_pago_vr"><x-pago id="component_pago_vr"></x-pago></div></paper-dialog><paper-dialog id="dialog_erro_print"modal style="min-width:330px"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"><h4>Error en impresora</h4><p id="print_error"></p><br><div class="xBoton2 xVerde divLeft23"onclick="xReImprimir()">Intentar Nuevamente</div><div class="xBoton2 xPlomo divLeft23"dialog-dismiss onclick="xNuevoPedidoVR()">No imprimir</div><br><br><br></paper-dialog><div id="contentPedidosPendientesCobrar"class="xInvisible"><x-pedidos-por-pagar id="pedido_pagar_cuenta"></x-pedidos-por-pagar></div><div style="display:contents;background:#eee;width:100%"id="contentVentaRapida"><div class="xContentCard"style="height:100%"><div class="xdivEnLinea2x"><div class="itemsDivx a"><div class="xMenu_Encabezado_small"id="Encabezado_menu_m"><span style="font-size:22px;line-height:25px"id="r_titulo">{{xt_nombre_sede}}</span><div class="xsub_titulo"id="r_subtitulo">[[xt_eslogan]]</div></div><div class="xLineaSombra"id="line_sombra"></div><div class="xMenu_body_vr"id="_xMenu_body_vr"></div></div><div class="itemsDivx b"id="xVentaRapidaBuscar"><div class="xMarginLateral10"><br><input class="xMiInput xfont18"placeholder="Codigo de barras o descripcion"id="txt_bus_item"autofocus></div><br><div class="xLinea2"></div><ul id="accordion"class="list_add_item2"></ul></div><div class="itemsDivx c"><div class="xEncabezadoMesa"><table width="100%"><thead class="xtable3 xFondoRowIndigo"><th align="center"width="30%">MESA<th align="left">REFERENCIA / CLIENTE</thead><tr class="xSinBorde"><td><input type="number"class="xMiInput xfont18 xtxt_enca xBold xAlinearCentro w-100"id="txt_mesa"data-val="mesa"min="0"><td><input class="xMiInput xtxt_enca xfont16 w-100"maxlength="50"onchange="conMayusculas(this)"onkeyup="removeSpecialCharObj(this)"data-val="referencia"id="txt_ref_vr"></table><div class="xLinea7"></div><div class="xLineaSombra"></div></div><br><div class="xCentradoDiv"><x-comp-canal-consumo id="compCanalConsumo"></x-comp-canal-consumo><select class="xMiInput xInvisible"id="select_ulTPC"></select></div><br><div id="xBody"></div><br><br><div class="xLinea7"></div><div class="xLineaSombra"></div><div class="xdiv_Totales"><br><table width="100%"data-tablaname="pedido_subtotales"id="xtb_pedido_subtotales"></table><br><div class="p-2"hidden$="[[!showCompDescuento]]"><x-comp-descuento nom-table-pedido="tb_pedido_detalle"show-detalle="false"id="component_descuento_pedido_vr"importeventa$="[[ importeTotalPedido ]]"classselect="selected-template-1 fs-11"></x-comp-descuento></div><div style="float:left"><paper-checkbox style="padding:10px;display:block"class="noselect"id="check_reserva">Reservar</paper-checkbox><br></div></div></div></div></div><div class="footer_fixed zindex-0"><div class="xBoton2 xRojo xIzquierda"onclick="dialog_nuevo_pedido.open()">Nuevo pedido</div><div class="xDerecha"style="margin-top:15px"><div class="xBoton2 xAzul xInvisible"id="btn_enviar_cuenta"onclick="xEnviarACuenta()">[F8] Enviar a cuenta</div><div class="xBoton2 xVerde xInvisible"id="btn_registrar_pago"onclick="xIrARegistrarPago()">[F10] Registrar pago</div></div></div></div></template></dom-module><style type="text/css">.move a:focus{outline:0}.xdivEnLinea2x{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:space-between;height:100%}.xdivEnLinea2x>.itemsDivx{width:35%;height:calc(100vh - 120px);border:solid rgba(0,0,0,.25) 1px;border-top:none;overflow-y:auto;-webkit-transition:all .3s ease;-o-transition:all .3s ease;-ms-transition:all .3s ease;-moz-transition:all .3s ease;transition:all .3s ease}.xBtnDatosAdjuntos{background:bisque;padding:2px 5px 2px 5px;right:0;margin-right:-11px;border-radius:3px}.xdivEnLinea2x>.itemsDivx.b{width:40%}.itemsDivx .xtitulo{padding:5px;background:rgba(189,189,189,.5);border-bottom:1px solid rgba(0,0,0,.25)}ul.list_add_item2 li.divLi{padding:0}.content_li{padding:14px 25px 14px}.content-titulo .stock_item{padding:5px 3px 10px;text-align:center;border-radius:4px;line-height:0;margin-top:-22px;margin-left:-20px;width:15px}.content-titulo .xt-p{font-size:14px}.content-titulo .num-stock{font-size:11px}@media screen and (max-width:920px){.xdivEnLinea2x>.itemsDivx.a{position:absolute;background:#d3d3d3;z-index:200;width:0}.xdivEnLinea2x>.itemsDivx.a.open{width:300px}.xdivEnLinea2x>.itemsDivx.b{width:50%!important}.xdivEnLinea2x>.itemsDivx.c{width:50%}}.btn-full-screen{float:right;top:-30px;right:-15px;margin:0}.subtotal-tr-row{padding-top:1px;padding-bottom:1px}.tool-bar-vr{background:#483d8b;padding:8px;color:#f5f5f5}.paper-toggle-button-0[checked] .toggle-button.paper-toggle-button{background:#ff0}.paper-toggle-button-0[checked] .toggle-button.paper-toggle-button{background:#ff0}.paper-toggle-button-0[checked] .toggle-bar.paper-toggle-button{background:grey}</style><script src="../view/config.const.js"></script><script rel="prefetch"src="../view/socket.master.service.js"></script><script rel="prefetch"src="../view/socket.service.p.js"></script><script src="../view/item_pedidos.js"></script><script src="../view/cpe_interno.js"></script><script src="../view/xJsonSunat.js"></script><script src="../view/xSOAPSunat.js"></script><script src="../view/item_pedido_estructura.js"></script><script src="../view/item_pedido_subtotales.js"></script><script src="../view/item_pedido_print_comprobante.js"></script><script src="../view/deNumALetras.js"></script><script src="../view/manager_storage.js"></script><script src="../view/cliente.service.js"></script><script src="../../js/keynavigator-min.js"></script><script src="../../js/mifuncion_web.js"></script><script>var xThisVentaRapida,$li,$xlist_li,xCompDescuentoPedidoVR,xidCategoriaVR,xEstadoPedido,xNumMesasBd,xCompSubitems,xCompCanalConsumo,xDataPagoPedidoPendiente,_pedido_pagar_cuenta,xedit_detalle_item=!1,xArrayRegla=[],xDtPrint=[],xDtSubTotales=[],xenviar_cuenta=!1,xregistrar_pago=!1,xtxt_select=!1,xtxt_descuento_focus_vr=!1,xtxt_mod_cantidad_focus_vr=!1,arrSubtTotalesDescuentoVR=null,tt_pedido=0,xIdPedido="",xnum_mesa_valido=!1,xarr_header=[],xarr_body=[],xarr_footer=[],xRpt_pago=[],guardando_vr=!1,xdelivery=0,xReservar=0,xsolo_llevar=0,xid_cliente_pago=0,xarr_subtotales=[],arrDatosAdjuntoDelivery=[],xIdCliente_pedido="",xClientePedidoFnac="",isSreenFull=!1,isTouch=!0,isShowOpcionesPrimero=!1,xCadenaTC="",isSocket=!1;function xIniVentaRapida(){xm_log_get("ini_us"),$("#Titulo_page").text("Venta Rapida"),document.title="Venta Rapida",$("body").addClass("loaded"),xPopupLoad=document.getElementById("xLoad"),localStorage.removeItem("::app3_woDUS::cxe"),xArrayRegla=xm_log_get("reglas_de_carta"),xDtPrint=xm_log_get("sede_generales"),xNumMesasBd=parseInt(xDtPrint[0].mesas);var e=xm_log_get("app3_woPer"),e=(xThisVentaRapida.showCompDescuento=-1<e.indexOf("Pe5"),isSocket=0!==parseInt(xm_log_get("datos_org_sede")[0].pwa),xLoadArrayPedido(),xTraerDtTipoConsumo(),loadCuponesActivos(),xThisVentaRapida.xt_nombre_sede=xDtPrint[0].des_sede,xThisVentaRapida.xt_eslogan=xDtPrint[0].eslogan,disableScrollRefresh(),$(document.body).on("change","#select_ulTPC",function(e){xsolo_llevar=xdelivery=0,"delivery"===$("#select_ulTPC :selected").text().toLowerCase()&&(xdelivery=1),-1<$("#select_ulTPC :selected").text().toLowerCase().indexOf("llevar")&&(xsolo_llevar=1),localStorage.removeItem("::app3_woDUS::cxe"),xCompDatosDelivery.resetValInit(),xSumarTotal(),xChangeTipoConsumoItems(e.target.value)}),$("#x-main").removeClass("xContent"),$("#x-main").removeClass("content"),$("#panel_toolbar").addClass("xInvisible"),setValuesStorage(),xCadenaTC=xArmarTipoConsumo(1),xCount_cant_ico=0,$(document.body).on("change","#check_reserva",function(e){xReservar=e.target.checked?1:0,xenviar_cuenta=!0,$("#btn_enviar_cuenta").removeClass("xInvisible")}),(xCompCanalConsumo=document.getElementById("compCanalConsumo")).addEventListener("getValorIncial",e=>{e=e.detail?.values||null;e&&(select_ulTPC.value=e.idtipo_consumo,xsolo_llevar=xdelivery=0,"delivery"===e.descripcion.toLowerCase()&&(xdelivery=1),-1<e.descripcion.toLowerCase().indexOf("llevar")&&(xsolo_llevar=1),localStorage.removeItem("::app3_woDUS::cxe"),xCompDatosDelivery.resetValInit(),xSumarTotal(),xChangeTipoConsumoItems(e.idtipo_consumo))}),(compFindCategoria=document.getElementById("compFindCategoria")).addEventListener("onChange",function(e){_getCategoria(e.detail.categorias)}),compFindCategoria.addEventListener("getValorIncial",function(e){let a;if(a=e.detail.categorias,getLocalStorage("::app3_cat_defualt")){a=JSON.parse(getLocalStorage("::app3_cat_defualt")),xidCategoriaVR=a.idcategoria;try{setTimeout(()=>{compFindCategoria.$.compFindListCategoria.value=a.index},500)}catch(e){}}else xidCategoriaVR=e.detail.categorias.idcategoria;setLocalSotrage("::app3_cat_defualt",JSON.stringify(a)),xLoadCartaVR()}),document.defaultAction=!1,detectEvent);document.body.onkeydown=e,$("#txt_mesa").on("keyup",function(){xenviar_cuenta=0==tt_pedido||""==this.value?($("#btn_enviar_cuenta").addClass("xInvisible"),!1):($("#btn_enviar_cuenta").removeClass("xInvisible"),!0);var e=this.value;xnum_mesa_valido=e<=0||xNumMesasBd<e?!1:!0}),$xlist_li=$("#accordion li:visible").keynavigator({useCache:!1,cycle:!0,activeClass:"xitem_seleccionado_li",onBeforeActive:function(e){return e.toggleClass(this.options.activeClass),e.hasClass(this.options.activeClass)}}),$(document.body).on("focusout","#accordion li",function(e){var a=$(this).find("#xinput_li");"inline-block"==$(a).css("display")&&""==$(a)[0].value&&$(a).css("display","none"),xedit_detalle_item=!1}),$(document.body).on("click",".xbtn_li_editar",function(e){var a=$(this);a.parent().find("#xinput_li").css("display","inline-block"),a.parent().find("#xinput_li").focus(),xedit_detalle_item=!0,e.stopPropagation(),e.stopPropagation(),e.stopImmediatePropagation()}),$("#txt_bus_item").keyup(function(e){const a=$(this);var t=a.val();40==e.keyCode&&($xlist_li.eq(0).focus(),$xlist_li.eq(0).addClass("xitem_seleccionado_li"),$xlist_li.eq(0).click()),""==t?($("#accordion li").each(function(){a.show()}),xIniFocusMoveLi()):($(".list_add_item2 li").each(function(){(this.textContent+this.dataset.cat).search(new RegExp(t,"i"))<0?$(this).hide():$(this).show()}),xIniFocusMoveLi(),13==e.keyCode&&1==$xlist_li.length&&(xBtnSumarRestarKey($xlist_li.find(".xBtn_li2"),1),xVerMipedidoVR(),a.val("")))}),$(document.body).keydown(function(e){xtxt_descuento_focus_vr||xtxt_mod_cantidad_focus_vr||dialog_datos_delivery.opened||"referencia"!==document.activeElement.dataset.val&&"mesa"!==document.activeElement.dataset.val&&107!=e.keyCode&&109!=e.keyCode&&40!=e.keyCode&&38!=e.keyCode&&117!=e.keyCode&&118!=e.keyCode&&17!=e.keyCode&&77!=e.keyCode&&1!=xedit_detalle_item&&($("#txt_bus_item").focus(),1==xtxt_select)&&($("#txt_bus_item").select(),xtxt_select=!1)}),$(document.body).on("click","#accordion div.xBtn_li2",function(e){e.target.parentElement.parentElement.dataset.index;xVerMipedidoVR()}),$(document.body).on("keydown",$xlist_li,function(e){var a,t;if(38==e.keyCode||40==e.keyCode)return a=$("#xVentaRapidaBuscar"),t=$xlist_li.filter(".xitem_seleccionado_li:last"),a.scrollTop(t.offset().top+(a.scrollTop()-a.offset().top)-100),e.stopPropagation(),e.stopImmediatePropagation(),!1;"referencia"===document.activeElement.dataset.val||"mesa"===document.activeElement.dataset.val||107!=e.keyCode&&109!=e.keyCode||(xtxt_select=!0,t=107==e.keyCode?1:-1,xBtnSumarRestarKey($(this).find("li.xitem_seleccionado_li .xBtn_li2"),t),xVerMipedidoVR(),e.stopPropagation(),e.stopImmediatePropagation())}),xCompSubitems=document.getElementById("comp_subitems"),(xCompDatosDelivery=document.getElementById("component_datos_delivery")).addEventListener("xGetDatosDelivery",function(e){arrDatosAdjuntoDelivery=e.detail.datos}),(xValPago=document.getElementById("component_pago_vr")).setObjConntet($("#dialog_pagar_vr")),xValPago.addEventListener("xSend",function(e){xRpt_pago=e.detail.xRpts,0!==e.detail.xRpts[0].ok&&1==e.detail.xRpts[0].paseEnterTxt&&xRegistrarClientePagoVR()}),xValPago.addEventListener("xCancelarCerrar",function(e){xThisVentaRapida.$.dialog_pagar_vr.close()}),xValPago.addEventListener("xListoRegistraPago",function(e){xRegistrarClientePagoVR()}),xValPago.addEventListener("xSelectTipoComprobante",function(e){xThisVentaRapida.$.dialog_pagar_vr.center()}),xValPago.addEventListener("xFormClienteValid",function(e){xThisVentaRapida.$.dialog_pagar_vr.center()}),(_pedido_pagar_cuenta=document.getElementById("pedido_pagar_cuenta")).addEventListener("total_pagar_cuenta",e=>{xDataPagoPedidoPendiente=e.detail;e=e.detail.tt_pedido;xValPago.setVisiblePanel1(),xThisVentaRapida.$.dialog_pagar_vr.open(),$("#component_pago_vr").focus(),component_pago_vr.setVal(xMoneda(e))}),_pedido_pagar_cuenta.addEventListener("close_pedidos_pendientes",e=>{$(contentPedidosPendientesCobrar).addClass("xInvisible"),$(contentVentaRapida).removeClass("xInvisible")}),(xCompDescuentoPedidoVR=document.getElementById("component_descuento_pedido_vr")).addEventListener("changeDescuento",function(e){var a=e.detail;arrSubtTotalesDescuentoVR=colocarDescuentoSubtotales(a.value,xLocal_xDtSubTotales,a.descripcion,a.isAgregar),a.isAgregar||removeCuponDsct("tb_pedido_detalle"),xSumarTotal(!0),e.stopPropagation(),e.stopImmediatePropagation()}),$("#component_descuento_pedido_vr").on("focus-input",e=>{xtxt_descuento_focus_vr=e.detail}),$("#dialog_pagar_vr").on("iron-overlay-opened",function(){component_pago_vr.setFocusTxt(),$("#btn_pago").attr("disabled",!0)}),document.addEventListener("GeneralUpdateItemsSolo",function(e){xLoadCartaVR(),e.stopPropagation(),e.stopImmediatePropagation(),e.cancelBubble=!0}),isTouch=!0}function xValidarPedidoonBtnVR(){var o=0,i=0;xnum_mesa_valido=!0,xArrayPedidoObj.filter(e=>e).map(e=>{for(const t in e){var a;e.hasOwnProperty(t)&&"object"==typeof(a=e[t])&&0!==a.cantidad&&(-1<e.des.toLowerCase().indexOf("local")&&(xnum_mesa_valido=!1,xdelivery=xsolo_llevar=0,o++),-1<e.des.toLowerCase().indexOf("llevar")&&0,-1<e.des.toLowerCase().indexOf("delivery"))&&i++}}),xsolo_llevar=0===o&&0===i?1:0,xdelivery=0<i?1:0}function _getCategoria(e){xidCategoriaVR=e.idcategoria,setLocalSotrage("::app3_cat_defualt",JSON.stringify(e)),xLoadCartaVR()}function empty(){}function detectEvent(e){var a=e||window.event;if(!dialog_datos_delivery.opened)if(a.ctrlKey&&77==a.keyCode&&txt_mesa.focus(),27==a.keyCode&&dialog_pagar_vr.opened)xThisVentaRapida.$.dialog_pagar_vr.close(),$("#txt_bus_item").focus(),xedit_detalle_item=!1;else if(116<=a.keyCode&&a.keyCode<=123){if(119!=a.keyCode){if(121==a.keyCode&&!dialog_pagar_vr.opened){if(guardando_vr)return;xIrARegistrarPago(),a.stopPropagation(),e.stopPropagation(),e.stopImmediatePropagation()}return document.defaultAction}xEnviarACuenta()}}function xValPagoMostrarContainerPago(){xValPago.setVisibleContainerPago()}function xIrARegistrarPago(){if(tt_pedido&&0!=tt_pedido&&(xDataPagoPedidoPendiente=null,0!=xregistrar_pago)&&!guardando_vr){var e=$("#txt_mesa").val();if(1!==xsolo_llevar&&1!==xdelivery){if(""===e)return void alert("Indique numero de mesa. Coloque cero(0) si no corresponde");if(0==(xnum_mesa_valido=!isNaN(parseInt(txt_mesa.value))))return void alert("Numero de mesa no es valido.")}xValPago.setVisiblePanel1(),xedit_detalle_item=!0,xEstadoPedido=2,xThisVentaRapida.$.dialog_pagar_vr.open(),$("#component_pago_vr").focus(),component_pago_vr.setVal(xMoneda(tt_pedido))}}function xEnviarACuenta(){!tt_pedido||0==tt_pedido||guardando_vr||(guardando_vr=!0,xReservar=check_reserva.checked?1:0,1==xenviar_cuenta&&(0==(xnum_mesa_valido=!isNaN(parseInt(txt_mesa.value)))&&0===xdelivery&&0===xReservar&&0===xsolo_llevar?(alert("Numero de mesa no es valido."),guardando_vr=!1):(xPopupLoad.titulo="Guardando...",xPopupLoad.xopen(),setTimeout(()=>{xid_cliente_pago=xEstadoPedido=0,xGuardarPedidoVR(function(){guardando_vr=!1})},500))))}function xNuevoPedidoDialogVR(){xNuevoPedidoVR(),isSocket&&xLoadCartaVR()}function xNuevoPedidoVR(){localStorage.removeItem("::app3_woDUS::cxe"),window.localStorage.removeItem("::app3_sys_dta_pe"),xCompDatosDelivery.resetValInit(),tt_pedido=0,xLimpiarItemSeleccionadosSubItems(),xLimpiarItemIndicaciones(),xLoadArrayPedido(),xPopupLoad.xopen(),isSocket?(_cpSocketRestoreFromPedidoStorage(),_resetCeroItemcarta(),setTimeout(()=>{xPopupLoad.xclose()},500)):xLoadCartaVR(),$("#xtb_pedido_subtotales tr").remove(),$("#tb_pedido_detalle").remove(),$(".xcheck_print").attr("checked",!1),xenviar_cuenta=xregistrar_pago=!1,xCount_cant_ico=xid_cliente_pago=0,$("#btn_registrar_pago").addClass("xInvisible"),$("#btn_enviar_cuenta").addClass("xInvisible"),$("#txt_mesa").val(""),$("#txt_ref_vr").val(""),xedit_detalle_item=!1,check_reserva.checked=!1,$("#txt_bus_item").focus(),guardando_vr=!1,xValPago.setResetFormaPago(),xRpt_pago=[],arrDatosAdjuntoDelivery=[],frm_cliente.reset(),xLocal_SubTotal_Quitados="",xCompDescuentoPedidoVR&&xCompDescuentoPedidoVR.reset(),dialog_nuevo_pedido.close()}function _resetCeroItemcarta(){$(".xcant_li2.cant_fixed_li").text("")}function xIniFocusMoveLi(){$xlist_li=$("#accordion li:visible").keynavigator({cycle:!0,activeClass:"xitem_seleccionado_li"})}function xRegistrarClientePagoVR(){$("#btn_pago").attr("disabled",!0),!0!==guardando_vr&&(guardando_vr=!0,xid_cliente_pago=xRpt_pago[0].idcliente,xPopupLoad.titulo="Guardando...",xPopupLoad.xopen(),xDataPagoPedidoPendiente?pagarCompPeiddoCuentaPendiente(xDataPagoPedidoPendiente):xGuardarPedidoVR(function(){dialog_pagar_vr.close()}))}function xRegistrarPagoVR(e,a){var t=select_ulTPC.value;(new httpFecht).axiosExecute({type:"POST",url:"../../bdphp/log.php?op=509",data:{idclie:e,tt:xMoneda(tt_pedido),idp:a,xArrayItems:"",ArrayPago:xRpt_pago[0].xtipo_pagos,idtipo_consumo:t}}).then(e=>{(e=$.parseJSON(e)).success?(xPopupLoad.xclose(),xThisVentaRapida.$.dialog_pagar_vr.close()):alert(e.error)})}async function xGuardarPedidoVR(e){var t,a,o,i,d,r,n=$("#txt_mesa").val(),s=$("#txt_ref_vr").val(),l=($(".xPedidoTotal").text(),""),c="",x="",_=0;0!=tt_pedido&&(1==check_reserva.checked&&(n="0",$("#txt_mesa").val(0),_=1),t=xdelivery=xsolo_llevar=0,$("#xBody .xEncabezadoTpConX").each(function(e,a){$("#btn_enviar_cuenta").addClass("xInvisible"),t++,0==e&&(c=$(a).attr("data-idtpc"));e=$(a).text();e.toLowerCase().indexOf("local"),-1<e.toLowerCase().indexOf("llevar")&&(xsolo_llevar=1),-1<e.toLowerCase().indexOf("delivery")&&(xdelivery=1,xenviar_cuenta=!0,$("#btn_enviar_cuenta").removeClass("xInvisible"))}),1<t&&(xsolo_llevar=0),xarr_tipo_pago=xRpt_pago[0]?xRpt_pago[0].xtipo_pagos:[],r=!xRpt_pago[0]||""===xRpt_pago[0].idcliente?0:xRpt_pago[0].idcliente,a=xRpt_pago[0]?""!=xRpt_pago[0].cliente.nombres?xRpt_pago[0].cliente:0!=arrDatosAdjuntoDelivery.length?arrDatosAdjuntoDelivery:[]:[],d=xRpt_pago[0]?xRpt_pago[0].comprobante:[],i=await ClienteService_Guardar(a),(a.idcliente=i)&&r!=i&&xValPago.reloadInputDatalientes(),xGeneralValidarRegalasCarta(xArrayPedidoObj,!0),arrSubtTotalesDescuentoVR||0!=xArmarSubtotalesArray())&&(xVerificarImprimirComanda=!1,xVerificarSiSeImprimeComanda(xArrayPedidoObj),r=xm_log_get("datos_org_all_sede")[0].pwa_habilitar_busqueda_mapa,s=""===s?a.nombres||a.nombre||"":s,xarr_cliente={cliente:a,i:""},1===arrDatosAdjuntoDelivery?.delivery&&(arrDatosAdjuntoDelivery.importeTotal=parseFloat(xLocal_xDtSubTotales[xLocal_xDtSubTotales.length-1].importe)),xarr_header={idclie:i||"",referencia:s,idcategoria:xidCategoriaVR,mesa:n,reservar:_,tipo_consumo:c,subtotales_tachados:xLocal_SubTotal_Quitados,arrDatosDelivery:arrDatosAdjuntoDelivery,isComercioAppDeliveryMapa:r},xarr_comprobante=d,xarr_body=xArrayPedidoObj,xarr_subtotales=xLocal_xDtSubTotales,2===xEstadoPedido?(xarr_tipo_pago=xRpt_pago[0].xtipo_pagos,x="12"):(xarr_tipo_pago=[],x="1",xarr_comprobante=null),xPopupLoad.xopen(),xarr_body=xarr_body.filter(e=>e).map(e=>e),a=xEstructuraExpress(xarr_body,xdelivery,r),o=await goSendPedidoFecht({p_from:x,p_cliente:xarr_cliente,p_body:xarr_body,p_body_h:a,p_header:xarr_header,p_tipo_pago:xarr_tipo_pago,p_subtotales:xarr_subtotales,p_comprobante:xarr_comprobante,estado_p:xEstadoPedido}))&&(xSendItemVentaxPesoVR(xarr_body),i=(_arrRpt=o).correlativo_comprobante,d=xCeroIzq(_arrRpt.correlativo_dia,5),r=_arrRpt.idregistro_pago,l=xCeroIzq(_arrRpt.numpedido,5),_arrRpt.idpedido,xArrayEnca={m:xCeroIzq(n,2),r:xMayusculaPrimera(xSoloMinuscula(s)),num_pedido:l,idpedido:_arrRpt.idpedido,reservar:_,solo_llevar:xsolo_llevar,delivery:xdelivery,correlativo_dia:d,arrDatosDelivery:arrDatosAdjuntoDelivery,isFromVR:!0},""!==i&&xMandarCocinarImpresionComprobante(i,r),(1==xVerificarImprimirComanda?(guardando_vr=!0,xLLamarPrintVR):(xPopupLoad.xclose(),isSocket&&_cpSocketClearStorage(),xNuevoPedidoVR))(),_cpSocketprinterOnly(xArrayEnca),e(!0))}async function pagarCompPeiddoCuentaPendiente(e){var a,t,o;0!=e.tt_pedido&&(t=xRpt_pago[0].cliente,o=xRpt_pago[0]?xRpt_pago[0].comprobante:[],a=""===t.idcliente?await ClienteService_Guardar(t):t.idcliente,(t.idcliente=a)&&_idCLienteCompara!=a&&xValPago.reloadInputDatalientes(),a={cliente:t,i:e.checkItemsSeleccionados.idPedidosSeleccionados},t={idclie:t.idcliente,ImporteTotal:xMoneda(e.tt_pedido),tipo_consumo:e.checkItemsSeleccionados.tipoConsumo,idPedidoSeleccionados:e.checkItemsSeleccionados.idPedidosSeleccionados,is_from_client_pwa:e.is_from_client_pwa},xarr_tipo_pago=xRpt_pago[0].xtipo_pagos,o=xRpt_pago[0].comprobante,e=e.arr_subtotal,xarr_subtotales=e,a={p_from:"3",p_cliente:a,p_header:t,p_tipo_pago:xarr_tipo_pago,p_subtotales:e,p_comprobante:o},xPopupLoad.xopen(),t=await goSendPedidoFecht(a))&&(e=t.idregistro_pago,""!==(o=t.correlativo_comprobante)&&xMandarCocinarImpresionComprobante(o,e),dialog_pagar_vr.close(),(1==xVerificarImprimirComanda?(guardando_vr=!0,xLLamarPrintVR):(xPopupLoad.xclose(),isSocket&&_cpSocketClearStorage(),xNuevoPedidoVR))(),_pedido_pagar_cuenta.quitarObjPedido())}async function goSendPedidoFecht(e){var a=new httpFecht;try{var t=await a.axiosExecute({type:"POST",url:"../../bdphp/log_001.php",data:e},!0,!1);return t&&getVariableSede("update_stock_after")&&updateStockOnOrderCompletion(e.p_body),t}catch(e){return guardando_vr=!1}}function xMandarCocinarImpresionComprobante(e,a){if(0<xRpt_pago.length){var t=xRpt_pago[0].cliente,o=xRpt_pago[0].comprobante;""===xRpt_pago[0].idcliente&&1===xdelivery&&(t={idcliente:0,num_doc:"",nombres:xarr_cliente.cliente.nombre,direccion:xarr_cliente.cliente.direccion,telefono:xarr_cliente.cliente.telefono,referencia:xarr_cliente.cliente.referencia});try{o.correlativo=xCeroIzqNumComprobante(e)}catch(e){}e=xDataPagoPedidoPendiente?xCargarDatosAEstructuraImpresion(xDataPagoPedidoPendiente.checkItemsSeleccionados.arrayPedidosSeleccionados):xArrayPedidoObj;xCocinarImprimirComprobante(e,xarr_subtotales,o,t,a,-2)}}function xLLamarPrintVR(){xCocinarImprimirComanda(xArrayEnca,xArrayPedidoObj,xarr_subtotales,e=>{0==e?(xPopupLoad.xclose(),isSocket&&_cpSocketClearStorage(),xNuevoPedidoVR()):dialog_erro_print.open()})}function xReImprimir(){dialog_erro_print.close(),xPopupLoad.titulo="Enviando...",xPopupLoad.xopen(),xLLamarPrintVR()}function xLoadCartaVR(){xGeneralLoadItems(xidCategoriaVR,function(){xPopupLoad.xopen();for(var e="",a=new Array,t="",o="",i=0,d=0;d<xGeneralDataCarta.length;d++)if(t!=xGeneralDataCarta[d].idseccion){for(var t=xGeneralDataCarta[d].idseccion,o="",r=0;r<xGeneralDataCarta.length;r++)t==xGeneralDataCarta[r].idseccion&&(0<parseInt(xGeneralDataCarta[d].cantidad)||"ND"==xGeneralDataCarta[d].cantidad)&&(o=o+xGeneralDataCarta[r].des_item+", ");o=o.slice(0,-2),o=xMayusculaPrimera(xSoloMinuscula(o)),a[i]={des:xGeneralDataCarta[d].des_seccion,id:xGeneralDataCarta[d].idseccion_index,detalle:o,procede:xGeneralDataCarta[d].procede},i++}for(var n=0;n<a.length;n++)e=String(e+'<div class="xmenu_item xBordeBold xPading15 xCursor" data-id="'+a[n].id+'" data-procede="'+a[n].procede+'" onclick="xFiltrarItemsCartaDet(this);"><p class="xtitulo_item">'+a[n].des+"</p></div>");$("#_xMenu_body_vr div").remove(),$("#_xMenu_body_vr").append(e).trigger("create"),xLoadItemsDetalleCartaALL(),setTimeout(()=>{xPopupLoad.xclose()},300)})}function xFiltrarItemsCartaDet(e){var t=e.dataset.id;""==t?$("#accordion li").each(function(){$(this).show()}):($("#accordion li").each(function(e,a){t==a.dataset.idseccionindex?$(a).show():$(a).hide()}),xIniFocusMoveLi(),$xlist_li.eq(0).focus(),$xlist_li.eq(0).addClass("xitem_seleccionado_li"),$xlist_li.eq(0).click(),xClosePanelDeVR())}function xSeDisabledSearchText(e){xtxt_descuento_focus_vr=e}function xSetFocusTextChangeCant(e){xtxt_descuento_focus_vr=xtxt_mod_cantidad_focus_vr=e}function xSetChangeTextModCantidad(e){e.select()}function xLoadItemsDetalleCartaALL(){$("#accordion ul").remove();for(var e="",a="",t=0,o="",i=0;i<xGeneralDataCarta.length;i++){a="",t=xGeneralDataCarta[i].cantidad,parseInt(t)<=0&&(a="xTachar"),"ND"==t&&(t=1e4),xGeneralDataCarta[i].stock_actual=t,xGeneralDataCarta[i].idcategoria=xidCategoriaVR,xCantItem=xGeneralDataCarta[i].cantidad,xClassEstadoStock=xClassEstadoItem(xCantItem),xClassEstado=xClassEstadoStock.split("|")[0],xClassEstadoStock=xClassEstadoStock.split("|")[1];var d=getVariableSede("update_stock_after"),o='<span class="xcant_li2" data-cantmax="'+t+'">0</span>';"1"!=xGeneralDataCarta[i].venta_x_peso&&!d||(o=`<input type="text" 
								pattern="[0-9]+(.[0-9]+)?"
								class="xcant_li2 text-center input-modifica input-venta-rapida-mod" 
								max-value="${t}" 
								onBlur="xSetFocusTextChangeCant(false)"
								onFocus="xSetFocusTextChangeCant(true)"
								onClick="xSetChangeTextModCantidad(this)" data-cantmax="${t}">`),e=String(e+'<li id="li2'+xGeneralDataCarta[i].idcarta_lista+'" class="noselect divLi" data-isli="1" data-signo="+" data-index="'+i+'" data-idcategoria="'+xidCategoriaVR+'" data-cat="'+xGeneralDataCarta[i].des_seccion+'" data-idcl="'+xGeneralDataCarta[i].idcarta_lista+'" data-idseccion="'+xGeneralDataCarta[i].idseccion+'" data-idseccionindex="'+xGeneralDataCarta[i].idseccion_index+'" data-iditem="'+xGeneralDataCarta[i].iditem+'" data-idcartalista="'+xGeneralDataCarta[i].idcarta_lista+'" data-punitario="'+xGeneralDataCarta[i].precio+'" data-idimpresora="'+xGeneralDataCarta[i].idimpresora+'" data-idprocede="'+xGeneralDataCarta[i].idprocede+'" data-procede="'+xGeneralDataCarta[i].procede+'" data-procedeindex="'+xGeneralDataCarta[i].procede_index+'" data-ventarapida=1 data-imprimircomanda="'+xGeneralDataCarta[i].imprimir_comanda+'" data-iddescontar="'+xGeneralDataCarta[i].idprocede+'" data-cant_descontar="'+xGeneralDataCarta[i].cant_descontar+'" data-stock_actual="'+xGeneralDataCarta[i].cantidad+'" data-idalmacen_items="'+xGeneralDataCarta[i].idalmacen_items+'"><div class="content_li"><div class="content-titulo"><div class="xicon3 xeditar xbtn_li_editar" title="editar"></div><p class="xtitulo_li2 xt-p '+a+'">'+xGeneralDataCarta[i].des_item+'</p><div class="stock_item '+xClassEstadoStock+'" id="content-stock-item"><span class="num-stock" id="numStock">'+xCeroIzq(xCantItem,2)+'</span></div><p class="xInvisible">'+xGeneralDataCarta[i].codigo_barra+'</p><input type="text" class="xMiInput xMiTextReferencia" anchofull id="xinput_li"></div><div class="xBtn_contet_li2"><div class="xBtn_li2 resta">-</div>'+o+'<div class="xBtn_li2 suma">+</div></div></div></li>')}$("#accordion").html(e).trigger("create"),xIniFocusMoveLi()}function _cpStockItemModificado(e){if(isSocket){var a="#li2"+e.idcarta_lista;const o=e.cantidad;var t=$(a).attr("data-index");xtachar_li="",parseInt(o)<=0&&(xtachar_li="xTachar"),"ND"==o&&(o=1e4),$(a).attr("data-stock_actual",o),$(a+" #numStock").text(xCeroIzq(o,2)),$(a+" span.xcant_li2").attr("data-cantmax",o),xClassEstadoStock=xClassEstadoItem(o).split("|")[1],$(a+" #content-stock-item").removeClass(),$(a+" #content-stock-item").addClass("stock_item "+xClassEstadoStock),xGeneralDataCarta[t].stock_actual=o,xGeneralDataCarta[t].cantidad=o;try{xGeneralDataCarta[t].subitems_selected=itemPedidos_objItemSelected.subitems_selected,xGeneralDataCarta[t].subitems=xGeneralDataCarta[t].subitems?itemPedidos_objItemSelected.subitems:null}catch(e){}if(itemPedidos_objItemSelected=xGeneralDataCarta[t],e.subitems){itemPedidos_objItemSelected.subitems=[],itemPedidos_objItemSelected.subitems=JSON.parse(JSON.stringify(e.subitems));try{xCompSubitems.refreshSubItems()}catch(e){}}""!=xtachar_li?$(a).find(".xtitulo_li2").addClass(xtachar_li):$(a).find(".xtitulo_li2").removeClass("xTachar")}}function xVerMipedidoVR(){var d,r,e="",n=new Array,t="",s="";$("#xBody div").remove(),xDtPedido=xArrayPedidoObj;for(var l=0;l<xDtPedido.length;l++)if(s=e=d="",n=new Array,r=0,null!=xDtPedido[l]&&(xDtPedido[l].des,$.map(xDtPedido[l],function(t,e){var o,i;"object"==typeof t&&null!=t&&(s="","00"!=t.cantidad)&&(null!=t.indicaciones&&""!=t.indicaciones&&(s='<span class="xPedidoItem_indicaciones">('+t.indicaciones+")</span>"),null==n[t.idseccion_index]&&(n[t.idseccion_index]='<tr><td colspan="2" class="xSinBorde xBold">'+t.des_seccion+"</td></tr>"),o="",t.subitems_view&&t.subitems_view.map((e,a)=>{i=parseFloat(e.precio),i=isNaN(i)?0:i,e.precio_mostrar=0===i?".":i.toFixed(2),e.precio=i,o+=String(`												
								<tr class="subitem-content-resumen"
									data-idtipo_consumo="${t.idtipo_consumo}" 
									data-idcarta_lista="${t.iditem}" 
									data-des = "${e.des}"
									data-idsubitem="${e.id}"
									data-index="${a}"									
									>										
										<td class="dis-flex" data-id="${t.idtipo_consumo}" data-ventarapida="1" data-viene-subitems-mod="1">
												<div class="btnCount btnMenos">-</div> 
													${e.cantidad_seleccionada} ${e.des} 
												<div class="btnCount btnMas">+</div>
										</td>
										<td style="text-align: right;">${e.precio_mostrar}</td>
								</tr>													
						`)}),d=String('<tr class="xPedidoItem row xCursor" onclick="xOpenDlgItemVR('+l+","+t.iditem.toString()+', this);" data-id="'+t.iditem+'" data-idseccion="'+t.idseccion+'" data-seccion="'+t.des_seccion+'" data-idbus="'+t.idseccion+'" data-idtipocobus="'+t.idtipo_consumo+'" data-idprocede="'+t.idprocede+'" data-procede="'+t.procede+'" data-procedeindex="'+t.procede_index+'" data-ventarapida=1 data-imprimircomanda="'+t.imprimir_comanda+'" data-iddescontar="'+t.idprocede+'" data-cant_descontar="'+t.cant_descontar+'" data-idalmacen_items="'+t.idalmacen_items+'" data-ptotal="'+t.precio_total+'" data-iditem="'+t.iditem2+'"><td width="90%">'+xCeroIzq(t.cantidad,2)+" | "+t.des+" "+s+'</td><td class="xInvisible" data-ColumName="cantidad" id="cant_descontar">'+xCeroIzq(t.cantidad,2)+'</td><td width="10px" align="right" class="xtb_pedido_importe" data-ColumName="ptotal" id="ptotal">'+t.precio_total+'</td><td class="xInvisible" id="ptotal_calc">'+t.precio_total_calc+'</td><td class="xInvisible" data-ColumName="punitario" id="punitario">'+t.precio+'</td><td class="xInvisible" id="td_cant">'+t.cantidad+'</td><td class="xInvisible" data-ColumName="iditem">'+t.iditem2+'</td><td class="xInvisible" data-ColumName="idcarta_lista" id="id_descontar">'+t.iditem+'</td><td class="xInvisible" data-ColumName="idseccion">'+t.idseccion+'</td><td class="xInvisible" id="row_idprocede">'+t.idprocede+'</td><td class="xInvisible" data-ColumName="idcategoria">'+t.idcategoria+'</td><td class="xInvisible" data-ColumName="idtipo_consumo">'+xDtPedido[l].id+'</td><td class="xInvisible" data-ColumName="descripcion">'+t.des+" "+t.indicaciones+'</td><td class="xInvisible" data-ColumName="procede">'+t.procede_index+'</td><td class="xInvisible" id="row_tb_procede">'+t.procede+'</td><td class="xInvisible" data-ColumName="idpedido">?p</td></tr>'+o),n[t.idseccion_index]=n[t.idseccion_index]+d,xHayPedido=1,r=parseInt(r)+parseInt(t.cantidad))}),""!=d)){var o="DELIVERY"===xDtPedido[l].des.toUpperCase()?'<div class="xDerecha xBtnDatosAdjuntos xCursor"><a onclick="dialog_datos_delivery.open()">Adjuntar Datos</a></div>':"",o='<tr><td colspan="2" class="xFondoRowPlomo noselect xBold xMargin5 xEncabezadoTpConX" data-idtpc="'+xDtPedido[l].id+'">'+xDtPedido[l].des+o+"</td></tr>";for(a in n)e=String(e+n[a]);t=String(t+o+e)}t=String('<table width="100%" class="xtb_pedido" data-TablaName="pedido_detalle" id="tb_pedido_detalle">'+t+"</table></div></div>"),$("#xBody").html(t).trigger("create"),xValidarReglaCarta(),xValidarPedidoonBtnVR()}function xValidarReglaCarta(){xGeneralValidarRegalasCarta($(".xtb_pedido"),!1),xSumarTotal(null,!0)}function xSumarTotal(e=!1){xGeneralValidarRegalasCarta(xArrayPedidoObj,!0),tt_pedido=xArmarSubtotalesArray();var t,o,i,d,r,n,s="",l="",c="",x="";(xLocal_xDtSubTotales=e?arrSubtTotalesDescuentoVR:xLocal_xDtSubTotales).forEach((e,a)=>{d=e.tachado?"xTachar":"",r=e.tachado?"Add":"Quitar",n=e.tachado?e.importe_tachado:e.importe,r=e.quitar?'<span data-tachado="'+e.tachado+'" class="xCursor xBold xColorRow_Azul xfont11" title="no cobrar" onclick="quitarSubTotal(this, '+a+')"> '+r+" </span>":"","TOTAL"===e.descripcion.toUpperCase()?(c="tt_importe_pagar_t",o="",t="xfont24 xBold",i="IMPORTE A PAGAR",xtt_pedidos_det=parseFloat(e.importe)):(x="xColorRow_Plomo",t="xfont15",i=e.descripcion.toUpperCase(),l="subtotal-tr-row"),s=s+'<tr class="total '+d+'"><td colspan="3" class="'+l+'"><p class="'+o+' xColorRow_Plomo">'+i+" "+r+'</p></td><td align="right" class="'+l+'"><p class="'+t+" "+x+'" id="'+c+'">'+parseFloat(n).toFixed(2)+"</p></td></tr>"}),tt_pedido=xLocal_xDtSubTotales[xLocal_xDtSubTotales.length-1].importe,xThisVentaRapida.importeTotalPedido=tt_pedido,$("#xtb_pedido_subtotales").html(s).trigger("create"),0==tt_pedido?($("#btn_registrar_pago").addClass("xInvisible"),xregistrar_pago=!1,$("#btn_enviar_cuenta").addClass("xInvisible"),xenviar_cuenta=!1):($("#btn_registrar_pago").removeClass("xInvisible"),xregistrar_pago=!0,""==$("#txt_mesa").val()&&1!==xdelivery&&1!==xsolo_llevar||($("#btn_enviar_cuenta").removeClass("xInvisible"),xenviar_cuenta=!0))}function quitarSubTotal(e,a){e=$(e).attr("data-tachado"),a=xLocal_xDtSubTotales[a].id;if("true"==e)xLocal_SubTotal_Quitados=xLocal_SubTotal_Quitados.replace(a+",","");else{if(0<=xLocal_SubTotal_Quitados.indexOf(a))return;xLocal_SubTotal_Quitados+=a+","}xSumarTotal()}function xTraerDtTipoConsumo(){for(var e="",a=xm_log_get("estructura_pedido"),t=0;t<a.length;t++)e=String(e+'<option value="'+a[t].idtipo_consumo+'">'+a[t].descripcion+"</option>");$("#select_ulTPC").html(e).trigger("create")}function _pantallaCompleta(){xThisVentaRapida.xIconScreen=isSreenFull?"icons:fullscreen-exit":"icons:fullscreen",isSreenFull=!isSreenFull,pantallaCompleta()}function xActivarFullSreen(e){isSreenFull=!isSreenFull,pantallaCompleta();var a=isSreenFull?1:0;window.localStorage.setItem("::app3_sys_vr_fullscreen",a)}function xActivarTouch(e){var a=(isTouch=!isTouch)?1:0;window.localStorage.setItem("::app3_sys_vr_touch",a)}function xActivarFirstOptionsItem(e){var a=(isShowOpcionesPrimero=!isShowOpcionesPrimero)?1:0;window.localStorage.setItem("::app3_sys_vr_show_opcion",a)}function setValuesStorage(){var e=window.localStorage.getItem("::app3_sys_vr_touch")?window.localStorage.getItem("::app3_sys_vr_touch"):0,a=window.localStorage.getItem("::app3_sys_vr_show_opcion")?window.localStorage.getItem("::app3_sys_vr_show_opcion"):0;isTouch=0!==parseInt(e),isShowOpcionesPrimero=0!==parseInt(a);try{toogleTouch.checked=isTouch,toogleShowOpciones.checked=isShowOpcionesPrimero}catch(e){}}function xOpenDlgItemVR(e,a,t){t=t.dataset.id;itemPedidos_objItemSelected=xArrayPedidoObj[e][t],xCompSubitems.openDialog(e,t)}function xLoadItemMiPedidoVR(e,a,t){itemPedidos_objItemSelected.idcarta_lista=itemPedidos_objItemSelected.iditem,itemPedidos_objItemSelected.des_item=itemPedidos_objItemSelected.des||itemPedidos_objItemSelected.des_item;var o=itemPedidos_objItemSelected,i="",d="",r="",n="",s=o.stock_actual;i=(i=xClassEstadoItem(s)).split("|")[1],i='<input class="xcheck_item" type="radio" name="option" value="other"><p class="xprecio_item xEnLinea">'+o.precio+'</p><div class="xstock_item '+i+'"><span>stock</span><p>'+xCeroIzq(s,2)+'</p></div><p class="xtitulo_item xEnLinea">'+o.des_item+"</p>",n="",o.img&&(d='<img src="../img/'+o.img+'">',n="1"),o.detalle&&(r='<div class="xsub_titulo_item">'+xMayusculaPrimera(o.detalle||"")+"</div>",n="1");s='<div class="xdetalle_item">'+(n="1"==n?'<div class="xdescripcion_foto">'+r+d+"</div>":"")+'<div class="xreferencia_item"><input type="text" autocomplete="on" placeholder="Escribe aqui las especificaciones..." class="xMiTextReferencia" id="txt_referencia"></div>'+xCadenaTC+"</div></div>",r=o.idseccion_index.split(".")[0],d=String('<div class="xmenu_item_2 xitem_seleccionado_pedido" data-id="'+o.idcarta_lista+'" data-item="'+o.iditem+'" data-idseccion="'+o.idseccion+'" data-desseccion="'+o.des_seccion+'" data-idseccionindex="'+r+'" data-idbus="'+o.idseccion+'" data-idimpresora="'+o.idimpresora+'" data-idprocede="'+o.idprocede+'" data-procede="'+o.procede+'" data-procedeindex="'+o.procede_index+'" data-imprimircomanda="'+o.imprimir_comanda+'" data-iddescontar="'+o.idprocede+'" data-cant_descontar="'+o.cant_descontar+'" data-idalmacen_items="'+o.idalmacen_items+'">'+i+s);$("#_xdlgBody .spinner").remove(),$("#_xdlgBody").html(d).trigger("create"),$("#dlgBtn").removeClass("xInvisible"),dialog_item.center(),$("#_xdlgBody").find("div.xmenu_item_2 .xpedir_row").each(function(e,a){xidTipoConsumoItem=$(a).attr("data-id"),null!=xArrayPedidoObj[xidTipoConsumoItem][xidItem]&&(xidTipoConsumo=xidTipoConsumoItem,xCantArray=xArrayPedidoObj[xidTipoConsumo][xidItem].cantidad,xindicaciones=xArrayPedidoObj[xidTipoConsumo][xidItem].indicaciones,$(a).find(".xCant_item").text(xCeroIzq(xCantArray,2)))}),dialog_item.center(),$(".xmenu_item_2").find("#txt_referencia").val(xindicaciones)}function xListoDlgVR(){xVerMipedidoVR(),dialog_item.close()}function xOpenPanelDeVR(){dialog_opciones_adcionales.open()}function xClosePanelDeVR(){$(".itemsDivx.a").removeClass("open")}function xOpenPedidosCuentaPendientes(){$(contentVentaRapida).addClass("xInvisible"),$(contentPedidosPendientesCobrar).removeClass("xInvisible"),_pedido_pagar_cuenta.loadPedidosPendientesCobrar()}function xRestorePedidoLocalStorageVR(){var e=window.localStorage.getItem("::app3_sys_dta_pe_sk");e&&(xArrayPedidoObj=JSON.parse(e),xVerMipedidoVR())}window.addEventListener("beforeunload",async function(e){var a;if(0<tt_pedido)return a="Se perderán todos los datos. ¿Estás seguro de que quieres hacer esto?",e.preventDefault(),e.returnValue=a}),Polymer({is:"x-venta-rapida",properties:{xt_org:Number,xt_idsede:Number,xt_idus:Number,xdt_items:Object,xt_nombre_sede:String,xt_eslogan:String,hidden_container_registro_pago:boolean=!1,valid_form_cliente_pago:boolean=!1,valid_monto_pago:boolean=!1,xIconScreen:String,objSubItemQuitar:Object,importeTotalPedido:Number,showCompDescuento:Boolean},attached:function(){this.selected_us=0,this.showCompDescuento=!1,this.xIconScreen="icons:fullscreen",xThisVentaRapida=this,xIniVentaRapida(),_cpSocketOpen(),xRestorePedidoLocalStorageVR(),$("#x-main").removeClass("xContent"),$("#x-main").removeClass("content"),$("#panel_toolbar").addClass("xInvisible")},detached:function(){document.defaultAction=!1,document.onkeydown=empty,clearInterval(xGeneralRelojUpdateItemsSolo),_cpSocketClose(),enableScrollRefresh(),$("#x-main").addClass("xContent"),$("#x-main").addClass("content"),$("#panel_toolbar").removeClass("xInvisible")}})</script>