<link rel="import"href="../../x-componentes/x-comp-find-tipo-gasto/x-comp-find-tipo-gasto.html"><dom-module id="x-gastos-fijos"><template is="dom"><paper-dialog class="dialog_redondo"id="dialog_borrar"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="xtxtCentro"><img src="../../../images/_dlg_remove.gif"alt=""width="150px"></div><p>Esta seguro de querer borrar este registro?</p><br><div class="buttons"><button class="xBoton2 xPlomo"dialog-dismiss>Cancelar</button> <button class="xBoton2 xRojo"onclick="xDlgBorrar()">Si, borrar</button></div></paper-dialog><paper-dialog class="dialog_redondo"id="dialog_new_gasto"style="width:345px"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"><div><h4>Registrar nuevo gasto fijo.</h4><br><form id="form_new_gasto"method="POST"><x-comp-find-tipo-gasto id="compTpGasto"id-tipo-gasto="1"onchange="_getTipoGastoDetalle(list_tipo_gasto)"></x-comp-find-tipo-gasto><input class="xMiInput xPasarEnter2"placeholder="DESCRIPCION"onchange="conMayusculas(this)"id="descripcion"name="descripcion"espaciar required> <input type="number"class="xMiInput xPasarEnter2"placeholder="IMPORTE"onchange="conMayusculas(this)"id="importe"name="importe"espaciar required> <input type="number"class="xMiInput xPasarEnter2"placeholder="PERIODO (cuotas)"onchange="conMayusculas(this)"id="cuotas"name="cuotas"espaciar required> <input type="number"class="xMiInput xPasarEnter2"placeholder="DIA DEL MES A PAGAR"onchange="conMayusculas(this)"id="dia_pago"name="dia_pago"espaciar required> <textarea class="xMiInput"class="xMiInput"placeholder="GLOSA"maxlength="100"id="text_glosa"cols="30"rows="3"></textarea><div class="xInvisible"><input id="idsede"name="idsede"value$="[[xt_idsede]]"> <input id="idorg"name="idorg"value$="[[xt_org]]"> <input id="idtipo_gasto"name="idtipo_gasto"> <input id="idtipo_gasto_detalle"name="idtipo_gasto_detalle"> <input id="mes_ultimo_pago"name="mes_ultimo_pago"> <input id="glosa"name="glosa"></div></form><br><br><button dialog-dismiss id="dlg_sunat_btn"onclick="newGasto()"class="xBoton2 xVerde">Listo Guardar</button> <button dialog-dismiss class="xBoton2 xRojo">Cerrar</button></div></paper-dialog><paper-dialog class="dialog_redondo"id="dialog_detalle_gasto_fijo"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"><div><h4>Registrar Pago</h4><h4>{{selItemGastoFijo.descripcion}}</h4><p class="xfont11 xColorRow_Plomo">{{selItemGastoFijo.glosa}}<hr><br><div class="x_div_linea"><div id="historial"class="xitem1 xBordeDe"style="height:50vh;overflow-y:auto"><div><p><strong>Historial de pagos</strong><table width="100%"><thead class="xfont10"><th>#<th>Fecha<th>Cuota<th width="20%">Doc.<th align="right">Importe<tbody><template is="dom-repeat"items="{{ListDetallesGastosFijos}}"as="subitem"><tr class="xfont10"><td data-id="{{index}}"><span>{{displayIndex(index)}}</span><td>{{subitem.fecha_pago}}<td>{{subitem.cuota}}<td><span class="xfont10 xColorRow_Plomo">{{subitem.doc}}</span><td align="right">{{subitem.importe}}</template><tr><td><td colspan="3"><p class="xfont15 xBold">Total<td align="right"><p class="xfont15 xBold">{{sumListDetalle}}</table></div></div><div id="registrar-pago"class="xitem2"><table width="100%"class="table-like"><tr><td>Importe<td><h3>{{selItemGastoFijo.total}}</h3><tr><td>Cuota<td>{{selItemGastoFijo.cuotas_hoy}}<tr><td>Fecha de pago<td><input type="date"class="xMiInput xPasarEnter2"id="date_fecha_pago"name="fecha_pago"espaciar><tr><td>Doc de pago<td><input class="xMiInput xPasarEnter2"onchange="conMayusculas(this)"id="doc_pago"name="doc_pago"value="{{selItemGastoFijo.doc}}"espaciar></table></div></div><hr><div class="xDerecha"><button dialog-dismiss class="xBoton2 xRojo">Cerrar</button> <button dialog-dismiss id="dlg_sunat_btn"onclick="confimarPago()"class="xBoton2 xVerde">Listo confirmar pago</button></div><br></div></paper-dialog><br><br><div class="xMiCard xradius"style="width:90%"><div class="xEncanezadoCard xFondoRowAmarillo2"><h3>Gastos Fijos.</h3><p>Registra los gastos fijos y el periodo de tiempo en meses que estaran activos esto pagos. Ej: Prestamo, Banco BBVA importe S/. 400.00 periodo 24 (meses). Si es un tiempo ilimitado coloque cero (0).</div><div class="xContentCard"style="height:100%"><paper-fab icon="add"onclick="openDIalogNewGF()"title="Agregar"tabindex="0"class="xDerecha"></paper-fab><table width="100%"><thead><th>#<th>Tipo Gasto<th>Descripcion<th>Cuotas<th>Dia de pago<th>Faltan<th>Importe<th><tbody><template is="dom-repeat"items="{{ListGastosFijos}}"as="item"><tr data-t="contable_gasto_fijo"data-id="{{item.idcontable_gasto_fijo}}"class="animated fadeIn fast xCursor"id="{{index}}"onclick="_selItemGastoFijo(this)"><td data-id="{{index}}"><span>{{displayIndex(index)}}</span><td>{{item.tp_gasto}}<td>{{item.descripcion}}<td>{{item.cuotas_van}} de {{item.cuotas}}<td>{{item.dia_pago}}<td><span hidden="{{!item.resaltar}}"class="xRojo xBold">{{item.dif_dia_pago}} dias</span> <span hidden="{{item.resaltar}}"class="xVerde xBold">{{item.dif_dia_pago}} dias</span><td>{{item.total}}<td><span class="xDeleteRow2"title="Anular"onclick="xDialogBorrarObj(this)"></span></template><tr><td><td colspan="5"><p class="xfont15 xBold">Total<td><p class="xfont15 xBold">{{sumList}}<td colspan="2"></table></div></div></template></dom-module><script>var xThisGF,sel_idTipoGastoDetalle,xObjBorrar;function xIniGastosFijos(){$("body").addClass("loaded");var o=xm_log_get("app3_us");xThisGF.xt_org=o.ido,xThisGF.xt_idsede=o.idsede,xThisGF.xt_idus=o.idus,getAllListGastosFijos(),$(".xPasarEnter2").on("keyup",function(o){o=o.which;if(13==o||186==o){var o=$("input"),a=o.index(document.activeElement);if(null!==o[a+1]){var t=o[a+1];if(void 0===t)return;if(null==(t=t.disabled?o[a+2]:t))return;t.focus(),t.select()}return!1}})}function openDIalogNewGF(){sel_idTipoGastoDetalle=compTpGasto.__data__.list_tipo_gasto.idtipo_gasto_detalle,$("#form_new_gasto").reset(),dialog_new_gasto.open()}function getAllListGastosFijos(){$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=1"}).done(o=>{var o=JSON.parse(o),a=0;xThisGF.ListGastosFijos=o.datos.map(o=>(a+=parseFloat(o.importe),o.resaltar=o.dif_dia_pago<0,o)),xThisGF.sumList=numeroConComas(a.toFixed(2))})}function _getTipoGastoDetalle(o){sel_idTipoGastoDetalle=o.idtipo_gasto_detalle}function newGasto(){xPopupLoad.xopen();var o=$("#form_new_gasto");o.find("#idsede").val(xThisGF.xt_idsede),o.find("#idorg").val(xThisGF.xt_org),o.find("#idtipo_gasto").val(1),o.find("#idtipo_gasto_detalle").val(sel_idTipoGastoDetalle),o.find("#mes_ultimo_pago").val(xReturnSumaFechaDada(null,"mm",1)),o.find("#glosa").val(text_glosa.value),xvalidateForm("form_new_gasto",function(o){!1!==o&&$.post("../../bdphp/ManejoBD_IUD.php?tb=contable_gasto_fijo",$("#form_new_gasto").serialize(),function(o){xPopupLoad.xclose(),$("#form_gasto_f").reset(),xPopupLoad.xclose(),getAllListGastosFijos(),dialog_new_gasto.close()})})}function xDialogBorrarObj(o,a){xObjBorrar=o,dialog_borrar.open(),a.stopPropagation()}function xDlgBorrar(){xBorrarItem(xObjBorrar),dialog_borrar.close()}function _selItemGastoFijo(o){var a=o.id,a=xThisGF.ListGastosFijos[a],o=o.dataId;a.cuotas_hoy=parseInt(a.cuotas_van)+1,a.doc="",xThisGF.selItemGastoFijo=a,date_fecha_pago.max=(new Date).toISOString().split("T")[0],date_fecha_pago.value=(new Date).toISOString().split("T")[0],dialog_detalle_gasto_fijo.open(),loadDetalleGF(o)}function confimarPago(){xThisGF.selItemGastoFijo.fecha_pago=date_fecha_pago.value,xThisGF.selItemGastoFijo.doc=doc_pago.value;var o=xThisGF.selItemGastoFijo;$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=101",data:{item:o}}).done(o=>{})}function loadDetalleGF(o){$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=102",data:{i:o}}).done(o=>{var o=JSON.parse(o),a=(xThisGF.ListDetallesGastosFijos=o.datos,0);o.datos.map(o=>{a+=parseFloat(o.importe.replace(",",""))}),xThisGF.sumListDetalle=numeroConComas(a.toFixed(2))})}Polymer({is:"x-gastos-fijos",properties:{xt_org:Number,xt_idsede:Number,sumList:String,sumListDetalle:String,ListGastosFijos:[],ListDetallesGastosFijos:[],selItemGastoFijo:[]},attached:function(){this.selected=0,xThisGF=this,xIniGastosFijos()},displayIndex:function(o){return xCeroIzq(o+1,1)}})</script>