<link rel="import"href="../x-componentes/x-comp-find-almacen/x-comp-find-almacen.html"><dom-module id="x-usuarios"><template><paper-dialog class="dialog_redondo"id="dialog_borrar_usuario"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="xtxtCentro"><img src="../../images/_dlg_remove.gif"alt=""width="150px"></div><p>Esta seguro de querer borrar este usuario?</p><br><div class="buttons"><button class="xBoton2 xPlomo"dialog-dismiss>Cancelar</button> <button class="xBoton2 xRojo"onclick="xGoBorrarUsuario()">Si, borrar</button></div></paper-dialog><paper-dialog id="dialog_add_us"class="dialog_redondo"style="max-width:600px"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="xContent"><paper-tabs selected="{{selected_us}}"><paper-tab>DATOS</paper-tab><paper-tab>ACCESOS</paper-tab><paper-tab>ZONA</paper-tab></paper-tabs><div class="xLinea2"></div><br><iron-pages selected="{{selected_us}}"><div id="datos_us"><select class="xTextRow2"id="select_rol"onchange="tipoUsuario(this)"><option value="0">COLABORADOR<option value="1">ADMINISTRADOR<option value="3">REPARTIDOR / DELIVERISTA</select><br><br><form id="frm_us"hidden$="[[showFormRepartidor]]"><input class="xMiInput xPasarEnter2"placeholder="NOMBRES"onchange="conMayusculas(this)"id="nombres"name="nombres"espaciar required> <input class="xMiInput xPasarEnter2"placeholder="CARGO"onchange="conMayusculas(this)"id="cargo"name="cargo"espaciar required><div style="display:flex;margin-left:5px"><input class="xMiInput xPasarEnter2"placeholder="USUARIO"id="txt_sufijo"value$="[[xt_sufijo]]"style="width:50px"enlinea readonly="readonly"> <input class="xMiInput xPasarEnter2"placeholder="USUARIO"id="usuario"name="usuario"enlinea required></div><input type="password"class="xMiInput xPasarEnter2"placeholder="clave"id="pass"name="pass"espaciar required><br><div><input class="xMiInput xPasarEnter2"placeholder="TELEFONO"onchange="conMayusculas(this)"id="telefono"name="telefono"espaciar><div style="max-width:230px;line-height:1"><span class="text-info fs-11">A este numero de telefono se notificara las solicitudes remotas</span></div></div><div class="xInvisible"><input id="idusuario"name="idusuario"> <input id="idorg"name="idorg"value$="{{xt_org}}"> <input id="idsede"name="idsede"value$="[[xt_idsede]]"> <input id="idalmacen"name="idalmacen"> <input id="estadistica"name="estadistica"> <input id="acc"name="acc"> <input id="per"name="per"> <input id="rol"name="rol"></div></form><div id="formRepartidor"hidden$="[[!showFormRepartidor]]"><input class="xMiInput xPasarEnter2"placeholder="NOMBRES"onchange="conMayusculas(this)"id="nombres_r"name="nombres"espaciar required> <input class="xMiInput xPasarEnter2"placeholder="APELLIDOS"onchange="conMayusculas(this)"id="apellidos_r"name="apellidos"espaciar required> <input class="xMiInput xPasarEnter2"placeholder="DNI"onchange="conMayusculas(this)"id="dni_r"name="dni_r"espaciar required> <input class="xMiInput xPasarEnter2"placeholder="TELEFONO"onchange="conMayusculas(this)"id="telefono_r"name="telefono"espaciar required><div style="display:flex;margin-left:5px"><input class="xMiInput xPasarEnter2"placeholder="USUARIO"id="txt_sufijo_r"value$="[[xt_sufijo]]"style="width:50px"enlinea readonly="readonly"> <input class="xMiInput xPasarEnter2"placeholder="USUARIO"id="usuario_r"name="usuario"enlinea required></div><input type="password"class="xMiInput xPasarEnter2"placeholder="clave"id="pass_r"name="pass"espaciar required></div><br><a href="#"onclick="xResetearClave()">Resetear clave</a><br></div><div id="acc_us"class=""style="max-height:70vh"><div style="overflow-y:auto;overflow-x:none;max-height:60vh"><h4>OPERATIVIDAD</h4><paper-checkbox class="checkA"data-id="A1,">Elaborar carta</paper-checkbox><br><paper-checkbox class="checkA"data-id="A2,">Realizar Pedidos</paper-checkbox><br><paper-checkbox class="checkA"data-id="A3,">Caja</paper-checkbox><br><paper-checkbox class="checkA"data-id="A4,">Control de Mesas</paper-checkbox><br><paper-checkbox class="checkA"data-id="A5,">Punto de Venta</paper-checkbox><br><paper-checkbox class="checkA"data-id="A6,">Monitoreo del stock</paper-checkbox><br><paper-checkbox class="checkA"data-id="A7,">Registro de pagos</paper-checkbox><br><paper-checkbox class="checkA"data-id="A8,">Zona de Despacho</paper-checkbox><br><paper-checkbox class="checkA"data-id="A9,">Recuperar stock de items borrados</paper-checkbox><br><paper-checkbox class="checkA"data-id="A10,">Facturador CPE</paper-checkbox><br><paper-checkbox class="checkA"data-id="A11,">CPE Emitidos</paper-checkbox><br><paper-checkbox class="checkA"data-id="A12,">Servidor de Impresion</paper-checkbox><br><paper-checkbox class="checkA"data-id="A13,">Lanzar Encuesta</paper-checkbox><br><paper-checkbox class="checkA"data-id="A14,">Indicadores</paper-checkbox><br><paper-checkbox class="checkA"data-id="A15,">Mozo Virtual</paper-checkbox><br><paper-checkbox class="checkA"data-id="A16,">Pagos desde el APP</paper-checkbox><br><paper-checkbox class="checkA"data-id="A17,">Tracker Delivery</paper-checkbox><br><paper-checkbox class="checkA"data-id="A18,">Promociones</paper-checkbox><br><paper-checkbox class="checkA"data-id="A19,">Solicitud Remota</paper-checkbox><br><paper-checkbox class="checkA"data-id="A20,">Ticket Entrada</paper-checkbox><br><paper-checkbox class="checkA"data-id="A21,">Chat Bot</paper-checkbox><br><br><h4>LOGISTICA</h4><paper-checkbox class="checkA"data-id="B1,">Compras</paper-checkbox><br><paper-checkbox class="checkA"data-id="B2,">Distribucion</paper-checkbox><br><paper-checkbox class="checkA"data-id="B3,">Porcionar</paper-checkbox><br><paper-checkbox class="checkA"data-id="B4,">Recetas y costos</paper-checkbox><br><paper-checkbox class="checkA"data-id="B5,">Almacenes y Productos</paper-checkbox><br><paper-checkbox class="checkA"data-id="B12,">Porciones</paper-checkbox><br><paper-checkbox class="checkA"data-id="B6,">Entradas y Salidas del almacen</paper-checkbox><br><paper-checkbox class="checkA"data-id="B7,">Inventario</paper-checkbox><br><paper-checkbox class="checkA"data-id="B8,">Clientes</paper-checkbox><br><paper-checkbox class="checkA"data-id="B10,">Orden de Pedido</paper-checkbox><br><paper-checkbox class="checkA"data-id="B11,">Produccion</paper-checkbox><br><paper-checkbox class="checkA"data-id="B13,">Proveedores</paper-checkbox><br><paper-checkbox class="checkA"data-id="B14,">Recibir Distribuicion</paper-checkbox><br><br><h4>CONTABLE</h4><paper-checkbox class="checkA"data-id="D1,">Cuentas por pagar / cobrar</paper-checkbox><br><paper-checkbox class="checkA"data-id="D2,">Gastos fijos</paper-checkbox><br><paper-checkbox class="checkA"data-id="D3,">Gastos Variables</paper-checkbox><br><paper-checkbox class="checkA"data-id="D4,">Otros Ingresos</paper-checkbox><br><paper-checkbox class="checkA"data-id="D7,">Gesti√≥n de Recursos Humanos</paper-checkbox><br><br><h4>ADMINISTRACION</h4><paper-checkbox class="checkA"data-id="C1,">Configuraciones del sistema</paper-checkbox><br><paper-checkbox class="checkA"data-id="C2,">Usuarios</paper-checkbox><br><paper-checkbox class="checkA"data-id="C5,">Andalitica Modulo Gerencial</paper-checkbox><br><paper-checkbox class="checkA"data-id="C6,">Configurar Encuestas</paper-checkbox><br><br><h4>PERMISOS</h4><paper-checkbox class="checkP"data-id="Pe1,">Eliminar pedidos</paper-checkbox><br><paper-checkbox class="checkP"data-id="Pe2,">Reimprimir Pedido</paper-checkbox><br><paper-checkbox class="checkP"data-id="Pe3,">Agregar sin imprimir</paper-checkbox><br><paper-checkbox class="checkP"data-id="Pe4,">Cambiar de mesa el pedido</paper-checkbox><br><paper-checkbox class="checkP"data-id="Pe5,">Asignar descuentos</paper-checkbox><br><paper-checkbox class="checkP"data-id="Pe6,">Eliminar Porciones</paper-checkbox><br><paper-checkbox class="checkP"data-id="Pe7,">Eliminar Productos</paper-checkbox><br><paper-checkbox class="checkP"data-id="Pe8,">Eliminar Clientes</paper-checkbox><br></div></div><div id="div_zona"><h4>Asignar un almacen.</h4><span class="xfont8">Esta opcion se utiliza en los siguientes escenarios: Discoteca, bares o locales que tengan mas zona de despacho de productos terminados o embotellados,<br><strong>Ejemplo:</strong> En una discoteca cuentan con varios bares de venta de cerveza, entonces al usuario se le asigna un bar(almacen) del que va ser responsable, entonces todas las ventas que haga el sistema descontara de este almacen(bar) asignado.<br><strong>Tenga en cuenta que si utiliza esta opcion, lo mejor es trabajar directamente con las cajas a la hora de hacer los pedidos.</strong></span><br><br><label for="listAlmacen">Asigne un Almacen:</label><x-comp-find-almacen id="listAlmacen"opninguno="true"></x-comp-find-almacen></div></iron-pages><br><button class="xBoton2 xAzul"onclick="xGuardarUs()">Guardar</button> <button class="xBoton2 xPlomo"onclick="dialog_add_us.close()">Cancelar</button><br></div></paper-dialog><br><h3>USUARIOS</h3><div class="xLinea2"></div><br><paper-fab icon="add"onclick="xNuevoUsuario(),dialog_add_us.open()"title="Agregar"tabindex="0"class="btnAdd"></paper-fab><table id="tb_us"width="100%"class="xtable2"><thead><th align="left">Nombres<th align="left">Cargo<th align="left">usuario<th width="5px"><th width="5px"></thead></table><br><br><br><h3>REPARTIDORES / DELIVERISTA</h3><div class="xLinea2"></div><table id="tb_us_re"width="100%"class="xtable2"><thead><th align="left">Nombres<th align="left">Cargo<th align="left">usuario<th width="5px"></thead></table></template></dom-module><script>var xThis,objUsuarioSeleted;function xIniUsuarios(){$("#Titulo_page").text("Usuarios"),xm_log_get("ini_us"),$("body").addClass("loaded");var e=xm_log_get("datos_org_all_sede")[0].sufijo;xThis.xt_org=xIdOrg,xThis.xt_idsede=xIdSede,xThis.xt_idus=xIdUsuario,xThis.xt_sufijo=e,xThis.showFormRepartidor=!1,""!==xIdOrg&&null!=xIdOrg||(e=xm_log_get("app3_us"),xThisConfig.xt_org=e.ido,xThisConfig.xt_idsede=e.idsede,xThisConfig.xt_idus=e.idus),xLoadUs(),$(".xPasarEnter2").on("keyup",function(e){e=e.which;if(13==e||186==e){var e=$("input"),o=e.index(document.activeElement);if(null!==e[o+1]){var a=e[o+1];if(void 0===a)return;if(null==(a=a.disabled?e[o+2]:a))return;a.focus(),a.select()}return!1}})}function xResetearClave(){var e=$("#frm_us #idusuario")[0].value;""!==e&&(xPopupLoad.xopen(),$.ajax({type:"POST",url:"../../bdphp/log.php?op=4031",data:{i:e}}),setTimeout(()=>{xPopupLoad.xclose()},200))}function xModificarUs(e){xNuevoUsuario(),xPopupLoad.xopen(),xPopupLoad.titulo="Cargando..";var s=$(e).parents("tr").attr("data-id");$.ajax({type:"POST",url:"../../bdphp/log.php?op=403",data:{i:s}}).done(function(e){for(var e=$.parseJSON(e),o=(e=e.datos)[0].acc,a=e[0].per,r=$("#frm_us"),i=(r.find("#idusuario").val(s),r.find("#idorg").val(xThis.xt_org),r.find("#idsede").val(xThis.xt_idsede),r.find("#cargo").val(e[0].cargo),r.find("#nombres").val(e[0].nombres),r.find("#usuario").val(e[0].usuario.toUpperCase().replace(xThis.xt_sufijo.toUpperCase(),"")),r.find("#pass").val(e[0].pass),r.find("#acc").val(o),r.find("#per").val(a),r.find("#idalmacen").val(listAlmacen.getAlmacen().idalmacen),r.find("#telefono").val(e[0].telefono),select_rol.value=e[0].rol,""),o=o.split(","),t=0;t<o.length;t++)i=o[t]+",",$(".checkA").each(function(e,o){if($(o).attr("data-id")==i)return!(o.checked=!0)});for(a=a.split(","),t=0;t<a.length;t++)i=a[t]+",",$(".checkP").each(function(e,o){if($(o).attr("data-id")==i)return!(o.checked=!0)});dialog_add_us.open(),xPopupLoad.xclose(),xPopupLoad.titulo="Guardando.."})}function xGuardarUs(){var a="",r="",i="",e=($(".checkA").each(function(e,o){0!=o.checked&&("C5,"===(i=o.dataset.id)&&$("#frm_us #estadistica").val("1"),a+=i)}),$(".checkP").each(function(e,o){0!=o.checked&&(i=o.dataset.id,r+=i)}),$("#frm_us #acc").val(a),$("#frm_us #per").val(r),$("#frm_us #rol").val(select_rol.value),xThis.xt_sufijo+usuario.value);$("#frm_us #usuario").val(e),xThis.showFormRepartidor?(e={nombre:nombres_r.value,apellido:apellidos_r.value,dni:dni_r.value,telefono:telefono_r.value,usuario:txt_sufijo_r.value+usuario_r.value,pass:pass_r.value,idsede:xThis.xt_idsede},xPopupLoad.xopen(),$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=11",data:{item:e}}).done(function(e){xLoadUs(),xPopupLoad.xclose(),dialog_add_us.close()})):xvalidateFormInput("frm_us",function(e){!1===e?xThis.selected_us=0:(xPopupLoad.xopen(),$.post("../../bdphp/ManejoBD_IUD.php?tb=usuario",$("#frm_us").serialize(),function(e){dialog_add_us.close(),xPopupLoad.xclose(),xNuevoUsuario(),xLoadUs()}))})}function xNuevoUsuario(){$("#frm_us").reset(),$(".checkA").each(function(e,o){o.checked=!1}),$(".checkP").each(function(e,o){o.checked=!1})}function xLoadUs(){$("#tb_us").append('<tr class="row"><td colspan="4"><paper-spinner active></paper-spinner></td></tr>'),$.ajax({type:"POST",url:"../../bdphp/log.php?op=402"}).done(function(e){for(var o="",a=$.parseJSON(e).datos,r=0;r<a.length;r++)o=String(o+'<tr class="row" data-id="'+a[r].idusuario+'" data-t="usuario"><td>'+a[r].nombres+"</td><td>"+a[r].cargo+"</td><td>"+a[r].usuario+'</td><td title="Modificar" onClick="xModificarUs(this)"><span class="icon xCursor"><img src="../../images/edit.png"></span></td><td><span onClick="xBorrarUsuarioOpenDialog(this)" class="xDeleteRow" title="Borrar"></span></td></tr>');$("#tb_us .row").remove(),$("#tb_us").append(o).trigger("create")}),$("#tb_us_re").append('<tr class="row"><td colspan="4"><paper-spinner active></paper-spinner></td></tr>'),$.ajax({type:"POST",url:"../../bdphp/log.php?op=4021"}).done(function(e){for(var o="",a=$.parseJSON(e).datos,r=0;r<a.length;r++)o=String(o+'<tr class="row" data-id="'+a[r].idrepartidor+'" data-t="repartidor"><td>'+a[r].nombre+" "+a[r].apellido+"</td><td>Repartidor</td><td>"+a[r].usuario+'</td><td><span onclick="xBorrarItem(this);" class="xDeleteRow" title="Borrar"></span></td></tr>');$("#tb_us_re .row").remove(),$("#tb_us_re").append(o).trigger("create")})}function xBorrarUsuarioOpenDialog(e){objUsuarioSeleted=e,dialog_borrar_usuario.open()}function xGoBorrarUsuario(){xBorrarItem(objUsuarioSeleted),dialog_borrar_usuario.close()}function tipoUsuario(e){xThis.showFormRepartidor=2===e.selectedIndex}Polymer({is:"x-usuarios",properties:{xt_org:Number,xt_idsede:Number,xt_idus:Number,xt_sufijo:String,showFormRepartidor:boolean=!1,subscription$:Object},attached:function(){this.selected_us=0,this.showFormRepartidor=!1,xThis=this,xIniUsuarios(),this.subscription$=onStatusSetUsChangeSede().subscribe(e=>{1==e&&xIniUsuarios()})},detached:function(){this.subscription$.unsubscribe()}})</script>