<link rel="import" href="../x-componentes/x-comp-find-almacen/x-comp-find-almacen.html">
<dom-module id="x-usuarios">
<template>
<paper-dialog id="dialog_add_us" class="dialog_redondo" style="max-width:600px" modal entry-animation="scale-up-animation" exit-animation="fade-out-animation" with-backdrop>
<div class="xContent">
<paper-tabs selected="{{selected_us}}">
<paper-tab>DATOS</paper-tab>
<paper-tab>ACCESOS</paper-tab>
<paper-tab>ZONA</paper-tab>
</paper-tabs>
<div class="xLinea2"></div>
<br>
<iron-pages selected="{{selected_us}}">
<div id="datos_us">
<select class="xTextRow2" id="select_rol" onchange="tipoUsuario(this)">
<option value="0">COLABORADOR</option>
<option value="1">ADMINISTRADOR</option>
<option value="3">REPARTIDOR / DELIVERISTA</option>
</select>
<br><br>
<form id="frm_us" hidden$="[[showFormRepartidor]]">
<input type="text" class="xMiInput xPasarEnter2" placeholder="NOMBRES" onChange="conMayusculas(this)" id="nombres" name="nombres" espaciar required>
<input type="text" class="xMiInput xPasarEnter2" placeholder="CARGO" onChange="conMayusculas(this)" id="cargo" name="cargo" espaciar required>
<div style="display:flex;margin-left:5px">
<input type="text" class="xMiInput xPasarEnter2" placeholder="USUARIO" id="txt_sufijo" value$="[[xt_sufijo]]" style="width:50px" enLinea readonly>
<input type="text" class="xMiInput xPasarEnter2" placeholder="USUARIO" id="usuario" name="usuario" enLinea required>
</div>
<input type="password" class="xMiInput xPasarEnter2" placeholder="clave" id="pass" name="pass" espaciar required>
<div class="xInvisible">
<input type="text" id="idusuario" name="idusuario">
<input type="text" id="idorg" name="idorg" value$="{{xt_org}}">
<input type="text" id="idsede" name="idsede" value$="[[xt_idsede]]">
<input type="text" id="idalmacen" name="idalmacen">
<input type="text" id="estadistica" name="estadistica">
<input type="text" id="acc" name="acc">
<input type="text" id="per" name="per">
<input type="text" id="rol" name="rol">
</div>
</form>
<div id="formRepartidor" hidden$="[[!showFormRepartidor]]">
<input type="text" class="xMiInput xPasarEnter2" placeholder="NOMBRES" onChange="conMayusculas(this)" id="nombres_r" name="nombres" espaciar required>
<input type="text" class="xMiInput xPasarEnter2" placeholder="APELLIDOS" onChange="conMayusculas(this)" id="apellidos_r" name="apellidos" espaciar required>
<input type="text" class="xMiInput xPasarEnter2" placeholder="DNI" onChange="conMayusculas(this)" id="dni_r" name="dni_r" espaciar required>
<input type="text" class="xMiInput xPasarEnter2" placeholder="TELEFONO" onChange="conMayusculas(this)" id="telefono_r" name="telefono" espaciar required>
<div style="display:flex;margin-left:5px">
<input type="text" class="xMiInput xPasarEnter2" placeholder="USUARIO" id="txt_sufijo_r" value$="[[xt_sufijo]]" style="width:50px" enLinea readonly>
<input type="text" class="xMiInput xPasarEnter2" placeholder="USUARIO" id="usuario_r" name="usuario" enLinea required>
</div>
<input type="password" class="xMiInput xPasarEnter2" placeholder="clave" id="pass_r" name="pass" espaciar required>
</div>
<br>
<a href="#" onclick="xResetearClave()"> Resetear clave</a>
<br>
</div>
<div id="acc_us" class="" style="max-height:70vh">
<div style="overflow-y:auto;overflow-x:none;max-height:60vh">
<h4>OPERATIVIDAD</h4>
<paper-checkbox class="checkA" data-id='A1,'> Elaborar carta</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='A2,'> Realizar Pedidos</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='A3,'> Caja</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='A4,'> Control de Mesas</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='A5,'> Punto de Venta</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='A6,'> Monitoreo del stock</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='A7,'> Registro de pagos</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='A8,'> Zona de Despacho</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='A9,'> Recuperar stock de items borrados</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='A10,'> Facturador CPE</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='A11,'> CPE Emitidos</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='A12,'> Servidor de Impresion</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='A13,'> Lanzar Encuesta</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='A14,'> Indicadores</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='A15,'> Mozo Virtual</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='A16,'> Pagos desde el APP</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='A17,'> Tracker Delivery</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='A18,'> Promociones</paper-checkbox><br>
<br>
<h4>LOGISTICA</h4>
<paper-checkbox class="checkA" data-id='B1,'> Compras</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='B2,'> Distribucion</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='B3,'> Porcionar</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='B4,'> Recetas y costos</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='B5,'> Productos Porciones</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='B6,'> Entradas y Salidas del almacen</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='B7,'> Inventario</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='B8,'> Clientes</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='B10,'> Orden de Pedido</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='B11,'> Produccion</paper-checkbox><br>
<br>
<h4>CONTABLE</h4>
<paper-checkbox class="checkA" data-id='D1,'> Cuentas por pagar / cobrar</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='D2,'> Gastos fijos</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='D3,'> Gastos Variables</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='D4,'> Otros Ingresos</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='D5,'> Recursos Humanos</paper-checkbox><br>
<br>
<h4>ADMINISTRACION</h4>
<paper-checkbox class="checkA" data-id='C1,'> Configuraciones del sistema</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='C2,'> Usuarios</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='C5,'> Andalitica Modulo Gerencial</paper-checkbox><br>
<paper-checkbox class="checkA" data-id='C6,'> Configurar Encuestas</paper-checkbox><br>
<br>
<h4>PERMISOS</h4>
<paper-checkbox class="checkP" data-id='Pe1,'>Eliminar pedidos</paper-checkbox><br>
<paper-checkbox class="checkP" data-id='Pe2,'>Reimprimir Pedido</paper-checkbox><br>
<paper-checkbox class="checkP" data-id='Pe3,'>Agregar sin imprimir</paper-checkbox><br>
<paper-checkbox class="checkP" data-id='Pe4,'>Cambiar de mesa el pedido</paper-checkbox><br>
<paper-checkbox class="checkP" data-id='Pe5,'>Asignar descuentos</paper-checkbox><br>
</div>
</div>
<div id="div_zona">
<h4>Asignar un almacen.</h4>
<span class="xfont8">Esta opcion se utiliza en los siguientes escenarios: Discoteca, bares o locales que tengan mas zona de despacho de productos terminados o embotellados,
<br><strong>Ejemplo:</strong> En una discoteca cuentan con varios bares de venta de cerveza, entonces al usuario se le asigna un bar(almacen) del que va ser responsable, entonces todas las ventas que haga el sistema descontara de este almacen(bar) asignado.
<br><strong>Tenga en cuenta que si utiliza esta opcion, lo mejor es trabajar directamente con las cajas a la hora de hacer los pedidos. </strong>
</span>
<br><br>
<label for="listAlmacen">Asigne un Almacen:</label>
<x-comp-find-almacen id="listAlmacen" opninguno="true"></x-comp-find-almacen>
</div>
</iron-pages>
<br>
<button class="xBoton2 xAzul" onclick="xGuardarUs()">Guardar</button>
<button class="xBoton2 xPlomo" onclick="dialog_add_us.close()">Cancelar</button>
<br>
</div>
</paper-dialog>
<br>
<h3>USUARIOS</h3>
<div class="xLinea2"></div>
<br>
<paper-fab icon="add" onclick="xNuevoUsuario();dialog_add_us.open()" title="Agregar" tabindex="0" class="btnAdd"></paper-fab>
<table id="tb_us" width="100%" class="xtable2">
<thead>
<th align="left">Nombres</th>
<th align="left">Cargo</th>
<th align="left">usuario</th>
<th width="5px"></th>
<th width="5px"></th>
</thead>
</table>
<br>
<br><br>
<h3>REPARTIDORES / DELIVERISTA</h3>
<div class="xLinea2"></div>
<table id="tb_us_re" width="100%" class="xtable2">
<thead>
<th align="left">Nombres</th>
<th align="left">Cargo</th>
<th align="left">usuario</th>
<th width="5px"></th>
</thead>
</table>
</template>
</dom-module>
<script>/*<![CDATA[*/var xThis;function xIniUsuarios(){$("#Titulo_page").text("Usuarios");xm_log_get('ini_us');$('body').addClass('loaded');const sufijoSede=xm_log_get('datos_org_all_sede')[0].sufijo;xThis.xt_org=xIdOrg;xThis.xt_idsede=xIdSede;xThis.xt_idus=xIdUsuario;xThis.xt_sufijo=sufijoSede;xThis.showFormRepartidor=false;if(xIdOrg===""||xIdOrg==undefined){var _dtUs=xm_log_get('app3_us');xThisConfig.xt_org=_dtUs.ido;xThisConfig.xt_idsede=_dtUs.idsede;xThisConfig.xt_idus=_dtUs.idus;}
xLoadUs();$('.xPasarEnter2').on('keyup',function(e){var code=e.which;if(code==13||code==186){var inputs=$('input');var a=inputs.index(document.activeElement);if(inputs[a+1]!==null)
{var nextBox=inputs[a+1];if(nextBox===undefined){return}
if(nextBox.disabled){nextBox=inputs[a+2]}
if(nextBox==undefined){return;}
nextBox.focus();nextBox.select();}
return false;}});}
function xResetearClave(){const idUsReset=$("#frm_us #idusuario")[0].value;if(idUsReset==='')return;xPopupLoad.xopen();$.ajax({type:'POST',url:'../../bdphp/log.php?op=4031',data:{i:idUsReset}})
setTimeout(()=>{xPopupLoad.xclose();},200);}
function xModificarUs(obj){xNuevoUsuario();xPopupLoad.xopen();xPopupLoad.titulo="Cargando..";var xid=$(obj).parents('tr').attr('data-id');$.ajax({type:'POST',url:'../../bdphp/log.php?op=403',data:{i:xid}}).done(function(dtLoadUs){var xdtLoadUs=$.parseJSON(dtLoadUs);xdtLoadUs=xdtLoadUs.datos;var xacc_bd=xdtLoadUs[0].acc;var xper_bd=xdtLoadUs[0].per;const frm_us=$("#frm_us");frm_us.find("#idusuario").val(xid);frm_us.find("#idorg").val(xThis.xt_org);frm_us.find("#idsede").val(xThis.xt_idsede);frm_us.find("#cargo").val(xdtLoadUs[0].cargo);frm_us.find("#nombres").val(xdtLoadUs[0].nombres);frm_us.find("#usuario").val(xdtLoadUs[0].usuario.toUpperCase().replace(xThis.xt_sufijo.toUpperCase(),''));frm_us.find("#pass").val(xdtLoadUs[0].pass);frm_us.find("#acc").val(xacc_bd);frm_us.find("#per").val(xper_bd);frm_us.find("#idalmacen").val(listAlmacen.getAlmacen().idalmacen);select_rol.value=xdtLoadUs[0].rol;var xBus='';var xCharFind='';xacc_bd=xacc_bd.split(',')
for(var i=0;i<xacc_bd.length;i++){xBus=xacc_bd[i]+',';$(".checkA").each(function(index,element){xCharFind=$(element).attr('data-id');if(xCharFind==xBus){element.checked=true;return false;}})}
xper_bd=xper_bd.split(',')
for(var i=0;i<xper_bd.length;i++){xBus=xper_bd[i]+',';$(".checkP").each(function(index,element){xCharFind=$(element).attr('data-id');if(xCharFind==xBus){element.checked=true;return false;}})}
dialog_add_us.open();xPopupLoad.xclose();xPopupLoad.titulo="Guardando..";});}
function xGuardarUs(){var xCadena_a='';var xCadena_p='',dataIdCheck='',valEstadistica=0;$(".checkA").each(function(index,element){if(element.checked==false){return;}
dataIdCheck=element.dataset.id;if(dataIdCheck==='C5,'){$("#frm_us #estadistica").val('1');}
xCadena_a=xCadena_a+dataIdCheck;});$(".checkP").each(function(index,element){if(element.checked==false){return;}
dataIdCheck=element.dataset.id;xCadena_p=xCadena_p+dataIdCheck;});$("#frm_us #acc").val(xCadena_a);$("#frm_us #per").val(xCadena_p);$("#frm_us #rol").val(select_rol.value);const _usuario=xThis.xt_sufijo+usuario.value;$("#frm_us #usuario").val(_usuario);if(xThis.showFormRepartidor){const _dataSend={nombre:nombres_r.value,apellido:apellidos_r.value,dni:dni_r.value,telefono:telefono_r.value,usuario:txt_sufijo_r.value+usuario_r.value,pass:pass_r.value,idsede:xThis.xt_idsede}
console.log(JSON.stringify(_dataSend));xPopupLoad.xopen();$.ajax({type:'POST',url:'../../bdphp/log_005.php?op=11',data:{item:_dataSend}}).done(function(DtProv){console.log(DtProv);xLoadUs();xPopupLoad.xclose();dialog_add_us.close();});return;}
xvalidateFormInput('frm_us',function(a){if(a===false){xThis.selected_us=0;return;}
xPopupLoad.xopen();$.post("../../bdphp/ManejoBD_IUD.php?tb=usuario",$("#frm_us").serialize(),function(id){dialog_add_us.close();xPopupLoad.xclose();xNuevoUsuario();xLoadUs();})});}
function xNuevoUsuario(){$("#frm_us").reset();$(".checkA").each(function(index,element){element.checked=false;});$(".checkP").each(function(index,element){element.checked=false;});}
function xLoadUs(){$("#tb_us").append('<tr class="row"><td colspan="4"><paper-spinner active></paper-spinner></td></tr>');$.ajax({type:'POST',url:'../../bdphp/log.php?op=402'}).done(function(dtUs){var xdtUs=$.parseJSON(dtUs);var xCadenaUs='';xdtUs=xdtUs.datos;for(var i=0;i<xdtUs.length;i++){xCadenaUs=String(xCadenaUs+'<tr class="row" data-id="'+xdtUs[i].idusuario+'" data-t="usuario"><td>'+xdtUs[i].nombres+'</td><td>'+xdtUs[i].cargo+'</td><td>'+xdtUs[i].usuario+'</td>'+'<td title="Modificar" onClick="xModificarUs(this)"><span class="icon xCursor"><img src="../../images/edit.png"></span></td>'+'<td><span onclick="xBorrarItem(this);" class="xDeleteRow" title="Borrar"></span></td>'+'</tr>');}
$("#tb_us .row").remove();$("#tb_us").append(xCadenaUs).trigger('create');});$("#tb_us_re").append('<tr class="row"><td colspan="4"><paper-spinner active></paper-spinner></td></tr>');$.ajax({type:'POST',url:'../../bdphp/log.php?op=4021'}).done(function(dtUs){var xdtUs=$.parseJSON(dtUs);var xCadenaUs='';xdtUs=xdtUs.datos;for(var i=0;i<xdtUs.length;i++){xCadenaUs=String(xCadenaUs+'<tr class="row" data-id="'+xdtUs[i].idrepartidor+'" data-t="repartidor"><td>'+xdtUs[i].nombre+' '+xdtUs[i].apellido+'</td><td>Repartidor</td><td>'+xdtUs[i].usuario+'</td>'+'<td><span onclick="xBorrarItem(this);" class="xDeleteRow" title="Borrar"></span></td>'+'</tr>');}
$("#tb_us_re .row").remove();$("#tb_us_re").append(xCadenaUs).trigger('create');});}
function tipoUsuario($event){xThis.showFormRepartidor=$event.selectedIndex===2;}
Polymer({is:'x-usuarios',properties:{xt_org:Number,xt_idsede:Number,xt_idus:Number,xt_sufijo:String,showFormRepartidor:boolean=false},attached:function(){this.selected_us=0;this.showFormRepartidor=false;xThis=this;xIniUsuarios();}})/*]]>*/</script>