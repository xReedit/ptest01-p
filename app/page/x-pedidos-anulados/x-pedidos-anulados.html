<link rel="import"href="../../web_components/polymer/polymer.html"><dom-module id="x-pedidos-anulados"><template is="dom-bind"><div class="p-3"style="max-width:1200px!important;margin:0 auto"><div class="pl-2 mb-2"><h3>Pedidos Anulados</h3><input class="selected-template-1 xCursor"id="pick-date"placeholder="Elige fecha"></div><div><table class="w-100 content-table-delivery fs-12"style="min-width:600px"><thead><th align="center">#<th align="left">Fecha<th align="left"style="max-width:200px">Usuario<th align="left">Pedido<th align="left">Detalle<tbody><template is="dom-repeat"items="{{listPedidosBorrados}}"as="item"><tr><td align="center"><p class="fw-600 fs-18">{{item.num}}</p><i hidden$="[[!item.isCerrado]]"class="fa fa-lock"></i><td><p class="fw-600">{{ item.fecha }}<p>{{ item.hora }}<td><p>{{ item.usuario}}<p title="Autorizo"><i class="fa fa-key text-success fw-900"></i> {{ item.usuario_autoriza }}<p><strong>Motivo:</strong> <span class="text-danger fw-600">{{ item.motivo_anular }}</span><td><p>{{ item.idpedido }}<p class="fw-900">{{ item.tp }}<p hidden$="[[!item.isShowMesa]]"class="badge badge-primary"><span class="fs-15">MESA {{item.nummesa}}</span><td><p hidden="[[ !item.isShowRecuperaStock ]]"class="badge badge-success">Stock Recuperado<p hidden="[[ item.isShowRecuperaStock ]]"class="badge badge-danger">Stock No Recuperado</p><template is="dom-repeat"items="{{item.items}}"as="row"><div class="d-flexx justify-content-between"><p>{{ row.cantidad }} {{ row.descripcion }}<p>{{ row.importe }}</div></template></template><tr><td colspan="4"align="right"class="fw-600"><td align="right"style="padding:10px"><span class="fw-600 fs-18">{{ convertRowFixed(importeTotal) }}</span></table></div></div></template><style>.content-table-delivery{padding:15px 0;background:#fff;border-radius:8px;border:1px solid #e0e0e0}.content-table-delivery tr>td{border-bottom:8px solid #e5e5e7}</style><script>var xThisPB;function xPBLoad(){$("#Titulo_page").text("Pedidos Anulados"),$("#pick-date").pickadate({format:"dd mmmm, yyyy",today:"Hoy",clear:"Borrar",close:"Cerrar",onSet:function(e){xPBGetData(e.select?new Date(e.select).toLocaleDateString():"")}}),xPBGetData("")}function xPBGetData(e){const o=e;var t=0;$.ajax({type:"POST",url:"../../bdphp/log_009.php?op=9",data:{f:o}}).done(function(e){var a=(e=JSON.parse(e)).datos.length;xThisPB.listPedidosBorrados=e.datos.map(e=>{e.num=a,e.items=JSON.parse(e.items);var o=e.items[0].motivo||"No indico";return e.isCerrado=""!==e.fecha_cierre,e.isShowMesa=0!=e.nummesa,e.motivo_anular=e.motivo_anular||o,e.isShowRecuperaStock="1"==e.recupera_stock,t+=e.items.map(e=>parseFloat(e.importe)).reduce((e,o)=>e+o,0),a--,e}),xThisPB.importeTotal=t})}Polymer({is:"x-pedidos-anulados",properties:{listPedidosBorrados:[],importeTotal:Number},attached:function(){xThisPB=this,xPBLoad()},convertRowFixed:e=>e.toFixed(2)})</script></dom-module>