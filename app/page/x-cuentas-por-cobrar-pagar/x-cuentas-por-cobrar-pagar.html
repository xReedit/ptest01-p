<link rel="import"href="../../x-componentes/pagination-input/pagination-input.html"><dom-module id="x-cuentas-por-cobrar-pagar"><link rel="import"href="./x-cuentas-por-cobrar.html"><template is="dom"><paper-dialog class="dialog_redondo"id="dialog_borrar"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="xtxtCentro"><img src="../../../images/_dlg_remove.gif"alt=""width="150px"></div><p>Esta seguro de querer borrar este registro?</p><br><div class="buttons"><button class="xBoton2 xPlomo"dialog-dismiss>Cancelar</button> <button class="xBoton2 xRojo"onclick="xDlgBorrar()">Si, borrar</button></div></paper-dialog><paper-dialog class="dialog_redondo"id="dialog_detalle_cp"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"><div><h4>Registrar Pago</h4><h4>{{selItemCP.des_proveedor}}</h4><span>Deuda total: {{selItemCP.total_total}}</span><hr><br><div class="x_div_linea"><div id="historial"class="xitem1 xBordeDe"style="height:50vh;overflow-y:auto"><div><p><strong>Historial de abonos</strong><table width="100%"><thead class="xfont10"><th>#<th>Fecha<th align="right">Importe<tbody><template is="dom-repeat"items="{{ListDetallesCP}}"as="subitem"><tr class="xfont10"><td data-id="{{index}}"><span>{{displayIndex(index)}}</span><td>{{subitem.fecha}}<td align="right">{{subitem.total}}</template><tr><td colspan="2"><p class="xfont15 xBold">Total<td align="right"><p class="xfont15 xBold">{{sumTotalDetalleCP}}</table></div></div><div id="registrar-pago"class="xitem2"><table width="100%"class="table-like"><tr><td>F. compra<td>{{selItemCP.f_compra}}<tr><td>Pendiente<td>{{selItemCP.total}}<tr><td>Pagar<td><input type="number"class="xMiInput xPasarEnter2"onchange="conMayusculas(this)"onkeyup="comprobarValPagar(this)"id="importe_pagar"espaciar></table></div></div><hr><div class="xDerecha"><button dialog-dismiss class="xBoton2 xRojo">Cerrar</button> <button dialog-dismiss id="dlg_sunat_btn"onclick="confimarPago()"class="xBoton2 xVerde"disabled$="[[!habiltarBtnPago]]">Listo confirmar pago</button></div><br></div></paper-dialog><br><br><div class="xMiCard xradius"style="width:90%;max-width:1200px"><br><div class="xContentCard"style="height:100%"><div class="div_container_cuentas mt-3 mb-3"hidden$="[[!showBtnPrincipales]]"><div class="div_cuentas"onclick="showPanelOptionListCuentasCobrarPagar(0)"><img src="../../../images/001-por-pagar.png"alt="img-por-pagar"><p class="fw-600 fs-18">Cuentas por <strong class="text-warning">Pagar</strong><p>Compras realizadas<br>a los proveedores al credito.</div><div class="div_cuentas"onclick="showPanelOptionListCuentasCobrarPagar(1)"><img src="../../../images/002-por-cobrar.png"alt="img-por-pagar"><p class="fw-600 fs-18">Cuentas por <strong class="text-primary">Cobrar</strong><p>Consumo de clientes<br>registradas al credito.</div></div><iron-pages selected="{{selected}}"hidden$="[[showBtnPrincipales]]"><div id="div_cuentas_pagar"><div class="d-flexx justify-content-between"><h4>Cuentas por pagar</h4><button class="btn btn-sm btn-secondary"onclick="xGoBackListaCuentasCobrarPrincipal()"><i class="fa fa-arrow-left mr-1"></i> Atras</button></div><span>Compras realizadas al credito. <strong><a class="xColorRow_verde xCursor"onclick="xVerHistorialCuentasPagadas()">Ver historial de cuentas pagadas</a></strong></span><br><br><br><table width="100%"><thead><th>#<th>Proveedor<th>F. Compra<th>F. Pago<th>Faltan<th>Importe<th><tbody><template is="dom-repeat"items="{{ListCuentasPagar}}"as="item"><tr data-t="compra"data-id="{{item.idcompra}}"class="animated fadeIn fast xCursor"id="{{index}}"onclick="_selItemCP(this)"><td data-id="{{index}}"><span>{{displayIndex(index)}}</span><td>{{item.des_proveedor}}<td>{{item.f_compra}}<td>{{item.f_pago}}<td><span hidden="{{!item.resaltar}}"class="xRojo xBold">{{item.faltan}} dias</span> <span hidden="{{item.resaltar}}"class="xVerde xBold">{{item.faltan}} dias</span><td>{{item.total}}<td><span class="xDeleteRow2"title="Anular"onclick="xDialogBorrarObj(this)"></span></template><tr><td><td colspan="4"><p class="xfont15 xBold">Total<td><p class="xfont15 xBold">{{sumListCuentasPagar}}<td></table><br><br></div><div id="div_cuentas_cobrar"><x-cuentas-por-cobrar></x-cuentas-por-cobrar><br></div><div id="div_historial_cuentas_pagadas"><button class="xDerecha xBoton2 xPlomo"onclick="xThisCpc.selected=0">Regresar</button><h3>Historial de cuentas pagadas</h3><br><br><input class="xMiInput xfont15"style="width:100%"placeholder="Buscar"autofocus onkeyup="xfiltrarDatos_re(0)"id="txt_buscar_re"enlinea><br><table width="100%"><thead><th>#<th>Proveedor<th>Pagar el<th>Ultimo Pago<th align="right">Pasaron<th align="right">Importe<tbody><template is="dom-repeat"items="{{ListHistorialCuentasPagar}}"as="item"><tr data-t="compra"data-id="{{item.idcompra}}"class="animated fadeIn fast xCursor"id="{{index}}"onclick="_selItemCP(this)"><td data-id="{{index}}"><span>{{displayIndex(index)}}</span><td>{{item.des_proveedor}}<td>{{item.f_pago}}<td>{{item.f_ultimo_pago}}<td align="right"><span hidden="{{!item.resaltar}}"class="xRojo xBold">{{item.faltan}} dias</span> <span hidden="{{item.resaltar}}"class="xColorRow_verde xBold">{{item.faltan}} dias</span><td align="right">{{item.total_total}}</template></table><br><div><pagination-input id="paginator"current-page="1"page-count="10"current-page-changed="onChangePagination($event)"></pagination-input></div><br></div></iron-pages></div></div></template><style>.div_container_cuentas{display:flex;justify-content:center;flex-wrap:wrap}.div_cuentas{text-align:center;border:1px solid #ccc;border-radius:5px;padding:15px;margin:10px;cursor:pointer}.div_cuentas:hover{background:#e3f2fd}</style></dom-module><script>var xThisCpc,sel_idTipoIngreso,xObjBorrar,xdebounce,data_pagination={},p_rows=0,xe_debounce=!1;function xIniCpc(){$("body").addClass("loaded");var a=xm_log_get("app3_us");xThisCpc.xt_org=a.ido,xThisCpc.xt_idsede=a.idsede,xThisCpc.xt_idus=a.idus,xThisCpc.habiltarBtnPago=!1,getAllListCuentasPagar(),$(".xPasarEnter2").on("keyup",function(a){a=a.which;if(13==a||186==a){var a=$("input"),e=a.index(document.activeElement);if(null!==a[e+1]){var o=a[e+1];if(void 0===o)return;if(null==(o=o.disabled?a[e+2]:o))return;o.focus(),o.select()}return!1}}),xThisCpc.$.paginator.addEventListener("page-limit-change",a=>{data_pagination=a.detail.value,p_desde=data_pagination.pageDesde,xloadHistorialCuentasPagar()}),$(document.body).on("click","#table_cobrar tr",function(a){getIndexRow(this,a)}),$(document.body).on("click","#table_cobrar .check_item",function(a){getIndexRow(this,a)}),$("#tab_cpc").on("iron-select",function(){1===xThisCpc.selected&&(data_pagination={},p_rows=0,xloadCuentasCobrar())})}function getIndexRow(a,e){var o=a.nodeName,a=("TR"!==o?$(a):$(a).find("paper-checkbox"))[0],o="TR"!==o?a.checked:!a.checked,t=a.id;a.checked=o,xThisCpc.ListCuentasCobrar[t].pagado=o,xChecCheksMarcados(),e.stopPropagation(),e.stopImmediatePropagation()}function xChecCheksMarcados(){var a=xThisCpc.ListCuentasCobrar.filter(a=>!0===a.pagado).length;xThisCpc.habilitarBtnPagado=0<a}function comprobarValPagar(a){xThisCpc.habiltarBtnPago=!!(0<a.value.length&&xThisCpc.selItemCP)}function getAllListCuentasPagar(){xPopupLoad.xopen(),$.ajax({type:"GET",url:"../../bdphp/log_005.php?op=3"}).done(a=>{var a=JSON.parse(a),e=0;xThisCpc.ListCuentasPagar=a.datos.map(a=>(e+=parseFloat(a.importe),a.resaltar=a.faltan<0,a)),xThisCpc.sumListCuentasPagar=numeroConComas(e.toFixed(2)),xThisCpc.sumListHistorialCuentasPagar=numeroConComas(0..toFixed(2)),xPopupLoad.xclose()})}function newIO(){xPopupLoad.xopen(),$("#form_new_io #idsede").val(xThisCpc.xt_idsede),$("#form_new_io #idorg").val(xThisCpc.xt_org),$("#form_new_io #idtipo_ingreso").val(sel_idTipoIngreso),$("#form_new_io #fecha_ingreso").val(xDevolverFechaFormatInputDate(date_fecha_ingreso.value)),$("#form_new_io #fecha_registro").val(xDevolverFecha()),xvalidateForm("form_new_io",function(a){!1!==a&&$.post("../../bdphp/ManejoBD_IUD.php?tb=contable_ingreso_otro",$("#form_new_io").serialize(),function(a){xPopupLoad.xclose(),$("#form_new_io").reset(),xPopupLoad.xclose(),date_fecha_ingreso.value=dateNow.toISOString().split("T")[0],getAllListCuentasPagar(),dialog_new_ingreso.close()})})}function _changeDateFiltro(a){a=a.value.split("-");_mm=a[1],_yy=a[0],getAllListCuentasPagar()}function xDialogBorrarObj(a,e){xObjBorrar=a,dialog_borrar.open()}function xDlgBorrar(){xBorrarItem(xObjBorrar),dialog_borrar.close()}function _getTipoIngreso(a){sel_idTipoIngreso=a.idtipo_ingreso}function _selItemCP(a){var e=a.id,e=xThisCpc.ListCuentasPagar[e],a=a.dataId;xThisCpc.selItemCP=e,importe_pagar.select(),importe_pagar.focus(),importe_pagar.value="",xThisCpc.habiltarBtnPago=!1,dialog_detalle_cp.open(),loadDetalleCP(a)}function loadDetalleCP(a){$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=301",data:{i:a}}).done(a=>{var a=JSON.parse(a),e=(xThisCpc.ListDetallesCP=a.datos,0);a.datos.map(a=>{e+=parseFloat(a.importe.replace(",",""))}),xThisCpc.sumTotalDetalleCP=numeroConComas(e.toFixed(2))})}function confimarPago(){xThisCpc.selItemCP.importe_pagar=importe_pagar.value;var a=xThisCpc.selItemCP;$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=302",data:{item:a}}).done(a=>{getAllListCuentasPagar(),importe_pagar.value=""})}function xVerHistorialCuentasPagadas(){xThisCpc.selected=2,xloadHistorialCuentasPagar()}function xloadHistorialCuentasPagar(){}function xfiltrarDatos_re(a){xe_debounce||(xe_debounce=!0,clearTimeout(xdebounce),xdebounce=setTimeout(()=>{xe_debounce=!1,(0===a?(xThisCpc.$.paginator.currentPage=1,xloadHistorialCuentasPagar):(xThisCpc.$.paginator_cobrar.currentPage=1,xloadCuentasCobrar))()},900))}function xloadCuentasCobrar(){}function xRegistrarComoPagado(){var e=[];xThisCpc.ListCuentasCobrar.filter(a=>!0===a.pagado).map(a=>{e.push(a.idregistro_pago_detalle)}),$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=305",data:{ids:e.join(",")}}).done(function(a){xloadCuentasCobrar()})}function showPanelOptionListCuentasCobrarPagar(a){xThisCpc.showBtnPrincipales=!1,xThisCpc.selected=a}function xGoBackListaCuentasCobrarPrincipal(){xThisCpc.showBtnPrincipales=!0}Polymer({is:"x-cuentas-por-cobrar-pagar",properties:{xt_org:Number,xt_idsede:Number,sumListCuentasPagar:String,sumListHistorialCuentasPagar:String,ListCuentasPagar:[],ListDetallesCP:[],ListHistorialCuentasPagar:[],selItemCP:[],sumTotalDetalleCP:String,ListCuentasCobrar:[],sumListCuentasCobrar:String,habilitarBtnPagado:!1,habiltarBtnPago:!1,showBtnPrincipales:Boolean},attached:function(){this.showBtnPrincipales=!0,this.selected=0,this.habilitarBtnPagado=!1,xThisCpc=this,xIniCpc()},displayIndex:function(a){return xCeroIzq(a+1,1)}})</script>