<dom-module id="x-indicadores-top-colaborador"><template is="dom"><h3 class="text-secondary">Top Colaboradores {{ ragoTitulo }}</h3><br><div><div class="xContentCard border-bottom p-0"><div class="div-content-grid"><div><p class="fs-18 text-secondary fw-600">Cajeros</p><br><table width="100%"><thead><th>#<th>Colaborador<th>Transacciones<th align="right">Importe<tbody><template is="dom-repeat"items="{{listDataTopCaja}}"as="item"><tr><td>{{displayIndex(index)}}<td>{{ item.key }}<td>{{ item.value.count_show }} <span data-id="[[ item.value.idprint_cierre ]]"class="pl-2 text-success xCursor fw-600"onclick="reImprimirCierre(this)">{{ item.value.cierre_caja }}</span><td align="right">{{ item.value.importe_show }}</template></table></div><div><p class="fs-18 text-secondary fw-600">Mozos <span class="fs-13 fw-100 text-info">Seleccione para filtrar.</span></p><br><table width="100%"class="table-mozo"><thead><th>#<th>Colaborador<th>Pedidos<th align="right">Importe<tbody><template is="dom-repeat"items="{{listDataTopMozosOedido}}"as="item"><tr onclick="changeMozo(this)"data-index="[[ index ]]"class="xCursor"><td>{{displayIndex(index)}}<td>{{ item.key }}<td>{{ item.value.count_show }}<td align="right">{{ item.value.importe_show }}</template></table></div></div><br><br></div><br><h3 class="text-secondary">Productos vendidos por: <span class="color-text-principal">[[ nomColaborador ]]</span></h3><br><br><div class="xContentCard border-bottom p-0"><div class="div-content-grid"><div><p class="fs-18 text-secondary fw-600">Secciones</p><br><table width="100%"><thead><th>#<th>Seccion<th>Cant<th align="right">Importe<tbody><template is="dom-repeat"items="{{listDataTopMozoSecciones}}"as="seccion"><tr><td>{{displayIndex(index)}}<td>{{ seccion.key }}<td>{{ seccion.value.count_show }}<td align="right">{{ seccion.value.importe_show }}</template></table></div><div><p class="fs-18 text-secondary fw-600">Productos Carta</p><br><table width="100%"><thead><th>#<th>Producto<th>Cant<th align="right">Importe<tbody><template is="dom-repeat"items="{{listDataTopMozoProductos}}"as="item"><tr><td>{{displayIndex(index)}}<td>{{ item.key }}<td>{{ item.value.count_show }}<td align="right">{{ item.value.importe_show }}</template></table></div></div></div><br><br><div class="xContentCard border-bottom p-0"><div class="div-content-grid"><div><p class="fs-18 text-secondary fw-600">Productos de Bodega</p><br><table width="100%"><thead><th>#<th>Seccion<th>Cant<th align="right">Importe<tbody><template is="dom-repeat"items="{{listDataTopMoozoBodega}}"as="seccion"><tr><td>{{displayIndex(index)}}<td>{{ seccion.key }}<td>{{ seccion.value.count_show }}<td align="right">{{ seccion.value.importe_show }}</template></table></div><div></div></div></div></div></template></dom-module><script>var xThisI2TopColaborador,crosTopProductosMozos,dataTopPedidosByMozo=[];function loadDataTopColaborador(){xPopupLoad.xopen(),$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=4006",data:xThisI2TopProductos.rango}).done(function(o){o=JSON.parse(o).datos;topCajeros(crossfilter(o)),loadDataMozosPedidos()})}function topCajeros(o){topCajerosCierre(o.dimension(o=>o.usuario).group().reduce((o,e)=>(++o.count,o.importe+=parseFloat(e.total),o.count_show=xCeroIzq(o.count,2),o.importe_show=numeroConComas(o.importe.toFixed(2)),o.idusuario=e.idusuario,o),(o,e)=>(--o.count,o.importe-=parseFloat(e.total),o.count_show=xCeroIzq(o.count,2),o.importe_show=numeroConComas(o.importe.toFixed(2)),o.idusuario=e.idusuario,o),()=>({count:0,importe:0,count_show:"",importe_show:"",idusuario:0})).order(o=>o.importe).top(Number.POSITIVE_INFINITY))}function topCajerosCierre(e){$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=40061",data:xThisI2TopProductos.rango}).done(function(o){var r=[],r=""===o?[]:JSON.parse(o).datos;e.map(e=>{var o=r.filter(o=>o.idusuario===e.value.idusuario)[0];o?(e.value.cierre_caja="Reimprimir Cierre",e.value.idprint_cierre=o.idprint_server_detalle):(e.value.cierre_caja="",e.value.idprint_cierre=0)}),xThisI2TopColaborador.listDataTopCaja=JSON.parse(JSON.stringify(e))})}function loadDataMozosPedidos(){$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=4004",data:xThisI2TopProductos.rango}).done(function(o){o=JSON.parse(o).datos;dataTopPedidosByMozo=o,topMozos(crossfilter(o)),xPopupLoad.xclose()})}function topMozos(o){o=o.dimension(o=>o.usuario).group().reduce((o,e)=>(++o.count,o.importe+=parseFloat(e.total),o.count_show=xCeroIzq(o.count,2),o.importe_show=numeroConComas(o.importe.toFixed(2)),o.nom_mozo=e.nombres,o),(o,e)=>(--o.count,o.importe-=parseFloat(e.total),o.count_show=xCeroIzq(o.count,2),o.importe_show=numeroConComas(o.importe.toFixed(2)),o.nom_mozo=e.nombres,o),()=>({count:0,importe:0,count_show:"",importe_show:"",nom_mozo:""}));xThisI2TopColaborador.listDataTopMozosOedido=o.order(o=>o.importe).top(Number.POSITIVE_INFINITY),changeMozo(0),setTimeout(()=>{$(".table-mozo tbody tr").each((o,e)=>{0===o&&$(e).addClass("selected").siblings().removeClass("selected")})},500)}function changeMozo(o){var e="object"==typeof o?o.dataIndex:o;const r=xThisI2TopColaborador.listDataTopMozosOedido[e];e=dataTopPedidosByMozo.filter(o=>o.usuario===r.key);crosTopProductosMozos=crossfilter(e),r&&(xThisI2TopColaborador.nomColaborador=primeraConMayusculas(r.value.nom_mozo.toLowerCase())),topMozoSecciones(),topMozoProductos(),topMozoProductosBodega(),$(o).addClass("selected").siblings().removeClass("selected")}function topMozoSecciones(){var o=crosTopProductosMozos.dimension(o=>o.des_seccion).group().reduce((o,e)=>(o.count+=parseFloat(e.cantidad),o.importe+=parseFloat(e.total),o.descripcion=e.des_seccion,o.count_show=xCeroIzq(o.count,2),o.importe_show=numeroConComas(o.importe.toFixed(2)),o),(o,e)=>(o.count-=parseFloat(e.cantidad),o.importe-=parseFloat(e.total),o.descripcion=e.des_seccion,o),()=>({count:0,descripcion:"",importe:0,count_show:"",importe_show:""}));xThisI2TopColaborador.listDataTopMozoSecciones=o.order(o=>o.importe).top(Number.POSITIVE_INFINITY)}function topMozoProductos(){var o=crosTopProductosMozos.dimension(o=>o.des_item).group().reduce((o,e)=>(o.count+=parseFloat(e.cantidad),o.importe+=parseFloat(e.total),o.procede=e.procede,o.descripcion=e.des_seccion,o.count_show=xCeroIzq(o.count,2),o.importe_show=numeroConComas(o.importe.toFixed(2)),o),(o,e)=>(o.count-=parseFloat(e.cantidad),o.importe-=parseFloat(e.total),o.procede=e.procede,o.descripcion=e.des_seccion,o),()=>({count:0,descripcion:"",importe:0,count_show:"",importe_show:"",procede:0}));xThisI2TopColaborador.listDataTopMozoProductos=o.order(o=>o.importe).top(Number.POSITIVE_INFINITY),xThisI2TopColaborador.listDataTopMozoProductos=xThisI2TopColaborador.listDataTopMozoProductos.filter(o=>"0"===o.value.procede).map(o=>o)}function topMozoProductosBodega(){var o=crosTopProductosMozos.dimension(o=>o.des_item).group().reduce((o,e)=>(o.count+=parseFloat(e.cantidad),o.importe+=parseFloat(e.total),o.procede=e.procede,o.descripcion=e.des_seccion,o.count_show=xCeroIzq(o.count,2),o.importe_show=numeroConComas(o.importe.toFixed(2)),o),(o,e)=>(o.count-=parseFloat(e.cantidad),o.importe-=parseFloat(e.total),o.procede=e.procede,o.descripcion=e.des_seccion,o),()=>({count:0,descripcion:"",importe:0,count_show:"",importe_show:"",procede:0}));xThisI2TopColaborador.listDataTopMoozoBodega=o.order(o=>o.importe).top(Number.POSITIVE_INFINITY),xThisI2TopColaborador.listDataTopMoozoBodega=xThisI2TopColaborador.listDataTopMoozoBodega.filter(o=>"1"===o.value.procede).map(o=>o)}function reImprimirCierre(o){o=o.dataId;xPopupLoad.xopen(),setTimeout(()=>{xPopupLoad.xclose()},600),$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=16061",data:{ids:o}}).done(function(o){JSON.parse(o).datos.map(o=>{o={descripcion_doc:"cuadre-caja",detalle_json:o.detalle_json,hora:o.hora,idprint_server_detalle:o.idprint_server_detalle,idprint_server_estructura:4,nom_documento:"cuadre-caja",tipo:"cuadre-caja"};_cpSocketEmitPrinterOnly(o)})})}Polymer({is:"x-indicadores-top-colaborador",properties:{ragoSubTitulo:String,ragoTitulo:String,rango:{type:[],notify:!0,reflectToAttribute:!0,observer:"changeRango"},listDataTopCaja:Object,listDataTopMozosOedido:[],listDataTopMoozoBodega:[],listDataTopMozoSecciones:[],listDataTopMozoProductos:[],nomColaborador:String},attached:function(){xThisI2TopColaborador=this},changeRango:o=>{},showData:()=>{loadDataTopColaborador()},detached:function(){},displayIndex:function(o){return xCeroIzq(o+1,1)}})</script>