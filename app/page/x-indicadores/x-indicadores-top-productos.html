<dom-module id="x-indicadores-top-productos"><template is="dom"><h3 class="text-secondary">Top de Productos {{ ragoTitulo }}</h3><br><div><div class="xContentCard border-bottom p-0"><div class="div-content-grid"><div><p class="fs-18 text-secondary fw-600">Secciones</p><br><table width="100%"><thead><th>#<th>Seccion<th>Cant<th align="right">Importe<tbody><template is="dom-repeat"items="{{listDataTopSeccion}}"as="seccion"><tr><td>{{displayIndex(index)}}<td>{{ seccion.key }}<td>{{ seccion.value.count_show }}<td align="right">{{ seccion.value.importe_show }}</template></table></div><div><p class="fs-18 text-secondary fw-600">Productos Carta</p><br><table width="100%"><thead><th>#<th>Producto<th>Cant<th align="right">Importe<tbody><template is="dom-repeat"items="{{listDataTopProductos}}"as="item"><tr><td>{{displayIndex(index)}}<td>{{ item.key }}<td>{{ item.value.count_show }}<td align="right">{{ item.value.importe_show }}</template></table></div></div></div><div class="xContentCard border-bottom p-0"><br><br><div class="div-content-grid"><div><p class="fs-18 text-secondary fw-600">Productos Bodega</p><br><table width="100%"><thead><th>#<th>Producto<th>Cant<th align="right">Importe<tbody><template is="dom-repeat"items="{{listDataTopBodega}}"as="item"><tr><td>{{displayIndex(index)}}<td>{{ item.key }}<td>{{ item.value.count_show }}<td align="right">{{ item.value.importe_show }}</template></table></div><div><p class="fs-18 text-secondary fw-600">Porciones</p><br><table width="100%"><thead><th>#<th>Producto<th>Cant<th align="right">Importe<tbody><template is="dom-repeat"items="{{listDataTopPorciones}}"as="item"><tr><td>{{displayIndex(index)}}<td>{{ item.key }}<td>{{ item.value.count_show }}<td align="right">{{ item.value.importe_show }}</template></table></div></div></div></div></template></dom-module><script>var xThisI2TopProductos,dataIETopProductos,crosTopProductos;function loadDataTopProductos(){xPopupLoad.xopen(),$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=4004",data:xThisI2TopProductos.rango}).done(function(o){dataIETopProductos=JSON.parse(o).datos,crosTopProductos=crossfilter(dataIETopProductos),topSecciones(),topProductos(),topProductosBodega(),loadDataTopPorciones()})}function loadDataTopPorciones(){$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=4005",data:xThisI2TopProductos.rango}).done(function(o){o=JSON.parse(o).datos;topPorciones(crossfilter(o)),xPopupLoad.xclose()})}function topSecciones(){var o=crosTopProductos.dimension(o=>o.des_seccion).group().reduce((o,t)=>(o.count+=parseFloat(t.cantidad),o.importe+=parseFloat(t.total),o.descripcion=t.des_seccion,o.count_show=xCeroIzq(o.count,2),o.importe_show=numeroConComas(o.importe.toFixed(2)),o),(o,t)=>(o.count-=parseFloat(t.cantidad),o.importe-=parseFloat(t.total),o.descripcion=t.des_seccion,o),()=>({count:0,descripcion:"",importe:0,count_show:"",importe_show:""}));xThisI2TopProductos.listDataTopSeccion=o.order(o=>o.importe).top(Number.POSITIVE_INFINITY)}function topProductos(){var o=crosTopProductos.dimension(o=>o.des_item).group().reduce((o,t)=>(o.count+=parseFloat(t.cantidad),o.importe+=parseFloat(t.total),o.procede=t.procede,o.descripcion=t.des_seccion,o.count_show=xCeroIzq(o.count,2),o.importe_show=numeroConComas(o.importe.toFixed(2)),o),(o,t)=>(o.count-=parseFloat(t.cantidad),o.importe-=parseFloat(t.total),o.procede=t.procede,o.descripcion=t.des_seccion,o),()=>({count:0,descripcion:"",importe:0,count_show:"",importe_show:"",procede:0}));xThisI2TopProductos.listDataTopProductos=o.order(o=>o.importe).top(Number.POSITIVE_INFINITY),xThisI2TopProductos.listDataTopProductos=xThisI2TopProductos.listDataTopProductos.filter(o=>"0"===o.value.procede).map(o=>o)}function topProductosBodega(){var o=crosTopProductos.dimension(o=>o.des_item).group().reduce((o,t)=>(o.count+=parseFloat(t.cantidad),o.importe+=parseFloat(t.total),o.procede=t.procede,o.descripcion=t.des_seccion,o.count_show=xCeroIzq(o.count,2),o.importe_show=numeroConComas(o.importe.toFixed(2)),o),(o,t)=>(o.count-=parseFloat(t.cantidad),o.importe-=parseFloat(t.total),o.procede=t.procede,o.descripcion=t.des_seccion,o),()=>({count:0,descripcion:"",importe:0,count_show:"",importe_show:"",procede:0}));xThisI2TopProductos.listDataTopBodega=o.order(o=>o.importe).top(Number.POSITIVE_INFINITY),xThisI2TopProductos.listDataTopBodega=xThisI2TopProductos.listDataTopBodega.filter(o=>"1"===o.value.procede).map(o=>o)}function topPorciones(o){o=o.dimension(o=>o.des_item).group().reduce((o,t)=>(o.count+=parseFloat(t.cantidad),o.importe+=parseFloat(t.total),o.procede=t.procede,o.descripcion=t.des_seccion,o.count_show=xCeroIzq(o.count,2),o.importe_show=numeroConComas(o.importe.toFixed(2)),o),(o,t)=>(o.count-=parseFloat(t.cantidad),o.importe-=parseFloat(t.total),o.procede=t.procede,o.descripcion=t.des_seccion,o),()=>({count:0,descripcion:"",importe:0,count_show:"",importe_show:"",procede:0}));xThisI2TopProductos.listDataTopPorciones=o.order(o=>o.importe).top(Number.POSITIVE_INFINITY)}Polymer({is:"x-indicadores-top-productos",properties:{ragoSubTitulo:String,ragoTitulo:String,rango:{type:[],notify:!0,reflectToAttribute:!0,observer:"changeRango"},listDataTopSeccion:Object,listDataTopProductos:Object,listDataTopBodega:Object,listDataTopPorciones:Object},attached:function(){xThisI2TopProductos=this},changeRango:o=>{},showData:()=>{loadDataTopProductos()},detached:function(){},displayIndex:function(o){return xCeroIzq(o+1,1)}})</script>