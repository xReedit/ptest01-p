<dom-module id="x-indicadores-versus"><template is="dom"><div class="p-4"><h3 class="text-secondary">Ventas todos los locales {{ ragoTitulo }}</h3><br><br><div class="xContentCard border-bottom p-0"><canvas id="chartVentaAll"></canvas><br><br></div></div><br><br></template></dom-module><script>var xThisI2Versus,crosVentaVersus,ctxCharVentasAll,myBarChartPrincipalAll,configParamsChart;function loadDatoVentasVersus(){xPopupLoad.xopen(),ctxCharVentasAll=document.getElementById("chartVentaAll").getContext("2d"),$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=4008",data:dataFiltro}).done(function(a){var e=JSON.parse(a).datos;switch(xPopupLoad.xclose(),dataFiltro.rango){case"fecha":graficoVentasHoraHoyAll(e);break;case"semana":graficoVentasSemanaAll(e);break;case"mes":graficoVentasMesAll(e)}})}function graficoVentasMesAll(a){var o,a=crossfilter(a),e=a.dimension(a=>a.nomsede),a=a.dimension(a=>a.num_mes+"-"+a.nomsede),n=[],s=(s=a.group().reduce((a,e)=>{a.num_mes=e.num_mes,a.nom_mes=e.nom_mes,a.importe+=parseFloat(e.importe),a.nomsede=e.nomsede,a.idsede=e.idsede;const r=e.num_mes;return n.filter(a=>a?.m===r)[0]||n.push({m:r,msort:r+e.num_yy,mshow:e.nom_mes}),a},(a,e)=>(a.num_mes=e.num_mes,a.nom_mes=e.nom_mes,a.importe-=parseFloat(e.importe),a.nomsede=e.nomsede,a.idsede=e.idsede,a),()=>({num_mes:0,nom_mes:"",importe:0,nomsede:"",idsede:0}))).all(),n=n.sort((a,e)=>a.m-e.m),t=[];e.group().all().map(r=>{var a=s.filter(a=>a.value.nomsede===r.key);n.map(e=>{o=(o=a.filter(a=>a.value.nom_mes===e.mshow)[0])?o.value:{importe:0,nomsede:r.key,num_mes:e},t.push(o)})}),configParamsChart={type:"line",data:{labels:n.map(a=>primeraConMayusculas(xDesMes(parseInt(a.m)-1).toLowerCase())),datasets:e.group().all().map((e,a)=>({label:e.key,data:t.filter(a=>a.nomsede===e.key).map(a=>a.importe),borderColor:[getColorChar(a)],backgroundColor:getColorGradianChar(a),borderWidth:2,pointRadius:5}))},options:{legend:{display:!0,position:"top"},scales:{xAxes:[{gridLines:{display:!0,drawBorder:!0,drawOnChartArea:!1}}],yAxes:[{gridLines:{display:!0,drawBorder:!0,drawOnChartArea:!1}}]}}},myBarChartPrincipalAll=null,myBarChartPrincipalAll=new Chart(ctxCharVentasAll,configParamsChart)}function graficoVentasSemanaAll(a){var o,a=crossfilter(a),e=a.dimension(a=>a.nomsede),a=a.dimension(a=>a.num_semana+"."+a.num_dia),n=(n=a.group().reduce((a,e)=>(a.semana_actual=e.hoy,a.num_dia=e.num_dia,a.nom_dia=e.nom_dia,a.num_semana=e.num_semana,a.importe+=parseFloat(e.importe),a.nomsede=e.nomsede,a.idsede=e.idsede,a),(a,e)=>(a.semana_actual=e.hoy,a.num_dia=e.num_dia,a.nom_dia=e.nom_dia,a.num_semana=e.num_semana,a.importe+=parseFloat(e.importe),a),()=>({nom_dia:"",num_dia:0,num_semana:0,semana_actual:0,importe:0,nomsede:"",idsede:0}))).all(),s=(dias=["Lunes","Martes","Miercoles","Jueves","Viernes","Sabado","Domingo"],numdias=[2,3,4,5,6,7,1],[]);e.group().all().map(r=>{var a=n.filter(a=>a.value.nomsede===r.key);numdias.map(e=>{o=(o=a.filter(a=>a.value.num_dia.toString()===e.toString())[0])?o.value:{importe:0,nomsede:r.key,num_dia:e},s.push(o)})}),configParamsChart={type:"line",data:{labels:dias,datasets:e.group().all().map((e,a)=>({label:e.key,data:s.filter(a=>a.nomsede===e.key).map(a=>a.importe),borderColor:[getColorChar(a)],backgroundColor:getColorGradianChar(a),borderWidth:2,pointRadius:5}))},options:{legend:{display:!0,position:"top"},scales:{xAxes:[{gridLines:{display:!0,drawBorder:!0,drawOnChartArea:!1}}],yAxes:[{gridLines:{display:!0,drawBorder:!0,drawOnChartArea:!1}}]}}},myBarChartPrincipalAll=null,myBarChartPrincipalAll=new Chart(ctxCharVentasAll,configParamsChart)}function graficoVentasHoraHoyAll(a){var a=crossfilter(a),e=a.dimension(a=>a.nomsede),a=a.dimension(a=>a.nomsede+"-"+a.hora),n=[],s=(s=a.group().reduce((a,e)=>{++a.count,a.importe+=parseFloat(e.importe),a.nomsede=e.nomsede,a.idsede=e.idsede;const r=e.hora.split(" ")[0];return a.hora=r,n.filter(a=>a?.h===r)[0]||n.push({h:r,hshow:e.hora}),a},(a,e)=>(--a.count,a.importe-=parseFloat(e.importe),a.nomsede=e.nomsede,a.idsede=e.idsede,a.hora=e.hora,a),()=>({count:0,importe:0,nomsede:"",hora:"",idsede:0}))).all(),n=n.sort((a,e)=>a.h-e.h);listChartHora=[],e.group().all().map(r=>{var o=s.filter(a=>a.value.nomsede===r.key);n.map(e=>{var a=(a=o.filter(a=>a.value.hora===e.h)[0])?a.value:{importe:0,nomsede:r.key,hora:e};listChartHora.push(a)})}),configParamsChart={type:"line",data:{labels:n.map(a=>a.hshow),datasets:e.group().all().map((e,a)=>({label:e.key,data:listChartHora.filter(a=>a.nomsede===e.key).map(a=>a.importe),borderColor:[getColorChar(a)],backgroundColor:getColorGradianChar(a),borderWidth:2,pointRadius:5}))},options:{legend:{display:!0,position:"top"},scales:{xAxes:[{gridLines:{display:!0,drawBorder:!0,drawOnChartArea:!1}}],yAxes:[{gridLines:{display:!0,drawBorder:!0,drawOnChartArea:!1}}]}}},myBarChartPrincipalAll=null,myBarChartPrincipalAll=new Chart(ctxCharVentasAll,configParamsChart)}function getColorChar(a){return["rgba(33,150,243,1)","rgba(156,39,176,1)","rgba(105,240,174,1)","rgba(255,214,0,1)","rgba(161,136,127,1)"][a]}function getColorGradianChar(a){var e=["rgba(33,150,243,1)","rgba(156,39,176,1)","rgba(105,240,174,1)","rgba(255,214,0,1)","rgba(161,136,127,1)"][a],a=["rgba(33,150,243,0)","rgba(156,39,176,0)","rgba(105,240,174,0)","rgba(255,214,0,0)","rgba(161,136,127,0)"][a],r=ctxCharVentasAll.createLinearGradient(0,0,0,500);return r.addColorStop(0,e),r.addColorStop(1,a),r}function updateChartPrincipalAll(){myBarChartPrincipalAll.config=configParamsChart,myBarChartPrincipalAll.legend.options.display=configParamsChart.options.legend.display,myBarChartPrincipalAll.legend.options.position=configParamsChart.options.legend.position,myBarChartPrincipalAll.update()}Polymer({is:"x-indicadores-versus",properties:{ragoSubTitulo:String,ragoTitulo:String,rango:{type:[],notify:!0,reflectToAttribute:!0,observer:"changeRango"}},attached:function(){xThisI2Versus=this},changeRango:a=>{console.log("change rango",a)},showData:()=>{loadDatoVentasVersus()},detached:function(){},displayIndex:function(a){return xCeroIzq(a+1,1)}})</script>