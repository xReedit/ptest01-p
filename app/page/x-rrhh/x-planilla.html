<link rel="import"href="../../x-componentes/x-comp-find-colaborador/x-comp-find-colaborador.html"><link rel="import"href="../../x-componentes/x-comp-find-cargo/x-comp-find-cargo.html"><link rel="import"href="../../x-componentes/x-comp-find-planilla-tiempo-pago/x-comp-find-planilla-tiempo-pago.html"><dom-module id="x-planilla"><template is="dom"><paper-dialog class="dialog_redondo dialog_titulo"id="dialog_new_pla_co"style="width:345px"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"><h4>Colaborador.</h4><div><form id="form_new_co_pla"method="POST"><x-comp-find-colaborador id="selColaborador"espaciar></x-comp-find-colaborador><br><x-comp-find-cargo id="selCargo"espaciar></x-comp-find-cargo><br><x-comp-find-planilla-tiempo-pago id="selPeriodo"espaciar></x-comp-find-planilla-tiempo-pago><br><input class="xMiInput xPasarEnter2"onchange="conMayusculas(this)"id="area"name="area"value$="[[selPlaColaborador.area]]"placeholder="AREA"espaciar required><div class="xInvisible"><input id="idorg"name="idorg"value$="[[xt_org]]"> <input id="idsede"name="idsede"value$="[[xt_idsede]]"> <input id="idplanilla"name="idplanilla"value$="[[selPlaColaborador.idplanilla]]"> <input id="idcolaborador"name="idcolaborador"value$="[[selPlaColaborador.idcargo]]"> <input id="idcargo"name="idcargo"value$="[[selPlaColaborador.idcargo]]"> <input id="idplanilla_periodo"name="idplanilla_periodo"value$="[[selPlaColaborador.idcargo]]"> <input id="mes_activo"name="mes_activo"value$="[[selPlaColaborador.mes_activo]]"></div></form><br><br><button dialog-dismiss onclick="newPlaColaborador()"class="xBoton2 xVerde">Listo Guardar</button> <button dialog-dismiss class="xBoton2 xRojo">Cerrar</button></div></paper-dialog><div><button class="xBoton2 xAzul xDerecha"onclick="openNewColaborador()">Agregar Colaborador</button> <button class="xBoton2 xVerde xDerecha"onclick="location.reload()">Refrescar</button><div style="width:250px"><label for="f_filtro_mes"class="xColorRow_Plomo">Mes activo:</label> <input type="month"class="xMiInput xPasarEnter2 xfont18"id="f_filtro_mes"onchange="getLoadPlanilla()"></div><br><table width="100%"><thead><th>#<th align="left">Colaborador<th align="left">Cargo<th align="left">Pago<th align="right">Ingresos<th align="right">Descuentos<th align="right">Neto a pagar<th><th><tbody><template is="dom-repeat"items="{{ListPlanilla}}"as="item"><tr data-t="planilla"data-id="{{item.idplanilla}}"class$="[[item.debaja]]"id="{{index}}"onclick="_selRowPlanilla(this)"><td data-id="{{index}}"><span>{{displayIndex(index)}}</span><td><p class="xfont15">{{item.nombres}}</p><span>Profesion: <strong>{{item.profesion}}</strong></span><td><p class="xfont15">{{item.descargo}}</p><span>Area: <strong>{{item.area}}</strong></span><td>{{item.periodo_pago}}<td align="right"><p class="xfont13">{{item.ingresos}}<td align="right"><p class="xfont13">{{item.descuentos}}<td align="right"><p class="xfont13">{{item.neto_pagar}}<td><span class="xFileRow xCursor"title="File"onclick="_selColaboradorDetalle(this)"></span><td><span class="xDeleteRow2 xCursor"title="Anular"onclick="xDialogBorrarObj(this)"></span></template></table><br></div></template></dom-module><style>.dialog_titulo .paper-dialog-0>:first-child{margin-top:-7px}</style><script>var xThisPPlanilla,dateNow;function xIniPPlanilla(){var a=xm_log_get("app3_us"),a=(xThisPPlanilla.xt_org=a.ido,xThisPPlanilla.xt_idsede=a.idsede,xThisPPlanilla.xt_idus=a.idus,(dateNow=new Date).getFullYear()+"-"+xCeroIzq(dateNow.getMonth()+1,2));f_filtro_mes.max=a,f_filtro_mes.value=a,getLoadPlanilla(),$(".xPasarEnter2").on("keyup",function(a){a=a.which;if(13==a||186==a){var a=$("input"),l=a.index(document.activeElement);if(null!==a[l+1]){var o=a[l+1];if(void 0===o)return;if(null==(o=o.disabled?a[l+2]:o))return;o.focus(),o.select()}return!1}})}function getLoadPlanilla(){$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=502",data:{mes:xDevolverFechaFormatInputDate(f_filtro_mes.value)}}).done(a=>{a=JSON.parse(a);xThisPPlanilla.ListPlanilla=a.datos.map(a=>(a.neto_pagar=parseFloat(a.ingresos.replace(",",""))-parseFloat(a.descuentos.replace(",","")),a.neto_pagar=numeroConComas(parseFloat(a.neto_pagar).toFixed(2)),a.fecha_baja=null===a.fecha_baja?"":a.fecha_baja,a.debaja=""!=a.fecha_baja?"animated fadeIn fast xCursor xColorRow_Ambar":"animated fadeIn fast xCursor",a))})}function openNewColaborador(){selColaborador.$.compFindListColaborador.disabled=!1,dialog_new_pla_co.open()}function newPlaColaborador(){var a=$("#form_new_co_pla"),l=xDevolverFechaFormatInputDate(f_filtro_mes.value),a=(a.find("#idorg").val(xThisPPlanilla.xt_org),a.find("#idsede").val(xThisPPlanilla.xt_idsede),a.find("#idcolaborador").val(selColaborador.getColaborador().idcolaborador),a.find("#idcargo").val(selCargo.getCargo().idcargo),a.find("#idplanilla_periodo").val(selPeriodo.getPlatiempo().idplanilla_periodo),a.find("#mes_activo").val(l),objectifyForm($("#form_new_co_pla").serializeArray()));$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=504",data:{item:a}}).done(a=>{getLoadPlanilla()})}function _selRowPlanilla(a){dialog_borrar.opened||(a=a.id,xThisPPlanilla.selPlaColaborador=xThisPPlanilla.ListPlanilla[a],selColaborador.setValue(xThisPPlanilla.selPlaColaborador.idcolaborador),selColaborador.$.compFindListColaborador.disabled=!0,selCargo.setValue(xThisPPlanilla.selPlaColaborador.idcargo),selPeriodo.setValue(xThisPPlanilla.selPlaColaborador.idplanilla_periodo),dialog_new_pla_co.open())}function _selColaboradorDetalle(a){a=a.parentElement.parentElement.id,xThisPPlanilla.selPlaColaborador=xThisPPlanilla.ListPlanilla[a],a={id:xThisPPlanilla.selPlaColaborador.idplanilla,mes:xDevolverFechaFormatInputDate(f_filtro_mes.value)},a=btoa(JSON.stringify(a));router.go("/recursos_humanos_file?"+a)}Polymer({is:"x-planilla",properties:{xt_org:Number,xt_idsede:Number,ListPlanilla:[],selPlaColaborador:[]},attached:function(){xThisPPlanilla=this,xIniPPlanilla()},displayIndex:function(a){return xCeroIzq(a+1,1)}})</script>