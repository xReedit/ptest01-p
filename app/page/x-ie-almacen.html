<dom-module id="x-ie-almacen"><template><paper-dialog modal id="dialog_msj_confirma"style="min-width:300px"entry-animation="scale-up-animation"exit-animation="fade-out-animation"><div class="xContent"><h4 id="titulo_msj">Recuerde: Todos los movimientos por Entradas, Salidas se reflejan automaticamente en el Kardex del Producto. Confirmar?</h4><br><div class="xLinea2"></div><br><div class="xBoton2 xVerde"dialog-confirm onclick="xGuardarESAlmacen()"id="btn_dlg_confirm">Confirmar</div><div class="xBoton2 xPlomo"dialog-dismiss>Cancelar</div></div></paper-dialog><br><div class="xMiCard xradius"style="width:80%"><div class="xEncanezadoCard xFondoRowAmarillo4"><p><strong>Registre las Entradas y Salidas de productos del almacen. Recuerde: Todos los movimientos por Entradas, Salidas se reflejan automaticamente en el fichero Kardex del Producto.</strong><br>Las entradas que se registran en este modulo son todos los productos que NO tengan origen de COMPRA. Por ejemplo: devoluciones,bonificaciones de los proveedores, etc.<p>Las salidas pueden ser por: Deterioro, vencimiento del producto, consumo del personal y otros.</div><div class="xContentCard"><form id="frm_ie_almacen"method="post"><p>Tipo de movimiento:</p><select class="xTextRow2 xfont18 xCursor"id="selecie"style="width:200px"><option value="1">ENTRADA<option value="2">SALIDA</select><br><br><p id="titulo_al">Almacen</p><select class="xTextRow2 xfont18 xCursor"id="sel_alamcen"style="width:200px"></select><br><br><p id="titulo_al">Motivo</p><select class="xTextRow2 xfont18 xCursor"id="sel_motivo"style="width:200px"></select><br><br><p>Detalle el motivo del movimiento del producto</p><input class="xMiInput xPasarEnter2"onchange="conMayusculas(this)"placeholder="Motivo"autocomplete="on"id="motivo"name="motivo"required><br><br><br><h3>Productos / porcion:</h3><div class="xLinea2"></div><br><table width="100%"id="tb_is_almacen"class="xtable2"><thead><th class="xSinBorde">Descripcion<th class="xSinBorde"width="100px">Cantidad<th class="xSinBorde"width="10px"></thead><tr class="xSinBorde"data-id=""><td><input class="xMiInput xPasarEnter2"style="width:100%"placeholder="Descripcion"onchange="conMayusculas(this)"required id="des_item"><td><input type="number"class="xMiInput xPasarEnter2"style="width:100%"placeholder="Cantidad"onchange="conMayusculas(this)"required id="cant_item"><td><paper-fab icon="add"onclick="xAddItemIEAlmacen()"title="Agregar item"></paper-fab></table></form><br><br><div class="xBoton2 xVerde"onclick="dialog_msj_confirma.open()">Listo Guardar</div><br><br></div></div><br><br></template><script>var xThisIEalmacen,xIdProducto_sel;function xIniIEAlmacen(){xPopupLoad=document.getElementById("xLoad"),xm_LogChequea(function(){xm_log_get("ini_us"),$("body").addClass("loaded")}),$("#Titulo_page").text("Ingreso / Salida del almacen"),$("#selecie").on("change",function(){1==this.value?($("#titulo_al").text("Alamcen a donde ENTRA:"),xloadProductoItemIngreso()):$("#titulo_al").text("Alamcen de donde SALE:"),xLoadMtPor(this.value)}),$(".xPasarEnter2").on("keyup",function(e){var t=e.which;if(13==t||186==t){var t=$("input"),a=t.index(document.activeElement);if(null!==t[a+1]){var o=t[a+1];if(void 0===o)return;if(null==(o=o.disabled?t[a+2]:o))return;o.focus(),o.select()}return event.stopPropagation(),e.stopPropagation(),e.stopImmediatePropagation(),!1}}),$("#cant_item").on("keyup",function(e){e=e.which;13!=e&&186!=e||xAddItemIEAlmacen()}),xloadAlamcen()}function xloadAlamcen(){xPopupLoad.titulo="Cargando...",xPopupLoad.xopen(),$.ajax({type:"POST",url:"../../bdphp/log.php?op=1604"}).done(function(e){for(var t="",a=$.parseJSON(e).datos,o=0;o<a.length;o++)t=String(t+'<option value="'+a[o].idalmacen+'">'+a[o].descripcion+"</option>");$("#sel_alamcen").html(t).trigger("create"),xloadProductoItemIngreso()})}function xloadProductoItemIngreso(){$.ajax({type:"POST",url:"../../bdphp/log.php?op=1805"}).done(function(e){var e=$.parseJSON(e).datos,a=$("#des_item");a.autocomplete({autoFocus:!0,source:e,select:function(e,t){return a.val(t.item.label),a.attr("data-id",t.item.value),a.attr("data-procede",t.item.procede),xIdProducto_sel=t.item.value,!1},focus:function(e,t){return!1},change:function(e,t){return null===t.item&&(a.attr("data-value",""),a.attr("data-id",""),a.attr("data-procede",""),xIdProducto_sel=0),!1}}),xLoadMotivoES(),xPopupLoad.xclose()})}function xLoadMotivoES(){$.ajax({type:"POST",url:"../../bdphp/log.php?op=1606"}).done(function(e){e=$.parseJSON(e);xThisIEalmacen.dt_mot=e.datos,xLoadMtPor(1)})}function xLoadMtPor(e){for(var t="",a=0;a<xThisIEalmacen.dt_mot.length;a++)e==xThisIEalmacen.dt_mot[a].tipo&&(t=String(t+'<option value="'+xThisIEalmacen.dt_mot[a].idalmacen_motivo_es+'">'+xThisIEalmacen.dt_mot[a].motivo+"</option>"));$("#sel_motivo").html(t).trigger("create")}function xAddItemIEAlmacen(){var e,t,a,o,n=parseFloat($("#cant_item").val());(0==xIdProducto_sel?(alert("Seleccione un producto o porcion validos"),$("#des_item").select(),$("#des_item")):0==n||isNaN(n)?(alert("Coloque una cantidad valida"),$("#cant_item").select(),$("#cant_item")):(o=(n=$("#tb_is_almacen")).find(".row").length,o+=xIdProducto_sel,e=$("#selecie option:selected").text()+" > "+$("#sel_alamcen option:selected").text()+" | "+$("#des_item").val(),t=$("#des_item").attr("data-procede"),a=$("#des_item").attr("data-id"),o='<tr class="row" id="'+o+'" data-tipo="'+selecie.value+'" data-idalmacen="'+sel_alamcen.value+'" procede="'+t+'" xid="'+a+'"><td>'+e+'</td><td align="center" class="cant_row" id="cantidad">'+$("#cant_item").val()+'</td><td><span class="xDeleteRowNeutro" title="Borrar" onclick="xBorrarItem(this);"></span></td></tr>',(0==n.find(".row").length?n.append(o):$("#tb_is_almacen tr.row:first").before(o)).trigger("create"),$("#des_item").val(""),$("#des_item").attr("data-id",""),$("#cant_item").val(""),$("#des_item"))).focus()}function xGuardarESAlmacen(){var a=new Array;$("#tb_is_almacen .row").each(function(e,t){a.push({tipo:selecie.value,idalmacen:sel_alamcen.value,id:$(t).attr("xid"),procede:$(t).attr("procede"),cantidad:$(t).find("#cantidad").text(),idmotivo:sel_motivo.value,motivo:$("#motivo").val()})}),0<a.length&&(xPopupLoad.xopen(),$.ajax({type:"POST",url:"../../bdphp/log.php?op=1806",data:{xarray_save_ae:a}}).done(function(e){e=$.parseJSON(e);e.success?(dialog_msj_confirma.close(),xPopupLoad.xclose(),xNuevo()):alert(e.error)}))}function xNuevo(){$("#motivo").val(""),$("#des_item").val(""),$("#des_item").attr("data-id",""),$("#cant_item").val(""),$("#des_item").focus(),$("#tb_is_almacen .row").remove()}Polymer({is:"x-ie-almacen",properties:{xt_org:Number,xt_idsede:Number,xt_idus:Number,dt_mot:Object},attached:function(){this.selected=0,xThisIEalmacen=this,xIniIEAlmacen()}})</script></dom-module>