<link rel="import"href="../x-componentes/x-comp-find-categoria/x-comp-find-categoria.html"><link rel="import"href="../x-componentes/x-comp-descuento/x-comp-descuento.html"><link rel="import"href="./x-control-delivery/x-control-delivery.html"><dom-module id="x-control-mesas"><link rel="import"href="../x-componentes/x-input-search-pedido-in-page/x-input-search-pedido-in-page.html"><link rel="import"href="../x-componentes/x-comp-btn-permiso/x-comp-btn-permiso.html"><link rel="import"href="../x-componentes/x-comp-btn-permiso/x-comp-dialog-permiso.html"><link rel="import"href="../x-componentes/x-comp-area-mesa/x-comp-area-mesa.html"><script src="../view/httpFech.js"></script><script src="../view/config.const.js"></script><script src="../view/socket.service.p.js"></script><script src="../view/notifica.js"></script><template><div id="backdrop-dialog-detalle"class="backdrop-dialog-detalle"></div><x-comp-dialog-permiso></x-comp-dialog-permiso><x-pass id="pass_us"titulo="Usuario autorizado"valor="Pe1"></x-pass><paper-dialog id="dialog_erro_print"modal style="min-width:330px"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"><h4>Error en impresora</h4><p id="print_error"></p><br><div class="xBoton2 xVerde divLeft23"onclick="xReImprimir()">Intentar Nuevamente</div><div class="xBoton2 xPlomo divLeft23"dialog-dismiss onclick="xCPcloseDialogDetalle()">No imprimir</div><br><br><br></paper-dialog><paper-dialog class="dialog_redondo"style="max-width:350px;background:#212121;color:#fff"id="dialog_borrar_item"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="xContent"><h3>BORRAR REGISTRO?</h3><div class="content-check-borrar-item"><paper-checkbox class="xCursor"id="check_recuperar_stock"><p class="fw-600">Recuperar Stock</p></paper-checkbox></div><br><button class="btn btn-success mr-1"dialog-dismiss onclick="xGetPermisoEliminarItem()">Si Borrar.</button> <button class="btn btn-danger"dialog-dismiss>Cancelar</button><br><div class="mt-2"><x-comp-btn-permiso></x-comp-btn-permiso></div></div></paper-dialog><paper-dialog style="min-width:290px;width:80%"id="dialog_add_item"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="xContent"><br><div><input class="xMiInput"placeholder="buscar..."style="width:70%"inline id="txt_bus_item"> <input type="number"class="xMiInput"placeholder="cantidad"style="width:20%"value="1"pattern="[0-9]+([\.,][0-9]+)?"step="any"min="1"inline id="cant_item"></div><br><br><br><div class="xBoton2 xVerde"dialog-confirm onclick="xBorrar_item()">SI</div><div class="xBoton2 xRojo"dialog-dismiss>Cancelar</div><br><br></div></paper-dialog><paper-dialog id="dialog_cambiar_mesa"style="max-width:350px"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="xContent"><br><h4>CAMBIAR</h4><h4 id="titulo_cambiar_mesa"class="txt_anular_cambiar_mesa">Cambiar de mesa todos los pedidos</h4><div><h4>Mesa:</h4><input type="number"class="xMiInput xfont18"placeholder="Numero mesa"enlinea pattern="[0-9]+([\.,][0-9]+)?"step="any"min="1"inline id="txt_num_mesa_change"autofocus></div><br><br><br><div class="xBoton2 xVerde"dialog-confirm onclick="xCambiarMesa()">Cambiar</div><div class="xBoton2 xRojo"dialog-dismiss>Cancelar</div><br><br></div></paper-dialog><paper-dialog id="dialog_motivo_anular"class="dialog_redondo"style="min-width:320px;background:#212121;color:#fff"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="xContent"><h3>ANULAR</h3><h4 class="txt_anular_cambiar_mesa"></h4><br><h4>Indique el motivo de anulacion</h4><div><input class="xMiInput text-white"placeholder="Motivo..."id="txt_motivo_anular"autofocus></div><br><div class="content-check-borrar-item"><paper-checkbox class="xCursor"id="check_recuperar_stock_all_pedido"><p class="fw-600">Recuperar Stock</p></paper-checkbox></div><br><div><button class="btn btn-success mr-1"dialog-dismiss onclick="pass_us.open()">Listo</button> <button class="btn btn-danger"dialog-dismiss>Cancelar</button><br><div class="mt-2"><x-comp-btn-permiso></x-comp-btn-permiso></div></div></div></paper-dialog><paper-dialog id="dialog_cambiar_item"style="border:1px solid #bdbdbd"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><h3>CAMBIAR POR</h3><div><input class="xMiInput xfont18 xPasarEnter2"placeholder="Buscar"id="list_bus_item"inline autofocus espaciar> <input type="number"min="1"max="2"onkeyup="xValidarCant_change(this)"onchange="xValidarCant_change(this)"class="xMiInput xfont18 xPasarEnter2 xtxtCentro"placeholder="Cantidad"id="txt_bus_cant"value="1"inline espaciar> <input class="xMiInput xPasarEnter2"placeholder="Especificaciones..."id="txt_espcificacion"inline autofocus espaciar><form id="frm_change_item"method="post"class="xInvisible"><input id="idpedido_detalle"name="idpedido_detalle"> <input id="idpedido"name="idpedido"> <input id="idtipo_consumo"name="idtipo_consumo"> <input id="idcategoria"name="idcategoria"> <input id="idcarta_lista"name="idcarta_lista"> <input id="iditem"name="iditem"> <input id="idseccion"name="idseccion"> <input id="cantidad"name="cantidad"> <input id="punitario"name="punitario"> <input id="ptotal"name="ptotal"> <input id="descripcion"name="descripcion"></form><br><br><div class="xBoton2 xVerde"dialog-confirm onclick="xCambiar_item()">Listo</div><div class="xBoton2 xRojo"dialog-dismiss>Cancelar</div><br></div></paper-dialog><paper-dialog style="min-width:290px;max-width:450px"id="dialog_info_call_repartidor"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="xContent"><p id="msj_dialo_call"></p><br><div class="xBoton2 xVerde"dialog-dismiss onclick="xCallRepartidorPapayaExec()"id="btnConfirmaCallReparto">Si, Confirmo.</div><div class="xBoton2 xPlomo"dialog-dismiss>Cancelar</div><br><br></div></paper-dialog><paper-dialog modal id="dialog_detalle"class="theme1 xNoScroll"entry-animation="scale-up-animation"exit-animation="fade-out-animation"><div><iron-pages selected="0"id="content_page"class="xNoScroll"><div id="div_detalle_pedido"class="xNoScroll"><div class="lh-7"><div class="xDerecha d-flexx"><div style="width:50px"class="mr-2 text-center"id="showRepartoAsignado"><i class="fa fa-check text-success fa-2x"></i> <span class="fs-9 fw-600">Repartidor Asignado</span></div><div style="width:50px"class="mr-2 text-center"id="showLoadingReparto"><i class="fa fa-motorcycle fa-2x"></i> <span class="fs-9 fw-600">Buscando Repartidor</span><paper-progress indeterminate class="w-100"></paper-progress></div><paper-fab mini icon="perm-phone-msg"onclick="xCallRepartidorPapaya()"title="Llamar a Repartidor de Papaya Express"tabindex="0"class="btnAddPapaya"id="btnLlamarRepartidorP"></paper-fab><paper-fab icon="add"onclick="xOpenLULI()"title="[F8] Agregar item"tabindex="0"class="btnAdd2"></paper-fab></div><h3 id="p_mesa">MESA 02</h3><div class="xfont11 pb-3"><span id="p_correlativo">CO: 00112</span><span id="p_referencia"> DR VALDES</span><span id="p_antendido"> | ATENDIDO POR: ORLANDO</span></div><div class="xdiv-info-delivery xInvisible lh-15"id="content-info-delivery"><div id="divRepartidorPropio"class="pb-3"><div id="divRepartidorNom"class="xInvisible"><span class="xfont11">Repartidor: </span><span class="xBold"id="a_nom_repartidor"></span><hr></div><div id="divRepartidorSelect"class="xInvisible"><span class="xfont11">Repartidor: </span><select name=""id="selectRepartidor"onchange="selectRepartidor()"><option value="-1">No Asignado</option><template is="dom-repeat"items="{{listRepartidor}}"as="repartidor"><option value="[[index]]">[[repartidor.nombre]]</template></select><hr></div></div><div class="div-info-pedido"><div class="w-50"><span class="xColorRow_Plomo3 fs-13">Datos del Cliente</span><div id="info-pedido"class="fs-11"></div></div><div class="w-50"><p class="xColorRow_Plomo3 fs-13">Comprobante<div id="info-comprobante"class="fs-11"></div></div></div><div id="div-info-delivery-from-app"class="xInvisible"style="padding:5px 0 5px 0;border-top:1px solid #bbbb;background:#faebd7"><div class="xfont12"id="txt-info-delivery-from-app"></div></div></div></div><div class="xLinea"></div><br><div class="content-pedido"><table width="100%"class="xtable4"><tr class="xSinBorde_tr"valign="top"><td width="40%"class="pd-r-10"><div class="xtd-derecha"id="xBodyPedidos"><table width="100%"id="tb_pedidos"class="xRowPading4"><thead><th colspan="5"align="left">PEDIDOS</thead><tr class="row selected1 xCursor check_item_p"data-idpedido="1"><td><paper-checkbox checked="checked"class="check_item"></paper-checkbox>1<td>Pedido 00102<td>13:15:02<td align="right"class="td_importe"id="td_importe">120.00<tr class="row selected1 xCursor check_item_p"data-idpedido="2"><td><paper-checkbox checked="checked"class="check_item"></paper-checkbox>2<td>Pedido 00102<td>13:15:02<td align="right"class="td_importe"id="td_importe">120.00<tr class="row selected1 xCursor check_item_p"data-idpedido="3"><td><paper-checkbox checked="checked"class="check_item"></paper-checkbox>3<td>Pedido 00102<td>13:15:02<td align="right"class="td_importe"id="td_importe">120.00</table><br><x-comp-descuento id="component_descuento_pedido"importeventa$="[[ importeTotalPedido ]]"></x-comp-descuento><br><br></div><td class="xBordeIzq pd-l-10"><div><img src="../../images/_union.png"onclick="xJuntarFilasIguales()"class="xDerecha xAlinearce xCursor pos-union"title="Unir items"> <img src="../../images/_juntar_row.png"onclick="xDesJuntarItem()"class="xDerecha xAlinearce xCursor pd-l-10-a"title="Separar items"></div><div class="xtd-derecha"id="xBody"><div><table width="100%"id="tb_det_pedidos"class="xRowPading4"><tr><td colspan="5"class="xFondoRowPlomo">CONSUMIR EN EL LOCAL<tr><td colspan="5"><h4>ENTRADAS</h4><tr class="row xCursor"data-idpedidodetalle="1"data-idpedido="1"data-punitario="1.00"data-idtipoconsumo="1"data-idcategoria="1"data-idcartalista="117422605116"><td width="50px"class="click_row_dt_p"id="td_cant"><paper-checkbox class="check_item"></paper-checkbox>03<td class="click_row_dt_p">COCO RALLADO<td class="click_row_dt_p"align="right"id="td_importe">0.00<td align="center"class="td_op"data-op="cambiar"><img src="../../images/_change.png"title="Cambiar"><td align="center"class="td_op"data-op="borrar"><img src="../../images/_delete3.png"title="Borrar"><tr class="row xCursor"data-idpedidodetalle="2"data-idpedido="1"data-punitario="2.00"data-idtipoconsumo="1"data-idcategoria="1"data-idcartalista="11122605116"><td width="50px"class="click_row_dt_p"id="td_cant"><paper-checkbox class="check_item"></paper-checkbox>02<td class="click_row_dt_p">GELATINA<td class="click_row_dt_p"align="right"id="td_importe">2.00<td align="center"class="td_op"data-op="cambiar"><img src="../../images/_change.png"title="Cambiar"><td align="center"class="td_op"data-op="borrar"><img src="../../images/_delete3.png"title="Borrar"></table></div></div><div class="d-flexx justify-content-end align-items-center"style="position:sticky;width:100%"hidden$="[[ !isAddItemRow ]]"><button class="btn btn-success"style="margin-top:-80px"onclick="xArmarSqlAddLUlI()"><i class="fa fa-check"></i> Confirmar</button></div></table></div><div class="xAddItemPedido xNoScroll"id="SelAddLuLi"><div><x-comp-find-categoria id="compFindCategoria"onchange="_getCategoria(categorias)"></x-comp-find-categoria><select class="xTextRow2 xCursor w-100"id="select_ulTPC"></select> <input class="xMiInput w-100"placeholder="Buscar.."id="txt_bus_item_add"></div><br><ul id="accordion"class="list_add_item noselect"></ul><br><div class="footer_dialog-more-item xFondoRowPlomo3"><div class="xLinea"></div><br><button class="btn btn-success"onclick="xArmarSqlAddLUlI()">F9 | Confirmar</button> <button class="btn btn-secondary"onclick="xCloseLULI()">Cerrar</button><br></div><div class="xInvisible"><table data-tablaname="pedido_detalle"id="xli_tb_pedido_ad"></table></div></div><div class="footer_dialog xAlinearce xFondoRowBlanco2"><br><div class="xDerecha pos-fotter-btn"><div class="xMiBoton_icon_lateral bgwhite mg-t-15"onclick="xImprimirPrecuenta()"><img src="../../images/_pre_cuenta.png"><p class="fs-10 m-0">Pre-cuenta</div><div class="xMiBoton_icon_lateral bgwhite mg-t-15"onclick="xOpenCambiarMesa()"id="btn_cambiar_mesa"><img src="../../images/_cambiar_mesa.png"><p class="fs-10">Cambiar mesa</div><div class="xMiBoton_icon_lateral bgwhite mg-t-15"onclick="xOpenAnularPedido()"id="btn_anular_pedido"><img src="../../images/_delete_pedido.png"><p class="fs-10">Anular <i id="btn_punto_verde_pedido"class="fa fa-unlock text-success punto-flotante-verde fs-12"></i></div></div><button class="btn btn-primary"id="btn_registrar_pago"onclick="xIrPage(1)">F10 | Listo, pagar</button> <button class="btn btn-dark"dialog-dismiss onclick="xCPcloseDialogDetalle()">Cerrar</button><br></div></div><div id="div_pago"><x-pago id="component_pago"></x-pago></div><br><br></iron-pages></div></paper-dialog><br><div class="xContent d-flex"><div hidden$="[[!showVisibleAreaMesas]]"><x-comp-area-mesa id="comp-area-mesas"></x-comp-area-mesa></div><div class="grid grid-contente-pedidos"id="_gridCM"style="overflow:hidden!important"><paper-spinner active class="xCentradoVerticalHorizontal"></paper-spinner></div><div id="control-delivery-new-view"class="xInvisible"><x-control-delivery id="comp-control-delivery"></x-control-delivery></div></div></template><style>.lh-7{line-height:7px}.lh-15{line-height:15px}.pd-r-10{padding-right:10px}.pd-l-10{padding-left:10px}.pd-l-10-a{padding-left:10px;position:absolute;right:40px}.mg-t-15{margin-top:-15px}.pos-union{position:absolute;right:78px}.pos-fotter-btn{margin-top:12px;display:inline-flex}.div-filtro-header-input{width:80px;margin-right:5px}.subtotal-tr-row{padding-top:1px;padding-bottom:1px}.xdiv-info-delivery{padding:10px 0 0 0;border-top:1px solid #d3d3d3;margin-top:10px;color:gray}.content-info-delivery{line-height:15px}.txt-info-delivery{line-height:15px!important}.txt-info-delivery-from-app{padding:5px 5px!important}.content-check-borrar-item{background:#e9e9e9;padding:5px;border-radius:3px;display:flex}</style></dom-module><style type="text/css">.grid:after{content:'';display:block;clear:both}#dialog_detalle.tall{border-radius:5px;width:100%;min-width:300px;position:fixed;top:0;left:2;bottom:0;right:2;margin:2px;min-height:50vh;width:-webkit-fill-available;height:-webkit-fill-available}#dialog_detalle.tall-polys{width:-webkit-fill-available;height:-webkit-fill-available;border-radius:5px}#dialog_detalle.normal{border-radius:5px;width:auto 0;min-width:300px}.xtd-derecha{height:calc(100vh - 193px);bottom:0;overflow-y:auto}img.xdisabled{pointer-events:none;opacity:.5;cursor:auto}</style><script src="../view/item_pedidos.js"></script><script src="../view/xJsonSunat.js"></script><script src="../view/xSOAPSunat.js"></script><script src="../view/cpe_interno.js"></script><script src="../view/cliente.service.js"></script><script src="../view/item_pedido_estructura.js"></script><script src="../view/item_pedido_subtotales.js"></script><script src="../view/item_pedido_print_comprobante.js"></script><script src="../view/deNumALetras.js"></script><script src="../view/manager_storage.js"></script><script>var xThisCM,xsourceEvent,xRefreshPedidos,xRefreshHora,xIdFiltro1="",xCronometro_us=0,xPermisoSupervisor=0,xPermisoSupervisorNombre="",xRefreshPermiso,xpass_op,xid_pedido_detalle_item,xid_carta_lista_de,xid_carta_lista_a,xidprocede_item_lista,xdescontar_en_item_lista,xIDdescontar_en_item_lista,xid_pedido,xid_tpc_item,xid_cat_item,xcant_item,xobj_row_item,xObj_miPedido,xPopupLoad,xtt_pedidos=0,xDtPrint=[],xDtSede_cm=[],xArrayEnca=[],xArrayPrintEncaLi=[],xArrayPedido=[],xDtSubTotales=[],xRpt_pago=[],xitem_print,xidpedido_filtro=0,xArraychek_pedido=[],xAgrupar_item_activo=!1,xArrayTpC=[],xArraySeccion=[],xArrayDtOrdenFiltro=[],xopen_add_item=!1,xidpedid_txt_change="",xSelAllPedidos=!1,xbuscar_mesa=!1,iIniIsotope=!1,xkey_f10=!0,xidCategoriaPD="",xArrayItemEliminar=[],xCountTotalPedidos=0,xValCountPedidos=0,enProcesoGuardarPago=!1,guardandoPedido_cp=0,checkItemsSeleccionados=[],arrSumSubtTotales=[],ImporteDiferencia=0,xImporteTotalSeleccionados=0,datosDelivery=null,isSocket=!1,isPedidoOpenDeliveryCliente=!1,arrTotalesDeliveryCliente,xid_pedido_selected,optionDeliveryCliente,xdtDpedido,pasoRedibujado=!1,isPedidoPagadoFromApp=!1,cuentaEventoLoadIni=0,cuentaEventoLoadIniPrincipal=0,xCompDescuentoPedido,arrSubtTotalesDescuento,xPSupervisor,lastIdPedidoPrint=0,EstadoLoadMesas=!1,firstLoad_mesas=!0,lastIdPedidoCobrado=0,lastDataPedidoInsert=null,xp_sel_idcategoria,isComercioServicioDeliveryPropio=!1,isDeliveryCalculaCostoEntrega=!1,isDeliveryCalculaCostoEntregaSoloApp=!1,idUsuarioOperador=0,isPedidoDelivery=!1,isDeliverySolicitoReparto=!1,isClienteDeliveryFromApp=!1,countIntiCP=0,isPassAddRowItemList=!1,xLocal_xDtSubTotales_cp,isProcessRemoveItemPedido=!1;const _fetchApi=new httpFecht;function xIniControlMesa(){var e;0<cuentaEventoLoadIniPrincipal||(cuentaEventoLoadIniPrincipal++,$("#accordion").accordion({heightStyle:"content",animate:50}),$("#spinner_li").spinner({min:0,step:1}),$("#tb_accordion").accordion({heightStyle:"content"}),xPopupLoad=document.getElementById("xLoad"),isSocket=0!==parseInt(xm_log_get("datos_org_sede")[0].pwa),idUsuarioOperador=xIdUsuario,firstLoad_mesas=!0,xm_log_get("ini_us"),xNuevoPedidoCM(),xTraerDtTipoConsumo(),xLoadDtPrintCM(),xLoadLastIdPedidoCobrado(),xLoadMesas(),xRefreshHora=setInterval(function(){xCalcularTiempoPedido()},2e3),xShowCantidadPedidosBorrados(),e=(e=getUrlParameter("df1","?")).replace(/%20/g," "),xIdFiltro1=getUrlParameter("f1","?"),$("#Titulo_page").text("PEDIDOS | "+e),document.title="Control de Pedidos",$("#div_filtro_header").removeClass("xInvisilbe"),$("#div_filtro_header").html(`<x-input-search-pedido-in-page id="comp_input_search_pedido_in_page"></x-input-search-pedido-in-page>
									<div class="xBoton2 xVerde ml-1" onclick="xOrdenPedido(1);">Por Estado</div>
									<div class="xBoton2 xPlomo" onclick="xOrdenPedido(0);">Por Numero</div>`).trigger("create"),xThisCM.xt_org=xIdOrg,xThisCM.xt_idsede=xIdSede,xThisCM.xt_idus=xIdUsuario,document.defaultAction=!1,document.body.onkeydown=detectEvent,$(".xPasarEnter2").on("keyup",function(e){var a,t,e=e.which;if(13==e||186==e)return a=(e=$("input")).index(document.activeElement),null!==e[a+1]&&(t=(t=e[a+1]).disabled?e[a+2]:t).focus(),!1}),$("#txt_bus_item_add").keyup(function(e){var a=$(this).val();""==a?$(".list_add_item li").each(function(){$(this).show()}):($(".list_add_item li").each(function(){($(this).text()+$(this).attr("data-cat")).search(new RegExp(a,"i"))<0?$(this).hide():($(this).show(),$(this).find("ul").show())}),13==e.keyCode&&1==$(".list_add_item li ul li:visible").length&&(xBtnSumarRestarKey($(".list_add_item li ul li:visible").find(".xBtn_li"),1),$(this).val("")))}),$(document).on("focusout",".list_add_item li ul li",function(e){var a=$(this).find("#xinput_li");"inline-block"==$(a).css("display")&&""==$(a)[0].value&&$(a).css("display","none")}),$(document).on("click",".xbtn_li_editar",function(e){$(this).parent().find("#xinput_li").css("display","inline-block"),$(this).parent().find("#xinput_li").focus(),e.stopPropagation(),e.stopImmediatePropagation()}),$(document).on("click",".check_item_p",function(e){xCheckPedidos(),1==xSelAllPedidos&&$("#tb_pedidos .check_item").each(function(e,a){a.checked=!1,$(a).parent().parent().removeClass("selected1"),$(a).parent().parent().find("#td_importe").removeClass("td_importe")});var a=this.classList.contains("selected1");$(this).attr("data-idpedido");1==a?($(this).removeClass("selected1"),$(this).find(".check_item").attr("checked",!1),$(this).find("#td_importe").removeClass("td_importe")):($(this).addClass("selected1"),$(this).find(".check_item").attr("checked",!0),$(this).find("#td_importe").addClass("td_importe")),xFiltrarRowArray(),xSumarTotalPedidos(),xCheckPedidos(),e.stopPropagation(),e.stopImmediatePropagation()}),$(document).on("click",".click_row_dt_p",function(e){var a=$(this).parent();1==a.hasClass("selected1")?(a.removeClass("selected1"),a.find(".check_item").attr("checked",!1),a.find("#td_importe").removeClass("td_importe")):(a.addClass("selected1"),a.find(".check_item").attr("checked",!0),a.find("#td_importe").addClass("td_importe")),xSumarTotalPedidos(),e.stopPropagation(),e.stopImmediatePropagation()}),$(document).on("click",".btn-add-item",async function(e){var a=(xobj_row_item=$(this).parents("tr")[0]).dataset.idtipoconsumo,t=parseInt(xobj_row_item.dataset.cantidad)+1,o=parseFloat(xobj_row_item.dataset.punitario),o=parseFloat(t*o).toFixed(2);xobj_row_item.dataset.cantidad=t,xobj_row_item.dataset.cantidadr=t,xobj_row_item.dataset.total=o,xobj_row_item.dataset.total_r=o,xobj_row_item.dataset.ptotal=o,$(xobj_row_item).find("#td_cant").text(xCeroIzq(t,2)),$(xobj_row_item).find("#td_importe").text(o),$("#select_ulTPC").val(a),xThisCM.isAddItemRow=!0,handlerFnMiPedidoControl(e),e.stopPropagation(),e.stopImmediatePropagation()}),$(document).on("click",".td_op",function(e){var a;isProcessRemoveItemPedido||"0"==$(this).attr("data-procede")&&1!=xAgrupar_item_activo&&(xpass_op=$(this).attr("data-op"),xobj_row_item=$(this).parent(),isProcessRemoveItemPedido=!0,xArrayItemEliminar={procede:xobj_row_item.attr("data-descontar"),cant_descontar:xobj_row_item.attr("data-cant_descontar"),idprocede:xobj_row_item.attr("data-iddescontar"),idalmacen_items:xobj_row_item.attr("data-idcartalista"),idcarta_lista:xobj_row_item.attr("data-idcartalista"),iditem:xobj_row_item.attr("data-iditem"),idseccion:xobj_row_item.attr("data-idseccion"),idimpresora_seccion:xobj_row_item.attr("data-idimpresora_seccion"),idtipoconsumo:xobj_row_item.attr("data-idtipoconsumo"),idpedido_detalle:xobj_row_item.attr("data-idpedidodetalle"),idpedido:xobj_row_item.attr("data-idpedido"),precio_total:parseFloat(xobj_row_item.find("#td_importe").text()),precio_unitario:xobj_row_item.attr("data-punitario"),des_tp:xobj_row_item.attr("data-des_tp"),descripcion:xobj_row_item.attr("data-descripcion"),is_cantidad_nd:xobj_row_item.attr("data-is_cantidad_nd")},a=$(this).find(".btn-delete-row").hasClass("text-success"),xCompArraySolitaPermiso={tipo_permiso:1,obj:xArrayItemEliminar,mesa:xObj_miPedido.data().nummesa,numpedido:xObj_miPedido.data().numpedido,isBtnDeleteRowSuccess:a},xOp_permiso(),setTimeout(()=>{isProcessRemoveItemPedido=!1},2500),e.stopPropagation(),e.stopImmediatePropagation())}),(xPSupervisor=document.getElementById("pass_us")).setVal("Pe1"),xPSupervisor.addEventListener("xSend",function(e){1===e.detail.xRpts[0].p&&(xPermisoSupervisor=e.detail.xRpts[0].us,xPermisoSupervisorNombre=e.detail.xRpts[0].nomus,xCronometro_us=30,xRefreshPermiso=setInterval(function(){xcronometro_permiso()},1e3),xGoProcessBorrar(),e.stopPropagation(),e.stopImmediatePropagation())}),$("#dialog_cotent").on("iron-overlay-opened",function(){$("#dialog_cotent #us").focus()}),(xCompDescuentoPedido=document.getElementById("component_descuento_pedido")).addEventListener("changeDescuento",function(e){var a=e.detail;arrSubtTotalesDescuento=colocarDescuentoSubtotales(a.value,arrSumSubtTotales,a.descripcion,a.isAgregar),xSumarTotalPedidos(null,!0),e.stopPropagation(),e.stopImmediatePropagation()}),$("#dialog_detalle").on("iron-overlay-closed",function(){xbuscar_mesa=!1,xdtDpedido=null,xThisCM.isAddItemRow&&_cpSocketRestoreFromPedidoStorage(),xCPcloseDialogDetalle()}),$("#dialog_detalle").on("iron-overlay-opened",function(){xbuscar_mesa=!0;var e=$("#dialog_detalle").height()-$("#dialog_detalle .footer_dialog").height()-135;$(".xtd-derecha").height(e),(xValPago=document.getElementById("component_pago")).setObjConntet($("#dialog_detalle")),xValPago.addEventListener("xSend",function(e){xRpt_pago=e.detail.xRpts,0!==e.detail.xRpts[0].ok&&1==e.detail.xRpts[0].paseEnterTxt&&xRegistrarClientePagoCP()}),xValPago.addEventListener("xCancelarCerrar",function(e){xIrPage(0)}),xValPago.addEventListener("xListoRegistraPago",function(e){xRegistrarClientePagoCP()})}),$("#dialog_cambiar_mesa").on("iron-overlay-closed",function(){$("#txt_num_mesa_change").focus()}),$("#dialog_motivo_anular").on("iron-overlay-closed",function(){$("#txt_motivo_anular").focus()}),$("#dialog_motivo_anular #txt_motivo_anular").keyup(function(e){13==e.keyCode&&(dialog_motivo_anular.close(),xPSupervisor.setVal("Pe1"),pass_us.open())}),$("#dialog_cambiar_mesa #txt_num_mesa_change").keyup(function(e){13==e.keyCode&&xCambiarMesa()}),$("#content_page").on("iron-select",function(e,a){1==e.target.selected&&component_pago.setFocusTxt()}),$(document).on("keyup",".xMiTextReferencia",function(e){e=e.target.parentElement.parentElement.dataset.index;xidTipoConsumo=$("#select_ulTPC option:selected").val(),itemPedidos_objItemSelected=xGeneralDataCarta[e],xidItem=itemPedidos_objItemSelected.idcarta_lista}),$(document.body).on("keydown","#txt_bus_mesa",function(t){var o;13==t.keyCode&&(o=parseInt($(this).val()),$(".xMiCardPedido.xOcupado").each(function(e,a){parseInt($(a).find(".numero").text())==o?(lastDataPedidoInsert=null,xLoadDetallesPedido($(a)),$("#txt_bus_mesa").select(),t.stopPropagation(),t.stopImmediatePropagation()):$("#txt_bus_mesa").val("")})),t.stopPropagation(),t.stopImmediatePropagation()}),(compFindCategoria=document.getElementById("compFindCategoria")).addEventListener("getValorIncial",function(e){return void setCatetgoriaCartaCP(e.detail.categorias)}),(e=compFindCategoria.getCategoria())&&setCatetgoriaCartaCP(e),xPopupLoad=document.getElementById("xLoad"),$(document.body).on("change","#select_ulTPC",function(e){xChangeTipoConsumoItems(e.target.value)}),getAllRepartidor(),document.getElementById("comp-area-mesas").addEventListener("onChangeTitle",function(e){e="."+e.detail.title;$(".grid").isotope({filter:e})}))}function xCPcloseDialogDetalle(){dialog_detalle.close(),document.querySelector("#backdrop-dialog-detalle").classList.add("fade-out")}function xCPopenDialogDetalle(){document.querySelector("iron-overlay-backdrop");var e=document.querySelector("#backdrop-dialog-detalle");e.style.display="block",e.classList.remove("fade-out"),dialog_detalle.open()}function setCatetgoriaCartaCP(e){let a;var t;a=e,getLocalStorage("::app3_cat_defualt")?((t=JSON.parse(getLocalStorage("::app3_cat_defualt"))).idcategoria!=a.idcategoria?setLocalSotrage("::app3_cat_defualt",JSON.stringify(a)):a=t,xidCategoriaPD=a.idcategoria,setTimeout(()=>{compFindCategoria.$.compFindListCategoria.value=a.index},500)):xidCategoriaPD=e.idcategoria,setLocalSotrage("::app3_cat_defualt",JSON.stringify(a))}function xLoadLastIdPedidoCobrado(){_fetchApi.axiosExecute({type:"POST",url:"../../bdphp/log.php?op=50701"}).then(e=>{localStorage.setItem("::app3_woLastIdP",e),lastIdPedidoCobrado=e})}function _getCategoria(e){xidCategoriaPD=e.idcategoria,setLocalSotrage("::app3_cat_defualt",JSON.stringify(e)),xLoadDataUlAdd()}function xValPagoMostrarContainerPago(){xValPago.setVisibleContainerPago()}async function PreparComprobante(){var e=await getItemsSeleccionados(),e=e.esSeleccionTotal?[]:e.arrayPedidosSeleccionados,e=xCargarDatosAEstructuraImpresion(e);xArmarSubtotalesArray(e,xDtPrint),xLocal_xDtSubTotales_cp=xLocal_xDtSubTotales}async function getItemsSeleccionados(){var t,e,o="",i=[],d=0,r=0,a=parseFloat($("#tb_pedidos #tt_importe_pagar_t").text()),_=($("#tb_pedidos .row.selected1").each(function(e,a){d++,o=o+$(a).attr("data-idpedido")+",",t=$(a).attr("data-idcliente"),r+=parseFloat(r)+parseFloat($(a).find("#td_importe")),xid_tipo_consumo=$(a).attr("data-idtipoconsumo"),0===i.filter(e=>e===t).length&&i.push(t)}),o=o.slice(0,-1),e=d==xdtDpedido.length,[]),s=$("#tb_det_pedidos"),m=s.find(".row.selected1").length,n=(s.find(".row").length,parseInt(s.find(".row").length)),l=parseInt(s.find(".row.selected1").length),n=!(l<n&&0<l);return s.find(".row").each(function(e,a){var t=$(a).attr("data-idpedido"),o=($(a).attr("data-idcliente"),$(a).attr("data-iditem")),i=$(a).attr("data-idpedidodetaller"),d=$(a).attr("data-totalr"),r=$(a).attr("data-punitario"),s=$(a).attr("data-cantidadr"),n=$(a).attr("data-total"),l=($(a).attr("data-cantidad"),$(a).attr("data-des_seccion")),p=$(a).attr("data-idseccion"),c=$(a).attr("data-subtotales_tachados"),x=$(a).find("#descripcion_item").text();-1!==i.indexOf(",")&&(i=-1<i.indexOf(",")?i.slice(0,-1):i,d=-1<d.indexOf(",")?d.slice(0,-1):d,s=-1<s.indexOf(",")?s.slice(0,-1):s),xid_tipo_consumo=$(a).attr("data-idtipoconsumo"),0!==m&&!$(a).hasClass("selected1")||_.push({des_seccion:l,idseccion:p,descripcion:x,idpedido:t,idpedido_detalle:i,iditem:o,cantidad:s,precio:r,total:d,ptotal:n,idtipo_consumo:xid_tipo_consumo,subtotales_tachados:c})}),{esSeleccionTodoPeidoLista:e,esSeleccionTotal:n,arrayPedidosSeleccionados:_,arrayIdClienteUsPedido:i,idPedidosSeleccionados:o,tipoConsumo:xid_tipo_consumo,importeTotalSeleccionado:a,importeTotalSubItemSeleccionados:r}}function addListClienteUsuarioPedido(e){}function xCheckPedidos(){var t=0,o=0,i="";xidpedid_txt_change="",xSelAllPedidos=!1,$("#btn_cambiar_mesa").attr("disabled",!1),$("#btn_anular_pedido").attr("disabled",!1),$("#btn_registrar_pago").attr("disabled",!1),xkey_f10=!0,$("#tb_pedidos .check_item").each(function(e,a){1==a.checked&&(xidpedid_txt_change=xidpedid_txt_change+","+$(a).parent().parent().attr("data-idpedido"),xnum_pedido_check=$(a).parent().parent().find("td:nth-child(2)").text(),i=i+" "+xnum_pedido_check+",",t++),o++}),0==t&&($("#btn_cambiar_mesa").attr("disabled","disabled").off("click"),$("#btn_registrar_pago").attr("disabled","disabled").off("click"),$("#btn_anular_pedido").attr("disabled","disabled").off("click"),xkey_f10=!1),o==t&&(i="todos los pedidos: ",xSelAllPedidos=!0),t<o&&(i="los pedidos: "+(i=i.slice(0,-1))+"."),$(".txt_anular_cambiar_mesa").text(i),xidpedid_txt_change=xidpedid_txt_change.slice(1)}function empty(){}function detectEvent(e){var a=e||window.event;if(27==a.keyCode){if(dialog_cambiar_mesa.opened)return void dialog_cambiar_mesa.close();if(xopen_add_item)return void xCloseLULI();if(1==content_page.selected)return void xIrPage(0);if(dialog_detalle.opened)return void xCPcloseDialogDetalle()}if(48<=e.keyCode&&e.keyCode<=90||96<=e.keyCode&&e.keyCode<=105){if(1==xbuscar_mesa)return;var t=document.getElementById("comp_input_search_pedido_in_page");t.focus(),1==xbuscar_mesa&&(t.select(),xbuscar_mesa=!1)}if(119<=a.keyCode&&a.keyCode<=121&&dialog_detalle.opened)return 119==a.keyCode&&dialog_detalle.opened&&xOpenLULI(),120==a.keyCode&&xopen_add_item&&xArmarSqlAddLUlI(),121==a.keyCode&&1==xkey_f10&&1!==xThisCM.$.content_page.selected&&(xIrPage(1),e.stopPropagation(),e.stopImmediatePropagation()),document.defaultAction}function xOpenAnularPedido(){var e,a,t;""==xidpedid_txt_change&&xCheckPedidos(),""!=xidpedid_txt_change&&(xpass_op="anular_pedido",xPSupervisor.setVal("Pe1"),e=localStorage.getItem("::app3_woRestoreStock"),check_recuperar_stock_all_pedido.checked=e||!1,a=0<(e=xCPGetItemPedidosAnular()).filter(e=>"1"===e.is_cantidad_nd).length,t=!$(".xDerecha pos-fotter-btn").find("#btn_punto_verde_pedido").hasClass("xInvisble"),xCompArraySolitaPermiso={tipo_permiso:2,obj:e,mesa:xObj_miPedido.data().nummesa,numpedido:xObj_miPedido.data().numpedido,importe_total:parseFloat($("#tb_pedidos #tt_importe_pagar_t").text()),is_cantidad_nd:a?"1":"0",isBtnDeleteRowSuccess:t},t?xCMCheckPermisoBorrar():dialog_motivo_anular.open())}function xCPGetItemPedidosAnular(){xCheckPedidos();var r=[];return $("#tb_det_pedidos .row").each(function(e,a){var t=parseFloat($(a).find("#td_cant").text()),o=($(a).attr("data-idpedido"),$(a).attr("data-iddescontar")),i=$(a).attr("data-cant_descontar"),d=$(a).attr("data-descontar");r.push({idpedidos:xidpedid_txt_change,m_a:$("#txt_motivo_anular").val(),c:i,cant_item:t,descripcion:$(a).attr("data-descripcion"),des_tp:$(a).attr("data-des_tp"),idimpresora_seccion:$(a).attr("data-idimpresora_seccion"),idtipoconsumo:$(a).attr("data-idtipoconsumo"),idseccion:$(a).attr("data-idseccion"),iddescontar:o,tabladescontar:d,is_cantidad_nd:$(a).attr("data-is_cantidad_nd")})}),r}function xAnularPedido(e=!1,a=""){xCheckPedidos();var t=xCPGetItemPedidosAnular(),e=e||check_recuperar_stock.checked?"1":"0",o={nummesa:xObj_miPedido.data().nummesa,numpedido:xObj_miPedido.data().numpedido},a=""===a?txt_motivo_anular.value:a;cocinarImpresionAnulacionList(t,xPermisoSupervisorNombre,xNomU,o,a),_fetchApi.axiosExecute({type:"POST",url:"../../bdphp/log.php?op=5011",data:{ArrayPeAnular:t,xPedidos:xidpedid_txt_change,xMotivo:a,u:xPermisoSupervisor,xisRecuperarStock:e}}).then(e=>{xPopupLoad.xclose(),xActualizarItems(),1==xSelAllPedidos&&($(xObj_miPedido).removeClass("xOcupado"),$(xObj_miPedido).removeClass("xDespachado"),$(xObj_miPedido).addClass("xNeutro"),$(xObj_miPedido).find(".show-led-precuenta").addClass("xInvisible"),$(xObj_miPedido).find(".show-led-print").addClass("xInvisible"),$(xObj_miPedido).find(".show-ico-mozo").addClass("xInvisible"),$(xObj_miPedido).find(".referencia-pedido").addClass("xInvisible"),$(xObj_miPedido).find(".show-led-reserva").addClass("xInvisible"),$(xObj_miPedido).find(".show-mozo-pedido").removeClass("pintar"),$(xObj_miPedido).find("#nommozo").text("."),$(xObj_miPedido).find(".importe").text("."),$(xObj_miPedido).find(".tiempo").text("disponible"),$(xObj_miPedido).attr("data-hora",""),$(xObj_miPedido).attr("data-estado","b"),$(xObj_miPedido).attr("data-abrir-detalle","0"),$(".grid").isotope("updateSortData",$(xObj_miPedido)).isotope("layout")),xCPcloseDialogDetalle()}),xShowCantidadPedidosBorrados()}function xOpenCambiarMesa(){""==xidpedid_txt_change&&xCheckPedidos(),""!=xidpedid_txt_change&&dialog_cambiar_mesa.open()}function xCambiarMesa(){var e=txt_num_mesa_change.value;""!=e&&(xPopupLoad.xopen(),_fetchApi.axiosExecute({type:"POST",url:"../../bdphp/log.php?op=5010",data:{n:e,i:xidpedid_txt_change}}).then(e=>{dialog_cambiar_mesa.close(),txt_num_mesa_change.value="",xPopupLoad.xclose(),xCPcloseDialogDetalle(),$("#dialog_cambiar_mesa #titulo_cambiar_mesa").text().indexOf("todos")<0||($(xObj_miPedido).removeClass("xOcupado"),$(xObj_miPedido).removeClass("xDespachado"),$(xObj_miPedido).addClass("xNeutro"),$(xObj_miPedido).find(".show-led-precuenta").addClass("xInvisible"),$(xObj_miPedido).find(".show-led-reserva").addClass("xInvisible"),$(xObj_miPedido).find(".show-led-print").addClass("xInvisible"),$(xObj_miPedido).find(".show-ico-mozo").addClass("xInvisible"),$(xObj_miPedido).find(".referencia-pedido").addClass("xInvisible"),$(xObj_miPedido).find(".show-mozo-pedido").removeClass("pintar"),$(xObj_miPedido).find("#nommozo").text("."),$(xObj_miPedido).find(".importe").text("."),$(xObj_miPedido).find(".tiempo").text("disponible"),$(xObj_miPedido).attr("data-hora",""),$(xObj_miPedido).attr("data-estado","b"),$(xObj_miPedido).attr("data-abrir-detalle","0"),$(".grid").isotope("updateSortData",$(xObj_miPedido)).isotope("layout")),xPintarEstadoPedido()}))}async function xImprimirPrecuenta(){checkItemsSeleccionados=await getItemsSeleccionados(),e=xCargarDatosAEstructuraImpresion(checkItemsSeleccionados.arrayPedidosSeleccionados,!0);var e,a=$("#p_mesa").text().split(" "),t=$("#p_correlativo").text(),a=(t=(t=(t=t.replace("CO-","")).replace("|","")).replace(/\s/g,""),xdtDpedido[0].nummesa),a=(xArrayPrintEncaLi_pre_cuenta={m:a,r:"",num_pedido:t,reservar:0,solo_llevar:0,correlativo_dia:t,precuenta:!0,delivery:isPedidoDelivery?1:0,arrDatosDelivery:datosDelivery},"1"==xDtPrint[0].isprint_cpe_short);xMandarImprimirOtroDoc(xArrayPrintEncaLi_pre_cuenta,xDtPrint,e,arrSumSubtTotales,-1,a),xUpdatePrintPrecuentaPedido(checkItemsSeleccionados.idPedidosSeleccionados),$(xObj_miPedido).find(".show-led-precuenta").removeClass("xInvisible")}function xImprimirComprobante(){var e=xCargarDatosAEstructuraImpresion(checkItemsSeleccionados.arrayPedidosSeleccionados);xCocinarImprimirComprobante(e,arrSumSubtTotales,-2)}function xTraerDtTipoConsumo(){for(var e="",a=xm_log_get("estructura_pedido"),t=0;t<a.length;t++)e=String(e+'<option value="'+a[t].idtipo_consumo+'">'+a[t].descripcion+"</option>");$("#select_ulTPC").html(e).trigger("create")}function xOpenLULI(){xopen_add_item=!0,$("#SelAddLuLi").css("display","inline-block"),$("#select_ulTPC").val($("#select_ulTPC option:first").val()),xLoadDataUlAdd()}function xCloseLULI(){_cpSocketRestoreFromPedidoStorage(),$("#SelAddLuLi").css("display","none"),xopen_add_item=!1}function xNuevoPedidoCM(){try{isSocket&&_cpSocketClearStorage()}catch(e){}window.localStorage.removeItem("::app3_sys_dta_pe"),xArrayPedido=new Array,xDtSubTotales=new Array,guardandoPedido_cp=0,xThisCM.isAddItemRow=!1,xLoadArrayPedido()}function xLoadDataUlAdd(){var e;$("#accordion").html('<div><paper-spinner active class="xCentradoVerticalHorizontal"></paper-spinner></div>').trigger("create"),xNuevoPedidoCM(),""===xidCategoriaPD&&(e=compFindCategoria.getCategoria())&&setCatetgoriaCartaCP(e),xGeneralLoadItems(xidCategoriaPD,function(){for(var e=new Array,a="",t=0;t<xGeneralDataCarta.length;t++)a!=xGeneralDataCarta[t].des_seccion&&(e.push({id:xGeneralDataCarta[t].idseccion_index,des_seccion:xGeneralDataCarta[t].des_seccion}),a=xGeneralDataCarta[t].des_seccion);for(var o,i="",d="",r="",s=0;s<e.length;s++){for(var n=e[s].id,l=String('<li class="li_tocuh"><div>'+e[s].des_seccion+"</div>"),p=0;p<xGeneralDataCarta.length;p++)n==xGeneralDataCarta[p].idseccion_index&&(r="",o=xGeneralDataCarta[p].cantidad,parseInt(o)<=0&&(r="xTachar"),"ND"==o&&(o=1e3),xGeneralDataCarta[p].stock_actual=o,xGeneralDataCarta[p].idcategoria=xidCategoriaPD,i=String(i+'<li class="row" id="li'+xGeneralDataCarta[p].idcarta_lista+'" data-index = "'+p+'" data-signo="+"  data-idcategoria="'+xidCategoriaPD+'" data-cat="'+e[s].des_seccion+'" data-idcl="'+xGeneralDataCarta[p].idcarta_lista+'" data-idcartalista="'+xGeneralDataCarta[p].idcarta_lista+'" data-idseccion="'+xGeneralDataCarta[p].idseccion+'" data-idseccionindex="'+xGeneralDataCarta[p].idseccion_index+'" data-iditem="'+xGeneralDataCarta[p].iditem+'" data-punitario="'+xGeneralDataCarta[p].precio+'" data-idimpresora="'+xGeneralDataCarta[p].idimpresora+'" data-idprocede="'+xGeneralDataCarta[p].idprocede+'" data-procede="'+xGeneralDataCarta[p].procede+'" data-procedeindex="'+xGeneralDataCarta[p].procede_index+'" data-imprimircomanda="'+xGeneralDataCarta[p].imprimir_comanda+'" data-iddescontar="'+xGeneralDataCarta[p].idprocede+'" data-cant_descontar="'+xGeneralDataCarta[p].cant_descontar+'" data-stock_actual="'+xGeneralDataCarta[p].cantidad+'" data-idalmacen_items="'+xGeneralDataCarta[p].idalmacen_items+'"><div><div class="xicon3 xeditar xbtn_li_editar" title="editar" style="width:15px;height:15px;"></div><p class="xtitulo_li '+r+'">'+xGeneralDataCarta[p].des_item+'</p><p class="xInvisible">'+xGeneralDataCarta[p].codigo_barra+'</p><input type="text" class="xMiInput xMiTextReferencia" anchofull id="xinput_li"></div><div class="xBtn_contet_li"><div class="xBtn_li">-</div><span class="xcant_li" data-cantmax="'+o+'">0</span><div class="xBtn_li">+</div></div></li>'));i=l+'<ul id="content_item_pedido">'+i+"</ul></li>",d=String(d+i),i=i=""}$("#accordion").html(d).trigger("create"),$("#accordion").accordion("refresh"),$("#accordion").accordion({collapsible:!0,active:!1}),$("#txt_bus_item_add").focus()})}function _cpStockItemModificado(e){if(isSocket&&xopen_add_item){var a="#li"+e.idcarta_lista;const t=e.cantidad;e=$(a).attr("data-index");xtachar_li="",parseInt(t)<=0&&(xtachar_li="xTachar"),"ND"==t&&(t=1e3),$(a).attr("data-stock_actual",t),$(a+" span.xcant_li").attr("data-cantmax",t),xGeneralDataCarta[e].stock_actual=t,xGeneralDataCarta[e].cantidad=t,itemPedidos_objItemSelected=xGeneralDataCarta[e],""!=xtachar_li?$(a).find(".xtitulo_li").addClass(xtachar_li):$(a).find(".xtitulo_li").removeClass("xTachar")}}async function xArmarSqlAddLUlI(){if(1!==guardandoPedido_cp){guardandoPedido_cp=1;var t,o,i,d,e=$("#select_ulTPC option:selected").val(),a=$("#select_ulTPC option:selected").text().trim().toLowerCase();if($("#tb_pedidos .check_item").each(function(e,a){1==a.checked&&($(a).parent().parent().attr("data-idpedido"),$(a).parent().parent().attr("data-idcat"),t=$(a).parent().parent().attr("data-m"),o=$(a).parent().parent().attr("data-nump"),i=$(a).parent().parent().attr("data-correlativo"),d=$(a).parent().parent().attr("data-ref"))}),xGeneralValidarRegalasCarta(xArrayPedidoObj,!0),0!=xArmarSubtotalesArray()){xLocal_xDtSubTotales_cp=xLocal_xDtSubTotales;var r="0",s="0";switch(a){case"para llevar":r="1";break;case"delivery":s="1"}"0"!==r||"0"!==s||""!==t&&"0"!==t?(xArrayPrintEncaLi={m:xCeroIzq(t,2),r:xMayusculaPrimera(xSoloMinuscula(d)),num_pedido:xCeroIzq(o,5),reservar:0,solo_llevar:r,delivery:s,correlativo_dia:i},xarr_header={idclie:0,referencia:"",idcategoria:xidCategoriaPD,mesa:xCeroIzq(t,2),num_pedido:o,reservar:0,tipo_consumo:e,subtotales_tachados:""},xarr_body=xArrayPedidoObj,xarr_subtotales=xLocal_xDtSubTotales_cp,xVerificarSiSeImprimeComanda(xArrayPedidoObj),a=await goSendPedidoFecht({p_from:"1",p_header:xarr_header,p_body:xarr_body,p_subtotales:xarr_subtotales,estado_p:0}),lastDataPedidoInsert=a,xPopupLoad.xopen(),(1==xVerificarImprimirComanda?xLLamarPrintAddLUlI:(xLoadDetallesPedido(xObj_miPedido,!1),xNuevoPedidoCM(),xCloseLULI))(),xSumarTotalPedidos(1),$(xObj_miPedido).removeClass("xDespachado"),xThisCM.isAddItemRow=!1):(alert("Indique numero de mesa. Coloque cero(0) si no corresponde"),guardandoPedido_cp=0)}}}async function goSendPedidoFecht(e){return await(new httpFecht).postJson("../../bdphp/log_001.php",e)}function xLLamarPrintAddLUlI(){xCocinarImprimirComanda(xArrayPrintEncaLi,xArrayPedidoObj,xLocal_xDtSubTotales_cp,e=>{e?dialog_erro_print.open():(xPopupLoad.xclose(),xLoadDetallesPedido(xObj_miPedido,!1),xNuevoPedidoCM(),xCloseLULI())})}function xIrPage(e){switch(e){case 0:$("#dialog_detalle").removeClass("normal"),$("#dialog_detalle").addClass("tall");break;case 1:xValPago.setVisiblePanel1(),component_pago.setVal(xMoneda(xtt_pedidos)),component_pago.setModoSoloComprobante(!1),component_pago.setIsPedidoPagadoFromAPP(isPedidoPagadoFromApp),xValPago.setIsPedidoPagadoFromAPP(isPedidoPagadoFromApp)}content_page.selected=e}async function xRegistrarClientePagoCP(){var e,a,t,o,i;enProcesoGuardarPago||(enProcesoGuardarPago=!0,xPopupLoad.titulo="Guardando...",xPopupLoad.xopen(),i=xRpt_pago[0].cliente,e=""===xRpt_pago[0].idcliente?0:xRpt_pago[0].idcliente,a=xRpt_pago[0].comprobante,t=await ClienteService_Guardar(i),i.idcliente=t,"1"===xdtDpedido[0].pwa_is_delivery.toString()&&(o=xdtDpedido[0].json_datos_delivery.p_header.arrDatosDelivery,i.direccion=(""!==i.direccion?i:o).direccion,i.nombres=""!==i.nombres?i.nombres:o.nombre,i.telefono=o.telefono,i.referencia=o.referencia),e!=t&&xValPago.reloadInputDatalientes(),o=parseInt($("#tb_pedidos .row").length),o-=parseInt($("#tb_pedidos .row.selected1").length),e=await getItemsSeleccionados(),xarr_cliente={cliente:i,i:e.idPedidosSeleccionados},xarr_header={idclie:i.idcliente,ImporteTotal:xMoneda(xtt_pedidos),tipo_consumo:e.tipoConsumo,idPedidoSeleccionados:e.idPedidosSeleccionados,is_from_client_pwa:xdtDpedido[0].is_from_client_pwa},xarr_comprobante=a,xarr_items_seleccionados=e.arrayPedidosSeleccionados,xarr_list_cliente_usuario_pedido=e.arrayIdClienteUsPedido,xarr_tipo_pago=xRpt_pago[0].xtipo_pagos,xarr_subtotal=arrSumSubtTotales,e.esSeleccionTotal&&e.esSeleccionTodoPeidoLista?(i=(t=await goSendPedidoFecht({p_from:"3",p_cliente:xarr_cliente,p_header:xarr_header,p_tipo_pago:xarr_tipo_pago,p_subtotales:xarr_subtotal,p_comprobante:xarr_comprobante})).idregistro_pago,xrpt_correlativo=t.correlativo_comprobante,enProcesoGuardarPago=!1,xRegistrarPagoCM(o),_cpSocketEmitPedidoPagoCliente(xarr_list_cliente_usuario_pedido),xarr_subtotal=darFormatoSubTotalesParaFacturacion(arrSumSubtTotales),xMandarCocinarImpresionComprobante(xrpt_correlativo,i),a={idusuario:idUsuarioOperador,num_pedido:xObj_miPedido.data().numpedido,num_mesa:xObj_miPedido.data().nummesa,importe_restante:0,p_tipo_pago:xarr_tipo_pago},_cpASocketNotifyPayPedido(a)):(o=(t=await goSendPedidoFecht({p_from:"4",p_items_seleccionados:xarr_items_seleccionados,p_cliente:xarr_cliente,p_header:xarr_header,p_tipo_pago:xarr_tipo_pago,p_subtotales:xarr_subtotal,p_comprobante:xarr_comprobante})).idregistro_pago,xrpt_correlativo=t.correlativo_comprobante,enProcesoGuardarPago=!1,xLoadDetallesPedido(xObj_miPedido),_cpSocketPintarPedido(null),_cpSocketEmitPedidoPagoCliente(xarr_list_cliente_usuario_pedido),xarr_subtotal=darFormatoSubTotalesParaFacturacion(arrSumSubtTotales),xMandarCocinarImpresionComprobante(xrpt_correlativo,o),i={idusuario:idUsuarioOperador,num_pedido:xObj_miPedido.data().numpedido,idpedido:xObj_miPedido.data().numpedido,num_mesa:xObj_miPedido.data().nummesa,importe_restante:e.importeTotalSeleccionado,p_tipo_pago:xarr_tipo_pago},_cpASocketNotifyPayPedido(i)),xValPago.setResetFormaPago())}function xRegistrarPagoCM(e){var a=parseInt($(xObj_miPedido).attr("data-nummesa")),t=parseInt($(xObj_miPedido).attr("data-isconfirmarpago"));0==e&&(0!=a&&"0"===t.toString()?($(xObj_miPedido).removeClass("xOcupado"),$(xObj_miPedido).removeClass("xDespachado"),$(xObj_miPedido).addClass("xNeutro"),$(xObj_miPedido).find(".show-led-precuenta").addClass("xInvisible"),$(xObj_miPedido).find(".show-led-reserva").addClass("xInvisible"),$(xObj_miPedido).find(".show-led-print").addClass("xInvisible"),$(xObj_miPedido).find(".show-ico-mozo").addClass("xInvisible"),$(xObj_miPedido).find(".referencia-pedido").addClass("xInvisible"),$(xObj_miPedido).find(".show-mozo-pedido").removeClass("pintar"),$(xObj_miPedido).find("#nommozo").text("."),$(xObj_miPedido).find(".importe").text("."),$(xObj_miPedido).find(".tiempo").text("disponible"),$(xObj_miPedido).attr("data-hora",""),$(xObj_miPedido).attr("data-estado","b"),$(xObj_miPedido).attr("data-abrir-detalle","0"),$(".grid").isotope("updateSortData",$(xObj_miPedido)).isotope("layout")):($(".grid").isotope("remove",$(xObj_miPedido)).isotope("layout"),$(xObj_miPedido).remove()),setTimeout(()=>{xPintaCountAreasMesas()},500)),xPopupLoad.xclose(),xCPcloseDialogDetalle()}async function xMandarCocinarImpresionComprobante(e,a){if(0<xRpt_pago.length){xPopupLoad.xclose();var t=xRpt_pago[0].cliente,o=xRpt_pago[0].comprobante;try{o.correlativo=xCeroIzqNumComprobante(e)}catch(e){}xArrayItemComprobante=xCargarDatosAEstructuraImpresion(checkItemsSeleccionados.arrayPedidosSeleccionados),xCocinarImprimirComprobante(xArrayItemComprobante,arrSumSubtTotales,o,t,a,-2)}xRpt_pago=[]}function isPedidoInMesa(a,e){_fetchApi.axiosExecute({type:"POST",url:"../../bdphp/log.php?op=507",data:{m:e,p:"",confirmar_pago:0,lastIdPedido:lastIdPedidoCobrado}}).then(e=>{$.parseJSON(e).datos[0]||($(a).removeClass("xOcupado"),$(a).removeClass("xDespachado"),$(a).addClass("xNeutro"),$(a).find(".show-led-precuenta").addClass("xInvisible"),$(a).find(".show-led-reserva").addClass("xInvisible"),$(a).find(".show-led-print").addClass("xInvisible"),$(a).find(".show-ico-mozo").addClass("xInvisible"),$(a).find(".referencia-pedido").addClass("xInvisible"),$(a).find(".show-mozo-pedido").removeClass("pintar"),$(a).find("#nommozo").text("."),$(a).find(".importe").text("."),$(a).find(".tiempo").text("disponible"),$(a).attr("data-hora",""),$(a).attr("data-estado","b"),$(a).attr("data-abrir-detalle","0"),$(".grid").isotope("updateSortData",$(a)).isotope("layout"))})}function xLoadDetallesPedido(e,a=!0){var x,_,t,m,u,v;0!=$(e).attr("data-abrir-detalle")&&(lastDataPedidoInsert=a?null:lastDataPedidoInsert,xAgrupar_item_activo=isDeliverySolicitoReparto=isPedidoOpenDeliveryCliente=!1,xPopupLoad.titulo="Cargando...",xPopupLoad.xopen(),xIrPage(0),xObj_miPedido=$(e),xLocal_SubTotal_Quitados="",arrTotalesDeliveryCliente=null,x=$(e).attr("data-nummesa"),_=$(e).attr("data-numpedido"),t=$(e).attr("data-correlativo"),xp_sel_idcategoria=$(e).attr("data-idcat"),m=$(e).attr("data-isconfirmarpago"),u="",u="0"==x?"PEDIDO "+xCeroIzq(t,5):"MESA "+xCeroIzq(x,2),v=!!xdtDpedido&&"1"===xdtDpedido[0]?.pwa_is_delivery,isPedidoOpenDeliveryCliente=v,a?(_fetchApi.axiosExecute({type:"POST",url:"../../bdphp/log.php?op=507",data:{m:x,p:_,confirmar_pago:m,lastIdPedido:lastIdPedidoCobrado}}).then(e=>{var a="",t="";pintarInfoDeliveryCliente="",isLlamoRepartidorRed=isClienteDeliveryFromApp=!1,infoFacturacion="",isPedidoPagadoFromApp="1"===m.toString(),localStorage.setItem("::app3_papp",m.toString()),xdtDpedido=(xdtDpedido=$.parseJSON(e)).datos,xid_pedido_selected=xdtDpedido[0].idpedido;var e="ATENDIDO POR: "+(xdtDpedido[0].nom_usuario||"Cliente")+" | ";v=!!xdtDpedido&&"1"===xdtDpedido[0]?.pwa_is_delivery,isPedidoOpenDeliveryCliente=v,isLlamoRepartidorRed=xdtDpedido&&"1"===xdtDpedido[0]?.flag_solicita_repartidor_papaya||!1,isDeliverySolicitoReparto=isLlamoRepartidorRed,$("#p_correlativo").text("CO-"+xCeroIzq(xdtDpedido[0].correlativo_dia,5)+" | "),$("#p_referencia").text(xdtDpedido[0].referencia+" | "),$("#p_antendido").text(e),datosDelivery=xdtDpedido[0].json_datos_delivery;try{datosDelivery=""!=datosDelivery&&"{}"!=datosDelivery&&"[]"!=datosDelivery?JSON.parse(datosDelivery):null}catch(e){try{datosDelivery=JSON.parse(datosDelivery.replace(/(\r\n|\n|\r)/g,""))}catch(e){datosDelivery=null}}e=!!(xdtDpedido[0].json_datos_delivery=datosDelivery)&&1===parseInt(datosDelivery.p_header.delivery),isPedidoDelivery=e,$("#btnLlamarRepartidorP").addClass("xInvisible"),$("#content-info-delivery").addClass("xInvisible"),$("#showLoadingReparto").addClass("xInvisible"),$("#showRepartoAsignado").addClass("xInvisible"),$("#div-info-delivery-from-app").addClass("xInvisible"),$("#btn_cambiar_mesa").removeClass("xInvisible"),e&&($("#btn_cambiar_mesa").addClass("xInvisible"),isClienteDeliveryFromApp=!!(optionDeliveryCliente=datosDelivery)&&!!optionDeliveryCliente.p_header&&1===optionDeliveryCliente.p_header.isCliente,isComercioServicioDeliveryPropio="1"===xDtSede_cm[0].pwa_delivery_servicio_propio,isDeliveryCalculaCostoEntrega="1"===xDtSede_cm[0].pwa_delivery_hablitar_calc_costo_servicio,isDeliveryCalculaCostoEntregaSoloApp="1"===xDtSede_cm[0].pwa_delivery_habilitar_calc_costo_servicio_solo_app,isPuedeLLamarRepartdiroPapaya="1"===xDtSede_cm[0].pwa_delivery_habilitar_llamar_repartidor_papaya,isClienteDeliveryFromApp&&(isPedidoOpenDeliveryCliente=isClienteDeliveryFromApp,u="Pedido #"+_,pintarInfoDeliveryCliente=optionDeliveryCliente.p_header.arrDatosDelivery.pasoRecoger?"El cliente pasa a recoger. ":xdtDpedido[0].nom_repartidor?"REPARTIDOR: "+xdtDpedido[0].nom_repartidor+" "+xdtDpedido[0].ap_repartidor+". Telefono: "+xdtDpedido[0].tel_repartidor:"",p=optionDeliveryCliente.p_header.arrDatosDelivery.tipoComprobante,l=optionDeliveryCliente.p_header.arrDatosDelivery.metodoPago,c=p?p.dni||"Publico en general "+(p.otro_dato||""):"Publico en general",n=2===l.idtipo_pago?"El pedido YA ESTA pagado, solo recogen.":"El pedido DEBE ser pagado",isPedidoPagadoFromApp=2===l.idtipo_pago,infoFacturacion=" | Facturacion: "+p.descripcion+" "+c+"  |  "+n,t="<p>"+p.descripcion+" "+c+"  </p><strong>"+n+"</strong></p>",arrTotalesDeliveryCliente=isComercioServicioDeliveryPropio?optionDeliveryCliente.p_subtotales:darFormatoSubTotalesDelivery(optionDeliveryCliente.p_subtotales),$("#btnLlamarRepartidorP").removeClass("xInvisible"),(isLlamoRepartidorRed="1"===xdtDpedido[0].flag_solicita_repartidor_papaya)&&!isPuedeLLamarRepartdiroPapaya&&$("#btnLlamarRepartidorP").addClass("xInvisible"),isLlamoRepartidorRed&&$("#showLoadingReparto").removeClass("xInvisible"),xdtDpedido[0].idrepartidor?($("#divRepartidorNom #a_nom_repartidor").text(xdtDpedido[0].nom_repartidor+" "+xdtDpedido[0].ap_repartidor+". Telefono: "+xdtDpedido[0].tel_repartidor),$("#divRepartidorNom").removeClass("xInvisible"),$("#divRepartidorSelect").addClass("xInvisible"),$("#btnLlamarRepartidorP").addClass("xInvisible"),$("#showRepartoAsignado").removeClass("xInvisible"),$("#showLoadingReparto").addClass("xInvisible")):isComercioServicioDeliveryPropio&&!isLlamoRepartidorRed?($("select#selectRepartidor").val(-1),$("#divRepartidorSelect").removeClass("xInvisible"),$("#divRepartidorNom").addClass("xInvisible")):($("#divRepartidorNom").removeClass("xInvisible"),$("#divRepartidorSelect").addClass("xInvisible"),$("#btnLlamarRepartidorP").addClass("xInvisible"),$("#divRepartidorNom #a_nom_repartidor").text("Repartidor no asignado.."),isLlamoRepartidorRed&&$("#showLoadingReparto").removeClass("xInvisible"))),(datosDelivery="object"==typeof datosDelivery&&datosDelivery.p_header?0===datosDelivery.p_header.delivery?null:datosDelivery.p_header.arrDatosDelivery:datosDelivery)?($("#content-info-delivery").removeClass("xInvisible"),datosDelivery.paga_con=datosDelivery.paga_con.replace("undefined",""),l=datosDelivery.num_doc||" | "+datosDelivery.nombre+" | "+datosDelivery.direccion+" | "+datosDelivery.telefono+" | "+datosDelivery.paga_con,$("#txt-info-delivery").text("DELIVERY: "+l+infoFacturacion),datosDelivery.pasoRecoger?(pintarInfoDeliveryCliente="El cliente pasa a recoger. ",$("#divRepartidorPropio").addClass("xInvisible"),$("#btnLlamarRepartidorP").addClass("xInvisible"),a='<p><i class="fa fa-user"></i> '+xdtDpedido[0].referencia+'</p><p><i class="fa fa-phone"></i> '+datosDelivery.telefono+"</p>",t='<p class="badge badge-warning fs-14"><strong> <i class="fa fa-user"></i> El cliente pasa a recoger. <strong></p>'):($("#divRepartidorPropio").removeClass("xInvisible"),p=""===xdtDpedido[0].referencia?datosDelivery.nombre:xdtDpedido[0].referencia,c=datosDelivery.referencia?'<p><i class="fa fa-map-marker"></i> '+datosDelivery.referencia+"</p>":"",a='<p><i class="fa fa-user"></i> '+p+'</p><p><i class="fa fa-map-marker"></i> '+datosDelivery.direccion+"</p>"+c+'<p><i class="fa fa-phone"></i> '+datosDelivery.telefono+"</p>",pintarInfoDeliveryCliente=xdtDpedido[0].nom_repartidor?"REPARTIDOR: "+xdtDpedido[0].nom_repartidor+" "+xdtDpedido[0].ap_repartidor+". Telefono: "+xdtDpedido[0].tel_repartidor:""),t+='<p><strong>Metodo de pago: </strong><span class="badge '+(datosDelivery.metodoPago&&2===datosDelivery.metodoPago.idtipo_pago?"fs-14 badge-info":"badge-secondary")+'">'+datosDelivery.paga_con+"</span></p>",$("#info-comprobante").html(t),$("#info-pedido").html(a),"0"!==xDtSede_cm[0].pwa_delivery_servicio_propio&&"0"!==xdtDpedido[0].flag_solicita_repartidor_papaya||$("#div-info-delivery-from-app").addClass("xInvisible"),"1"===xdtDpedido[0].flag_solicita_repartidor_papaya&&(isDeliverySolicitoReparto=!0,arrTotalesDeliveryCliente=darFormatoSubTotalesComisionRepartidor(xDtSede_cm[0],optionDeliveryCliente.p_subtotales,optionDeliveryCliente.p_header.arrDatosDelivery.costoTotalDelivery,!0)),isPuedeLLamarRepartdiroPapaya&&$("#btnLlamarRepartidorP").removeClass("xInvisible"),xdtDpedido[0].idrepartidor?($("#divRepartidorNom #a_nom_repartidor").text(xdtDpedido[0].nom_repartidor+" "+xdtDpedido[0].ap_repartidor+". Telefono: "+xdtDpedido[0].tel_repartidor),$("#divRepartidorNom").removeClass("xInvisible"),$("#divRepartidorSelect").addClass("xInvisible"),$("#btnLlamarRepartidorP").addClass("xInvisible"),$("#showRepartoAsignado").removeClass("xInvisible"),$("#showLoadingReparto").addClass("xInvisible")):isComercioServicioDeliveryPropio&&!isLlamoRepartidorRed?($("select#selectRepartidor").val(-1),$("#divRepartidorSelect").removeClass("xInvisible"),$("#divRepartidorNom").addClass("xInvisible")):($("#divRepartidorNom").removeClass("xInvisible"),$("#divRepartidorSelect").addClass("xInvisible"),$("#btnLlamarRepartidorP").addClass("xInvisible"),$("#divRepartidorNom #a_nom_repartidor").text("Repartidor no asignado.."),isLlamoRepartidorRed&&$("#showLoadingReparto").removeClass("xInvisible"))):$("#content-info-delivery").addClass("xInvisible"));var o="",i=1;let d=0;for(var r=0;r<xdtDpedido.length;r++){let e="";switch(d+=parseFloat(xdtDpedido[r].permission_delete),xdtDpedido[r].val_color_despachado){case"1":e="xColorRow_verde";break;case"2":e="xColorRow_Ambar";break;case"3":e="xColorRow_Rojo"}var s=""===e?"xColorRow_Plomo":e,s=0<xdtDpedido[r].tiempo_atencion?'<p class="'+e+'">'+xdtDpedido[r].tiempo_atencion+' <span class="xfont11 '+s+'">min</span></p>':"";let a=xdtDpedido[r].nom_usuario,t="fa-user";a=a||"1"!==xdtDpedido[r].flag_is_cliente?primeraConMayusculas(a):(t="fa-mobile text-success fa-2x",""),o=String(o+'<tr class="row selected1 xCursor check_item_p" data-idcategoria="'+xidCategoriaPD+'" data-idpedido="'+xdtDpedido[r].idpedido+'" data-idcliente="'+xdtDpedido[r].idcliente+'" data-idcat="'+xp_sel_idcategoria+'" data-punitario="'+xdtDpedido[r].punitario+'" data-total="'+xdtDpedido[r].total+'" data-m="'+xdtDpedido[0].nummesa+'" data-idtipoconsumo="'+xdtDpedido[0].idtipo_consumo+'" data-nump="'+xdtDpedido[0].numpedido+'" data-correlativo="'+xdtDpedido[0].correlativo_dia+'" data-ref="'+xdtDpedido[0].referencia+'">" data-subtotales_tachados="'+xdtDpedido[0].subtotales_tachados+'"><td><paper-checkbox checked class="check_item"></paper-checkbox>'+i+"</td><td><span>"+xdtDpedido[r].des_pedido+'<span><p class="xfont10 xColorRow_Plomo">'+xdtDpedido[r].referencia+'</p></td><td><span class="fw-100 fs-12 text-secondary text_puntos" title="Usuario"><i class="fa '+t+' pr-1"></i>'+a+"</span></td><td>"+xdtDpedido[r].min_transcurridos+' <span class="xfont11 xColorRow_Plomo">min</span>'+s+'</td><td align="right" class="td_importe" id="td_importe">'+xMoneda(xdtDpedido[r].total)+"</td></tr>"),i++}var n=0<d,l=$(".pos-fotter-btn").find("#btn_punto_verde_pedido"),p=(n?l.removeClass("xInvisible"):l.addClass("xInvisible"),$("#tb_pedidos .row").remove(),$("#tb_pedidos").append(o).trigger("create"),$("#xBody div").remove(),$("#xBody").append('<div><paper-spinner active class="xCentradoVerticalHorizontal"></paper-spinner></div>').trigger("create"),e?($("#xBody").addClass("tall-delivery"),$("#xBodyPedidos").addClass("tall-delivery")):($("#xBody").removeClass("tall-delivery"),$("#xBodyPedidos").removeClass("tall-delivery")),lastDataPedidoInsert?lastDataPedidoInsert.idpedido:0),c=lastDataPedidoInsert?0:x;_fetchApi.axiosExecute({type:"POST",url:"../../bdphp/log.php?op=3051",data:{m:c,p:_,confirmar_pago:m,lastIdPedido:lastIdPedidoCobrado,idpedido:p}}).then(e=>{e=$.parseJSON(e);lastDataPedidoInsert?e.datos.map(e=>{xArrayDtOrdenFiltro.push(e)}):xArrayDtOrdenFiltro=e.datos,xLoadMipedidoBD(xThisCM.xdtPedDet=xArrayDtOrdenFiltro),xSumarTotalPedidos(),xCheckPedidos()}),xPopupLoad.xclose(),xCPopenDialogDetalle(),xThisCM.isAddItemRow=!1,xNuevoPedidoCM(),event.stopPropagation()}),$("#p_mesa").text(u),xGeneralDataCarta||xLoadDataUlAdd()):(xRefreshListaPedidosItems(e),xPopupLoad.xclose()))}function xVerificarCheckPedidos(){xArraychek_pedido=[],$(".check_item_p .check_item").each(function(e,a){a.checked&&xArraychek_pedido.push({idp:$(a).parent().parent().attr("data-idpedido")})})}function xFiltrarRowArray(){var e=xThisCM.xdtPedDet.slice(),e=JSON.parse(JSON.stringify(e));xAgrupar_item_activo=!1,xVerificarCheckPedidos();for(var a=0;a<e.length;a++)for(var t=0;t<xArraychek_pedido.length;t++){if(e[a].idpedido==xArraychek_pedido[t].idp){e[a].visible=0;break}e[a].visible=1}xLoadMipedidoBD(xArrayDtOrdenFiltro=e)}function xDesJuntarItem(){var i,d,r;$("#tb_det_pedidos .row").each(function(e,a){i=parseInt($(a).find("#td_cant").text()),p_total=parseFloat($(a).find("#td_importe").text()),d=0===p_total?0:parseFloat($(a).attr("data-punitario")),r=$(a).attr("data-idpedidodetalle");for(var t=$(a),o=0;0<i;)0<o&&(t=$(a).clone(!0),$(t).find("#checkboxLabel").empty()),p_total-=d,$(t).attr("data-totalr",d),$(t).attr("data-total",d),$(t).attr("data-cantidadr",1),$(t).attr("data-idpedidodetaller",r),$(t).find("#td_cant").text("01").trigger("create"),$(t).find("#td_importe").text(xMoneda(d)),0<o&&$(this).after(t),d=p_total<=0?0:d,o++,i--})}function xJuntarFilasIguales(){var e=xThisCM.xdtPedDet.slice(),e=JSON.parse(JSON.stringify(e)),i="",d="",r="";xAgrupar_item_activo=!0,0===xArraychek_pedido.length&&xVerificarCheckPedidos(),hist=e.map(e=>(e.grupo=e.idtipo_consumo+e.idseccion_index+e.idcarta_lista,e)).filter(e=>e.grupo).reduce(function(e,a){e[xi_grupo=a.grupo]?(xcant_item=parseFloat(e[xi_grupo].cantidad),xptotal_item=parseFloat(e[xi_grupo].ptotal)):(xptotal_item=xcant_item=0,r=d=i=""),i_cantidad=parseFloat(a.cantidad),i_ptotal=parseFloat(a.ptotal),xcant_item+=i_cantidad,xptotal_item+=i_ptotal,i=i+a.idpedido_detalle+"|"+a.idpedido+",",d=d+i_cantidad+",",r=r+i_ptotal+",";var t=a.idtipo_consumo+a.idseccion_index+a.idcarta_lista,o=!1;for(z in xArraychek_pedido){if(a.idpedido==xArraychek_pedido[z].idp){o=!0;break}o=!1}return 1==o&&(e[xi_grupo]||(e[xi_grupo]=a),e[xi_grupo].cantidad=xCeroIzq(xcant_item,2),e[xi_grupo].ptotal=xMoneda(xptotal_item)),e[t].idpedido_detalle_r=i,e[t].cantidad_r=d,e[t].total_r=r,e},{}),xLoadMipedidoBD(xArrayDtOrdenFiltro=hist)}function xLoadMipedidoBD(e){var t,o="",d=(xArrayTpC=[],xArraySeccion=[],""),r=e,s="";for(a in r)null==xArrayTpC[r[a].idtipo_consumo]&&(xArrayTpC[r[a].idtipo_consumo]={id:r[a].idtipo_consumo,des:r[a].des_tp});xArraychek_pedido=[];var n,l,p,c;for(b in xArrayTpC){for(i in o="",xArraySeccion=[],r)xArrayTpC[b].id==r[i].idtipo_consumo&&1!=r[i].visible&&(r[i].procede,1==xAgrupar_item_activo?s="xdisabled":xAgrupar_item_activo="",n=r[i].des_seccion,l=(p="1"==r[i].item_permiso_borrar)?"text-success":"",p=p?"":"xInvisible",c=r[i].precio_default?'<div class="btn-add-item btn-sm-add-row" data-op="itempedido" title="Agregar Uno"><i class="fa fa-plus" data-op="itempedido"></i></div>':'<div class="text-danger"><i class="fa fa-eye-slash" aria-hidden="true" title="Item borrado de la carta"></i></div>',null==xArraySeccion[r[i].idseccion_index]&&(xArraySeccion[r[i].idseccion_index]='<tr><td colspan="5" class="xBold">'+n+"</td></tr>"),n=String('<tr class="row xCursor" data-idpedidodetalle="'+r[i].idpedido_detalle+'" data-i="'+i+'" data-idpedido="'+r[i].idpedido+'" data-idcliente="'+r[i].idcliente+'" data-punitario="'+r[i].punitario+'" data-idtipoconsumo="'+r[i].idtipo_consumo+'" data-idcategoria="'+r[i].idcategoria+'" data-iditem="'+r[i].iditem+'" data-idcartalista="'+r[i].idcarta_lista+'" data-procede="'+r[i].procede+'" data-descontar="'+r[i].descontar_en+'" data-iddescontar="'+r[i].iddescontar+'" data-cant_descontar="'+r[i].cant_descontar+'" data-idpedidodetaller="'+r[i].idpedido_detalle_r+'" data-cantidadr="'+r[i].cantidad_r+'" data-totalr="'+r[i].total_r+'" data-cantidad="'+r[i].cantidad+'" data-total="'+r[i].ptotal+'" data-des_seccion="'+n+'" data-subtotales_tachados="'+r[i].subtotales_tachados+'" data-idbus = "'+r[i].idseccion+'" data-des_tp = "'+r[i].des_tp+'" data-descripcion = "'+r[i].descripcion+'" data-idseccion_index = "'+r[i].idseccion_index+'" data-isalmacen = "'+r[i].isalmacen+'" data-precio_default = "'+r[i].precio_default+'" data-procede_index = "'+r[i].procede_index+'" data-ptotal = "'+r[i].ptotal+'" data-total = "'+r[i].total+'" data-total_r = "'+r[i].total_r+'" data-totalr = "'+r[i].totalr+'" data-is_cantidad_nd = "'+r[i].is_cantidad_nd+'" data-idimpresora_seccion="'+r[i].idimpresora_seccion+'" data-idseccion="'+r[i].idseccion+'" ><td width="50px" class="click_row_dt_p" id="cant_descontar"><paper-checkbox class="check_item"></paper-checkbox><span id="td_cant">'+xCeroIzq(r[i].cantidad,2)+'</span></td><td class="click_row_dt_p" width="50%" id="descripcion_item">'+r[i].descripcion+'</td><td class="click_row_dt_p" align="right" id="td_importe">'+r[i].ptotal+'</td><td align="center" style="width: 35px" class="rowadditem" data-op="itempedido" data-procede=0>'+c+'</td><td align="center" style="width: 20px" class="td_op" data-op="borrar" data-procede=0><i style="font-size: 18px !important" title="Borrar" class="btn-delete-row fa fa-trash-o '+s+" "+l+'">  <i class="fa fa-unlock text-success punto-flotante-verde '+p+'"></i> </i></td></tr>'),xArraySeccion[r[i].idseccion_index]=xArraySeccion[r[i].idseccion_index]+n);for(a in t='<tr><td colspan="5" class="xFondoRowBlanco xBold">'+xArrayTpC[b].des+"</td></tr>",xArraySeccion)o=String(o+xArraySeccion[a]);d=String(d+t+o)}d='<div><table width="100%" id="tb_det_pedidos" class="xRowPading4">'+d+"</table></div>",$("#xBody div").remove(),$("#xBody").html(d).trigger("create")}function xCPAddClassItemPermissionDelete(t){$("#tb_det_pedidos .row").each(function(e,a){$(a).attr("data-idpedidodetalle")==t&&((a=$(a).find(".btn-delete-row")).addClass("text-success"),a.attr("data-item_permiso_borrar",t),$(a).find(".punto-flotante-verde").removeClass("xInvisible"))})}function xCPAddClassItemPermissionAnularPedido(t){$("#tb_pedidos .row").each(function(e,a){a=$(a).attr("data-idpedido");-1<t.split(",").indexOf(a)&&$(".pos-fotter-btn").find("#btn_punto_verde_pedido").removeClass("xInvisible")})}function xLoadDtPrintCM(){xDtPrint=xm_log_get("sede_generales"),xDtSede_cm=xm_log_get("datos_org_all_sede")}function xcronometro_permiso(){0==--xCronometro_us&&clearInterval(xRefreshPermiso)}function xOp_permiso(){var e=localStorage.getItem("::app3_woRestoreStock");switch(check_recuperar_stock.checked=e||!1,check_recuperar_stock_all_pedido.checked=e||!1,xpass_op){case"borrar":xCMCheckPermisoBorrar();break;case"cambiar":$("#txt_bus_cant").val(1),$("#txt_espcificacion").val(""),$("#list_bus_item").val(""),dialog_cambiar_item.open();break;case"anular_pedido":xAnularPedido()}}async function xCMCheckPermisoBorrar(){let a=!1,e=0;try{1===xCompArraySolitaPermiso.tipo_permiso&&(e=xCompArraySolitaPermiso.obj.idpedido_detalle,a=!!xCompArraySolitaPermiso?.obj?.is_cantidad_nd&&"1"===xCompArraySolitaPermiso.obj.is_cantidad_nd),2===xCompArraySolitaPermiso.tipo_permiso&&(e=xCompArraySolitaPermiso.obj.map(e=>e.idpedidos).join(","),a=!!xCompArraySolitaPermiso?.is_cantidad_nd&&"1"===xCompArraySolitaPermiso.is_cantidad_nd)}catch(e){a=!1}var t,o,i;xCompArraySolitaPermiso.isBtnDeleteRowSuccess?!1!==(t=await findStorageSolicudPermisoRemota(e,xCompArraySolitaPermiso.tipo_permiso))?(i=paramsSwalAlert,o=a?"":`<div class="bg-white" style="display: inline; padding: 2px 10px 5px 10px; border-radius: 5px; font-size: 15px;">
																		<paper-checkbox id="check_recuperar_stock_dialog_borrar" checked>Recuperar stock</paper-checkbox>
																	</div>`,i.html=`<div class="p-1" style="overflow: hidden;"><i class="fa fa-trash-o fa-2x text-danger" aria-hidden="true"></i>
                                <p class="mt-1 fs-18">Esta seguro de borrar este registro?</p>
                                ${o}</div>`,i.confirmButtonText="Si, borrar",i.cancelButtonText="Cancelar",i.showCancelButton=!0,(await showAlertSwalHtmlDecision(i)).isConfirmed&&(xPermisoSupervisor=t.idusuario_admin,i=!!o&&check_recuperar_stock_dialog_borrar.checked,1===xCompArraySolitaPermiso.tipo_permiso&&xEliminarItemPedido(i,t.motivo),2===xCompArraySolitaPermiso.tipo_permiso)&&xAnularPedido(i,t.motivo)):(1===xCompArraySolitaPermiso.tipo_permiso&&(a?xGetPermisoEliminarItem():dialog_borrar_item.open()),2===xCompArraySolitaPermiso.tipo_permiso&&dialog_motivo_anular.open()):a?xGetPermisoEliminarItem():dialog_borrar_item.open()}function xGetPermisoEliminarItem(){var e=check_recuperar_stock.checked?"1":"0";localStorage.setItem("::app3_woRestoreStock",e),0<xCronometro_us&&30!=xCronometro_us?(xPermisoSupervisor=xIdUsuario,xEliminarItemPedido()):(xPSupervisor.solicitarPermisoRemoto(!0),xPSupervisor.setVal("Pe1"),pass_us.open())}function xGoProcessBorrar(){switch(xpass_op){case"borrar":xEliminarItemPedido();break;case"anular_pedido":xAnularPedido()}}function xEliminarItemPedido(e=null,a=""){e=(null!==e?e:check_recuperar_stock.checked)?"1":"0";xPopupLoad.xopen(),_fetchApi.axiosExecute({type:"POST",url:"../../bdphp/log.php?op=3042",data:{xarr:xArrayItemEliminar,u:xPermisoSupervisor,xisRecuperarStock:e,xMotivo:a}}).then(e=>{var a,t,o,i,d;(xe_rpt=$.parseJSON(e)).success?(a=parseFloat(xobj_row_item.find("#td_cant").text()),o=(t=xBuscarAttrTbData($("#tb_pedidos"),"data-idpedido",xArrayItemEliminar.idpedido)).find("#td_importe").text(),i=xobj_row_item.attr("data-i"),a--,d=parseFloat(xArrayItemEliminar.precio_total),0==a&&(t.find("#td_importe").text("0"),$(xobj_row_item).fadeTo(500,0,function(){$(this).remove()}),xThisCM.xdtPedDet[i].visible=1),0<d&&(i=parseFloat(xArrayItemEliminar.precio_total-xArrayItemEliminar.precio_unitario),xobj_row_item.find("#td_importe").text(xMoneda(i)),$(xobj_row_item).attr("data-totalr",i),$(xobj_row_item).attr("data-total",i),$(xobj_row_item).attr("data-cantidad",a),$(xobj_row_item).attr("data-cantidadr",a),o=parseFloat(o-xArrayItemEliminar.precio_unitario),t.find("#td_importe").text(xMoneda(parseFloat(xMoneda(o)))),o<=0)&&$(t).fadeTo(500,0,function(){$(this).remove()}),xobj_row_item.find("#td_cant").text(xCeroIzq(a,2)),setTimeout(()=>{xSumarTotalPedidos(1)},550),xPopupLoad.xclose(),d={nummesa:xObj_miPedido.data().nummesa,numpedido:xObj_miPedido.data().numpedido},cocinarImpresionAnulacionOne(xArrayItemEliminar,xPermisoSupervisorNombre,xNomU,d,!0),xShowCantidadPedidosBorrados()):alert(e.error)})}function xReImprimir(){dialog_erro_print.close(),xPopupLoad.titulo="Enviando...",xPopupLoad.xopen(),(0<xDtSubTotales.length?xLLamarPrintAddLi:xLLamarPrint)()}function xLLamarPrint(){xPopupLoad.xopen(),xPopupLoad.titulo="Enviando...";var e=$("#p_mesa").text(),a=$("#p_correlativo").text();xArrayEnca={m:e,correlativo_dia:a,item:xitem_print},_fetchApi.axiosExecute({type:"POST",url:"../../print/print3_1.php",data:{Array_enca:xArrayEnca,Array_print:xDtPrint}}).then(e=>{xPopupLoad.xclose(),-1!=e.indexOf("Error")?($("#print_error").text(e),dialog_erro_print.open()):(xPopupLoad.titulo="Exito!",setTimeout(function(){xCPcloseDialogDetalle()},1e3))})}function xLLamarPrintAddLi(){xArrayPrintEncaLi.solo_llevar=0,xArrayPrintEncaLi.reservar=0,xPopupLoad.titulo="Enviando...",_fetchApi.axiosExecute({type:"POST",url:"../../print/print3.php",data:{Array_enca:xArrayPrintEncaLi,Array_print:xDtPrint,ArrayItem:xArrayPedidoObj,ArraySubTotales:xDtSubTotales}}).then(e=>{xPopupLoad.xclose(),-1!=e.indexOf("Error")?($("#print_error").text(e),dialog_erro_print.open()):(xPopupLoad.titulo="Exito!",xNuevoPedidoCM())})}function xValidarCant_change(e){parseInt($(e).val())>parseInt($(e).attr("max"))&&$(e).val($(e).attr("max"))}async function xSumarTotalPedidos(e,a){var p=xtt_pedidos=0,t=$("#tb_pedidos"),t=($("#tb_pedidos .total").remove(),xtt_pedidos=xSumaCantRow(t,".td_importe"),t=$("#tb_det_pedidos"),p=xSumaCantRow(t,".td_importe"),(checkItemsSeleccionados=await getItemsSeleccionados()).arrayPedidosSeleccionados),o=xCargarDatosAEstructuraImpresion(t),o=xArmarSubtotalesArray(o,t.importeTotalSubItemSeleccionados),c=(xLocal_xDtSubTotales_cp=xLocal_xDtSubTotales,xImporteTotalSeleccionados=checkItemsSeleccionados.esSeleccionTotal?o:xImporteTotalSeleccionados,isPedidoOpenDeliveryCliente&&arrTotalesDeliveryCliente?(arrSumSubtTotales=addCostoDeliveryArrTotal(xLocal_xDtSubTotales_cp,arrTotalesDeliveryCliente,isComercioServicioDeliveryPropio,isDeliveryCalculaCostoEntrega,isDeliveryCalculaCostoEntregaSoloApp,isDeliverySolicitoReparto,isClienteDeliveryFromApp),xImporteTotalSeleccionados=getImporteTotalSubTotalesDelivery(arrSumSubtTotales)):arrSumSubtTotales=xLocal_xDtSubTotales_cp,"");(xLocal_xDtSubTotales_cp=arrSumSubtTotales=a?arrSubtTotalesDescuento:arrSumSubtTotales).forEach((e,a)=>{var t,o,i,d="",r="",s=e.tachado?"xTachar":"",n=e.tachado?"Add":"Quitar",l=e.tachado?e.importe_tachado:parseFloat(e.importe).toFixed(2),a=e.quitar?'<span data-tachado="'+e.tachado+'" class="xCursor xBold xColorRow_Azul xfont11" title="no cobrar" onclick="quitarSubTotal(this, '+a+')"> '+n+" </span>":"";"TOTAL"===e.descripcion.toUpperCase()?(r="tt_importe_pagar_t",o="",t="xfont18 xBold",i="IMPORTE A PAGAR",p=parseFloat(e.importe).toFixed(2)):(t="xfont15",i=e.descripcion.toUpperCase(),d="subtotal-tr-row"),c=c+'<tr class="total '+s+'"><td colspan="4" class="'+d+'"><p class="'+o+'">'+i+" "+a+'</p></td><td align="right" class="'+d+'"><p class="'+t+' xColorRow_Azul" id="'+r+'">'+l+"</p></td></tr>"}),t=String('<tr class="total"><td colspan="4">CONSUMO TOTAL</><td align="right"><P class="xfont18" id="tt_consumo_t"><b>'+xMoneda(xtt_pedidos)+"</b></p></td></tr>"),o=parseFloat(xImporteTotalSeleccionados)-parseFloat(p),t=String(t+c+'<tr class="total"><td colspan="4">DIFERENCIA</><td align="right"><P class="xfont18 xColorRow_Rojo"><b>'+xMoneda(ImporteDiferencia=a?0:o)+"</b></p></td></tr>"),$("#tb_pedidos").append(t).trigger("create"),xtt_pedidos=p,xThisCM.importeTotalPedido=xtt_pedidos,0!=parseFloat(xtt_pedidos)||0!=o||a?$(xObj_miPedido).find(".importe").text(xMoneda(xtt_pedidos)):($(xObj_miPedido).removeClass("xOcupado"),$(xObj_miPedido).removeClass("xDespachado"),$(xObj_miPedido).addClass("xNeutro"),$(xObj_miPedido).find(".show-led-precuenta").addClass("xInvisible"),$(xObj_miPedido).find(".show-led-reserva").addClass("xInvisible"),$(xObj_miPedido).find(".show-led-print").addClass("xInvisible"),$(xObj_miPedido).find(".show-ico-mozo").addClass("xInvisible"),$(xObj_miPedido).find(".referencia-pedido").addClass("xInvisible"),$(xObj_miPedido).find(".show-mozo-pedido").removeClass("pintar"),$(xObj_miPedido).find("#nommozo").text("."),$(xObj_miPedido).find(".importe").text("."),$(xObj_miPedido).find(".tiempo").text("disponible"),$(xObj_miPedido).attr("data-hora",""),$(xObj_miPedido).attr("data-estado","b"),$(xObj_miPedido).attr("data-abrir-detalle","0"),$(".grid").isotope("updateSortData",$(xObj_miPedido)).isotope("layout"),xCPcloseDialogDetalle()),a||xCompDescuentoPedido.reset()}function quitarSubTotal(e,a){const i=e.dataset.tachado;var d=xLocal_xDtSubTotales_cp[a].id||"";"true"===i?(d+=",",xLocal_SubTotal_Quitados=xLocal_SubTotal_Quitados.replace(d,""),xLocal_xDtSubTotales_cp[a].tachado=!1,e.dataset.tachado=!1,xLocal_xDtSubTotales_cp[a].importe_tachado=parseFloat()):(xLocal_SubTotal_Quitados+=d+",",xLocal_xDtSubTotales_cp[a].tachado=!0,xLocal_xDtSubTotales_cp[a].importe_tachado=xLocal_xDtSubTotales_cp[a].importe,e.dataset.tachado=!0),$("#tb_det_pedidos .row").each(function(e,a){var t=$(a).attr("data-i"),o=$(a).attr("data-subtotales_tachados"),o="true"===i?o.replace(d,""):o+d+",";$(a).attr("data-subtotales_tachados",o),xThisCM.xdtPedDet[t].subtotales_tachados=o}),xSumarTotalPedidos()}function xOrdenPedido(e){switch(e){case 0:$(".grid").isotope({sortBy:["tpc","numero","estado"]});break;case 1:$(".grid").isotope({sortBy:["tpc","estado","numero"]})}}function xFiltroPedidos(e){xbuscar_mesa=!1,$("#div_filtro_header").removeClass("xInvisible"),$("#control-delivery-new-view").addClass("xInvisible"),$("#btn_vista_delivery").addClass("xInvisible"),$("#_gridCM").removeClass("xInvisible"),$("#div_filtro_header").removeClass("xInvisible");var a=window.location.href;if(xDesFiltro1=$(e).find(".titulo").text(),xIdFiltro1=$(e).attr("data-id"),xThisCM.showVisibleAreaMesas="local"===xDesFiltro1.toLowerCase(),$("#Titulo_page").text("PEDIDOS | "+xDesFiltro1),"delivery"===xDesFiltro1.toLowerCase()){xbuscar_mesa=!0,$("#btn_vista_delivery").removeClass("xInvisible"),$("#_gridCM").addClass("xInvisible"),$("#control-delivery-new-view").removeClass("xInvisible"),$("#div_filtro_header").addClass("xInvisible");try{document.getElementById("comp-control-delivery").ini()}catch(e){}}-1==a.indexOf("c_pedido")&&xOpenPage(2,"?f1="+xIdFiltro1+"?df1="+xDesFiltro1),xIdFiltro1=".tpc"+xIdFiltro1,iIniIsotope?$(".grid").isotope({filter:xIdFiltro1}):iIniIsotope=!0}function xVistaAnteriorDelivery(){$("#btn_vista_delivery").addClass("xInvisible"),$("#_gridCM").removeClass("xInvisible"),$("#control-delivery-new-view").addClass("xInvisible"),$(".grid").isotope()}async function xLoadMesas(){$(".grid").html('<paper-spinner active class="xCentradoVerticalHorizontal"></paper-spinner>').trigger("create"),$(".grid").isotope("destroy"),xPintarMesas(),xLogRun_CuentaNumeroPedidos(),xVerificarCajaAbiertaOtroUsuario()}function xGetAreaMesas(){return document.getElementById("comp-area-mesas").getDataListAreas()}function xPintarMesas(){var e=xGetAreaMesas(),a=0<e.length,t=xm_log_get("estructura_pedido").filter(e=>"LOCAL"===e.titulo).map(e=>e.idtipo_consumo)[0],o="tpc"+(t=t||(t=xm_log_get("estructura_pedido")[0]).idtipo_consumo);xIdFiltro1=t;let i="",d="";if(a)for(var r of e){d=""===d?"."+r.title:d;for(let e=parseInt(r.desde);e<=parseInt(r.hasta);e++)xtxtEstado="xNeutro",n=e,i=String(i+'<div class="xMiCardPedido xNeutro '+o+" "+r.title+'" data-estado="b" data-tpc="'+o+'" data-abrir-detalle=0 data-area="'+r.title+'" data-idarea="'+r.idarea_mesa+'"><div class="show-led-print xInvisible" title="Impreso"> <i class="fa fa-print"></i> </div><div><div class="show-led-precuenta xInvisible" title="Precuenta"><i class="fa fa-pencil-square-o"></i></div><p class="show-mozo-pedido" title="Atendido por"><span class="fs-8 pr-1 show-ico-mozo xInvisible"><i class="fa fa-user-circle"></i></span> <span id="nommozo">-</span></p><div class="show-led-reserva xInvisible" title="Reserva"><i class="fa fa-tag"></i></div></div><p class="tipo text-secondary">Mesa</p><p class="numero fs-28 p-2">'+xCeroIzq(n,2)+'</p><div class="xInvisible referencia-pedido"></div><p class="tiempo xfont11">disponible</p><p class="importe xBold">-</p></div>')}else for(var s=parseInt(xm_log_get("datos_org_all_sede")[0].mesas),n=1,l=0;l<s;l++)xtxtEstado="xNeutro",i=String(i+'<div class="xMiCardPedido xNeutro '+o+'" data-estado="b" data-tpc="'+o+'" data-abrir-detalle=0><div class="show-led-print xInvisible" title="Impreso"> <i class="fa fa-print"></i> </div><div><div class="show-led-precuenta xInvisible" title="Precuenta"><i class="fa fa-pencil-square-o"></i></div><p class="show-mozo-pedido" title="Atendido por"><span class="fs-8 pr-1 show-ico-mozo xInvisible"><i class="fa fa-user-circle"></i></span> <span id="nommozo">-</span></p><div class="show-led-reserva xInvisible" title="Reserva"><i class="fa fa-tag"></i></div></div><p class="tipo text-secondary">Mesa</p><p class="numero fs-28 p-2">'+xCeroIzq(n,2)+'</p><div class="xInvisible referencia-pedido"></div><p class="tiempo xfont11">disponible</p><p class="importe xBold">-</p></div>'),n++;xIdFiltro1=-1<xIdFiltro1.indexOf("tpc")?xIdFiltro1:".tpc"+xIdFiltro1,xIdFiltro1=""!=d?xIdFiltro1+d:xIdFiltro1,$(".grid").html(i).trigger("create"),$(".grid").isotope({itemSelector:".xMiCardPedido",layoutMode:"masonry",percentPosition:!0,getSortData:{tpc:"[data-tpc]",numero:".numero parseInt",estado:"[data-estado]",area:"[data-area]"},sortBy:["tpc","numero","estado"],filter:xIdFiltro1,masonry:{horizontalOrder:!0}}),iIniIsotope=!0,xPintarEstadoPedido()}function xPintarEstadoPedido(o=0){var e=xm_log_get("estructura_pedido").filter(e=>"LOCAL"===e.titulo).map(e=>e.idtipo_consumo)[0],f=(xIdFiltro1=e,parseInt(xm_log_get("datos_org_all_sede")[0].mesas),"tpc1");"object"==typeof o&&(o.lastIdPedido=lastIdPedidoCobrado),_fetchApi.axiosExecute({type:"POST",url:"../../bdphp/log.php?op=501",isShowPreload:!1,data:{objPedido:o}}).then(e=>{var t,d,r=JSON.parse(e),b=0;if(xCadenaNewItem="",r=r.datos.map(e=>(e.actualizado=!1,e)),!pasoRedibujado){$(".xMiCardPedido .numero").each(function(e,a){0;const o=$(a).parent();if(a.textContent,d=r.filter(e=>xCeroIzq(e.nummesa,2)===a.textContent||xCeroIzq(e.correlativo_dia,4)===a.textContent)[0])if("1"===d.confirmar_pago&&"0"!==d.nummesa)isPedidoInMesa(o,d.nummesa);else{if(t=0===parseInt(d.despachado)?"":"xDespachado",d.hora,o.removeClass("xNeutro"),o.removeClass("xDespachado"),o.addClass("xOcupado"),o.addClass("xCursor"),o.addClass(t),o.find(".show-ico-mozo").removeClass("xInvisible"),o.find(".show-led-print").removeClass("xInvisible"),o.find(".show-mozo-pedido").addClass("pintar"),"1"===d.is_precuenta.toString()?o.find(".show-led-precuenta").removeClass("xInvisible"):o.find(".show-led-precuenta").addClass("xInvisible"),"1"===d.is_printer.toString()&&o.find(".show-led-print").removeClass("xInvisible"),d.referencia&&""!==d.referencia){var i=primeraConMayusculas(d.referencia.replace(/^,/,"")).split(",");let t="";i.forEach((e,a)=>{t=t+'<p class="show-referencia-pedido">'+e+"</span>"}),o.find(".referencia-pedido").removeClass("xInvisible"),o.find(".referencia-pedido").html(t),o.find(".referencia-pedido").trigger("create")}else o.find(".referencia-pedido").addClass("xInvisible");b="DELIVERY"===d.des_tipo_consumo.toUpperCase()?"-":"S/. "+xMoneda(xArmarSubtotalesFromTotal(d)),o.find(".importe").text(b),o.attr("data-hora",d.hora),o.attr("data-p",d.idpedido),o.attr("data-nummesa",d.nummesa),o.attr("data-isconfirmarpago",d.confirmar_pago),o.attr("data-numpedido",d.numpedido),o.attr("data-correlativo",d.correlativo_dia),o.attr("data-estado","a"),o.attr("data-abrir-detalle","1"),o.click(function(e){lastDataPedidoInsert=null,xLoadDetallesPedido(o),e.stopPropagation(),e.stopImmediatePropagation()}),o.find("#nommozo").text(d.nommozo),"1"===d.reserva&&o.find(".show-led-reserva").removeClass("xInvisible"),d.actualizado=!0}});var P="";if(!pasoRedibujado){try{r.filter(e=>"1"==e.confirmar_pago).map(e=>{var a=document.getElementById(e.idpedido);a&&(a=$(a),"0"==e.nummesa?(a.addClass("xInfo"),a.find(".iconPedido").addClass("fa fa-credit-card fa-2x"),a.find(".tipo").text("Pago App")):(e.actualizado=!0,e.dibujado=!0))})}catch(e){}r.filter(e=>!e.actualizado).map(t=>{if(!t.dibujado){$(".xMiCardPedido .tipo").each(function(e,a){"mesa"!==a.textContent.toLowerCase()&&(a=a.parentElement.parentElement).dataset.numpedido===t.numpedido&&$(".grid").isotope("remove",$(a)).isotope("layout")});var a=t.json_datos_delivery;try{t.json_datos_delivery=""!=a&&"{}"!=a&&"[]"!=a?JSON.parse(a):null}catch(e){t.json_datos_delivery=JSON.parse(a.replace(/(\r\n|\n|\r)/g,""))}P="",f=t.idtipo_consumo,f="tpc"+(f=1===parseInt(t.reserva)?"99":f);var a="xOcupado ",e="a",o='<i class="iconPedido"></i>',i=(t.idpedido,t.json_datos_delivery&&t.json_datos_delivery.p_header&&t.json_datos_delivery.p_header.arrDatosDelivery.metodoPago&&(a=2===t.json_datos_delivery.p_header.arrDatosDelivery.metodoPago.idtipo_pago?"xWarning ":"xOcupado ",t.json_datos_delivery.p_header.arrDatosDelivery.pasoRecoger&&(a="xWarning ",t.json_datos_delivery.p_header.arrDatosDelivery.nombre,o='<i class="iconPedido fa fa-user fa-2x"></i>',e="r"),t.json_datos_delivery.p_header.arrDatosDelivery.tiempoEntregaProgamado&&t.json_datos_delivery.p_header.arrDatosDelivery.tiempoEntregaProgamado.modificado&&(a="xWarning ",t.json_datos_delivery.p_header.arrDatosDelivery.nombre,t.idpedido,o='<i class="iconPedido fa fa-clock-o fa-2x"></i>',t.json_datos_delivery.p_header.arrDatosDelivery.tiempoEntregaProgamado.dia,t.json_datos_delivery.p_header.arrDatosDelivery.tiempoEntregaProgamado.hora,e="p"),2===t.json_datos_delivery.p_header.arrDatosDelivery.metodoPago.idtipo_pago)&&(a="xOcupado ",t.json_datos_delivery.p_header.arrDatosDelivery.nombre,t.idpedido,e="t"),"otroCard "),d=(t.reserva=t.reserva||"0","0"===t.reserva.toString()&&"LOCAL"===t.tipo_consumo_titulo.toUpperCase()?"":xCeroIzq(t.correlativo_dia,4)),r='<p class="tiposubt fs-11 fw-100">ID:'+t.idpedido+" F: "+(t.fecha+" "+t.hora)+"</p>",s=""===d?"Mesa ":"Pedido",n=`<p class="refTitulo fs-17 pb-2 pt-2">${""===t.referencia?".":xMayusculaPrimera(t.referencia.toLowerCase())}</p>`,l="Atendido por: "+(l=t.nommozo?xMayusculaPrimera(t.nommozo.toLowerCase()):"Cliente"),p=!!t.json_datos_delivery&&!!t.json_datos_delivery.p_header&&1===t.json_datos_delivery.p_header.isCliente,c=1===t?.json_datos_delivery?.p_header?.delivery,x=p?'<span class="badge badge-success mr-1">APP</span>':"-",_='<i class="fa fa-shopping-bag ml-2 text-secondary" aria-hidden="true"></i>',m=2===t?.json_datos_delivery?.p_header?.arrDatosDelivery?.metodoPago?.idtipo_pago,u=m?'<span class="badge badge-info">Tarjeta</span>':"-";if(p&&!m){var v=t?.json_datos_delivery?.p_header?.arrDatosDelivery?.metodoPago?t?.json_datos_delivery?.p_header?.arrDatosDelivery?.metodoPago.descripcion:"";if(""!==v)switch(v.toLowerCase()){case"efectivo":u='<span class="badge badge-secondary">Efectivo</span>';break;case"yape":u='<span class="badge badge-warning">Yape</span>';break;default:u='<span class="badge badge-danger">'+v+"</span>"}}c&&(_='<i class="fa fa-motorcycle ml-2 text-secondary" aria-hidden="true"></i>'),1===parseInt(t.reserva)&&(_='<i class="fa fa-clock-o ml-2 text-secondary" aria-hidden="true"></i>'),"-"===(b="DELIVERY"===t.des_tipo_consumo.toUpperCase()?"-":"S/. "+xMoneda(xArmarSubtotalesFromTotal(t)))&&(b="S/. "+xMoneda(t?.json_datos_delivery?.p_subtotales.pop().importe));p="xInvisible";"1"===t.is_printer.toString()&&(p=""),"1"===t.confirmar_pago.toString()&&"0"!==t.nummesa.toString()&&(_='<i class="iconPedido fa fa-credit-card fa-2x"></i>',a="xInfo ",s=r=i="",n=`<p class="refTitulo fs-28 pb-2 pt-2">${xCeroIzq(t.nummesa,2)}</p>`,e="t",P="Mesa Pago App",u=x=l=""),xCadenaNewItem=String(xCadenaNewItem+'<div class="xMiCardPedido xOcupado '+i+a+f+' xCursor" id="'+t.idpedido+'" data-estado="'+e+'" data-tpc="'+f+'" data-hora="'+t.hora+'" data-p="'+t.idpedido+'" data-nummesa="'+t.nummesa+'" data-correlativo="'+t.correlativo_dia+'" data-isconfirmarpago="'+t.confirmar_pago+'" data-numpedido="'+t.numpedido+'"  data-abrir-detalle="1" onclick="xLoadDetallesPedido(this)"><div class="content-a">'+o+'<div class="show-led-print '+p+'" title="Impreso"> <i class="fa fa-print"></i> </div><p class="tipo fw-600">'+s+" "+d+_+"</p>"+r+n+'<p class="tiempo xfont11"></p>'+P+'<p class="fs-11">'+l+'</p></div><div class="content-b"><div class="d-flexx justify-content-center">'+x+u+'</div><div class="content-importe"><p class="importe xBold fs-15">'+b+"</p></div></div></div>"),t.dibujado=!0,t.actualizado=!0}}),0<r.length&&(r[r.length-1].actualizado=!0),""!=xCadenaNewItem&&(e=$(xCadenaNewItem),$(".grid").append(e).isotope("appended",e)),pasoRedibujado=iIniIsotope=!0,setTimeout(()=>{pasoRedibujado=!1},500),xCadenaNewItem="";const a=[];r.map(e=>{e=0==e.nummesa?"|"+xCeroIzq(e.correlativo_dia,4)+"|":"|"+xCeroIzq(e.nummesa,2)+"|";a.push(e)}),0===o&&xResetMesaDefault(a.join(",")),$(".grid").isotope("updateSortData"),setTimeout(()=>{$(".grid").isotope("layout")},1e3)}}}),setTimeout(()=>{xPintaCountAreasMesas()},500)}function _cpSocketPintarPedido(e){pNotificaNuevoPedido(e);var a=0;e&&(a=e.idpedido?e.isFromVR?{idpedido:e.idpedido,nummesa:""===e.m?0:e.m}:{idpedido:e.idpedido,nummesa:""===e.p_header.m?0:e.p_header.m}:{idpedido:(e=JSON.parse(e.detalle_json)).Array_enca.idpedido,nummesa:""===e.Array_enca.m?0:e.Array_enca.m}),lastIdPedidoPrint!==a.idpedido&&(lastIdPedidoPrint=a.idpedido,setTimeout(()=>{lastIdPedidoPrint=0},600),pasoRedibujado=!1,xPintarEstadoPedido(a))}async function xPintaCountAreasMesas(){for(var e=document.querySelectorAll(".xMiCardPedido.xOcupado"),a={},t=0;t<e.length;t++)a[o=e[t].getAttribute("data-idarea")]||(a[o]=0),a[o]++;var o,i=document.getElementById("comp-area-mesas");for(o in i.resetAreaCounts(),a)i.setCountArea(o,a[o])}function _cpSocketPintarFlagPedidoImpreso(e){(e=JSON.parse(e)).map(e=>{e=xBuscarPedidoDom((pedidoEnca=e.item.data.Array_enca).m,pedidoEnca.num_pedido);e&&""!==$(e).find(".importe").val()&&$(e).find(".show-led-print").removeClass("xInvisible")})}function xBuscarPedidoDom(t="0",o="0"){var i;return t=parseInt(t),o=parseInt(o),0!==t?$(".xMiCardPedido").each((e,a)=>{parseInt(a.dataset.nummesa)===t&&(i=a)}):$(".xMiCardPedido").each((e,a)=>{parseInt(a.dataset.numpedido)===o&&(i=a)}),i}function _cpSocketPintarNumerosPagosNotificados(){var e=$("#labelPagoFromApp"),a=parseInt(e.find(".xIndicadorCant-no-remove").text()),a=isNaN(a)?0:a;a++,e.find(".xIndicadorCant-no-remove").remove(),e.append('<span class="xIndicadorCant-no-remove">'+a+"</span>").trigger("create")}function xLogRun_CuentaNumeroPedidos(){isSocket||"undefined"!=typeof EventSource&&((xsourceEvent=new EventSource("../../bdphp/log_run.php?op=1")).onmessage=function(e){e.data!==xValCountPedidos&&(xValCountPedidos=e.data,firstLoad_mesas?firstLoad_mesas=!1:xActualizarItems())})}function xVerificarSiActualizaItems(){isSocket||_fetchApi.axiosExecute({type:"POST",url:"../../bdphp/log.php?op=50101"}).then(e=>{(e=parseInt(e))!=xCountTotalPedidos&&(xCountTotalPedidos=e,xActualizarItems())})}function xActualizarItems(){isSocket||xPintarEstadoPedido()}function xResetMesaDefault(o){$(".xMiCardPedido.xOcupado .numero").each(function(e,a){var t=$(a).parent(),a="|"+a.textContent+"|";6!==a.length&&-1===o.indexOf(a)&&(t.removeClass("xOcupado"),t.removeClass("xDespachado"),t.removeClass("xCursor"),t.addClass("xNeutro"),t.find(".show-led-precuenta").addClass("xInvisible"),t.find(".show-led-reserva").addClass("xInvisible"),t.find(".importe").text("-"),t.find(".tiempo").text("disponible"),t.attr("data-abrir-detalle","0"),t.attr("data-estado","b"),t.removeAttr("data-p"),t.removeAttr("data-hora"),t.removeAttr("data-numpedido"),t.removeAttr("data-correlativo"))}),$(".grid").isotope("updateSortData")}function xRefreshPedidoPaySocket(e){var a=xBuscarPedidoDom(e.num_mesa,e.num_pedido);if(a){a=$(a);if(0===e.importe_restante){if(0===e.num_mesa)return a.remove(),void $(".grid").isotope("updateSortData");a.removeClass("xOcupado"),a.removeClass("xDespachado"),a.removeClass("xCursor"),a.addClass("xNeutro"),a.find(".show-led-precuenta").addClass("xInvisible"),a.find(".show-led-reserva").addClass("xInvisible"),a.find(".show-led-print").addClass("xInvisible"),a.find(".show-ico-mozo").addClass("xInvisible"),a.find(".referencia-pedido").addClass("xInvisible"),a.find(".show-mozo-pedido").removeClass("pintar"),a.find("#nommozo").text("."),a.find(".importe").text("-"),a.find(".tiempo").text("disponible"),a.attr("data-abrir-detalle","0"),a.attr("data-estado","b"),a.removeAttr("data-p"),a.removeAttr("data-hora"),a.removeAttr("data-numpedido"),a.removeAttr("data-correlativo")}else{e=parseFloat(a.find(".importe").text().replace("S/. ",""))-e.importe_restante;a.find(".importe").text("S/. "+e.toFixed(2))}$(".grid").isotope("updateSortData")}}function xCalcularTiempoPedido(){var d,t=new Array;for(a in $(".xMiCardPedido.xOcupado").each(function(e,i){d=$(i).attr("data-hora"),xidtpc_item=(xidtpc_item=$(i).attr("data-tpc")).replace("tpc",""),isNaN(parseInt(t[xidtpc_item]))&&(t[xidtpc_item]=0),t[xidtpc_item]=parseInt(t[xidtpc_item])+1,xTiempoTranscurridos_2(d,function(e,a,t,o){d=xTiempoDe_MS_Hora(o),$(i).find(".tiempo").text(d)})}),$("#list_menu_lateral .xIndicadorCant").each(function(e,a){$(a).remove()}),t){var e="#DesTPC"+a;$(e).find("div .xIndicadorCant").remove(),$(e).find("div").append('<span class="xIndicadorCant">'+t[a]+"</span>").trigger("create")}}function xLoadItems_add(){_fetchApi.axiosExecute({type:"POST",url:"../../bdphp/log.php?op=901"}).then(dtConsumo=>{var xcadenaConsumo="",xdtConsumo=$.parseJSON(dtConsumo),xdtPro=eval(JSON.stringify(xdtConsumo.datos).replace(/descripcion/g,"label").replace(/idt/g,"value"));const _objListProductoVenta=$("#ListProductoVenta");_objListProductoVenta.autocomplete({autoFocus:!0,source:xdtPro,select:function(e,a){return _objListProductoVenta.val(a.item.label),_objListProductoVenta.attr("data-value",a.item.value),_objListProductoVenta.attr("data-tipo",a.item.tipo),_objListProductoVenta.attr("data-idproductodetalle",a.item.idproducto_detalle),$("#pventa").val(a.item.precio),!1},focus:function(e,a){return!1},change:function(e,a){return null===a.item&&_objListProductoVenta.attr("data-value",""),!1}})})}function getAllRepartidor(){_fetchApi.axiosExecute({type:"POST",url:"../../bdphp/log_005.php?op=13"}).then(e=>{e=$.parseJSON(e),xThisCM.listRepartidor=e.datos})}function selectRepartidor(){var e=xThisCM.$.selectRepartidor.value;const t=xThisCM.listRepartidor[e];_fetchApi.axiosExecute({type:"POST",url:"../../bdphp/log_005.php?op=1301",data:{idrepartidor:t.idrepartidor,idpedido:xid_pedido_selected}}).then(e=>{xdtDpedido[0].idrepartidor=t.idrepartidor,_cpSocketNoiticaRepartidorFromComercio(xdtDpedido[0]);try{var a=[{nombre:xdtDpedido[0].json_datos_delivery.p_header.arrDatosDelivery.nombres,telefono:xdtDpedido[0].json_datos_delivery.p_header.arrDatosDelivery.telefono,establecimiento:xdtDpedido[0].json_datos_delivery.p_header.arrDatosDelivery.establecimiento.nombre,idpedido:xdtDpedido[0].idpedido,repartidor_nom:t.nombre,repartidor_telefono:t.telefono}];_cpSocketNoiticaClienteRepartidorAsignado(a)}catch(e){}})}function xCallRepartidorPapaya(){var e=optionDeliveryCliente.p_header.arrDatosDelivery.costoTotalDelivery,a=parseFloat(e).toFixed(2);isNaN(a)?($("#dialog_info_call_repartidor #msj_dialo_call").text("No es posible llamar repartidor ya que la direccion que indico no esta georeferenciada, solicite a soporte tecnico habilitar esta opción."),$("#btnConfirmaCallReparto").addClass("xInvisible")):($("#dialog_info_call_repartidor #msj_dialo_call").text(`Deseo Solicitar un repartidor de Papaya Express para este pedido. Al confirmar no podra asignar este pedido a ningún otro repartidor.
					Ademas el comercio asume el costo del servicio de entrega (S/. ${parseFloat(e).toFixed(2)}). Desea confirmar su solicitud?`),$("#btnConfirmaCallReparto").removeClass("xInvisible")),dialog_info_call_repartidor.open()}function xCallRepartidorPapayaExec(){_fetchApi.axiosExecute({type:"POST",url:"../../bdphp/log_005.php?op=1302",data:{idpedido:xid_pedido_selected}}).then(e=>{isDeliverySolicitoReparto=!0,arrTotalesDeliveryCliente=darFormatoSubTotalesComisionRepartidor(xDtSede_cm[0],optionDeliveryCliente.p_subtotales,optionDeliveryCliente.p_header.arrDatosDelivery.costoTotalDelivery,!0),xSumarTotalPedidos(),_cpSocketComercioLLamaRepartidorPapaya(),$("#showLoadingReparto").removeClass("xInvisible"),$("#btnLlamarRepartidorP").addClass("xInvisible")})}function xRefreshListaPedidosItems(e){var a;isPassAddRowItemList||(isPassAddRowItemList=!0,a=xarr_subtotales[xarr_subtotales.length-1].importe,a={idpedido:lastDataPedidoInsert.idpedido,idcliente:0,total:a,nummesa:xarr_header.mesa,idtipo_consumo:xarr_header.tipo_consumo,numpedido:lastDataPedidoInsert.numpedido,correlativo_dia:lastDataPedidoInsert.correlativo_dia,referencia:"",subtotales_tachados:"",des_pedido:"P"+xCeroIzq(lastDataPedidoInsert.correlativo_dia,3),min_transcurridos:0,tiempo_atencion:0},xdtDpedido.push(a),xAddRowInsertListItems(e),xPintarListPedido(),setTimeout(()=>{isPassAddRowItemList=!1},1e3))}function xAddRowInsertListItems(e){var a=$(e).attr("data-nummesa"),t=$(e).attr("data-numpedido"),e=($(e).attr("data-correlativo"),$(e).attr("data-isconfirmarpago")),o=lastDataPedidoInsert?lastDataPedidoInsert.idpedido:0,a=lastDataPedidoInsert?0:a;_fetchApi.axiosExecute({type:"POST",url:"../../bdphp/log.php?op=3051",data:{m:a,p:t,confirmar_pago:e,lastIdPedido:lastIdPedidoCobrado,idpedido:o}}).then(e=>{e=$.parseJSON(e);lastDataPedidoInsert?e.datos.map(e=>{if(xArrayDtOrdenFiltro.length)xArrayDtOrdenFiltro.push(e);else{var a=e.idseccion_index.split(".");const t=e.idtipo_consumo+""+a[0]+"."+a[1]+e.idcarta_lista;a=Object.values(xArrayDtOrdenFiltro).find(e=>e.grupo===t);a.cantidad=parseFloat(a.cantidad)+parseFloat(e.cantidad),a.cantidad_r=a.cantidad,a.ptotal=(parseFloat(a.ptotal)+parseFloat(e.ptotal)).toFixed(2)}}):xArrayDtOrdenFiltro=e.datos,xLoadMipedidoBD(xThisCM.xdtPedDet=xArrayDtOrdenFiltro),xSumarTotalPedidos(),xCheckPedidos()}),xPopupLoad.xclose(),xCPopenDialogDetalle(),xThisCM.isAddItemRow=!1,xNuevoPedidoCM()}function xPintarListPedido(){for(var a="",t=1,o=0;o<xdtDpedido.length;o++){let e="";switch(xdtDpedido[o].val_color_despachado){case"1":e="xColorRow_verde";break;case"2":e="xColorRow_Ambar";break;case"3":e="xColorRow_Rojo"}var i=""===e?"xColorRow_Plomo":e,i=0<xdtDpedido[o].tiempo_atencion.length?'<td class="'+e+'">'+xdtDpedido[o].tiempo_atencion+' <span class="xfont11 '+i+'">min</span></td>':"<td></td>",a=String(a+'<tr class="row selected1 xCursor check_item_p" data-idcategoria="'+xidCategoriaPD+'" data-idpedido="'+xdtDpedido[o].idpedido+'" data-idcliente="'+xdtDpedido[o].idcliente+'" data-idcat="'+xp_sel_idcategoria+'" data-punitario="'+xdtDpedido[o].punitario+'" data-total="'+xdtDpedido[o].total+'" data-m="'+xdtDpedido[0].nummesa+'" data-idtipoconsumo="'+xdtDpedido[0].idtipo_consumo+'" data-nump="'+xdtDpedido[0].numpedido+'" data-correlativo="'+xdtDpedido[0].correlativo_dia+'" data-pedido_permiso_borrar="'+xdtDpedido[0].pedido_permiso_borrar+'" data-ref="'+xdtDpedido[0].referencia+'">" data-subtotales_tachados="'+xdtDpedido[0].subtotales_tachados+'"><td><paper-checkbox checked class="check_item"></paper-checkbox>'+t+"</td><td>"+xdtDpedido[o].des_pedido+' <span class="xfont10 xColorRow_Plomo">'+xdtDpedido[o].referencia+"</span></td><td>"+xdtDpedido[o].min_transcurridos+' <span class="xfont11 xColorRow_Plomo">min</span></td>'+i+'<td align="right" class="td_importe" id="td_importe">'+xMoneda(xdtDpedido[o].total)+"</td></tr>");t++}$("#tb_pedidos .row").remove(),$("#tb_pedidos").append(a).trigger("create")}function xVerificarCajaAbiertaOtroUsuario(){_fetchApi.axiosExecute({type:"POST",url:"../../bdphp/log_005.php?op=23"}).then(e=>{if((e=JSON.parse(e)).success){e=e.datos;if(0!==e.length&&0<parseInt(e[0].importe)){var t=isNaN(parseInt(localStorage.getItem("::app3_info_caja_open")))?0:parseInt(localStorage.getItem("::app3_info_caja_open"));if(1!=t){let a="";e.map(e=>{a+='<p class="text-warning fs-14">'+e.nombres+" con S/"+e.importe+" </p>"});t=paramsSwalAlert;t.html=`<div class="p-1">                    
												<img src="../../images/swal-cash-register.png">												
												<p class="fw-600 fs-20">Caja Abierta</p>
												<p class="fw-100 fs-14">
													Usuarios:
													${a}
												</p>
											</div>`,showAlertSwalHtml(t),localStorage.setItem("::app3_info_caja_open","1")}}}})}function xShowCantidadPedidosBorrados(){_fetchApi.axiosExecute({type:"POST",url:"../../bdphp/log_009.php?op=901"}).then(e=>{var a;(e=JSON.parse(e)).success&&(a=e.datos[0].cant,$("#DesTPC-borrados").find("div .xIndicadorCant3").remove(),"0"!=a)&&$("#DesTPC-borrados").find("div").append('<span class="xIndicadorCant3">'+e.datos[0].cant+"</span>").trigger("create")})}Polymer({is:"x-control-mesas",properties:{xt_org:Number,xt_idsede:Number,xt_idus:Number,dt_item:Object,xdtPedDet:Object,isLoadMesasIsotope:Boolean,isAddItemRow:Boolean,listRepartidor:[],importeTotalPedido:Number,showVisibleAreaMesas:Boolean},attached:function(){(xThisCM=this).select_page=0,countIntiCP++,cuentaEventoLoadIniPrincipal=0,xbuscar_mesa=iIniIsotope=!1,setTimeout(()=>{xIniControlMesa(),_cpSocketOpen()},500)},ready:()=>{},detached:function(){clearInterval(xRefreshHora),clearInterval(xRefreshPermiso),xbuscar_mesa=!0,_cpSocketClose()}})</script>