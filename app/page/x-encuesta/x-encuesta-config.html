<dom-module id="x-encuesta-config"><template is="dom"><paper-dialog class="dialog_redondo"id="dialog_borrar"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="xtxtCentro"><img src="../../../images/_dlg_remove.gif"alt=""width="150px"></div><p>Esta seguro de querer borrar este registro?</p><br><div class="buttons"><button class="xBoton2 xPlomo"dialog-dismiss>Cancelar</button> <button class="xBoton2 xRojo"onclick="xDlgBorrar()">Si, borrar</button></div></paper-dialog><paper-dialog class="dialog_redondo"style="min-width:350px"id="dialog_new_encuesta"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><p>Nueva Encuesta</p><br><form id="frmNewEncuesta"><input class="xMiInput xPasarEnter2"placeholder="Nombre"id="nombre"name="nombre"espaciar><div class="xInvisible"><input id="idorg"name="idorg"> <input id="idsede"name="idsede"> <input id="idusuario"name="idusuario"> <input id="fecha_creacion"name="fecha_creacion"></div></form><br><div class="buttons"><button class="xBoton2 xPlomo"dialog-dismiss>Cancelar</button> <button class="xBoton2 xVerde"onclick="xGuardarNewEncuesta()">Guardar</button></div></paper-dialog><paper-dialog class="dialog_redondo"style="min-width:350px"id="dialog_new_pregunta"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><p>Nueva pregunta</p><br><form id="frmNewPregunta"><input class="xMiInput xPasarEnter2"placeholder="Pregunta"id="pregunta"name="pregunta"espaciar><div class="xInvisible"><input id="idsede"name="idsede"></div></form><div class="buttons"><button class="xBoton2 xPlomo"dialog-dismiss>Cancelar</button> <button class="xBoton2 xVerde"onclick="xGuardarNewPregunta()">Guardar</button></div></paper-dialog><br><div class="xMiCard xradius"style="width:90%"><div class="xEncanezadoCard xFondoRowAmarillo2"><h3>Encuestas.</h3><p>Tener clientes complacidos o plenamente satisfechos es uno de los factores clave para alcanzar el éxito en los negocios. Cualquier organización que quiera entender qué piensan sus clientes sobre su producto, su servicio o su marca necesita hacer una encuesta de satisfacción.</div><div class="xContentCard"style="margin:0 auto;width:50%"><div><div><div class="dis-flex"><h2 style="padding-right:10px">Encuestas</h2><paper-fab mini icon="add"onclick="dialog_new_encuesta.open()"class="xDerecha"></paper-fab></div><table width="100%"><tbody><template is="dom-repeat"items="{{ListEncuestas}}"as="item"><tr data-index="{{index}}"data-t="encuesta_sede_conf"data-id="{{item.idencuesta_sede_conf}}"onclick="xLoadEncuestaSelect(this)"class="xCursor"><td>{{item.fecha_creacion}}<td>{{item.nombre}}<td><span class="xDeleteRow2"title="Anular"onclick="xDialogBorrarObj(this)"></span></template></table></div><br><div><h3>Inicio y fin</h3><label for="txt_ini"class="xColorRow_Plomo">Inicio</label> <input class="xMiInput xPasarEnter2"id="txt_ini"value="Tu opinión es muy importante y nos ayudará a mejorar."espaciar> <label for="txt_fin"class="xColorRow_Plomo">Agradecimineto (Final)</label> <input class="xMiInput xPasarEnter2"id="txt_fin"value="Gracias por responder."espaciar></div><br><div><h3>Preguntas</h3><span class="xColorRow_Plomo">Le recomendamos solo 4 preguntas como maximo, para que la encuesta no sea cansada para el cliente.</span><hr><h4>Preguntas Sugeridas</h4><div id="ListPreguntasSugeridas"><ul><template is="dom-repeat"items="{{ListPreguntasSugeridas}}"as="item"><li class="li-p"><paper-checkbox class="xcheck_pregunta"checked$="[[item.checked_obligatorio]]"disabled$="[[item.checked_obligatorio]]"data-isobligatorio="[[item.checked_obligatorio]]"data-index="{{index}}"data-procede="s"><span hidden$="[[!item.checked_obligatorio]]"><strong>Obligatorio</strong> </span>{{item.pregunta}}</paper-checkbox></template></ul><h4>Preguntas creadas</h4><ul><template is="dom-repeat"items="{{ListPreguntasUsuario}}"as="item"><li class="li-p"data-t="encuesta_preguntas"data-id$="{{item.idencuesta_preguntas}}"><paper-checkbox class="xcheck_pregunta"data-index="{{index}}"data-procede="u">{{item.pregunta}}</paper-checkbox><span class="xColorRow_Rojo xCursor"><strong onclick="xBorrarItem(this)">Borrar</strong></span></template></ul></div><div id="ListPreguntasUsuario"></div><button class="xBoton2 xAzul"onclick="dialog_new_pregunta.open()">Crear Pregunta</button></div><hr><br><div><h3>Links para compartir</h3><p id="url_encuesta">papaya.com.pe.encusesta/ioioimmM</div><hr><br><div class="xDerecha"><button class="xBoton2 xVerde"disabled$="{{!isValidSave}}"onclick="xGuardarEncuesta()">Listo Guardar Cambios.</button></div><br><br><br><br></div></div></div><br><br></template></dom-module><style>.li-p{list-style:none;padding:2px}</style><script>var xThisEnC,xObjBorrar,xIdEncuesta;function xIniEncuestaConfig(){$("body").addClass("loaded");var e=xm_log_get("app3_us");xThisEnC.xt_org=e.ido,xThisEnC.xt_idsede=e.idsede,xThisEnC.xt_idus=e.idus,xThisEnC.isValidSave=!1,xLoadAllEncuestas(),xGetLoadPreguntas(),$(".xPasarEnter2").on("keyup",function(e){e=e.which;if(13==e||186==e){var e=$("input"),a=e.index(document.activeElement);if(null!==e[a+1]){var n=e[a+1];if(void 0===n)return;if(null==(n=n.disabled?e[a+2]:n))return;n.focus(),n.select()}return!1}})}function xGetLoadPreguntas(){xGetLoadPreguntasSugeridas(),xGetLoadPreguntasUsuario()}function xGetLoadPreguntasSugeridas(){$.ajax({type:"GET",url:"../../bdphp/log_005.php?op=7"}).done(function(e){(e=JSON.parse(e)).datos.map(e=>(e.checked_obligatorio="1"===e.obligatorio,e)),console.log(e.datos),xThisEnC.ListPreguntasSugeridas=e.datos})}function xGetLoadPreguntasUsuario(){$.ajax({type:"GET",url:"../../bdphp/log_005.php?op=701"}).done(function(e){""!==e&&(e=JSON.parse(e),xThisEnC.ListPreguntasUsuario=e.datos,console.log(e.datos))})}function xGuardarNewPregunta(){""!==$("#frmNewPregunta #pregunta").val()&&($("#frmNewPregunta").find("#idsede").val(xThisEnC.xt_idsede),xPopupLoad.xopen(),$.post("../../bdphp/ManejoBD_IUD.php?tb=encuesta_preguntas",$("#frmNewPregunta").serialize(),function(e){xPopupLoad.xclose(),dialog_new_pregunta.close(),xGetLoadPreguntasUsuario()}))}function xGuardarNewEncuesta(){var e;""!==$("#frmNewEncuesta #nombre").val()&&(xPopupLoad.xopen(),(e=$("#frmNewEncuesta")).find("#idsede").val(xThisEnC.xt_idsede),e.find("#idorg").val(xThisEnC.xt_org),e.find("#idusuario").val(xThisEnC.xt_idus),e.find("#fecha_creacion").val(xDevolverFecha()),xPopupLoad.xopen(),$.post("../../bdphp/ManejoBD_IUD.php?tb=encuesta_sede_conf",$("#frmNewEncuesta").serialize(),function(e){xPopupLoad.xclose(),dialog_new_encuesta.close(),xResetControlEncuesta(),xLoadAllEncuestas(),xIdEncuesta=e,xThisEnC.isValidSave=!0}))}function xborrarPregunta(e){e=e.dataset.index;xThisEnC.ListPreguntasUsuario[e].idencuesta_preguntas_usuario}function xGuardarEncuesta(){xPopupLoad.xopen();var o=[],s={},e={},i={},a=($(".xcheck_pregunta").each((e,a)=>{var n,t;a.checked&&(n=a.dataIndex,t=a.dataset.procede,a.dataIsobligatorio?(i=("s"===t?xThisEnC.ListPreguntasSugeridas:xThisEnC.ListPreguntasUsuario)[n]).procede=t:((s=("s"===t?xThisEnC.ListPreguntasSugeridas:xThisEnC.ListPreguntasUsuario)[n]).procede=t,o.push(s)))}),i&&o.push(i),e.inicio=txt_ini.value,e.fin=txt_fin.value,e.preguntas=o,e.idencuesta=xIdEncuesta,xGetLinkShared());$("#url_encuesta").text(a),$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=702",data:{item:e,link:a}}).done(function(e){console.log(e),xPopupLoad.xclose()})}function xLoadAllEncuestas(){$.ajax({type:"GET",url:"../../bdphp/log_005.php?op=703"}).done(function(e){xThisEnC.ListEncuestas=JSON.parse(e).datos})}function xLoadEncuestaSelect(e){xPopupLoad.xopen();e=e.dataId;xResetControlEncuesta(),$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=704",data:{id:e}}).done(function(e){e=JSON.parse(e).datos[0],xIdEncuesta=e.idencuesta_sede_conf,xThisEnC.isValidSave=!0,$("#url_encuesta").text(e.link);const t=JSON.parse(e.preguntas);t&&(txt_ini.value=t?t.inicio:txt_ini.value,txt_fin.value=t?t.fin:txt_fin.value,$(".xcheck_pregunta").each((e,a)=>{var n;a.dataIsobligatorio||(n=t.preguntas.filter(e=>a.innerText.trim().toLowerCase()===e.pregunta.toLowerCase())[0],a.checked=!!n)})),xPopupLoad.xclose()})}function xResetControlEncuesta(){$(".xcheck_pregunta").each((e,a)=>{a.dataIsobligatorio||(a.checked=!1)}),$("#url_encuesta").text(""),xThisEnC.isValidSave=!1}function xDlgBorrar(){xBorrarItem(xObjBorrar),dialog_borrar.close(),xThisEnC.isValidSave=!1}function xDialogBorrarObj(e,a){xObjBorrar=e,dialog_borrar.open()}function xGetLinkShared(){var e={o:xThisEnC.xt_org,s:xThisEnC.xt_idsede,r:!1,e:xIdEncuesta},e="http://appx.papaya.com.pe/encuesta/?o="+btoa(JSON.stringify(e));return console.log(e),e}Polymer({is:"x-encuesta-config",properties:{xt_org:Number,xt_idsede:Number,isValidSave:Boolean,ListPreguntasSugeridas:[],ListPreguntasUsuario:[],ListEncuestas:[]},attached:function(){xThisEnC=this,xIniEncuestaConfig()}})</script>