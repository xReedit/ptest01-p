<dom-module id="x-caja"><link rel="preload"href="../../../images/_msj_envio_sunat.gif"as="image"media="(max-width: 600px)"><template><paper-dialog class="dialog_redondo"id="dialog_enviando_sunat"style="width:245px"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"><div style="text-align:center"><img id="dgl_sunat_img"src="../../../images/_msj_envio_sunat.gif"alt=""><p id="dgl_sunat_msj">Enviando comprobantes electronicos.<p id="dgl_sunat_msj2"class="xInvisible xColorRow_Azul">Proceso concluido con exito.<p id="dgl_sunat_msj3 xfont11"class="center xColorRow_Plomo">...</p><paper-progress id="dgl_sunat_progress"indeterminate style="width:100%"></paper-progress><button dialog-dismiss id="dlg_sunat_btn"class="xBoton2 xVerde xInvisible">Listo</button></div></paper-dialog><paper-dialog id="dialog_erro_print"modal style="min-width:330px"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"><h4>Error en impresora</h4><p id="print_error"></p><br><div class="xBoton2 xVerde"style="margin-left:23px"onclick="xReImprimirCierre()">Intentar Nuevamente</div><div class="xBoton2 xPlomo"style="margin-left:23px"dialog-dismiss onclick="dialog_detalle.close()">No imprimir</div><br><br><br></paper-dialog><paper-dialog id="dialog_cierre"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="xContent"><p class="xfont14"id="msj">OK cuadre conforme. Recuerde imprimir las operaciones detalladas, luego cierre su terminal.</p><br><paper-button tabindex="0"raised class="xverde"onclick=""><iron-icon icon="save"></iron-icon>Imprimir cierre</paper-button><paper-button tabindex="0"raised class="xnegro"onclick=""><iron-icon icon="save"></iron-icon>Cerrar sistema</paper-button></div></paper-dialog><x-pass id="xPSupervisor"titulo="Permiso del administrador"val="Rol1"></x-pass><br><div class="xContent"><paper-tabs selected="{{selected}}"id="tab_caja"><paper-tab>INGRESO / SALIDA DE CAJA</paper-tab><paper-tab>CIERRE DE CAJA</paper-tab></paper-tabs><div class="xLinea2"></div><br><br><iron-pages selected="{{selected}}"><div id="ingreso_caja"><br><form id="form_ingreso"onsubmit="return!1"><select class="xTextRow2 xfont18 xCursor"id="selecie"style="width:200px"><option value="1">INGRESO A CAJA<option value="2">SALIDA DE CAJA</select><br><br><p>Detalle el motivo del movimiento de efectivo.</p><input class="xMiInput xPasarEnter2"onchange="conMayusculas(this)"placeholder="Motivo"id="motivo"name="motivo"required><br><br><input type="number"class="xMiInput"placeholder="Monto"style="width:200px"pattern="[0-9]+([\.,][0-9]+)?"step="any"id="monto"name="monto"required><div class="xInvisible"><input id="idsede"name="idsede"value="[[xt_idsede]]"> <input id="idorg"name="idorg"value="[[xt_org]]"> <input id="idusuario"name="idusuario"value="[[xt_idus]]"> <input id="fecha"name="fecha"> <input id="tipo"name="tipo"></div></form><br><br><paper-button tabindex="0"raised class="xverde"onclick="xGuardarIngreso()"><iron-icon icon="save"></iron-icon>Listo Guardar</paper-button><br><br><br><h4>Resumen de movimientos que aun no tienen cierre</h4><div class="xLinea2"></div><table id="tb_resumen_ie"width="65%"class="xtable"><thead><th width="20px">#<th align="left">Fecha<th align="left">Tipo<th align="left">Motivo<th align="right">Importe</thead></table><div hidden$="[[ !isShowListaAdelantoOrden ]]"><br><br><div class="xLinea2"></div><br><h3>Adelantos de ordernes de pedido</h3><br><table><thead><th>Fecha<th>Usuario<th># Orden<th>Cliente<th>Detalle<th>Importe<th>.<tbody><template is="dom-repeat"items="{{listAdelantoOrden}}"as="item"><tr><td>{{ item.fecha_hora }}<td>{{ item.usuario }}<td>{{ item.numero }}<td>{{ item.cliente_nom }}<td>{{ item.concepto }}<td>{{ item.importe }}<td><button class="btn btn-sm btn-success"data-id="[[index]]"onclick="recibirAdelanto(this)">Recibir</button></template></table></div></div><div id="cierre_caja"><div class="xTxtCierreCajaContenedor"><b><h3 id="xTituloCierre">CIERRE DE CAJA</h3></b><p>Especifique que cantidad tiene en caja segun denominacion:</p><br><form id="formCierre"><div class="xAlinearce xm_at_cont xEpaciarInputCierre"><input class="xMiInput xPasarEnter2"data-valor="200"placeholder="De 200"> <input class="xMiInput xPasarEnter2"data-valor="100"placeholder="De 100"> <input class="xMiInput xPasarEnter2"data-valor="50"placeholder="De 50"> <input class="xMiInput xPasarEnter2"data-valor="20"placeholder="De 20"> <input class="xMiInput xPasarEnter2"data-valor="10"placeholder="De 10"> <input class="xMiInput xPasarEnter2"data-valor="5"placeholder="De 5"></div><div class="xAlinearce xm_at_cont xEpaciarInputCierre"><input class="xMiInput xPasarEnter2"data-valor="2"placeholder="De 2"> <input class="xMiInput xPasarEnter2"data-valor="1"placeholder="De 1"> <input class="xMiInput xPasarEnter2"data-valor="0.50"placeholder="De 0.50"> <input class="xMiInput xPasarEnter2"data-valor="0.20"placeholder="De 0.20"> <input class="xMiInput xPasarEnter2"data-valor="0.10"placeholder="De 0.10"id="txt_fin"> <input class="xMiInput"data-valor="total"placeholder="Total"id="TxtTotal"disabled="disabled"encendido></div><div id="xTituloRpt"></div><div id="xTituloRpt2"></div></form><br><div id="btns_cierre"><paper-button tabindex="0"raised class="xverde"onclick="xVerificar()"><iron-icon icon="save"></iron-icon>Verificar</paper-button><paper-button tabindex="0"raised class="xnegro"onclick="xPSupervisor.xopen()"><iron-icon icon="save"></iron-icon>Supervisor</paper-button></div></div><br><br><div class="xTxtCierreCajaContenedor mt-2"hidden$="[[ !isShowLastCierres ]]"><hr><p class="fw-600 fs-18">Ultimos cierres de caja</p><br><table width="100%"><thead><th align="left">Fecha<th align="left">Usuario<th><tbody><template is="dom-repeat"items="{{listCierres}}"as="item"><tr><td>{{ item.fecha }} {{ item.hora }}<td>{{ item.usuario }}<td><button class="btn btn-sm btn-info"data-id="[[item.idprint_server_detalle]]"onclick="reImprimirCierreHistory(this)">Re-imprimir</button></template></table></div><br><br></div></iron-pages><br><br><br></div><div id="ImprimeCierre"class="xInvisible"><p id="xImpTitulo"style="font-size:18px;line-height:1px">CIERRE DE CAJA<table width="290"border="0"id="xTableList"style="font-size:12px"><tr id="Seccion_total"><tr id="Seccion_caja"><tr id="Seccion_salida"><tr id="Seccion_venta_credito"><tr id="Seccion_tipo_consumo"><tr id="Seccion_estado_pedido"><tr id="Seccion_resumen_vendido"></table></div><div class="xInvisible"><div id="div_datos"style="max-width:500px"></div></div></template></dom-module><style>paper-button[raised].colorful{background:#4285f4;color:#fff}paper-button[raised].xverde{background:#43a047;color:#fff}paper-button[raised].xnegro{background:#424242;color:#fff}.xEpaciarInputCierre input{margin-bottom:20px;font-size:18px}.xTxtRojo{color:red}</style><script src="./cocinar.resumen.boletas.js"></script><script src="../../view/config.const.js"></script><script src="../../view/xm_all.js"></script><script src="./../x-caja/cocinar.resumen.boletas.js"></script><script src="../../view/item_pedido_print_comprobante.js"></script><script src="../../view/cpe_interno.js"></script><script src="../../view/xSOAPSunat.js"></script><script src="../../view/socket.service.p.js"></script><script>var xThisCaja,xMontoTotalCaja,xSumData,xtbReport,xArrayEncabezadoCierre,xlo_idorg,xlo_idsede,xlo_us,isSocket,xPermisoSupervisor=0,xArrayCierrePrint=[],xEfectivoCaja=0,nom_supervisor="",id_supervisor=0,xArraySumT=[],numImtentosUs=0,guadandoIngresoSalida=!1;function xIniCaja(){xPopupLoad=document.getElementById("xLoad"),xm_LogChequea(function(){xm_log_get("ini_us"),console.log("xUsAc_Ini",xUsAc_Ini),$("body").addClass("loaded"),xThisCaja.xt_org=xIdOrg,xThisCaja.xt_idsede=xIdSede,xThisCaja.xt_idus=xIdUsuario,$("#Titulo_page").text("Movimientos de Caja"),xtbReport=$("#xTableList"),isSocket=0!==parseInt(xm_log_get("datos_org_sede")[0].pwa)}),(xPSupervisor=document.getElementById("xPSupervisor")).valor="Rol1",xPSupervisor.addEventListener("xSend",function(e){1==e.detail.xRpts[0].p&&(nom_supervisor=e.detail.xRpts[0].nomus,id_supervisor=e.detail.xRpts[0].us,xPermisoSupervisor=1,xVerificar())}),$(".xPasarEnter2").on("keyup",function(e){var r=$(this).val(),t=$(this).attr("data-valor");if("total"!=t){parseFloat(parseFloat(r)/parseFloat(t))%1==0?($(this).removeClass("xTxtRojo"),xSumarTotal()):$(this).addClass("xTxtRojo");r=e.which;if(13==r||186==r){t=$("input"),e=t.index(document.activeElement);if(null!==t[e+1]){r=t[e+1];if(void 0===r)return;if(null==(r=r.disabled?t[e+2]:r))return;r.focus()}return!1}}}),$("#form_ingreso #monto").on("keyup",function(e){e=e.which;13!=e&&186!=e||xGuardarIngreso()}),$("#form_egreso #monto").on("keyup",function(e){e=e.which;13!=e&&186!=e||xGuardarEgreso()}),$("#txt_fin").on("keyup",function(e){e=e.which;13!=e&&186!=e||xVerificar()}),$("#tab_caja").on("iron-select",function(){switch(xThisCaja.selected){case 0:xLoadResumenIS();break;case 1:xloadLastCierres()}})}function xGuardarIngreso(){guadandoIngresoSalida||(guadandoIngresoSalida=!0,xvalidateFormInput("form_ingreso",function(e){!1===e?guadandoIngresoSalida=!1:(e=$("#form_ingreso #selecie").val(),xPopupLoad.xopen(),$("#form_ingreso #fecha").val(xDevolverFecha()+" "+xDevolverHora()),$("#form_ingreso #monto").val(xMoneda($("#form_ingreso #monto").val())),$("#form_ingreso #tipo").val(e),$.post("../../bdphp/ManejoBD_IUD.php?tb=ie_caja",$("#form_ingreso").serialize(),function(e){xPopupLoad.xclose(),$("#form_ingreso #motivo").val(""),$("#form_ingreso #monto").val(""),xLoadResumenIS(),guadandoIngresoSalida=!1}))}))}function xGetDataCierre(e){$.ajax({type:"POST",url:"../../bdphp/log.php?op=7000",data:{id:e}}).done(function(e){if((e=JSON.parse(e)).success){var r=JSON.parse(e.datos[0].data);const n=JSON.parse(e.datos[0].titulo);var t,o=0,a=[],i=[];r.map((e,r)=>{t=Object.keys(e)[0],(a=JSON.parse(e[t]))&&(i.push({des:n[r].des,t1:n[r].t1,t2:n[r].t2,t3:n[r].t3,visible:0}),a.map((e,r)=>{i[o][r]=e}),o++)}),xArrayCierrePrint=i,xEscribirDatosHtml(),console.log("arrPrint",i),xPopupLoad.xclose(),$("#btns_cierre").html('<paper-button tabindex="0" raised class="xverde" onclick="xCerrarSessionAll();"><iron-icon icon="close"></iron-icon>Cerrar terminal</paper-button>'),xPermisoSupervisor=0,xIniArraysPrint()?xImprimirCierre(xArrayEncabezadoCierre,xArrayCierrePrint):xVerificaSiFacturacionE()}else console.log(e),xPopupLoad.xclose()})}function xLoadResumenIS(){$("#tb_resumen_ie .row").remove(),$("#tb_resumen_ie").append('<tr class="row"><td colspan="5"><paper-spinner active></paper-spinner></td></tr>').trigger("create"),$.ajax({type:"POST",url:"../../bdphp/log.php?op=70011"}).done(function(e){for(var r="",t=0,o="",a=$.parseJSON(e).datos,i=0;i<a.length;i++)t++,o="",1!=a[i].tipo&&(o="xColorRow_Rojo"),r=String(r+'<tr class="row '+o+'"><td>'+xCeroIzq(t,2)+"</td><td>"+a[i].fecha+"</td><td>"+a[i].des_tipo+"</td><td>"+a[i].motivo+'</td><td align="right">'+a[i].monto+"</td></tr>");$("#tb_resumen_ie .row").remove(),$("#tb_resumen_ie").append(r).trigger("create")}),xLoadAdelantoOrdenPedido()}function xLoadAdelantoOrdenPedido(){$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=15"}).done(function(e){e=JSON.parse(e).datos;xThisCaja.listAdelantoOrden=e,console.log("xThisCaja.listAdelantoOrden",xThisCaja.listAdelantoOrden),xThisCaja.isShowListaAdelantoOrden=0<xThisCaja.listAdelantoOrden.length})}function xSumarTotal(){xMontoTotalCaja=0,$(".xTxtCierreCajaContenedor").find("input:text").each(function(e,r){var t=$(r).val();""!=t&&"total"!=$(r).attr("data-valor")&&(xMontoTotalCaja+=parseFloat(t))}),$("#TxtTotal").val(xMoneda(xMontoTotalCaja))}function xVerificar(){$("#xTituloRpt").html("<paper-spinner active></paper-spinner>").trigger("create");var e={totalcaja:parseInt(xMontoTotalCaja),idusuario_supervisor:id_supervisor||0};$.ajax({type:"POST",url:"../../bdphp/log.php?op=70111",data:{item:e}}).done(e=>{var r,t,o,a,i,n,s,d,p;(e=JSON.parse(e)).success?(n=i=a=o=t="",s="1"===(e=e.datos[0]).isConforme,d="1"===e.isNumIntentosAgotado,p=parseInt(e.calcTotal),s?(r="<h3>OK cuadre conforme.</h3>",t="#060",xArmarArrayPrint(e.idbitacora),xloadLastCierres()):1==xPermisoSupervisor?(isNaN(p)||(1<p?(n="(falta "+xMoneda(p)+"). ",a="xSubrayar xBold2"):(n="(sobra "+xMoneda(p)+"). ",i="xSubrayar xBold2")),r='<p class="xfont16"><strong>Efectivo: '+xMoneda(e.efectivoCaja)+" </strong> "+n+" Resultado de caja con supervision. Si <span class="+i+">tiene sobrante</span>, haga un ingreso en caja como sobrante de efectivo. Si por el contrario <span class="+a+'>tiene faltante</span>, haga una salida de caja como faltante en caja. Luego vuela a realizar el cuadre de caja, imprima los resultados y cierre su terminal. </p><a class="xCursor xfont16" onClick="xOpenPage(22);"><strong>Ver Resumen.</strong></a>',t="#8e24aa"):(t="#F00",d?r="<h3>NUMERO DE INTENTOS DE CIERRE AGOTADO, POR FAVOR LLAME AL SUPERVISOR.</h3>":(numImtentosUs=xCeroIzq(e.numintentos,2),o='<br><span class="xBold xfont14">Intentos de cierre '+xCeroIzq(e.numintentos,2)+" de "+xCeroIzq(e.numintentos_permitidos,2)+"</span> ",p<-1&&(r="<h3>Existe sobrante en caja."+o+"</h3>"),1<p&&(r="<h3>Existe faltante en caja."+o+"</h3>"))),$("#xTituloRpt").html(r),$("#xTituloRpt").css("color",t)):console.log(e)})}function xArmarSubItems(e,r,o){var a;7021==r?(a=xArrayCierrePrint.length-1,xArrayCierrePrint[a][0]={des:"EFECTIVO EN CAJA",t1:"",t2:"",t3:xMoneda(xEfectivoCaja)},o(!0)):$.ajax({type:"POST",url:"../../bdphp/log.php?op="+r}).done(function(e){var r=$.parseJSON(e).datos;a=xArrayCierrePrint.length-1;for(var t=0;t<r.length;t++)xArrayCierrePrint[a][t]={des:r[t].descripcion,t1:r[t].t1,t2:r[t].t2,t3:r[t].t3};0==r.length?xArrayCierrePrint[a].visible=1:xArrayCierrePrint[a].visible=0,o(!0)})}function xIniArraysPrint(){xArrayEncabezadoCierre=[];var e=1==xPermisoSupervisor?"Cierre con permiso de supervisor. "+nom_supervisor:"",r=(xDtPrint=xm_log_get("sede_generales"),xDtTipoDoc=xm_log_get("app3_woIpPrintO"),xArrayImpresoras=xm_log_get("app3_woIpPrint"),xgetImpresora(-3));return null==r?(xRpt='<p class="xColorRow_Rojo">No se selecciono ninguna impresora para este documento</p><a class="xCursor xfont16" onClick="xOpenPage(22);"><strong>Ver Resumen.</strong></a>',$("#xTituloRpt2").html(xRpt),!1):(xArrayEncabezadoCierre.push({ip_print:r[0].ip_print,logo:xDtPrint[0].logo,detalle_cierre:e,titulo:"CIERRE DE CAJA",var_margen_iz:r[0].var_margen_iz,var_size_font:r[0].var_size_font,papel_size:r[0].papel_size}),!0)}function xArmarArrayPrint(e){xPopupLoad.xopen(),xPopupLoad.titulo="Obteniendo Datos...",xGetDataCierre(e)}function xUpdateCerrarCession(r){$.ajax({type:"POST",url:"../../bdphp/log.php?op=70012",data:{i:xIdUsuario}}).done(function(e){xPopupLoad.xclose(),$("#btns_cierre").html('<paper-button tabindex="0" raised class="xverde" onclick="xCerrarSessionAll();"><iron-icon icon="close"></iron-icon>Cerrar terminal</paper-button>'),r(!0)})}function xImprimirCierre(e,r){var t=window.localStorage.getItem("::app3_woIpPrintLo"),t=(null!=t&&""!=t&&(t=$.parseJSON(t),e[0].ip_print=t.ip,e[0].var_margen_iz=t.var_margen_iz,e[0].var_size_font=t.var_size_font,e[0].papel_size=t.papel_size),parseInt(xm_log_get("datos_org_sede")[0].sys_local)),o=(e[0].nom_us=xm_log_get("app3_us").nomus,e[0].nom_sede=xm_log_get("datos_org_sede")[0].sedenombre,{Array_enca:e,ArrayItem:r});1===t?(xPopupLoad.xopen(),xSendDataPrintServer(o,4,"cuadre-caja"),setTimeout(()=>{xPopupLoad.xclose(),xVerificaSiFacturacionE()},1e3)):$.ajax({type:"POST",url:"../../print/print4.php",data:{Array_enca:e,ArrayItem:r}}).done(function(e){-1!=e.indexOf("Error")?(xPopupLoad.xclose(),$("#xTituloRpt").text(e),xErrorPrint=!0,dialog_erro_print.open()):(xErrorPrint=!1,xPopupLoad.titulo="Imprimiendo...",xPopupLoad.xopen(),xVerificaSiFacturacionE())})}function xVerificaSiFacturacionE(){"0"!==xm_log_get("datos_org_sede")[0].facturacion_e_activo?setTimeout(function(){xPopupLoad.xclose(),dialog_enviando_sunat.open(),setTimeout(()=>{xCocinarResumenBoletas()},1e3)},1500):xPopupLoad.xclose()}function xPreparaReport(){var i;new Array;$.ajax({type:"POST",url:"../../bdphp/log.php?op=7"}).done(function(e){var r=$.parseJSON(e).datos,t=0,o=0;xCadenaRG="",xTitulo='<tr><td colspan="2" style="border-bottom:1px solid;">RESUMEN GENERAL</td></tr>';for(var a=0;a<r.length;a++)"+"==r[a].operacion1&&(t=parseFloat(r[a].importe)+parseFloat(t)),"+"==r[a].operacion2&&(o=parseFloat(r[a].importe)+parseFloat(o)),"-"==r[a].operacion2&&(o=parseFloat(o)-parseFloat(r[a].importe)),xCadenaRG=String(xCadenaRG+"<tr><td>"+r[a].descripcion+'</td><td align="right">'+xMoneda(r[a].importe)+"</td></tr>");xpie_secc1='<tr><td style="border-top:1px solid;">VENTA TOTAL</td><td align="right" style="border-top:1px solid;">'+xMoneda(t)+'</td></tr><tr class="xBold" ><td style="border-top:1px solid;border-bottom:1px solid;">EFECTIVO EN CAJA</td><td style="border-top:1px solid;border-bottom:1px solid;" align="right">'+xMoneda(o)+"</td></tr>",xtbReport.find("#Seccion_total").html(xTitulo+xCadenaRG+xpie_secc1).trigger("create"),xAddReport("INGRESO DE CAJA",701,"Seccion_caja","si",i=["Descripcion","Importe"],function(){xAddReport("SALIDA DE CAJA",7002,"Seccion_salida","si",i,function(){xImprimir()})})})}function xAddReport(e,r,o,a,t,i){for(var n,s="",d=0,p="",l=0;l<t.length;l++)p=p+"<td "+(1==l?'align="right"':"")+' style="border-bottom:1px solid;">'+t[l]+"</td>";""!=t&&(p="<tr>"+p+"</tr>"),n='<tr><td colspan="2" style="border-bottom:1px solid;">'+e+"</td></tr>",$.ajax({type:"POST",url:"../../bdphp/log.php?op="+r}).done(function(e){for(var r=$.parseJSON(e),t=0;t<r.datos.length;t++)s=String(s+'<tr><td style="font-size:9px">'+r.datos[t].descripcion+'</td><td align="right">'+r.datos[t].t2+"</td></tr>"),d=parseFloat(d)+parseFloat(r.datos[t].t2);d="si"==a?'<tr><td colspan="2" align="right" style="border-top:1px dashed;">'+xMoneda(d)+"</td></tr>":"",""==s&&(s='<tr><td colspan="2">-</td></tr>'),xtbReport.find("#"+o).html(n+p+s+d+"<br>").trigger("create"),i(!0)})}function xImprimir(){$("#ImprimeCierre").find("#xImpFecha").text(xDevolverFecha()+" "+xDevolverHora()),xImprSelec("ImprimeCierre")}function xCerrarTerminal(){xCerrarSession()}function xReImprimirCierre(e){dialog_erro_print.close(),xPopupLoad.titulo="Enviando...",xPopupLoad.xopen(),xImprimirCierre(xArrayEncabezadoCierre,xArrayCierrePrint)}function xEscribirDatosHtml(){xArrayCierrePrint.map((e,r)=>{var t=0,o=0,a=0;for(const i in e)"object"==typeof e[i]&&(t+=isNaN(parseFloat(e[i].t1))?0:parseFloat(e[i].t1),o+=isNaN(parseFloat(e[i].t2))?0:parseFloat(e[i].t2),a+=isNaN(parseFloat(e[i].t3))?0:parseFloat(e[i].t3));xArraySumT[r]={t1:0==t?"":t,t2:0==o?"":o,t3:a.toFixed(2)}});var e,r,t="",o="",i=0,n=xm_log_get("datos_org_sede")[0];for(a in xArrayCierrePrint)i=0,t="",e='<thead><th align="left">'+xArrayCierrePrint[a].des+'</th><th align="right">'+xArrayCierrePrint[a].t1+'</th><th align="right">'+xArrayCierrePrint[a].t2+'</th><th align="right">'+xArrayCierrePrint[a].t3+"</th></thead>",$.map(xArrayCierrePrint[a],function(e,r){"object"==typeof e&&(i++,t=String(t+"<tr><td>"+e.des+'</td><td align="right" class="t1">'+e.t1+'</td><td class="t2" align="right">'+e.t2+'</td><td class="t3" align="right">'+e.t3+"</td><tr>"))}),r=String('<tr><td></td><td align="right"><strong>'+xArraySumT[a].t1+'</strong></td><td align="right"><strong>'+xArraySumT[a].t2+'</strong></td><td align="right"><strong>'+xArraySumT[a].t3+"</strong></td></tr>"),0!==i&&(o=String(o+'<table class="xtable2 xMarginTop" width="100%">'+e+t+r+"</table><br><br>"));o=`<div style = "line-height: 1;">
				<h3>CIERRE DE CAJA - ${xDevolverFecha()+" | "+xDevolverHora()}</h3>				
				<h3>Local: ${n.sedenombre}</h3>				
				<h3>Ciudad: ${n.sedeciudad} </h3>
				<h4>Usuario: ${xNomUsario}</h4>
				<p>Intentos: <strong>${numImtentosUs}</strong></p>
				<p>Supervisor: <trong>${nom_supervisor}</strong></p>
				<br><br>
				</div>${o}
				<br><br>
				<p>papaya.com.pe</p>`;$("#div_datos").append(o).trigger("create"),n.email_cierre&&(n={to:n.email_cierre,asunto:"CIERRE DE CAJA | "+n.sedenombre+" | "+xDevolverFecha(),titulo:"Cierre de caja",htmlContent:div_datos.outerHTML},xSendEmailClienteSES(n))}function xloadLastCierres(){$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=12"}).done(function(e){e=JSON.parse(e).datos,xThisCaja.listCierres=e,xThisCaja.isShowLastCierres=0<e.length})}function reImprimirCierreHistory(e){e=e.dataId;xPopupLoad.xopen(),$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=1703",data:{idprint:e}}).done(function(e){e=JSON.parse(e).datos,e={detalle_json:(e=0<e.length?e[0]:e).detalle_json,idprint_server_detalle:e.idprint_server_detalle+(new Date).getMilliseconds(),hora:xDevolverHora(),nomUs:"Caja",nom_documento:"cuadre-caja"};_cpSocketprinterOnly(e),setTimeout(()=>{xPopupLoad.xclose()},1500)})}function recibirAdelanto(e){e=e.dataId,e=xThisCaja.listAdelantoOrden[e];e.fecha_guardar=xDevolverFecha()+" "+xDevolverHora(),$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=1501",data:{data:e}}).done(function(e){xLoadResumenIS()})}Polymer({is:"x-caja",properties:{xt_org:Number,xt_idsede:Number,xt_idus:Number,winchaCierre:[],listCierres:[],isShowLastCierres:Boolean,listAdelantoOrden:[],isShowListaAdelantoOrden:Boolean},attached:function(){this.selected=0,this.isShowLastCierres=!1,this.isShowListaAdelantoOrden=!1,xThisCaja=this,xIniCaja(),setTimeout(()=>{_cpSocketOpen()},1e3)},detached:function(){_cpSocketClose()}})</script>