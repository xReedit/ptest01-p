<dom-module id="x-admin-new-org"><link rel="import"href="../../x-componentes/x-comp-select-plan/x-comp-select-plan.html"><template><br><div class="xMiCard xradius"style="width:calc(100% - 10%)"><div class="xEncanezadoCard xFondoRowAmarillo4">Agregar un nuevo restaurante o sede.</div><div class="xContentCard"><div class="x_div_linea"><div class="xitem1 xBordeDe"><p><strong>Datos del Restaurante</strong><hr><form id="frm_org"><input class="xMiInput xPasarEnter2"placeholder="RUC"onchange="conMayusculas(this)"id="ruc"name="ruc"espaciar required> <input class="xMiInput xPasarEnter2"placeholder="RAZON SOCIAL"onchange="conMayusculas(this)"id="nombre"name="nombre"espaciar required><div class="xInvisible"><input id="idorg"name="idorg"value$="{{xIdOrg}}"></div></form><br><p><strong>Usuario del sistema - Implementacion</strong></p><input class="xMiInput xPasarEnter2"placeholder="USUARIO"id="txt_usuario"onblur="xAdmNewValidarUsuario(this)"espaciar> <span class="xColorRow_verde xInvisible"id="labelUsValido">Usuario Valido</span> <input type="password"class="xMiInput xPasarEnter2"placeholder="PASSWORD"id="txt_usuario_password"espaciar><br><br><div class="xBoton2 xAzul"onclick="xAdmGuardarOrg()">Guardar</div><br><br><br><br><p><strong>Sedes</strong><hr><table width="100%"><thead><th>#<th>Sede<th>Ciudad<th>Estado<th><tbody><template is="dom-repeat"items="{{ListSedesPorOrg}}"as="item"><tr data-id="{{index}}"onclick="xAdmNewModificarSede(this)"class="xCursor"><td>{{displayIndex(index)}}<td>{{item.nombre}}<td>{{item.ciudad}}<td>Activo<td title="Modificar"onclick="xAdmNewModificarSede(this)"><span class="xIconRow xCursor"><img src="../../../images/edit.png"></span></template></table><br><br><div class="xBoton2 xVerde"onclick="xAdmNewNuevaSede()">Nueva Sede</div></div><div class="xitem2"><paper-tabs selected="{{selected_conf}}"id="tab_cnf"scrollable><paper-tab>DATOS DEL ESTABLECIMINETO</paper-tab><paper-tab>CONFIGURACION APP</paper-tab></paper-tabs><div class="xLinea2"></div><br><iron-pages selected="{{selected_conf}}"><div class="xBordeIzqHover"><form id="frm_sede"><input class="xMiInput xPasarEnter2"placeholder="NOMBRE"onchange="conMayusculas(this)"id="nombre"name="nombre"espaciar required> <input class="xMiInput xPasarEnter2"placeholder="CIUDAD"onchange="conMayusculas(this)"id="ciudad"name="ciudad"espaciar required> <input class="xMiInput xPasarEnter2"placeholder="UBIGEO"id="ubigeo"name="ubigeo"espaciar> <input class="xMiInput xPasarEnter2"placeholder="CODIGO DEL DOMICILIO FISCAL"id="codigo_del_domicilio_fiscal"name="codigo_del_domicilio_fiscal"espaciar><br><br><p><strong>Sufijo para creacion de usuarios:</strong></p><input class="xMiInput xPasarEnter2"id="sufijo"name="sufijo"placeholder="SUFIJO"onchange="conMayusculas(this)"onblur="xAdmNewValidarSufijo(this)"espaciar required> <span class="xColorRow_verde xInvisible"id="labelSufijoValido">Sufijo Valido</span><br><br><p><strong>Habilitar facturacion electronica</strong></p><label for="authorization_api_comprobante">Token</label> <input class="xMiInput xPasarEnter2"id="authorization_api_comprobante"name="authorization_api_comprobante"><br><label for="id_api_comprobante">ID</label><br><input class="xMiInput xPasarEnter2"id="id_api_comprobante"name="id_api_comprobante"><br><br><paper-checkbox id="check_habilita_facturacion"><span>Habilitar Facturacion Electronica</span></paper-checkbox><p><strong>Reporte del contador</strong></p><paper-checkbox id="check_habilita_verificacion_cpe"><span>Habilitar verificacion uno x uno</span></paper-checkbox><br><br><p><strong>Plataforma | local o web</strong></p><input class="xMiInput xPasarEnter2"placeholder="IP PRINT SERVER"id="ip_server_local"name="ip_server_local"espaciar><paper-checkbox id="check_print_server"><span>Print server desde la web | version de internet</span></paper-checkbox><br><br><input class="xMiInput xPasarEnter2"placeholder="TIEMPO LIMITE EN MINUTOS PARA TOMAR PEDIDO"id="pwa_time_limit"name="pwa_time_limit"espaciar><paper-checkbox id="check_pwa"><span>PWA con sockets</span></paper-checkbox><br><paper-checkbox id="check_isprinter_socket"><span>Servidor de impresion adminte socket?</span></paper-checkbox><div class="xInvisible"><input id="sys_local"name="sys_local"> <input id="pwa"name="pwa"> <input id="facturacion_e_activo"name="facturacion_e_activo"> <input id="habilita_verificacion_cpe"name="habilita_verificacion_cpe"> <input id="isprinter_socket"name="isprinter_socket"> <input id="speech_disabled"name="speech_disabled"></div><br><br><p><strong>Temporal (url_api_fac)</strong></p><input class="xMiInput xPasarEnter2"placeholder="URL api facturador"id="url_api_fac"name="url_api_fac"espaciar><br><br><p><strong>Escenario</strong></p><select id="selTipo"class="xCursor"><option value="PRUEBAS">PRUEBAS<option value="PRODUCCION">PRODUCCION</select> <input class="xMiInput xPasarEnter2"placeholder="FECHA INICIO"id="finicio"name="finicio"espaciar><p>COMISION FIJO MENSUAL</p><input class="xMiInput xPasarEnter2"placeholder="COSTO FIJO MENSUAL"id="costo_restobar_fijo_mensual"name="costo_restobar_fijo_mensual"espaciar><br><br><br><br><p class="fw-600">COBRO DEL SERVICIO<hr><p>Plan contratado:</p><x-comp-select-plan clasecss="selected-template-1"id="compPlanSelect"onchange="changePlan(planes)"></x-comp-select-plan><br><br><p>Ultimo mes que pago, formato (a√±o-mes-dia)</p><input class="xMiInput xPasarEnter2"placeholder="YYYY-MM-DD"id="umf_pago"name="umf_pago"espaciar><br><br><p>Tipo de Contribuyente, PN = PERSONA NATURAL O PJ= PERSONA JURIDICA</p><input class="xMiInput xPasarEnter2"placeholder="PN O PJ"id="tipo_contribuyente"name="tipo_contribuyente"espaciar><br><br><p>Link de carta virtual (Delivery). Ej: Rest. San Carlos = sancarlos</p><input class="xMiInput xPasarEnter2"onblur="verificarDisponibilidadLink(this)"placeholder="Link Carta"id="link_carta"name="link_carta"espaciar><p hidden$="[[!isLinkDisponible]]"class="text-danger fw-600">Link NO disponible.</p><br><br><p><strong>Mozo Virtual por Voz</strong></p><paper-checkbox id="check_speech_disabled"><span>Habilitar Mozo Virtual por Voz?</span></paper-checkbox><div class="xInvisible"><input id="idsede_plan_contratado"name="idsede_plan_contratado"value$="{{xIdSede}}"> <input id="idorg"name="idorg"value$="{{xIdOrg}}"> <input id="idsede"name="idsede"value$="{{xIdSede}}"> <input placeholder="TIPO"id="tipo"name="tipo"espaciar></div></form><br><br><br><div class="xBoton2 xAzul"onclick="xAdmGuardarSede()"disabled$="{{!formValid}}">Guardar</div></div><div class="xBordeIzqHover"><form method="post"id="formDatosAPP"><p>Coordenadas:</p><input class="xMiInput xPasarEnter2"placeholder="LATITUDE"id="latitude"name="latitude"espaciar required> <input class="xMiInput xPasarEnter2"placeholder="LONGITUDE"id="longitude"name="longitude"espaciar required><br><br><br><p>Habilitar busqueda con mapa cuando es delivery. Si esta deshabilitado no tiene en cuenta si el servicio papaya express esta en esa zona y la direccion solo sera un campo de texto:</p><br><paper-checkbox id="check_habilitar_busqueda_mapa"><span>Habilitar la busqueda de direccion con mapa</span></paper-checkbox><hr><br><br><hr><p>Datos para delivery:</p><br><paper-checkbox id="check_habilita_delivery"><span>Habilitar delivery, para que la sede figure en la app</span></paper-checkbox><hr><br><br><p>Comercio Afiliado: Al no ser afiliado cobra comision en productos</p><br><paper-checkbox id="check_afiliado_delivery"><span>Afiliado</span></paper-checkbox><hr><br><p>Tiene servicio delivery propio?: comercio tiene sus propios repartidores (el sistema no busca repartidor)</p><br><paper-checkbox id="check_afiliado_repartidor"><span>Comercio con repartidores propios</span></paper-checkbox><hr><br><p>Comercio requiere calcular la costo delivery segun distancia (se cobrara la comsion segun zona)</p><br><paper-checkbox id="check_afiliado_calc_distancia"><span>Habilitar calcular costo entrega segun zona</span></paper-checkbox><hr><hr><p>Comercio solo calcula el costo de entrega cuando el cliente hace pedido desde app</p><br><paper-checkbox id="check_afiliado_calc_distancia_solo_app"><span>Habilitar calcular costo entrega segun zona SOLO APP</span></paper-checkbox><hr><br><p>Comercio habilitar recojo en el local, el cliente pasa a recoger.</p><br><paper-checkbox id="check_afiliado_recojo_local"><span>Habilitar recojo en el local</span></paper-checkbox><hr><br><p>Comercio acepta pagos con Yape</p><br><paper-checkbox id="check_afiliado_yape"><span>Habilitar pagos con yape</span></paper-checkbox><hr><br><p>Comercio tiene la opcion de recojo en su propio local (quitar para Locales no afiliados -por la comision-)</p><br><paper-checkbox id="check_habilitar_tarjeta"><span>Habilitar pago con Tarjeta</span></paper-checkbox><hr><br><p>Comercio es partde del grupo de solidaridad</p><br><paper-checkbox id="check_habilitar_solidaridad"><span>Habilitar solidaridad</span></paper-checkbox><hr><br><p>Comercio paga el servicio de entrega: Cuando el repartidor llegue recoger el pedido pagara el total - costo de delivery</p><br><paper-checkbox id="check_habilitar_comercio_paga_entrega"><span>Comercio paga el servicio de entrega</span></paper-checkbox><hr><br><p>Comercio puede llamar a un repartidor de papaya express?</p><br><paper-checkbox id="check_habilitar_llamar_repartidor"><span>Habilitar llamar a repartdior</span></paper-checkbox><hr><br><p>Comercio acepta pedidos programados?</p><br><paper-checkbox id="check_habilitar_pedidos_programados"><span>Habilitar pedidos programados</span></paper-checkbox><hr><br><p>Comercio acepta pedidos programados solo del dia? -para los comercios que cambiar carta diario-</p><br><paper-checkbox id="check_pwa_pedido_programado_solo_del_dia"><span>Habilitar pedidos programados solo del dia</span></paper-checkbox><hr><br><p>Servicio de reparto papaya express solo para pedidos desde la App?</p><br><paper-checkbox id="check_pwa_delivery_reparto_solo_app"><span>Habilitar servicio delivery solo pedidos desde la app</span></paper-checkbox><hr><br><p>Comision FIJA comercio no afiliado - comision para la plataforma (x ej: 1.50)</p><input class="xMiInput xPasarEnter2"placeholder="COMSION FIJA COMERCIO NO AFILIADO"id="pwa_delivery_comision_fija_no_afiliado"name="pwa_delivery_comision_fija_no_afiliado"espaciar required><br><br><p>Importe minimo de delivery</p><input class="xMiInput xPasarEnter2"placeholder="IMPORTE MINIMO DE CONSUMO"id="pwa_delivery_importe_min"name="pwa_delivery_importe_min"espaciar required><br><br><p>Importe que acumula en pedidos para ser llevados por un solo repartidor</p><input class="xMiInput xPasarEnter2"placeholder="IMPORTE ACUMULA"id="pwa_delivery_monto_acumla"name="pwa_delivery_monto_acumla"espaciar required><br><br><p>COMISION ACORDADA (%) - colocar sin simbolo</p><input class="xMiInput xPasarEnter2"placeholder="COMISION ACORDADA"id="comsion_entrega"name="comsion_entrega"espaciar required><br><br><p>Datos para delivery:</p><input class="xMiInput xPasarEnter2"placeholder="CIUDAD"id="ciudad"name="ciudad"espaciar required> <input class="xMiInput xPasarEnter2"placeholder="PROVINCIA"id="provincia"name="provincia"espaciar required> <input class="xMiInput xPasarEnter2"placeholder="DEPARTAMENTO"id="departamento"name="departamento"espaciar required> <input class="xMiInput xPasarEnter2"placeholder="CODIGO POSTAL"id="codigo_postal"name="codigo_postal"espaciar required><br><br><br><p>Atencion al publico:</p><br><label><input type="checkbox"name=""class="dia_atencion"value="2">Lunes</label> <label><input type="checkbox"name=""class="dia_atencion"value="3">Martes</label> <label><input type="checkbox"name=""class="dia_atencion"value="4">Miercoles</label> <label><input type="checkbox"name=""class="dia_atencion"value="5">Jueves</label> <label><input type="checkbox"name=""class="dia_atencion"value="6">Viernes</label> <label><input type="checkbox"name=""class="dia_atencion"value="7">Sabado</label> <label><input type="checkbox"name=""class="dia_atencion"value="1">Domingo</label><br><br><hr><p>Horario de trabajo: Ingrese en formato 24hrs</p><br><div><input placeholder="desde"id="txt_horario_de"> <input placeholder="hasta"id="txt_horario_a"><div class="xBoton2 xVerde"onclick="xAddHorarioTrabajo()">Agregar</div><table width="100%"><tbody><template is="dom-repeat"items="{{ListSedesHorario}}"as="item"><tr data-id="{{item.idsede_horario_trabajo}}"data-t="sede_horario_trabajo"><td><p style="font-size:12px;inline-size:130px;overflow-wrap:break-word">{{item.desdia}}<td>{{item.de}}<td>{{item.a}}<td><span onclick="xBorrarItem(this)"class="xDeleteRow"title="Borrar"></span></template></table></div><br><br><input class="xMiInput xPasarEnter2"placeholder="TIEMPO DE ENTREGA EJ: 10 A 15 MIN"onchange="conMayusculas(this)"id="tiempo_aprox_entrega"name="tiempo_aprox_entrega"espaciar required><br><br><p>TIEMPO transcurridos para notificar al repartidor:</p><br><input class="xMiInput xPasarEnter2"placeholder="TIEMPO TRANSUCURRIDO PARA NOTIFICAR A REPARTIDOR EJ: Comercio prepara en 10min y el repartidor se lo avisa en 5(transucirridos)"onchange="conMayusculas(this)"id="pwa_min_despacho"name="pwa_min_despacho"espaciar required><br><br><p>Telefono a donde notifica pedido delivery nuevo - Si esta en blanco no notifica:</p><br><input class="xMiInput xPasarEnter2"placeholder="TELEFONO NOTIFICA PEDIDO"onchange="conMayusculas(this)"id="pwa_delivery_telefono_notifica_pedido"name="pwa_delivery_telefono_notifica_pedido"espaciar required><br><br><br><p>Imagen para app delivery: se recomienda un maximo de ancho 310px y alto de 125px</p><input class="xMiInput"placeholder="Logo"maxlength="200"onclick="xSeleccionarFoto()"id="pwa_delivery_img"readonly="readonly"> <input type="file"class="xInvisible xobj_subir_foto"id="ctrl_open_file"accept="image/*"> <img id="imgLogo"src=""alt=""style="max-width:310px"><br><br><p>Imagen para app delivery: Imagen peque√±a max 150px de ancho</p><input class="xMiInput"placeholder="Logo"maxlength="200"onclick="xSeleccionarFotoMini()"id="img_mini"readonly="readonly"> <input type="file"class="xInvisible xobj_subir_foto_mini"id="ctrl_open_file_mini"accept="image/*"> <img id="imgLogoMini"src=""alt=""style="max-width:310px"><br><br><br><br><p>Establecimiento acepta Resevas?</p><br><paper-checkbox id="check_pwa_acepta_reservas"><span>Habilitar resevas de papaya express</span></paper-checkbox><hr><br><p>Establecimiento muestra los items como supermercado o estanes? Solo para establecimientos delivery (mercados, licorerias ...)</p><br><paper-checkbox id="check_pwa_show_item_view_mercado"><span>Habilitar vista de items como supermercado</span></paper-checkbox><hr><br><p>Si recibe reservas antes del horario de atenci√≥n, especificar en formato 24hr. Al abrir el servidor de impresion se imprimiran las reservas hechas antes del horario de apertura.</p><br><input class="xMiInput xPasarEnter2"placeholder="DESDE QUE HORA RECIBE RESERVAS"onchange="conMayusculas(this)"id="pwa_acepta_reserva_desde"name="pwa_acepta_reserva_desde"espaciar required><br><br><div class="xInvisible"><input id="idorg"name="idorg"value$="{{xIdOrg}}"> <input id="idsede"name="idsede"value$="{{xIdSede}}"> <input id="dias_atienden"name="dias_atienden"> <input id="pwa_habilitar_delivery_app"name="pwa_habilitar_delivery_app"> <input id="pwa_comercio_afiliado"name="pwa_comercio_afiliado"> <input id="pwa_delivery_servicio_propio"name="pwa_delivery_servicio_propio"> <input id="pwa_delivery_hablitar_calc_costo_servicio"name="pwa_delivery_hablitar_calc_costo_servicio"> <input id="pwa_delivery_habilitar_calc_costo_servicio_solo_app"name="pwa_delivery_habilitar_calc_costo_servicio_solo_app"> <input id="pwa_delivery_acepta_yape"name="pwa_delivery_acepta_yape"> <input id="pwa_delivery_habilitar_recojo_local"name="pwa_delivery_habilitar_recojo_local"> <input id="pwa_delivery_comercio_solidaridad"name="pwa_delivery_comercio_solidaridad"> <input id="pwa_delivery_acepta_tarjeta"name="pwa_delivery_acepta_tarjeta"> <input id="pwa_delivery_comercio_paga_entrega"name="pwa_delivery_comercio_paga_entrega"> <input id="pwa_delivery_habilitar_llamar_repartidor_papaya"name="pwa_delivery_habilitar_llamar_repartidor_papaya"> <input id="pwa_delivery_habilitar_pedido_programado"name="pwa_delivery_habilitar_pedido_programado"> <input id="pwa_pedido_programado_solo_del_dia"name="pwa_pedido_programado_solo_del_dia"> <input id="pwa_habilitar_busqueda_mapa"name="pwa_habilitar_busqueda_mapa"> <input id="pwa_delivery_reparto_solo_app"name="pwa_delivery_reparto_solo_app"> <input id="pwa_acepta_reservas"name="pwa_acepta_reservas"> <input id="pwa_show_item_view_mercado"name="pwa_show_item_view_mercado"></div></form><br><br><br><p>Categoria<hr><template is="dom-repeat"items="{{ListCategoria}}"as="item"><input type="radio"class="option_categoria"id="{{item.descripcion}}"name="categioria"value="{{item.idsede_categoria}}"> <label for="{{item.descripcion}}">{{item.descripcion}}</label></template><br><br><p>Sub Categoria<hr><template is="dom-repeat"items="{{ListSubCategoria}}"as="item"><label><input type="checkbox"class="option_subcategoria"name=""id=""value="{{item.idsede_subcategoria}}">{{item.descripcion}}</label></template><br><br><hr><br><br><div class="xBoton2 xAzul"onclick="xAdmGuardarDatosAPP()">Guardar</div></div></iron-pages></div></div></div></div><br><br><br><br></template></dom-module><script>var xThisAdminNew,xPopupLoad,xCompPlanSelect;function xIniAdminNew(){xPopupLoad=document.getElementById("xLoad"),xThisAdminNew.selected_conf=0,xCompPlanSelect=document.getElementById("compPlanSelect"),xLoadAdmDatosOrg(),$("#ctrl_open_file").change(function(e){for(var a=0;a<e.originalEvent.srcElement.files.length;a++){var i,o=e.originalEvent.srcElement.files[a];$("#pwa_delivery_img").val(o.name),o&&((i=new FileReader).onload=function(e){$("#imgLogo").attr("src",e.target.result)},i.readAsDataURL(o))}}),$("#ctrl_open_file_mini").change(function(e){for(var a=0;a<e.originalEvent.srcElement.files.length;a++){var i,o=e.originalEvent.srcElement.files[a];$("#img_mini").val(o.name),o&&((i=new FileReader).onload=function(e){$("#imgLogoMini").attr("src",e.target.result)},i.readAsDataURL(o))}})}function xSeleccionarFoto(){$("#ctrl_open_file").click()}function xSeleccionarFotoMini(){$("#ctrl_open_file_mini").click()}function xItemGuardarFoto(){$(".xobj_subir_foto").each(function(e,a){""!=$(this).val()&&(file=this.files[0],name=file.name,size=file.size,type=file.type,nomfile=xThisAdminNew.xIdOrg+xThisAdminNew.xIdSede+name,(xhr=new XMLHttpRequest).upload.addEventListener("load",transferenciaCompleta(nomfile),!1),xhr.open("POST","upload.php?op=3",!0),xhr.setRequestHeader("Cache-Control","no-cache"),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.setRequestHeader("X-File-Name",nomfile),xhr.send(file))})}function transferenciaCompleta(a){$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=604",data:{idsede:xThisAdminNew.xIdSede,d:a}}).done(function(e){$("#pwa_delivery_img").val(a),xPopupLoad.xclose()})}function xItemGuardarFotoMini(){$(".xobj_subir_foto_mini").each(function(e,a){""!=$(this).val()&&(file=this.files[0],name=file.name,size=file.size,type=file.type,nomfile=xThisAdminNew.xIdOrg+xThisAdminNew.xIdSede+name,(xhr=new XMLHttpRequest).upload.addEventListener("load",transferenciaCompletaMini(nomfile),!1),xhr.open("POST","upload.php?op=3",!0),xhr.setRequestHeader("Cache-Control","no-cache"),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.setRequestHeader("X-File-Name",nomfile),xhr.send(file))})}function transferenciaCompletaMini(a){$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=60401",data:{idsede:xThisAdminNew.xIdSede,d:a}}).done(function(e){$("#img_mini").val(a),xPopupLoad.xclose()})}function xAdmGuardarOrg(){xPopupLoad.xopen(),$.post("../../bdphp/ManejoBD_IUD.php?tb=org",$("#frm_org").serialize(),function(e){xPopupLoad.xclose(),xAdmGuardarUsuario()})}function xAdmGuardarSede(){xPopupLoad.xopen();var e=selTipo.value,e=($("#frm_sede #idorg").val(xThisAdminNew.xIdOrg),$("#frm_sede #idsede").val(xThisAdminNew.xIdSede),$("#frm_sede #tipo").val(e),check_print_server.checked?1:0),a=check_pwa.checked?1:0,i=check_isprinter_socket.checked?1:0,o=check_habilita_facturacion.checked?1:0,r=check_speech_disabled.checked?1:0,d=check_habilita_verificacion_cpe.checked?1:0;$("#frm_sede #sys_local").val(e),$("#frm_sede #pwa").val(a),$("#frm_sede #isprinter_socket").val(i),$("#frm_sede #speech_disabled").val(r),$("#frm_sede #facturacion_e_activo").val(o),$("#frm_sede #habilita_verificacion_cpe").val(d),$.post("../../bdphp/ManejoBD_IUD.php?tb=sede",$("#frm_sede").serialize(),function(e){xPopupLoad.xclose(),""===xThisAdminNew.xIdSede&&(xThisAdminNew.xIdSede=e,xAddNewConfigNewOrg(xThisAdminNew.xIdOrg,xThisAdminNew.xIdSede)),xLoadAdmDatosOrg(),$("#frm_sede").reset()})}function xAdmGuardarUsuario(){var e={idorg:xThisAdminNew.xIdOrg,idsede:xThisAdminNew.xIdSede,u:txt_usuario.value,p:txt_usuario_password.value};$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=201",data:{d:e}}).done(e=>{$("#txt_usuario").val(""),$("#txt_usuario_password").val(""),xThisAdminNew.xIdSede=""})}function xLoadAdmDatosOrg(){var e=localStorage.getItem("::app3_woOAdm")?JSON.parse(localStorage.getItem("::app3_woOAdm")):null;xThisAdminNew.xIdOrg="",null!==e&&(xThisAdminNew.xIdOrg=e.idorg,$("#frm_org #nombre").val(e.razonsocial),$("#frm_org #ruc").val(e.ruc),$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=101",data:{idorg:e.idorg}}).done(e=>{e=$.parseJSON(e);xThisAdminNew.ListSedesPorOrg=e.datos}),$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=102",data:{idorg:e.idorg}}).done(e=>{txt_usuario.value=e}))}function xAdmNewModificarSede(e){var e=(void 0!==e.dataId?e:e.parentElement).dataId,a=xThisAdminNew.ListSedesPorOrg[e];xThisAdminNew.xIdSede=xThisAdminNew.ListSedesPorOrg[e].idsede,$("#frm_sede #nombre").val(a.nombre),$("#frm_sede #ciudad").val(a.ciudad),$("#frm_sede #ubigeo").val(a.ubigeo),$("#frm_sede #codigo_del_domicilio_fiscal").val(a.codigo_del_domicilio_fiscal),$("#frm_sede #authorization_api_comprobante").val(a.authorization_api_comprobante),$("#frm_sede #sufijo").val(a.sufijo),$("#frm_sede #id_api_comprobante").val(a.id_api_comprobante),$("#frm_sede #sys_local").val(a.sys_local),$("#frm_sede #ip_server_local").val(a.ip_server_local),$("#frm_sede #pwa").val(a.pwa),$("#frm_sede #pwa").val(a.isprinter_socket),$("#frm_sede #finicio").val(a.finicio),$("#frm_sede #pwa_time_limit").val(a.pwa_time_limit),$("#frm_sede #url_api_fac").val(a.url_api_fac),$("#frm_sede #costo_restobar_fijo_mensual").val(a.costo_restobar_fijo_mensual),$("#frm_sede #idsede_plan_contratado").val(a.idsede_plan_contratado),$("#frm_sede #umf_pago").val(a.umf_pago),$("#frm_sede #tipo_contribuyente").val(a.tipo_contribuyente),$("#frm_sede #link_carta").val(a.link_carta),xCompPlanSelect.setPlan(a.idsede_plan_contratado),check_print_server.checked="0"!==a.ip_server_local,check_pwa.checked="0"!==a.pwa,check_isprinter_socket.checked="0"!==a.isprinter_socket,check_habilita_facturacion.checked="0"!==a.facturacion_e_activo,check_habilita_verificacion_cpe.checked="0"!==a.habilita_verificacion_cpe,check_habilita_delivery.checked="0"!==a.pwa_habilitar_delivery_app,check_afiliado_delivery.checked="0"!==a.pwa_comercio_afiliado,check_afiliado_repartidor.checked="0"!==a.pwa_delivery_servicio_propio,check_afiliado_calc_distancia.checked="0"!==a.pwa_delivery_hablitar_calc_costo_servicio,check_afiliado_calc_distancia_solo_app.checked="0"!==a.pwa_delivery_habilitar_calc_costo_servicio_solo_app,check_afiliado_yape.checked="0"!==a.pwa_delivery_acepta_yape,check_afiliado_recojo_local.checked="0"!==a.pwa_delivery_habilitar_recojo_local,check_habilitar_solidaridad.checked="0"!==a.pwa_delivery_comercio_solidaridad,check_habilitar_tarjeta.checked="0"!==a.pwa_delivery_acepta_tarjeta,check_habilitar_comercio_paga_entrega.checked="0"!==a.pwa_delivery_comercio_paga_entrega,check_habilitar_llamar_repartidor.checked="0"!==a.pwa_delivery_habilitar_llamar_repartidor_papaya,check_habilitar_pedidos_programados.checked="0"!==a.pwa_delivery_habilitar_pedido_programado,check_pwa_pedido_programado_solo_del_dia.checked="0"!==a.pwa_pedido_programado_solo_del_dia,check_habilitar_busqueda_mapa.checked="0"!==a.pwa_habilitar_busqueda_mapa,check_pwa_delivery_reparto_solo_app.checked="0"!==a.pwa_delivery_reparto_solo_app,check_pwa_acepta_reservas.checked="0"!==a.pwa_acepta_reservas,check_pwa_show_item_view_mercado.checked="0"!==a.pwa_show_item_view_mercado,check_speech_disabled.checked="0"!==a.speech_disabled,selTipo.value=a.tipo,$("#formDatosAPP #latitude").val(a.latitude),$("#formDatosAPP #longitude").val(a.longitude),$("#formDatosAPP #ciudad").val(a.ciudad),$("#formDatosAPP #provincia").val(a.provincia),$("#formDatosAPP #departamento").val(a.departamento),$("#formDatosAPP #codigo_postal").val(a.codigo_postal),$("#formDatosAPP #tiempo_aprox_entrega").val(a.tiempo_aprox_entrega),$("#formDatosAPP #pwa_delivery_img").val(a.pwa_delivery_img),$("#formDatosAPP #dias_atienden").val(a.dias_atienden),$("#formDatosAPP #comsion_entrega").val(a.comsion_entrega),$("#formDatosAPP #pwa_delivery_importe_min").val(a.pwa_delivery_importe_min),$("#formDatosAPP #pwa_delivery_comision_fija_no_afiliado").val(a.pwa_delivery_comision_fija_no_afiliado),$("#formDatosAPP #pwa_habilitar_delivery_app").val(a.pwa_habilitar_delivery_app),$("#formDatosAPP #pwa_delivery_servicio_propio").val(a.pwa_delivery_servicio_propio),$("#formDatosAPP #pwa_delivery_hablitar_calc_costo_servicio").val(a.pwa_delivery_hablitar_calc_costo_servicio),$("#formDatosAPP #pwa_delivery_habilitar_calc_costo_servicio_solo_app").val(a.pwa_delivery_habilitar_calc_costo_servicio_solo_app),$("#formDatosAPP #pwa_delivery_acepta_yape").val(a.pwa_delivery_acepta_yape),$("#formDatosAPP #pwa_delivery_habilitar_recojo_local").val(a.pwa_delivery_habilitar_recojo_local),$("#formDatosAPP #pwa_delivery_comercio_solidaridad").val(a.pwa_delivery_comercio_solidaridad),$("#formDatosAPP #pwa_delivery_acepta_tarjeta").val(a.pwa_delivery_acepta_tarjeta),$("#formDatosAPP #pwa_delivery_comercio_paga_entrega").val(a.pwa_delivery_comercio_paga_entrega),$("#formDatosAPP #pwa_delivery_habilitar_llamar_repartidor_papaya").val(a.pwa_delivery_habilitar_llamar_repartidor_papaya),$("#formDatosAPP #pwa_min_despacho").val(a.pwa_min_despacho),$("#formDatosAPP #pwa_delivery_telefono_notifica_pedido").val(a.pwa_delivery_telefono_notifica_pedido),$("#formDatosAPP #pwa_delivery_monto_acumla").val(a.pwa_delivery_monto_acumla),$("#formDatosAPP #pwa_delivery_habilitar_pedido_programado").val(a.pwa_delivery_habilitar_pedido_programado),$("#formDatosAPP #pwa_habilitar_busqueda_mapa").val(a.pwa_habilitar_busqueda_mapa),$("#formDatosAPP #pwa_delivery_reparto_solo_app").val(a.pwa_delivery_reparto_solo_app),$("#formDatosAPP #pwa_acepta_reservas").val(a.pwa_acepta_reservas),$("#formDatosAPP #pwa_show_item_view_mercado").val(a.pwa_show_item_view_mercado),$("#formDatosAPP #pwa_acepta_reserva_desde").val(a.pwa_acepta_reserva_desde),$(".dia_atencion").each((e,a)=>{a.checked=!1});const i=a.dias_atienden;i&&$(".dia_atencion").each((e,a)=>{a.checked=-1<i.indexOf(a.value)}),xLoadCategorias(),xLoadHorarioTrabajo()}function xAdmNewNuevaSede(){$("#frm_sede").reset(),$("#txt_usuario").val(""),$("#txt_usuario_password").val(""),xThisAdminNew.xIdSede="",$("#frm_sede #nombre").focus()}function xAdmNewValidarUsuario(e){e=e.value;""!==e&&$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=2",data:{u:e}}).done(e=>{xThisAdminNew.formValidUsuario=0===e.length;var a="Usuario Valido";$("#labelUsValido").removeClass("xInvisible"),0===e.length?($("#labelUsValido").removeClass("xColorRow_Rojo"),$("#labelUsValido").addClass("xColorRow_verde")):(a="Usuario ya existe",$("#labelUsValido").addClass("xColorRow_Rojo"),$("#labelUsValido").removeClass("xColorRow_verde")),$("#labelUsValido").text(a)})}function xAdmNewValidarSufijo(e){e=e.value.toUpperCase();""!==e&&$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=202",data:{u:e}}).done(e=>{xThisAdminNew.formValidSufijo=0===e.length;var a="Sufijo Valido";$("#labelSufijoValido").removeClass("xInvisible"),0===e.length?($("#labelSufijoValido").removeClass("xColorRow_Rojo"),$("#labelSufijoValido").addClass("xColorRow_verde")):(a="Sufijo ya existe",$("#labelSufijoValido").addClass("xColorRow_Rojo"),$("#labelSufijoValido").removeClass("xColorRow_verde")),$("#labelSufijoValido").text(a)})}function xAddNewConfigNewOrg(e,a){$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=3",data:{idorg:e,idsede:a}}).done(e=>{})}function xLoadCategorias(){$(".option_categoria").each((e,a)=>{a.checked=!1}),$(".option_subcategoria").each((e,a)=>{a.checked=!1}),$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=6"}).done(e=>{xThisAdminNew.ListCategoria=JSON.parse(e).datos,$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=601"}).done(e=>{xThisAdminNew.ListSubCategoria=JSON.parse(e).datos,$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=602",data:{idsede:xThisAdminNew.xIdSede}}).done(e=>{xThisAdminNew.ListSubCategoriaSuscritas=JSON.parse(e).datos[0],xThisAdminNew.ListSubCategoriaSuscritas.idsede_categoria&&($(".option_categoria").each((e,a)=>{a.checked=-1<xThisAdminNew.ListSubCategoriaSuscritas.idsede_categoria.indexOf(a.value)}),$(".option_subcategoria").each((e,a)=>{a.checked=-1<xThisAdminNew.ListSubCategoriaSuscritas.idsede_subcategoria.indexOf(a.value)}))})})})}function xAdmGuardarDatosAPP(){xPopupLoad.xopen();var i,e=check_habilita_delivery.checked?1:0,a=check_afiliado_delivery.checked?1:0,o=check_afiliado_repartidor.checked?1:0,r=check_afiliado_calc_distancia.checked?1:0,d=check_afiliado_calc_distancia_solo_app.checked?1:0,_=check_afiliado_yape.checked?1:0,l=check_afiliado_recojo_local.checked?1:0,t=check_habilitar_solidaridad.checked?1:0,c=check_habilitar_tarjeta.checked?1:0,s=check_habilitar_comercio_paga_entrega.checked?1:0,p=check_habilitar_llamar_repartidor.checked?1:0,n=check_habilitar_pedidos_programados.checked?1:0,h=check_pwa_pedido_programado_solo_del_dia.checked?1:0,m=check_habilitar_busqueda_mapa.checked?1:0,v=check_pwa_delivery_reparto_solo_app.checked?1:0,f=check_pwa_acepta_reservas.checked?1:0,u=check_pwa_show_item_view_mercado.checked?1:0,w="",x=($(".dia_atencion").each((e,a)=>{a.checked&&(w+=a.value+",")}),[]),g={};$(".option_categoria").each((e,a)=>{a.checked&&(i=a.value)}),$(".option_subcategoria").each((e,a)=>{a.checked&&(g={idsede_categoria:i,idsede_subcategoria:a.value},x.push(g))}),0===x.length&&(g={idsede_categoria:i,idsede_subcategoria:0},x.push(g)),$("#formDatosAPP #dias_atienden").val(w),$("#formDatosAPP #pwa_habilitar_delivery_app").val(e),$("#formDatosAPP #pwa_comercio_afiliado").val(a),$("#formDatosAPP #pwa_delivery_servicio_propio").val(o),$("#formDatosAPP #pwa_delivery_hablitar_calc_costo_servicio").val(r),$("#formDatosAPP #pwa_delivery_habilitar_calc_costo_servicio_solo_app").val(d),$("#formDatosAPP #pwa_delivery_acepta_yape").val(_),$("#formDatosAPP #pwa_delivery_habilitar_recojo_local").val(l),$("#formDatosAPP #pwa_delivery_comercio_solidaridad").val(t),$("#formDatosAPP #pwa_delivery_acepta_tarjeta").val(c),$("#formDatosAPP #pwa_delivery_comercio_paga_entrega").val(s),$("#formDatosAPP #pwa_delivery_habilitar_llamar_repartidor_papaya").val(p),$("#formDatosAPP #pwa_delivery_habilitar_pedido_programado").val(n),$("#formDatosAPP #pwa_pedido_programado_solo_del_dia").val(h),$("#formDatosAPP #pwa_habilitar_busqueda_mapa").val(m),$("#formDatosAPP #pwa_delivery_reparto_solo_app").val(v),$("#formDatosAPP #pwa_acepta_reservas").val(f),$("#formDatosAPP #pwa_show_item_view_mercado").val(u),$.post("../../bdphp/ManejoBD_IUD.php?tb=sede",$("#formDatosAPP").serialize(),function(e){$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=603",data:{idsede:xThisAdminNew.xIdSede,arrItems:x}}).done(e=>{xItemGuardarFoto(),xItemGuardarFotoMini(),xPopupLoad.xclose()})})}function xAddHorarioTrabajo(){let i="",o="";$(".dia_atencion").each((e,a)=>{i+=a.checked?a.value+",":"",o+=a.checked?a.labels[0].textContent+",":""}),$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=700",data:{idsede:xThisAdminNew.xIdSede,de:txt_horario_de.value,a:txt_horario_a.value,dias:i,desdias:o}}).done(e=>{console.log(e),xLoadHorarioTrabajo()})}function xLoadHorarioTrabajo(){$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=701",data:{idsede:xThisAdminNew.xIdSede}}).done(e=>{xThisAdminNew.ListSedesHorario=JSON.parse(e).datos,console.log("xThisAdminNew.ListSedesHorario",xThisAdminNew.ListSedesHorario)})}function changePlan(e){console.log("changePlan",e),idsede_plan_contratado.value=e.idsede_plan_contratado}function verificarDisponibilidadLink(e){e=e.value;$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=16",data:{link_carta:e}}).done(e=>{e=JSON.parse(e).datos,xThisAdminNew.isLinkDisponible=0<e.length})}Polymer({is:"x-admin-new-org",properties:{formValid:boolean=!1,formValidUsuario:boolean=!1,formValidSufijo:boolean=!1,xIdOrg:{type:String,value:""},xIdSede:{type:String,value:""},ListSedesPorOrg:[],ListCategoria:[],ListSubCategoria:[],ListSubCategoriaSuscritas:[],ListSedesHorario:[],isLinkDisponible:Boolean},attached:function(){this.isLinkDisponible=!1,(xThisAdminNew=this).selected_conf=0,xIniAdminNew(),$("body").addClass("loaded")},displayIndex:function(e){return xCeroIzq(e+1,1)}})</script>