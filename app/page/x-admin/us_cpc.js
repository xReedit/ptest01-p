var _id_num_us_new_cpc,_companySelect,_num_us_new_cpc="";function xLoadCpc(){$.ajax({url:"../../bdphp/log_004.php?op=4"}).done(e=>{e=$.parseJSON(e);xThisAdmin.listCpc=e.datos})}function xCpcLoad_Uusario_Cpc(e){xPopupLoad.titulo="Cargado...",xPopupLoad.xopen();e=e.parentElement.dataId,xThisAdmin.UsarioCpc_sedes=xThisAdmin.listCpc[e],usuario_cpc.textContent=xThisAdmin.UsarioCpc_sedes.usuario,console.log(xThisAdmin.UsarioCpc_sedes),e=xThisAdmin.UsarioCpc_sedes.idus_cpc;xloadEstablecimientosAsigConta(_id_num_us_new_cpc=e),dialog_add_us_cpc.open()}function xloadEstablecimientosAsigConta(e){$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=401",data:{id:e}}).done(e=>{e=JSON.parse(e);xThisAdmin.listCpc_sedes=e.datos,xPopupLoad.xclose()})}function xCpeValidarFormSave(){xvalidateFormInput("frm_cpc",async function(e){!1===e?alert("Complete los campos requeridos"):xCpcSave_Usuario_Cpc()})}async function xCpcSave_Usuario_Cpc(){""==(_id_num_us_new_cpc=idusuario.value)&&(_id_num_us_new_cpc=await xCpcRegistrarNuevoUsuarioCPC(),idusuario.value=_id_num_us_new_cpc),xPopupLoad.xopen(),$.post("../../bdphp/ManejoBD_IUD.php?tb=us_cpc",$("#frm_cpc").serialize(),function(e){dialog_add_us_cpc.close(),xPopupLoad.xclose(),xNuevoUsuarioCPC(),xLoadCpc()})}function xResetearClave(){var e=xThisAdmin.UsarioCpc_sedes.idusuario;""!==e&&(xPopupLoad.xopen(),$.ajax({type:"POST",url:"../../bdphp/log.php?op=4031",data:{i:e}}),setTimeout(()=>{xPopupLoad.xclose()},200))}async function xCpcRegistrarNuevoUsuarioCPC(){var o=0,e=nombre_cpc.value;return await $.ajax({type:"POST",url:"../../bdphp/log_004.php?op=403",data:{n:e,u:_num_us_new_cpc}}).done(e=>{o=e}),o}function xNuevoUsuarioCPC(){$("#frm_cpc").reset(),xThisAdmin.UsarioCpc_sedes={},xThisAdmin.listCpc_sedes=[]}function xCpcNewUs(){xNuevoUsuarioCPC(),xGetUsNew(),dialog_add_us_cpc.open()}function xGetUsNew(){$.ajax({url:"../../bdphp/log_004.php?op=402"}).done(e=>{_num_us_new_cpc="CONTA"+xCeroIzq(e,3),usuario_cpc.textContent=_num_us_new_cpc})}function getAllCompaniesFac(){$.ajax({url:"../../bdphp/log_004.php?op=5"}).done(e=>{(e=JSON.parse(e)).error?console.log(e.error):xThisAdmin.listCompanies=e.data})}function selectOptionCompanies(){var e=xThisAdmin.$.selConpanies.value;_companySelect=xThisAdmin.listCompanies[e]}function addCompaniesContador(){var e;13==event.keyCode&&(_id_num_us_new_cpc?(e="",e=_companySelect.mes_inicio||xDevolverFechaParte("mm")+"/"+xDevolverFechaParte("yy"),e={user_id:_companySelect.user_id,idus_cpc:_id_num_us_new_cpc,razonsocial:_companySelect.razonsocial,ruc:_companySelect.ruc,nomsede:txt_companies_sede.value,serie:txt_companies_serie.value,ciudad:txt_companies_ciudad.value,mes_inicio:e},$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=501",data:{item:e}}).done(e=>{console.log(e),xloadEstablecimientosAsigConta(_id_num_us_new_cpc)})):alert("Guarda primero el contador."))}