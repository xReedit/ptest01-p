<link rel="import"href="./x-repartidores.html"><link rel="import"href="./x-admin-change-sys.html"><dom-module id="x-admin"><link rel="import"href="../../x-componentes/x-comp-select-plan/x-comp-select-plan.html"><template><paper-dialog id="dialogSedeUp"entry-animation="scale-up-animation"exit-animation="fade-out-animation"class="dialog_redondo"with-backdrop><div class="xContent"><p class="fs-20 fw-600">Restablecer Servicio</p><br><div><p>Establecimiento: <span class="text-primary"id="p_razonsocial">{{sedeDown.razonsocial}}</span><p>Sede: <span class="text-primary"id="p_nomsede">{{sedeDown.nomsede}}</span><p>Ciudad: <span class="text-primary"id="p_ciudad">{{sedeDown.ciudad}}</span><hr><p class="fw-600 fs-18">¿Está seguro de restablecer el servicio a la sede?</p><br><div><button class="btn btn-sm btn-success"on-click="upSede">Restablecer</button> <button class="btn btn-sm btn-secondary"onclick="dialogSedeUp.close()">Cerrar</button></div></div></div></paper-dialog><paper-dialog id="dialogSedeDown"entry-animation="scale-up-animation"exit-animation="fade-out-animation"class="dialog_redondo"with-backdrop><div class="xContent"><p class="fs-20 fw-600">Dar de baja</p><br><div><div><p>Establecimiento: <span class="text-primary"id="p_razonsocial">{{sedeDown.razonsocial}}</span><p>Sede: <span class="text-primary"id="p_nomsede">{{sedeDown.nomsede}}</span><p>Ciudad: <span class="text-primary"id="p_ciudad">{{sedeDown.ciudad}}</span></p><br><p>Motivo de baja:</p><textarea class="selected-template-1 w-100"id="motivo_baja_sede"></textarea><p>Fecha de baja:</p><input type="date"class="selected-template-1"id="fecha_baja_sede"></div><br><hr><p class="fw-600 fs-18">¿Está seguro de dar de baja a la sede?</p><br><div><button class="btn btn-sm btn-danger"on-click="downSede">Dar de baja</button> <button class="btn btn-sm btn-secondary"onclick="dialogSedeDown.close()">Cerrar</button></div></div></div></paper-dialog><paper-dialog id="dialogPagarServicio"entry-animation="scale-up-animation"exit-animation="fade-out-animation"class="dialog_redondo"with-backdrop><div class="xContent"><p class="fs-15 fw-600">Registrar pago del servicio</p><br><div><div class="d-flexx align-items-center"hidden$="[[isShowChagePlan]]"><p class="fw-600 text-primary"id="p_plancontrado">Plan contratado:</p><i class="fa fa-refresh text-dark ml-2 xCursor"onclick="showChangePlan()"></i></div><div hidden$="[[!isShowChagePlan]]"><p>Seleccione Plan:</p><x-comp-select-plan clasecss="selected-template-1"id="compPlanSelectChange"></x-comp-select-plan></div></div><br><div class="xLinea2"></div><div class="d-flexx"><div class="pr-2"><p>Ultimo Mes Pagado:</p><input type="month"class="selected-template-1 xPasarEnter2"id="sus_ultimo_mes_pago_re"></div><div><p>Periodo:</p><select id="selPeriodoRe"class="selected-template-1 xCursor"><option value="MENSUAL">MENSUAL<option value="SEMESTRAL">SEMESTRAL<option value="ANUAL">ANUAL</select></div></div><br><p>Importe pagado:</p><input class="selected-template-1"id="importe_pago_suscripcion"><br><br><div><button class="btn btn-sm btn-success"onclick="registerPagoServicioSuscripcion()">Registrar</button> <button class="btn btn-sm btn-secondary"onclick="dialogPagarServicio.close()">Cerrar</button></div></div></paper-dialog><paper-dialog id="dialog_add_us_cpc"entry-animation="scale-up-animation"exit-animation="fade-out-animation"class="dialog_redondo"with-backdrop><div class="xContent"><div class="d-flexx"><div class="xBordeDe w-50"><h3>Datos del contador</h3><hr><br><div><form method="POST"id="frm_cpc"><input class="xMiInput xPasarEnter2"value$="{{UsarioCpc_sedes.nombre_cpc}}"placeholder="RAZON SOCIAL | NOMBRE"onchange="conMayusculas(this)"id="nombre_cpc"name="nombre_cpc"espaciar required> <input type="number"class="xMiInput xPasarEnter2"value$="{{UsarioCpc_sedes.ruc}}"placeholder="RUC | DNI"onchange="conMayusculas(this)"id="ruc"name="ruc"espaciar> <input class="xMiInput xPasarEnter2"value$="{{UsarioCpc_sedes.telefono}}"placeholder="TELEFONO"onchange="conMayusculas(this)"id="telefono"name="telefono"espaciar> <input class="xMiInput xPasarEnter2"value$="{{UsarioCpc_sedes.direccion}}"placeholder="DIRECCION"onchange="conMayusculas(this)"id="direccion"name="direccion"espaciar> <input class="xMiInput xPasarEnter2"value$="{{UsarioCpc_sedes.ciudad}}"placeholder="CIUDAD"onchange="conMayusculas(this)"id="ciudad"name="ciudad"espaciar required> <input class="xMiInput xPasarEnter2"value$="{{UsarioCpc_sedes.ubigeo}}"placeholder="UBIGEO"onchange="conMayusculas(this)"id="ubigeo"name="ubigeo"espaciar required> <input class="xMiInput xPasarEnter2"value$="{{UsarioCpc_sedes.f_registro}}"placeholder="F. REGISTRO"onchange="conMayusculas(this)"id="f_registro"name="f_registro"espaciar><br><br><p><strong>Usuario del sistema: <span class="xColorRow_Azul"id="usuario_cpc"></span></strong><hr><br><a href="#"onclick="xResetearClave()">Resetear clave</a><br><hr><div class="xInvisible"><input id="idus_cpc"name="idus_cpc"value$="{{UsarioCpc_sedes.idus_cpc}}"> <input id="idusuario"name="idusuario"value$="{{UsarioCpc_sedes.idusuario}}"></div></form></div><br><button class="xBoton2 xAzul"onclick="xCpeValidarFormSave()">Guardar</button> <button class="xBoton2 xPlomo"onclick="dialog_add_us_cpc.close()">Cerrar</button></div><div class="xBordeIzqHover"><p><strong>Establecimientos Asignados</strong><hr><br><table width="100%"id="tb_cpc_sede"><thead><th align="left">#<th align="left">Establecimiento<th align="left">Sede<th align="left">Serie<th align="left">Ciudad<th align="left">Mes Inicio<th><tbody><tr><td colspan="2"><select id="selConpanies"class="xTextRow2 xCursor"onchange="selectOptionCompanies()"><template is="dom-repeat"items="{{listCompanies}}"as="item"><option value="[[index]]">[[item.razonsocial]]</template></select><td><input class="xMiInput xPasarEnter2"onchange="conMayusculas(this)"id="txt_companies_sede"espaciar><td><input type="number"class="xMiInput xPasarEnter2"onchange="conMayusculas(this)"id="txt_companies_serie"espaciar><td><input class="xMiInput xPasarEnter2"onchange="conMayusculas(this)"id="txt_companies_ciudad"espaciar><td><input type="month"style="width:50px"class="xMiInput xPasarEnter2"onchange="conMayusculas(this)"id="txt_companies_f_inicio"espaciar><td><button class="btn btn-sm btn-success"onclick="addCompaniesContador()">+</button></tr><template is="dom-repeat"items="{{listCpc_sedes}}"as="item"><tr data-t="us_cpc_sedes"data-id="{{item.idus_cpc_sedes}}"id="{{index}}"><td class="xfont11">{{displayIndex(index)}}<td class="xfont11">{{item.razonsocial}}<td class="xfont11">{{item.nomsede}}<td class="xfont11">{{item.serie}}<td class="xfont11">{{item.ciudad}}<td class="xfont11">{{item.mes_inicio}}<td><span class="xDeleteRow2 xCursor"title="Anular"onclick="xBorrarItem(this)"></span></template></table></div></div></div></paper-dialog><paper-dialog id="dialog_add_us_repartidor"style="max-width:420px"entry-animation="scale-up-animation"exit-animation="fade-out-animation"class="dialog_redondo"with-backdrop><div class="xContent"><h3>Datos del repartidor</h3><hr><br><div><x-repartidores usuarioreparido="UsarioRepartidorSelected"></x-repartidores></div></div></paper-dialog><br><div class="xMiCard xradius"style="width:calc(100% - 10%)"><div class="xEncanezadoCard xFondoRowAmarillo4">Listado de restaurantes.</div><div class="xContentCard"><paper-tabs selected="{{selected}}"id="tab_admin"><paper-tab>Establecimientos</paper-tab><paper-tab>Registro de Contadores CPC</paper-tab><paper-tab>Repartidores</paper-tab><paper-tab>Actualizaciones Sistema</paper-tab></paper-tabs><div class="xLinea2"></div><br><br><iron-pages selected="{{selected}}"><div id="div_establecimientos"><div class="x_div_linea"><h3>Establecimientos suscritos</h3><button class="xBoton2 xAzul xDerecha"onclick="xAdmGoNew()">Nuevo</button></div><hr><br><div><input id="textBuscarSede"class="xMiInput w-100 fs-18"placeholder="Buscar..."onkeyup="xBuscarSedesSuscritos(this)"></div><br><table width="100%"id="tb_pedidos_borrados"><thead><th>#<th>Razon Social<th>Sede<th>Ciudad<th>Tipo<th>F. Inicio<th>Estado<th>Pago<th><tbody><template is="dom-repeat"items="{{ListSedes}}"as="item"><tr data-id="{{index}}"><td>{{displayIndex(index)}}<td>{{item.razonsocial}}<td>{{item.nomsede}}<td>{{item.ciudad}}<td>{{item.tipo}}<td>{{item.finicio}}<td>Activo<td><div class="text-center"><span class$="{{computeClass(item.is_bloqueado)}}"><span hidden$="{{_isEqual(item.is_bloqueado, '1')}}"><i class="fa fa-check"></i></span> <span data-id="{{item.idsede}}"onclick="openPagoServicioSuscripcion(this)"hidden$="{{!_isEqual(item.is_bloqueado, '1')}}"><i class="fa fa-circle xCursor"></i></span></span></div><td><div class="d-flexx"data-id="{{index}}"><span class$="{{computeClass(item.is_baja)}}"data-id="{{index}}"><i hidden$="{{!_isEqual(item.is_baja, '1')}}"title="Dado de baja"class="fa fa-arrow-down xCursor"on-click="openDialogDown"></i> <i hidden$="{{_isEqual(item.is_baja, '1')}}"title="Activo"class="fa fa-rocket mr-4 xCursor"on-click="openDialogDown"></i> </span><span title="Modificar"onclick="xAdmModificarOrg(this)"class="xIconRow xCursor ml-2"><img src="../../../images/edit.png"></span></div></template></table></div><div id="div_contadores_cpc"><div class="x_div_linea"><h3>Listado de contadores</h3><button class="xBoton2 xAzul xDerecha"onclick="xCpcNewUs()">Nuevo</button></div><hr><br><table width="100%"id="tb_cpc"><thead><th>#<th>Razon Social / Nombres<th>Usuario<th>Ciudad<th># Sedes<th>F. registro<th>Estado<th><tbody><template is="dom-repeat"items="{{listCpc}}"as="item"><tr data-id="{{index}}"><td>{{displayIndex(index)}}<td>{{item.nombre_cpc}}<td>{{item.usuario}}<td>{{item.ciudad}}<td>{{item.num_sede}}<td>{{item.f_registro}}<td>Activo<td title="Modificar"onclick="xCpcLoad_Uusario_Cpc(this)"><span class="xIconRow xCursor"><img src="../../../images/edit.png"></span></template></table></div><div id="div_contadores_cpc"><div class="x_div_linea"><h3>Listado de repartidores</h3><button class="xBoton2 xAzul xDerecha"onclick="xCpcNewUsRepartidor()">Nuevo</button></div><hr><br><table width="100%"id="tb_cpc"><thead><th>#<th>Nombres<th>DNI<th>Telefono<th>Usuario<th>Ciudad<th>F. registro<th>Calificacion<th>P. Atendidos<th>P. Reasignados<th>En<th>Estado<th><tbody><template is="dom-repeat"items="{{listRepartidores}}"as="item"><tr data-id="{{index}}"><td>{{displayIndex(index)}}<td>{{item.nombre}} {{item.apellido}}<td>{{item.dni}}<td>{{item.telefono}}<td>{{item.usuario}}<td>{{item.ciudad}}<td>{{item.f_registro}}<td>{{item.calificacion}}<td>{{item.pedidos_atendidos}}<td>{{item.pedidos_reasignados}}<td>{{item.sede}}<td>{{item.des_estado}}<td title="Modificar"onclick="xCpcLoad_Uusario_Repartidor(this)"><span class="xIconRow xCursor"><img src="../../../images/edit.png"></span></template></table></div><div id="div_change_sys"><x-admin-change-sys></x-admin-change-sys></div></iron-pages><br><br></div></div></template></dom-module><style>.red{color:red}.green{color:green}</style><script src="./us_cpc.js"></script><script>var xThisAdmin,xPopupLoad,arrSede=[];function xIniAdmin(){xLoadCpc(),xLoadSedes(),getAllCompaniesFac(),xLoadRepartidores(),$("body").addClass("loaded")}function xLoadSedes(){$.ajax({url:"../../bdphp/log_004.php?op=1"}).done(e=>{e=$.parseJSON(e);arrSede=e.datos,xThisAdmin.ListSedes=e.datos})}function xBuscarSedesSuscritos(e){let d=e.value.toLowerCase();e=arrSede.filter(e=>e.nomsede).filter(e=>e.nomsede.toLowerCase().includes(d));xThisAdmin.ListSedes=e}function xLoadRepartidores(){$.ajax({url:"../../bdphp/log_004.php?op=9"}).done(e=>{e=$.parseJSON(e);xThisAdmin.listRepartidores=e.datos.map(e=>(e.des_estado="0"===e.estado?"Activo":"Baja",e.sede=null===e.idsede_suscrito?"RED":e.nom_sede,e))})}function xAdmModificarOrg(e){e=e.parentElement.dataId;localStorage.setItem("::app3_woOAdm",JSON.stringify(xThisAdmin.ListSedes[e])),router.go("/adm_dashboard-new")}function xAdmGoNew(){localStorage.removeItem("::app3_woOAdm"),router.go("/adm_dashboard-new")}function xCpcNewUsRepartidor(){dialog_add_us_repartidor.open()}function xCpcLoad_Uusario_Repartidor(e){xPopupLoad.titulo="Cargado...";e=e.parentElement.dataId;xThisAdmin.UsarioRepartidorSelected=xThisAdmin.listRepartidores[e],dialog_add_us_repartidor.open()}function openPagoServicioSuscripcion(d){xThisAdmin.idSedeSelectedPago=d.dataId;var e=xThisAdmin.ListSedes.filter(e=>e.idsede===d.dataId)[0];$("#importe_pago_suscripcion").val(e.costo_restobar_fijo_mensual),$("#selPeriodoRe").val(e.frecuencia),$("#p_plancontrado").text("Plan contratado: "+e.plan),document.getElementById("compPlanSelectChange").setPlan(e.idsede_plan_contratado),dialogPagarServicio.open()}function registerPagoServicioSuscripcion(){xPopupLoad.xopen();var e=$("#importe_pago_suscripcion").val(),d=$("#sus_ultimo_mes_pago_re").val(),a=$("#selPeriodoRe").val(),e={data:{idsede:xThisAdmin.idSedeSelectedPago,importe_pagado:e,ultimo_pago:d,frecuencia:a,idsede_plan_contratado:document.getElementById("compPlanSelectChange").getPlanSeleted().idsede_plan_contratado}};$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=1804",data:e}).done(e=>{dialogPagarServicio.close(),xThisAdmin.ListSedes.filter(e=>e.idsede===xThisAdmin.idSedeSelectedPago)[0].is_bloqueado="0",xThisAdmin.ListSedes=JSON.parse(JSON.stringify(xThisAdmin.ListSedes)),xPopupLoad.xclose()})}function showChangePlan(){xThisAdmin.isShowChagePlan=!xThisAdmin.isShowChagePlan}Polymer({is:"x-admin",properties:{ListSedes:[],listCpc:[],listCpc_sedes:[],listCompanies:[],listRepartidores:[],UsarioCpc_sedes:{},UsarioRepartidorSelected:{},idSedeSelectedPago:Number,isShowChagePlan:!1,sedeDown:{}},attached:function(){this.selected=0,this.isShowChagePlan=!1,xThisAdmin=this,xIniAdmin()},displayIndex:function(e){return xCeroIzq(e+1,1)},computeClass:function(e){return"1"===e?"red":"green"},_isEqual:function(e,d){return e===d},openDialogDown:function(e){e=e.target.parentElement.dataId;this.sedeDown=this.ListSedes[e],("0"===this.sedeDown.is_baja?dialogSedeDown:dialogSedeUp).open()},downSede:function(){var e=$("#motivo_baja_sede").val(),d=$("#fecha_baja_sede").val(),a=this.sedeDown.idsede;$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=19",data:{idsede:a,motivo_baja_sede:e,fecha_baja_sede:d}}).done(e=>{this.sedeDown.is_bloqueado="1",this.sedeDown.is_baja="1",this.ListSedes=JSON.parse(JSON.stringify(this.ListSedes)),dialogSedeDown.close()})},upSede:function(){var e=this.sedeDown.idsede;$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=1901",data:{idsede:e}}).done(e=>{this.sedeDown.is_bloqueado="0",this.sedeDown.is_baja="0",this.ListSedes=JSON.parse(JSON.stringify(this.ListSedes)),dialogSedeUp.close()})}})</script>