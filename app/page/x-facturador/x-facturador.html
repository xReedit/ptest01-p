<link rel="import"href="../../x-componentes/x-comp-find-comprobante/x-comp-find-comprobante.html"><link rel="import"href="../../x-componentes/x-comp-find-item-producto/x-comp-find-item-producto.html"><link rel="import"href="../../x-componentes/x-detected-mensajeria/x-detected-mensajeria.html"><dom-module id="x-facturador"><script src="../../view/xm_all.js"></script><template is="dom-bind"><paper-dialog id="dialog_tipo_pago_cpe_facturador"class="dialog_redondo"modal entry-animation="scale-up-animation"><div class="text-center"><p class="fw-600 fs-18">Elige el metodo de pago</p><br><x-comp-find-tipo-pago-option class="tpf_option_cpe_fac"></x-comp-find-tipo-pago-option><br><button class="xBoton2 xAzul">Listo, registrar</button> <button class="xBoton2 xPlomo"dialog-dismiss>Cancelar</button></div></paper-dialog><paper-dialog id="dialog_erro_print"modal style="min-width:330px"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"><h4>Error en impresora</h4><p id="print_error"></p><br><div class="xBoton2 xVerde"style="margin-left:23px"onclick="xReImprimirFac()">Intentar Nuevamente</div><div class="xBoton2 xPlomo"style="margin-left:23px"dialog-dismiss onclick="xNuevoPedidoVR()">No imprimir</div><br><br><br></paper-dialog><br><div class="xMiCard xradius"style="max-width:1000px;width:85%"><div class="xEncanezadoCard xFondoRowAmarillo2"><p>Emite comprobantes electronicos personalizados. Es decir el concepto y los montos no tienen que ser previamente registrados. <img ondblclick="xSeeFechaManual()"class="xDerecha"src="../../../images/candado.png"width="16px"></p><br><x-detected-mensajeria></x-detected-mensajeria></div><div class="xContentCard"style="height:100%"><p class="bold xColorRow_Plomo">Comprobante<div class="container-cliente"><div id="form_pago_cliente_fac"><div style="width:250px;padding-left:7px"><x-comp-find-comprobante id="compFindComprobante"hide-content-card-tpc="true"onchange="_getComprobante(comprobantes)"></x-comp-find-comprobante></div><br><div class="xInvisible"id="contentClie"><div style="width:260px"><div class="w-100 d-flexx"><div class="pr-2"><input autofocus type="number"class="xMiInput"placeholder="RUC Cliente"pattern="[0-9]*"required id="txt_ruc"onkeyup="validarDocumentoCliente(this.value,event)"espaciar><div class="xInvisible"id="progress_cliente"><paper-progress indeterminate style="width:100%;float:left;margin-top:-6px"></paper-progress></div><div><span class="xColorRow_Rojo xInvisible"id="txt_msj"style="padding-left:7px;float:left;margin-top:-3px"></span></div></div><paper-icon-button hidden$="[[!isShowSearchSunat]]"icon="icons:refresh"title="Obtner datos actualizados"onclick="validarDocumentoCliente(null,null,!0,!0)"style="position:relative;right:2px;float:right;background:#00ff7f;border-radius:5px"></paper-icon-button><button class="btn btn-sm btn-success"onclick="validarDocumentoCliente(null,null,!0)">Buscar</button></div></div><div style="padding:0 5px"><x-comp-find-input-cliente id="clie_nombres_fac"label="Nombres | Razon Social | Buscar"class="xPasarEnter2"espaciar></x-comp-find-input-cliente></div><input class="xMiInput xPasarEnter2"style="width:98%"placeholder="Direccion"onchange="conMayusculas(this)"onblur="removeSpecialCharObj(this)"required id="txt_direccion"espaciar> <input type="number"class="xMiInput xPasarEnter2"style="width:200px"placeholder="Telefono"onkeyup="showMsjTelefono(this)"required id="txt_telefono"espaciar><p class="fs-11 pl-2 fw-600 text-info"hidden$="[[!isShowMsjTelefono]]">Se enviará el comprobante al WhatsApp.<p class="fs-11 pl-2 fw-600 text-secondary"hidden$="[[isShowMsjTelefono]]">Para enviar el comprobante al WhatsApp.</p><br><input class="xMiInput xPasarEnter2"style="width:200px"placeholder="Observaciones"id="txt_observaciones_cpe"espaciar> <input class="xMiInput xInvisible"style="width:98%"placeholder="Cliente"onchange="conMayusculas(this)"id="txt_nombres"espaciar required$="[[!modificarCliente]]"readonly$="[[!modificarCliente]]"></div></div><br></div><br><hr class="xLinea3"><br><div class="w-100 d-flexx justify-content-end"><button class="btn btn-sm btn-success"onclick="xAddItem()">+ Agregar</button></div><table class="xtable4"width="100%"><thead><th class="xSinBorde"width="10px">Cant<th class="xSinBorde"width="60%">Descripcion<th class="xSinBorde"width="30px"align="right">P.Unitario<th class="xSinBorde"width="30px"align="right">P.Total</thead><tr class="xSinBorde"data-id=""><td><input type="number"pattern="[^0-9]+"class="xMiInput xPasarEnter2"style="width:100%"onkeyup="verificarInputInteger(this)"placeholder="Cant"required id="cant_item"autofocus><td><x-comp-find-item-producto clasecss="xMiInput xPasarEnter2 w-100"elplaceholder="Descripcion"id="compItemProductoFac"></x-comp-find-item-producto><td><input type="number"pattern="[^0-9]+"class="xMiInput xAlinearDerecha punitario_fac"placeholder="P. Unitario"id="punitario_fac"name="precio"required><td><input type="number"class="xMiInput xAlinearDerecha xprecio"placeholder="P. Total"id="ptotal"name="total"required readonly="readonly"></tr><template is="dom-repeat"items="{{arrItems}}"as="item"><tr data-value="[[index]]"><td><span class="xDeleteRowNeutro"title="Borrar"onclick="xBorrarItemLocalArr(this)"></span> {{item.cantidad}}<td>{{item.descripcion}}<td align="right">{{item.punitario}}<td align="right">{{item.ptotal}}</template><template is="dom-repeat"items="{{arrTotales}}"as="total"><tr class="tt_row"><td colspan="2"class="xSinBorde"><td align="right">{{ total.descripcion }}<td align="right">{{ total.importe }}</template></table></div><div class="xPieCard"><div class="d-flexx justify-content-between align-items-center"><div><div style="width:200px"hidden$="[[ !isShowCpeFactura ]]"><br><label for="selectFormaPago"class="xColorRow_Plomo">Forma de Pago:</label> <select id="selectFormaPago"class="xTextRow2 xCursor"><option value="0">Contado<option value="1">Credito</select><div hidden$="[[!isShowFechaPagoCredito]]"><br><label for="fechaPagoCredito"class="xColorRow_Plomo">Fecha de Pago:</label> <input type="date"name="fechaPagoCredito"id="fechaPagoCredito"class="xTextRow2 xCursor"onkeydown="return!1"></div><br><br><br></div><div style="width:200px"><label for="listPrint"class="xColorRow_Plomo">Impresora:</label> <select id="listPrint"class="xTextRow2 xCursor"onchange="fact_selectOptionCategoria()"><template is="dom-repeat"id="listImpresora"items="[[listImpresoras]]"as="impresora"><option value="[[index]]">{{ impresora.descripcion }}</template></select></div></div><div><div class="xMiBoton_icon_option"selected$="{{ isShowIngresaCaja }}"onclick="selectOptionIngresarCaja()"><div class="d-flexx mb-2"><div><i hidden$="[[!isShowIngresaCaja]]"class="fa fa-check text-success pl-1"></i> <i hidden$="[[isShowIngresaCaja]]"class="fa fa-close text-danger pl-2"></i></div><img src="../../../images/_caja.png"width="32px"class="mb-1"></div><p>Ingresa a Caja</div></div></div><br><button class="xBoton2 xAzul"onclick="xProcesarComprobante()"disabled="[[!formValid]]"hidden="[[cpe_show]]">Listo, emitir comprobante</button> <button class="xBoton2 xAzul"onclick="xProcesarComprobante()"hidden="[[!cpe_show]]">Volver a imprimir</button> <button class="xBoton2 xVerde"onclick="xNuevoFac()"hidden="[[!cpe_show]]">Nuevo</button><br><p hidden$="[[ !isShowMsjBoletaRequireDNI ]]"class="animate__animated animate__flash text-danger fw-600">Si el importe total supera los S/.700.00 es necesario un DNI o RUC</p><br><br></div></div><br><br></template><script rel="prefetch"src="../../view/socket.service.p.js"></script><script src="../../shared/validar.numdoc.js"></script><script src="../../view/item_pedido_print_comprobante.js"></script><script src="../../view/deNumALetras.js"></script><script src="../../view/xJsonSunat.js"></script><script src="../../view/xSOAPSunat.js"></script><script src="../../view/item_pedido_estructura.js"></script><script src="../../view/item_pedido_subtotales.js"></script><script src="../../view/manager_storage.js"></script><script src="../../view/cliente.service.js"></script><script src="../../view/cpe_interno.js"></script><style type="text/css">:root{--font-size:12px;--paper-input-container-input:{font-size:var(--font-size)};--paper-input-container-label:{font-size:13px};}.tt_row td{font-weight:600;font-size:15px}</style></dom-module><script>var xThisFacturador,xPopupLoad,cnf_ComprobanteSel,xIdCliente_pago,rptDoc,itemsConEstructuraPrint,_idregistro,_inputAutocompleteFac,xCartaSubtotales,comprobanteFormaPago,compItemProductoFac,itemOptionTpSelectedCPE,_arrCliente=[],_arrTotal=[],_arrItems=[],_listValid=!1,_formValid=!1,_modificarCliente=!1,impresoraSelect={},IdTpConsumo=0,arr_comprobante=[],txt_fecha_cpe_manual="",isSocket=!0,_labelElemetFind="",processRumComprobanteF=!1;function xIniFacturador(){xPopupLoad=document.getElementById("xLoad"),xThisFacturador.formValid=!1,_formValid=_listValid=!1,xThisFacturador.modificarCliente=!1,xThisFacturador.arrItems=[],xThisFacturador.arrTotales=[],xThisFacturador.listImpresoras=[],xThisFacturador.cpe_show=!1,xThisFacturador.fecha_manual=!1,comprobanteFormaPago={forma_de_pago:"Contado",fecha_de_pago:""};var a=xm_log_get("estructura_pedido");xCartaSubtotales=xm_log_get("carta_subtotales"),IdTpConsumo=a[0].idtipo_consumo,fact_getAllImpresoras(),$("body").addClass("loaded"),$("#Titulo_page").text("Facturador"),_inputAutocompleteFac=document.getElementById("clie_nombres_fac"),_inputAutocompleteFacObj=_inputAutocompleteFac.$.input_clie_nombres_auto,_inputAutocompleteFac.addEventListener("input-autocomplete-selected",a=>{a=a.detail;a.nombres?(xIdCliente_pago=a.idcliente,$("#txt_ruc").val(a.ruc),$("#txt_direccion").val(a.direccion),$("#txt_nombres").val(a.nombres),$("#txt_telefono").val(a.telefono),xThisFacturador.isShowMsjTelefono=""!==a.telefono,validarDocumentoCliente(null,null,!0,!1,!1)):xValidarBtnProcesar()}),(compItemProductoFac=document.getElementById("compItemProductoFac")).removespecialchart=!0,compItemProductoFac.addEventListener("elementSeleted",a=>{var e=a.detail;_labelElemetFind=e.label?e.label.split("|")[e.label.split("|").length-1]:a.target.valueInput,e.descripcion=_labelElemetFind.trim(),punitario_fac.value=e.precio||0,verificarInputInteger(punitario_fac),xCalcTotal()}),$(".xPasarEnter2").on("keyup",function(a){var e=a.which;if(13==e||186==e){var e=$("input"),o=e.index(document.activeElement);if(null!==e[o+1]){var t=e[o+1];if(void 0===t)return;if(null==(t=t.disabled?e[o+2]:t))return;t.focus(),t.select()}return event.stopPropagation(),a.stopPropagation(),a.stopImmediatePropagation(),!1}}),$(".punitario_fac").on("keyup",function(a){a=a.which;xCalcTotal(),13!=a&&186!=a||($("#punitario_fac").val(parseFloat(this.value)),$("#ptotal").focus())}),$(".xprecio").on("keyup",function(a){a=a.which;13!=a&&186!=a||xAddItem()}),$("#txt_fecha").on("change",function(){var a=$(this).val().split("-");txt_fecha_cpe_manual=void 0===a[1]?"":$(this).val()}),$("#selectFormaPago").on("change",a=>{xThisFacturador.isShowFechaPagoCredito=1===a.target.selectedIndex,comprobanteFormaPago.forma_de_pago=a.target.options[a.target.selectedIndex].text,xThisFacturador.isShowFechaPagoCredito?comprobanteFormaPago.fecha_de_pago=fechaPagoCredito.value:comprobanteFormaPago.fecha_de_pago="",xThisFacturador.isShowFechaPagoCredito&&""===comprobanteFormaPago.fecha_de_pago?xThisFacturador.formValid=!1:xValidarBtnProcesar();a=(new Date).toISOString().split("T")[0];document.getElementsByName("fechaPagoCredito")[0].setAttribute("min",a)}),$("#fechaPagoCredito").on("change",a=>{comprobanteFormaPago.fecha_de_pago=a.target.value,xThisFacturador.isShowFechaPagoCredito&&""===comprobanteFormaPago.fecha_de_pago?xThisFacturador.formValid=!1:xValidarBtnProcesar()}),setTimeout(()=>{xNuevoFac()},500),document.getElementById("compFindComprobante").addEventListener("_onchange",a=>{_getComprobante(a.detail),a.stopPropagation(),a.stopImmediatePropagation()}),$(document).on("getValorIncial",".tpf_option_cpe_fac",function(a){itemOptionTpSelectedCPE=a.detail.values})}function verificarInputInteger(a){var e=parseFloat(a.value);a.value=0<e?e:-1*e}function removeChartSpecial(a){a.value=removeSpecialChar(a.value)}function xSeeFechaManual(){xThisFacturador.fecha_manual=!xThisFacturador.fecha_manual}function _getComprobante(a){cnf_ComprobanteSel=a,xNuevoCliente(),"0"===cnf_ComprobanteSel.idtipo_comprobante?$("#contentClie").addClass("xInvisible"):$("#contentClie").removeClass("xInvisible"),xThisFacturador.modificarCliente="01"!==cnf_ComprobanteSel.codsunat,xThisFacturador.isShowCpeFactura="01"===cnf_ComprobanteSel.codsunat}function validarDocumentoCliente(a,e,o=!1,t=!1,r=!0){if(o||13===e.keyCode){a=a||txt_ruc.value,r&&xNuevoCliente(),$("#txt_msj").addClass("xInvisible");const i=validarNumDoc_ValidarDNIRUC(cnf_ComprobanteSel,a);i.valid?($("#progress_cliente").removeClass("xInvisible"),xGetFindCliente(i.numdoc,i.servicio,t,a=>{if(a.success){if(""===a.nombres)return i.valid=!1,i.msj="No se encontraron registros. Verifique el numero de documento.",$("#progress_cliente").addClass("xInvisible"),void NumDocNoValid(i);xThisFacturador.isShowSearchSunat=a.buscarSunat,i.valid=!0,i.msj="ok",i.cliente={idcliente:a.idcliente,nombres:a.nombres,direccion:a.direccion,num_doc:i.numdoc,f_nac:a.f_nac},_arrCliente=i.cliente,_formValid=i.valid,xThisFacturador.modificarCliente=!1,xValidarBtnProcesar(),xIdCliente_pago=a.idcliente,$("#txt_nombres").val(a.nombres),$("#txt_direccion").val(a.direccion),$("#txt_telefono").val(a.telefono),xThisFacturador.isShowMsjTelefono=""!==a.telefono,_inputAutocompleteFacObj.inputValue=a.nombres}else i.valid=!1,i.msj=a.msg,xThisFacturador.modificarCliente=!0,NumDocNoValid(i),xNuevoCliente();$("#progress_cliente").addClass("xInvisible")})):NumDocNoValid(i)}}function NumDocNoValid(a){_formValid=a.valid,xValidarBtnProcesar(),$("#txt_msj").text(a.msj),$("#txt_msj").removeClass("xInvisible"),$("#txt_ruc").select(),$("#txt_ruc").focus()}function xNuevoCliente(){_formValid=!1,xValidarBtnProcesar(),xThisFacturador.isShowMsjBoletaRequireDNI=!1,xThisFacturador.modificarCliente=!0,xIdCliente_pago="",_arrCliente=[],_inputAutocompleteFacObj.inputValue="",$("#txt_nombres").val(""),$("#txt_direccion").val(""),$("#txt_telefono").val(""),$("#txt_observaciones_cpe").val(""),xThisFacturador.isShowMsjTelefono=!1,$("#txt_ruc").select(),$("#txt_ruc").focus()}function validNomClienteFac(){"03"===cnf_ComprobanteSel.codsunat&&(xThisFacturador.formValid=""===clie_nombres_fac.$.input_clie_nombres_auto.$.input.value||4<clie_nombres_fac.$.input_clie_nombres_auto.$.input.value.length)}function xCalcTotal(){var a=(""===$("#cant_item").val()?0:parseFloat($("#cant_item").val()))*(""===$("#punitario_fac").val()?0:parseFloat($("#punitario_fac").val()))||0;$("#ptotal").val(a)}function xAddItem(){var a,e=$("#cant_item").val(),o=(_labelElemetFind=""!==_labelElemetFind?_labelElemetFind:compItemProductoFac.getTextInput(),xDes_item=_labelElemetFind,$("#punitario_fac").val()),t=$("#ptotal").val();""===e||""===xDes_item||""===o||""===t||parseFloat(o)<=0||parseFloat(e)<=0||parseFloat(t)<=0||parseFloat(e*o)===parseFloat(t)&&(a={id:a=Date.now().toString().slice(-6),iditem:a,idtipo_consumo:IdTpConsumo,des_seccion:"ITEMS",cantidad:e,descripcion:xDes_item,punitario:o,precio:o,ptotal:xMoneda(t),precio_total_calc:t},_arrItems.push(a),xThisFacturador.arrItems=JSON.parse(JSON.stringify(_arrItems)),xCalcularTotal(),xNuevoItem())}function xBorrarItemLocalArr(a){a=a.parentElement.parentElement.dataValue;const e=_arrItems[a];_arrItems=_arrItems.filter(a=>a.id!==e.id),xThisFacturador.arrItems=JSON.parse(JSON.stringify(_arrItems)),xCalcularTotal()}function xNuevoItem(){$("#cant_item").val(""),$("#des_item").val(""),$("#punitario_fac").val(""),$("#ptotal").val(""),$("#cant_item").focus(),compItemProductoFac.resetText()}function xValidarBtnProcesar(){if(0<_arrTotal.length){if(!cnf_ComprobanteSel)return;if("03"===cnf_ComprobanteSel.codsunat&&_listValid&&parseFloat(_arrTotal[2].importe)<=700)return xThisFacturador.formValid=!0,xThisFacturador.modificarCliente=!0,xThisFacturador.isShowMsjBoletaRequireDNI=!1,void validNomClienteFac();if("03"===cnf_ComprobanteSel.codsunat&&700<=parseFloat(_arrTotal[2].importe)&&(xThisFacturador.isShowMsjBoletaRequireDNI=!0),"1"===cnf_ComprobanteSel.idtipo_comprobante)return xThisFacturador.formValid=!0,void(xThisFacturador.modificarCliente=!0);validNomClienteFac()}xThisFacturador.formValid=_listValid&&_formValid}function xCalcularTotal(){_arrTotal=[];const t=this._arrItems.map(a=>parseFloat(a.ptotal)).reduce((a,e)=>a+e,0);_listValid=0!==parseInt(t);let r=t;xCartaSubtotales.map(e=>{if("1"===e.es_impuesto.toString()){var o=parseFloat(e.monto);let a="0.00";"0"===e.activo&&"I.G.V"===e.descripcion&&(r=parseFloat(xCalcMontoBaseIGV(t,o/100)),a=(t-r).toFixed(2)),_arrTotal.push({descripcion:e.descripcion,importe:a})}}),_arrTotal.unshift({descripcion:"Sub Total",importe:xMoneda(r)});var a=_arrTotal.map(a=>parseFloat(a.importe)).reduce((a,e)=>a+e,0);_arrTotal.push({descripcion:"Total",importe:xMoneda(a)}),xThisFacturador.arrTotales=JSON.parse(JSON.stringify(_arrTotal)),xValidarBtnProcesar()}async function xProcesarComprobante(){if(!0!==xThisFacturador.proccessCPEF)if(xThisFacturador.proccessCPEF=!0,xThisFacturador.cpe_show)await xMandarCocinarImpresionComprobante(arr_comprobante.correlativo,_idregistro),xProcessCpeFinish();else{arr_comprobante=cnf_ComprobanteSel,0===_arrCliente.length?(a=$("#txt_nombres").val(),e=$("#txt_direccion").val(),_arrCliente={idcliente:0,num_doc:"00000000"},a=""===a?_inputAutocompleteFacObj.inputValue:a,_arrCliente.nombres=""===a?"PUBLICO EN GENERAL":a,_arrCliente.direccion=e,_arrCliente.telefono=$("#txt_telefono").val()):(_arrCliente.direccion=$("#txt_direccion").val(),_arrCliente.telefono=$("#txt_telefono").val(),_arrCliente.idcliente=await ClienteService_Guardar(_arrCliente)),arr_comprobante.correlativo="#";var a,e={idcliente:_arrCliente.idcliente,idcomprobante:arr_comprobante.idtipo_comprobante,idtipo_comprobante_serie:arr_comprobante?.idtipo_comprobante_serie||null,num_comprobante:arr_comprobante.correlativo,subtotal:_arrTotal[0].importe,igv:_arrTotal[1].importe,total:_arrTotal[2].importe,concepto:xThisFacturador.arrItems[0].descripcion,idtipo_pago:itemOptionTpSelectedCPE.idtipo_pago,nombres_cliente:a};if(xThisFacturador.isShowIngresaCaja)if(!await xShowIngresoVarios(e))return void xProcessCpeFinish();xPopupLoad.xopen(),"1"===cnf_ComprobanteSel.idtipo_comprobante?(await xMandarCocinarImpresionComprobante(arr_comprobante.correlativo,null),xProcessCpeFinish()):$.ajax({type:"POST",url:"../../bdphp/log_002.php",data:{op:"102",data:e,arrItems:_arrItems}}).done(async function(a){_idregistro=[0,a],await xMandarCocinarImpresionComprobante(arr_comprobante.correlativo,_idregistro),xProcessCpeFinish()})}}function xProcessCpeFinish(){setTimeout(()=>{xThisFacturador.proccessCPEF=!1},1e3)}async function xMandarCocinarImpresionComprobante(a,e){xThisFacturador.cpe_show||(arr_comprobante.fecha_manual=txt_fecha_cpe_manual,(arr_comprobante=cnf_ComprobanteSel).correlativo=a,arr_comprobante.forma_de_pago=comprobanteFormaPago,arr_comprobante.observaciones=$("#txt_observaciones_cpe").val(),itemsConEstructuraPrint=(itemsConEstructuraPrint=xCargarDatosAEstructuraImpresion(xThisFacturador.arrItems)).filter(a=>a),rptDoc=await xCocinarImprimirComprobante(itemsConEstructuraPrint,_arrTotal,arr_comprobante,_arrCliente,e,-2,!1)),rptDoc.ok=!1,-1===impresoraSelect.idimpresora?"www.papaya.com.pe"===(rptDoc[0]||rptDoc).hash?(xPopupLoad.xclose(),alert("Error con la conexion al servicio de Sunat. No puede descargar el pdf. Pero si puede imprimirlo. Este comprobante sera enviado a sunat al cerrar caja.")):(xThisFacturador.cpe_show=!0,xSoapSunat_DownloadFile("pdf",rptDoc[0].external_id),xPopupLoad.xclose()):(xThisFacturador.cpe_show=!0,xLLamarPrintFac())}function xNuevoFac(){xThisFacturador.cpe_show=!1,_arrCliente=[],_arrItems=[],_arrTotal=[],xThisFacturador.$.selectFormaPago.selectedIndex=0,xThisFacturador.isShowFechaPagoCredito=!1,comprobanteFormaPago={forma_de_pago:"Contado",fecha_de_pago:""},xThisFacturador.arrItems=JSON.parse(JSON.stringify(_arrItems)),xThisFacturador.arrTotales=JSON.parse(JSON.stringify(_arrTotal)),xNuevoCliente();try{txt_ruc.value=""}catch(a){}}function xLLamarPrintFac(){var a=xm_log_get("sede_generales");a[0].ip_print=impresoraSelect.ip,a[0].var_margen_iz=impresoraSelect.var_margen_iz,a[0].var_size_font=impresoraSelect.var_size_font,a[0].local=impresoraSelect.local,a[0].num_copias=impresoraSelect.num_copias,a[0].papel_size=impresoraSelect.papel_size,xImprimirComprobanteAhoraPrintPreSelect(rptDoc,itemsConEstructuraPrint,_arrTotal,arr_comprobante,_arrCliente,a,function(a){if(0==a)return!1;xPopupLoad.titulo="Imprimiendo...",xPopupLoad.xopen(),setTimeout(function(){xPopupLoad.xclose()},3e3),xPopupLoad.xclose()})}function xReImprimirFac(){dialog_erro_print.close(),xPopupLoad.titulo="Enviando...",xPopupLoad.xopen(),xLLamarPrintFac()}function fact_selectOptionCategoria(){var a=xThisFacturador.$.listPrint.value;impresoraSelect=xThisFacturador.listImpresoras[a]}function fact_getAllImpresoras(){$.ajax({type:"POST",url:"../../bdphp/log_002.php",data:{op:"5"}}).done(function(a){var e=[];(a=$.parseJSON(a)).datos.map(a=>e.push(a)),e.push({idimpresora:-1,descripcion:"MOSTRAR EN PDF"}),xThisFacturador.listImpresoras=JSON.parse(JSON.stringify(e)),impresoraSelect=e[0]})}function showMsjTelefono(a){xThisFacturador.isShowMsjTelefono=""!==a.value}function selectOptionIngresarCaja(){xThisFacturador.isShowIngresaCaja=!xThisFacturador.isShowIngresaCaja,xThisFacturador.isShowIngresaCaja&&showAlertSwalOk("info","Ingresa a caja","Estas operaciones sumaran a tu caja, en la sección ingresos varios.","Listo")}async function xShowIngresoVarios(e){var a=paramsSwalAlert;return a.title='<p class="fw-600 fs-18">Elige el metodo de pago</p>',a.html=`<div class="pb-2" style="display: inline-flex;">                    
                                    <x-comp-find-tipo-pago-option class="tpf_option_cpe_fac"></x-comp-find-tipo-pago-option>
                                </div>`,a.confirmButtonText="Listo, registrar",a.showCancelButton=!0,showAlertSwalHtmlDecision(a,0).then(a=>(a.isConfirmed&&(e.idtipo_pago=itemOptionTpSelectedCPE.idtipo_pago,$.ajax({type:"POST",url:"../../bdphp/log_002.php",data:{op:"11",data:e}}).done(a=>{})),a.isConfirmed))}function xSaveIngresoVarios(){}Polymer({is:"x-facturador",properties:{arrItems:[],arrTotales:[],listImpresoras:[],formValid:boolean=!1,proccessCPEF:boolean=!1,modificarCliente:boolean=!1,cpe_show:boolean=!1,fecha_manual:boolean=!1,isShowSearchSunat:Boolean,isShowFechaPagoCredito:Boolean,isShowCpeFactura:Boolean,isShowMsjTelefono:Boolean,isShowMsjBoletaRequireDNI:Boolean,isShowIngresaCaja:Boolean,subscription$:Object},attached:function(){this.isShowSearchSunat=!1,this.isShowFechaPagoCredito=!1,this.isShowCpeFactura=!1,this.isShowMsjTelefono=!1,this.isShowMsjBoletaRequireDNI=!1,this.isShowIngresaCaja=!1,this.proccessCPEF=!1,xThisFacturador=this,xIniFacturador(),_cpSocketOpen(),this.subscription$=onStatusSetUsChangeSede().subscribe(a=>{1==a&&xIniFacturador()})},detached:function(){this.subscription$.unsubscribe()}})</script>