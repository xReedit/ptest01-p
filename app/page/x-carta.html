<link rel="import"href="../x-componentes/x-comp-item-subitems-edit/x-comp-item-subitems-edit.html">;<link rel="import"href="../x-componentes/x-comp-productos-enlazados-item-carta/x-comp-productos-enlazados-item-carta.html">;<link rel="import"href="../x-componentes/x-comp-img-upload/x-comp-img-upload.html"><link rel="import"href="../page/x-promociones/x-promociones.html"><dom-module id="x-carta"><template><paper-dialog id="dialog_img_ico_carta"class="dialog_redondo overflow-auto"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="xContent"><span class="xColorRow_Plomo">Este icono se mostrara en la aplicacion de pedidos</span><div class="content-icon-seccion"><template is="dom-repeat"items="{{listIconSeccion}}"as="item"><img data-index="[[index]]"onclick="updateIconSeccionCarta(this)"class="img-ico-seccion-size-2"src="{{item.img}}"alt="a2"></template></div><br><br><div class="xBoton2 xPlomo"dialog-dismiss>Cerrar</div></div></paper-dialog><paper-dialog id="dialog_detalle"class="dialog_redondo"style="width:90%;max-width:550px;height:auto!important;overflow:auto"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="xContent"><div class="d-flexx justify-content-between align-items-center"><div><h4 id="dlg_des_item_detalle">Item</h4></div><div class="pb-2"><paper-checkbox id="check_visible_cliente"onchange="updateVisible()"><span class="fs-12 text-secondary"><strong>No</strong> visible para el cliente.</span></paper-checkbox><br></div></div><div class="xLinea2"></div><paper-tabs selected="{{selectedDetalle}}"id="tab_detalle"><paper-tab>DESCRIPCION</paper-tab><paper-tab>SELECCIONABLES</paper-tab><paper-tab>FOTO</paper-tab><paper-tab>ENLAZADOS</paper-tab></paper-tabs><div class="xLinea2"></div><br><iron-pages selected="{{selectedDetalle}}"><div><textarea id="dlg_det_item"rows="4"cols="60"></textarea><br><br><button class="xBoton2 xAzul"onclick="xItemGuardarDetalle()">Listo, guardar</button><div class="xBoton2 xPlomo"dialog-dismiss>Cerrar</div></div><div><x-comp-item-subitems-edit id="comp-subitems-content"></x-comp-item-subitems-edit><br><br><div class="xBoton2 xPlomo"dialog-dismiss>Cerrar</div></div><div id="dlg_foto_vista_previa-div"><a class="xDerecha xInvisible xCursor"onclick="xItemQuitarFoto()"id="dlg_btn_quitar_foto">Quitar Foto</a><br><x-comp-img-upload id="compImgItem"medidasimg="[[medidaImgCarta]]"></x-comp-img-upload><br><br><br><br><div class="xBoton2 xAzul"dialog-confirm onclick="xItemGuardarFoto()">Listo, guardar</div><div class="xBoton2 xPlomo"dialog-dismiss>Cerrar</div></div><div><x-comp-productos-enlazados-item-carta id="compItemProductoRelacionado"iditem$="[[idItemSelected]]"></x-comp-productos-enlazados-item-carta><br><br><div class="xBoton2 xPlomo"dialog-dismiss>Cerrar</div><br><br><br></div></iron-pages></div></paper-dialog><paper-dialog id="dialog_orden"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"><div class="xContent"><h4 id="dlg_des_item">Ordenar Secciones</h4><p>Especifique el orden en el que se mostraran las secciones en el pedido.</p><br><table id="tb_sec_orden"width="100%"><thead><th>Secciones<th>Orden</thead></table><br><br><div class="xBoton2 xAzul"dialog-confirm onclick="xGuardarCambiosOrden()">Listo, guardar</div><div class="xBoton2 xPlomo"dialog-dismiss>Cancelar</div></div></paper-dialog><br><div class="xContent"id="content_carta"><paper-tabs selected="{{selected}}"id="tab_carta"><paper-tab>CARTA ACTUAL</paper-tab><paper-tab>PROMOCIONES <img src="../../images/p_confetti2_ico.gif"alt=""></paper-tab></paper-tabs><div class="xLinea2"></div><br><br><iron-pages selected="{{selected}}"><div><br><div class="xMiCard xradius"><div class="xEncanezadoCard xFondoRowAmarillo3"><img class="xencabezado_img"src="../../images/info.png"> <span>Al elaborar la carta tenga en cuenta lo siguiente: <b>La Seccion</b> puede ser, Entrada, platos de fondo, jugos, tragos, piqueos, etc. <b>El Item </b>es la descripcion del producto que pertenece a la seccion superior, por ejemplo: Causa rellena, lomito saltado, jugo de mango, coctel de cafe, etc.<br>Colocar en cantidad <b>"ND"</b> si la cantidad del item es "no definido"</span><br><br><span>Colocar <strong>SP (segun porcion)</strong> en catidad para que el sistema actualize las cantidades segun las porciones que existen del ingrediente principal en la receta.</span></div><div class="xSubEncanezadoCard xFondoRowPlomo"><select id="SelCarta"class="SelCarta xTextRow2 xfont18 xColorRow_blanco xCursor"inline></select><div class="xfont15 xEnLinea">Utlima modificacion: <b><span id="f_uc"></span></b></div></div><div class="xContentCard"><br><div id="opPersiste"><div class="xBoton2 xAzul xDerecha"onclick="xOrdenSecciones()"title="Orden en el que se mostraran las secciones en el pedido."><img src="../../images/_ordenar_carta.png"></div><div class="xBoton2 xAzul xDerecha"onclick="xImprimirCarta()"title="Imprimir"><img src="../../images/_print.png"></div><div class="xBoton2 xAzul xDerecha"onclick="xAddNewSeccion()">Agregar Seccion</div><div class="xBoton2 xVerde xDerecha"onclick="xGuardarCambios()">Guardar Cambios</div></div><div id="Lista_Carta"><div class="xSeccion"><input data-id=""tabindex="1"style="width:100%"class="xMiInput xfont20 xPasarEnter2 des_seccion"placeholder="SECCION"onchange="conMayusculas(this)"id="seccion_des"><br><div class="xCursor xDerecha xfont12"style="margin-left:7px;margin-top:3px"><img src="../../images/_prit_2.png"class="xImgCheck"onclick="xCheckImgPrint(this)"title="Mostrar en impresion"id="xseccio_print"></div><a class="xfont12 xColorRow_Azul xCursor xDerecha"onclick="xBorrarSeccion(this)">Borrar Seccion</a><br><br><table class="xtable3 xpadingLateralDe tb_item"width="100%"data-tablaname="carta_lista"><thead><th class="xSinBorde"width="70%"><th class="xSinBorde"width="20px"align="right"><th class="xSinBorde"width="20px"align="center"></thead><tr class="xSinBorde"data-id=""><td><input tabindex="2"id="item_des"data-id=""class="xMiInput xPasarEnter2 des_item"placeholder="ITEM"onchange="conMayusculas(this)"required><td><input tabindex="3"id="item_precio"class="xMiInput xPasarEnter2 xAlinearDerecha"placeholder="PRECIO"onchange="conMayusculas(this)"onblur="xRetornaMoneda(this)"placeholder="Precio"id="precio"name="precio"required><td><input tabindex="4"id="item_cantidad"class="xMiInput xAlinearCentro xcantidad"placeholder="CANTIDAD"onchange="conMayusculas(this)"required></table></div></div></div><div class="xPieCard"><div id="xdiv_print"class="xInvisible"><table class="xtable3 xRowPading6 xfont12x"width="50%"id="tb_print"><thead class="xSinBorde"><th width="80%"><th></thead></table></div></div></div></div><div id="promociones"><x-promociones></x-promociones></div><div id="historial carta"><h3>Historial carta</h3><br><input class="xMiInput xfont18 xitem2"style="width:100%"placeholder="Buscar"autofocus onkeyup="xfiltrarCartaHistorial()"id="txt_buscar"enlinea><table width="100%"><thead><th>#<th align="left">Seccion<th align="left">Item<th align="right">Precio<th align="right">Cant. Vendido<th align="right">Imp. Vendido<tbody><template is="dom-repeat"items="{{ListHistorial}}"as="item"><tr class="animated fadeIn fast"id="{{index}}"><td data-id="{{index}}"><span>{{displayIndex(index)}}</span><td align="left">{{item.desseccion}}<td align="left">{{item.desitem}}<td align="right">{{item.precio}}<td align="right">{{item.cant_vendido}}<td align="right">{{item.importe_vendido}}</template></table></div></iron-pages><br><br></div><style type="text/css">paper-checkbox.blue{--paper-checkbox-checked-color:var(--paper-grey-50);--paper-checkbox-checked-ink-color:var(--paper-blue-900);--paper-checkbox-unchecked-color:var(--paper-grey-100);--paper-checkbox-unchecked-ink-color:var(--paper-grey-100);--paper-checkbox-label-color:var(--paper-grey-50);--paper-checkbox-label-checked-color:var(--paper-grey-100);--paper-checkbox-checkmark-color:var(--paper-blue-900)}</style></template></dom-module><style>paper-button[raised].colorful{background:#4285f4;color:#fff}paper-button[raised].xverde{background:#43a047;color:#fff}paper-button[raised].xnegro{background:#424242;color:#fff}#xCardCarta,.xMiCard{width:80%}.div_foto{width:100%;height:260px;background:#e0e0e0;cursor:pointer;display:inline-block}.div_foto #dlg_label_foto{opacity:.8;text-align:center;z-index:0}.div_foto img{width:100%}.btn-add-item-carta{color:#fff;background:#4caf50;border-color:green;cursor:pointer;font-size:11px}</style><script>var xThisCarta,xdes_item,xdes_categoria,xprecio,xcant,xSeccActual,xTopHeaderPersiste,xObjImgDet,xIdCartaAnterior,xidCategoria,xFechaUltimaCarta,xdebounce,xdtCAct,itemSelectSubItem,xIdObjCartaLista,compImgItem,xidSeccionIcon,opIcon,xTbSeccion="",xIdCarta="",xIdObjImgDet="",xe_debounce=!1,xRutaIconSeccion="../../images/img-icon-carta/";function xInicarta(){xPopupLoad=document.getElementById("xLoad"),xm_LogChequea(function(){xm_log_get("ini_us"),$("body").addClass("loaded"),$("#Titulo_page").text("Elaborar Carta"),xIdCarta="",xLoadItemsCategoria(),xLoadCarta(),$("#accordion").accordion({heightStyle:"content",collapsible:!1})}),xThisCarta.medidaImgCarta={width:365,height:210},xPasaEnterClass(),xCompSubItemContet=document.getElementById("comp-subitems-content"),compImgItem=document.getElementById("compImgItem"),loadIconSeccionCarta(),$(document).scroll(function(){try{$(this).scrollTop()>$("#Lista_Carta").offset().top+100?$("#opPersiste").addClass("xHeaderPersiste"):$("#opPersiste").removeClass("xHeaderPersiste")}catch(t){}}),$("#ctrl_open_file").change(function(t){for(var a=0;a<t.originalEvent.srcElement.files.length;a++){var e=t.originalEvent.srcElement.files[a],i=document.createElement("img"),o=new FileReader;o.onloadend=function(){i.src=o.result},o.readAsDataURL(e),$("#dlg_foto_vista_previa img").remove(),$("#dlg_foto_vista_previa").append(i).trigger("create")}}),$(".SelCarta").on("change",t=>{xidCategoria=t.target.value,xLoadListadoCartaActual()}),$(document).change(".txt_modifica_bd",function(t){$(t.target.parentElement.parentElement).attr("data-modificado","1")}),$(document).change(".txt_modifica_bd_sec",function(t){$(t.target.parentElement).attr("data-modificado","1")}),$("#tab_carta").on("iron-select",function(){0===xThisCarta.selected&&(xThisCarta.medidaImgCarta={width:365,height:210})})}function xPasaEnterClass(){$(".xPasarEnter2").on("keyup",function(t){var a=t.which;if(13==a||186==a){var a=$("input"),e=a.index(document.activeElement);if(null!==a[e+1]){var i=a[e+1];if(void 0===i)return;if(null==(i=i.disabled?a[e+2]:i))return;i.focus(),i.select()}return event.stopPropagation(),t.stopPropagation(),t.stopImmediatePropagation(),!1}}),$(".xcantidad").on("keyup",function(t){t=t.which;13!=t&&186!=t||xAddRowItem(this)})}function xOrdenSecciones(){$.ajax({type:"POST",url:"../../bdphp/log.php?op=2011"}).done(function(t){for(var a="",e=$.parseJSON(t).datos,i=0;i<e.length;i++)a=String(a+'<tr class="row"><td>'+e[i].descripcion+'</td><td width="15px"><input class="xMiInput" type="number" data-id="'+e[i].idseccion+'" data-valini="'+e[i].sec_orden+'" value="'+e[i].sec_orden+'"><td></tr>');$("#tb_sec_orden .row").remove(),$("#tb_sec_orden").append(a).trigger("create"),dialog_orden.open()})}function xGuardarCambiosOrden(){var e,i,o,d=[];xPopupLoad.xopen(),$("#tb_sec_orden .row input").each(function(t,a){e=$(a).attr("data-valini"),i=$(a).val(),o=$(a).attr("data-id"),e!==i&&d.push({id:o,val:i})}),0!==d.length&&$.ajax({type:"POST",url:"../../bdphp/log.php?op=2012",data:{arr_orden:d}}).done(function(t){xPopupLoad.xclose(),dialog_orden.close()})}function xGuardarCambios(){var i,m,u,a=xDevolverFechaTrim2(),_=new Array,g=0,t=(xPopupLoad.xopen(),xm_log_get("app3_woIpPrint"));const o=t[0].idimpresora;xidCategoria=$("#SelCarta option:selected").val(),xIdCartaAnterior=xIdCarta,$(".xSeccion").each(function(p,t){i=$(t).find("#seccion_des");var x=$(i).attr("data-id"),a=i.val(),e=1===parseInt(t.dataset.modificado);u=p+1,null==x&&(x=""),_[p]={des_seccion:a,id_seccion:x,sec_orden:u,modificado:e,idimpresora:o},$(t).find(".tb_item tr.row").each(function(t,a){var e=$(a).attr("data-id"),i=0!==parseInt($(a).attr("data-modificado")),o=$(a).attr("data-idcarta")||xIdCarta,d=$(a).find("#td_des").text(),r=$(a).find("#td_precio").text(),n=$(a).find("#td_detalle").text(),c=$(a).find("#td_img").text(),s=$(a).find("#td_cant").text().toLocaleUpperCase(),a=$(a).find("#td_idcarta_lista").text();let l=!1;m=a,null!=e&&""!=e||(e="",l=!0),(l=i?!0:l)&&(g++,_[p][t]={idcarta:o,id_item:e,id_seccion:x,id_carta_lista:m,des_item:d,precio_item:r,det_item:n,img_item:c,cant_item:s,cant_preparado_item:s,sec_orden:u})})}),array_enviar_carta=[],70<g?(array_enviar_carta.push(_.splice(0,_.length/2)),array_enviar_carta.push(_.splice(0,_.length))):array_enviar_carta.push(_),xPopupLoad.xopen(),array_enviar_carta.map(t=>{$.ajax({type:"POST",url:"../../bdphp/log.php?op=204",data:{idc:xidCategoria,f:a,id_carta_anterior:xIdCartaAnterior,sql_array:t}}).done(function(t){xIdCarta=xIdCartaAnterior=t,xLoadCarta()})}),setTimeout(()=>{xPopupLoad.xclose()},1e3)}function xGuardarSeccion(t,a){var e=$(t).attr("data-id"),i=$(t).val(),t=$(t).attr("data-print");null==t&&(t=0),""==i?a(e):$.ajax({type:"POST",url:"../../bdphp/log.php?op=203",data:{i:e,des:i,p:t},async:!1}).done(function(t){a(t)})}function xGuardarItem(t,a){var e=$(t).attr("data-id"),i=$(t).find("#td_des").text(),o=$(t).find("#td_precio").text(),d=$(t).find("#td_detalle").text(),r=$(t).find("#td_img").text(),n=$(t).find("#td_cant").text();$(t).find("#td_cant_preparado").text(n),$.ajax({type:"POST",url:"../../bdphp/log.php?op=2031",data:{i:e,des:i,p:o,d:d,img:r},async:!1}).done(function(t){a(t)})}function xGuardarCarta(a){var e=xDevolverFecha();$.ajax({type:"POST",url:"../../bdphp/log.php?op=204",data:{idc:xidCategoria,f:e}}).done(function(t){$("#f_uc").text(e),a(t)})}function xImprimirCarta(){var e,i,o="",d="";$(".xSeccion").each(function(t,a){i="",e=$(a).find("#seccion_des").val(),$(a).find("#xseccio_print").hasClass("xImgNoCheck")||($(a).find(".tb_item tr.row").each(function(t,a){i=String(i+'<tr class="row"><td>'+$(a).find("#td_des").text()+'</td><td align="right">'+$(a).find("#td_precio").text()+"</td></tr>")}),o=String(o+'<tr class="xSinBorde row"><td colspan="2" align="left" style="'+d+' font-size:18px; font-weight:600;text-decoration: underline">'+e+"<td></tr>"+i),d="padding-top:20px;")}),$("#tb_print .row").remove(),$("#tb_print").append(o).trigger("create"),ImprBoletaConCSS("xdiv_print","")}function xAddNewSeccion(){$("#Lista_Carta").append('<div class="xSeccion" data-t="carta_lista"><br><br><input type="text" tabindex="1" data-id="" style="width:100%;" class="xMiInput xfont20 xPasarEnter2 des_seccion" placeholder="SECCION" onChange="conMayusculas(this)" id="seccion_des" data-print="0"><br><div class="xCursor xDerecha xfont12" style="margin-left:7px; margin-top:3px;"><img src="../../images/_prit_2.png" class="xImgCheck" onclick="xCheckImgPrint(this)" title="Mostrar en impresion" id="xseccio_print"><img src="../../images/_see_2.png" class="xImgCheck" onclick="xVerSiStockCero(this)" title="Ver si el stock es cero" id="xseccio_ver_si_stock_cero"></div><a class="xfont12 xColorRow_Azul xCursor xDerecha" onclick="xBorrarSeccionLocal(this);">Borrar Seccion</a><br><br><table class="xtable3 xpadingLateralDe tb_item" width="100%" data-TablaName="carta_lista"><thead><th class="xSinBorde" width="70%"></th><th class="xSinBorde" width="20px" align="right"></th><th class="xSinBorde" width="20px" align="center"></th></thead><tr class="xSinBorde" data-id="" data-modificado="0"><td><input type="text" tabindex="2" id="item_des" data-id="" class="xMiInput xPasarEnter2 des_item" placeholder="ITEM" onChange="conMayusculas(this)" required></td><td><input type="text" tabindex="3" id="item_precio" class="xMiInput xPasarEnter2 xAlinearDerecha" placeholder="PRECIO" onChange="conMayusculas(this)" onblur="xRetornaMoneda(this)"  placeholder="Precio" id="precio" name="precio" required></td><td class="d-flexx"><input type="text" tabindex="4" id="item_cantidad" class="xMiInput xAlinearCentro xcantidad" placeholder="CANTIDAD" onChange="conMayusculas(this)" required><button class="btn-add-item-carta" title="Agregar Item" onclick="xAddRowItem(this)"><i class="fa fa-plus"></i></button></td></tr></table></div>').trigger("create"),xPasaEnterClass();var t=$("#Lista_Carta .xSeccion:last-child");xScrolUpObj(t),$("#Lista_Carta .xSeccion:last-child #seccion_des").focus(),xCargarEnInputItem(),xCargarEnImputSeccion()}function xItemGuardarDetalle(){xPopupLoad.xopen();var a=$("#dialog_detalle #dlg_det_item").val().toUpperCase();$.ajax({type:"POST",url:"../../bdphp/log.php?op=206",data:{i:xIdObjImgDet,d:a}}).done(function(t){dialog_detalle.close(),$(xObjImgDet).parents("tr").find("#td_detalle").text(a),$("#dialog_detalle #dlg_det_item").val(""),xPopupLoad.xclose()})}function xItemDetalle(t,a){xObjImgDet=t,xIdObjImgDet=$(t).parents("tr").attr("data-id");var e=$(t).parents("tr").find("#td_detalle").text();$(t).parent().text();$("#dialog_detalle #dlg_det_item").val(e),dialog_detalle.open(),a.stopPropagation(),a.stopImmediatePropagation()}function xItemRecomendado(t,a,e){t=xdtCAct[t];"0"===t.is_recomendacion?(t.is_recomendacion="1",$(a).html('<i class="fa fa-star text-warning" aria-hidden="true"></i>')):(t.is_recomendacion="0",$(a).html('<i class="fa fa-star-o" aria-hidden="true"></i>')),$.ajax({type:"POST",url:"../../bdphp/log.php?op=20601",data:{d:t.is_recomendacion,i:t.iditem}}),e.stopPropagation(),e.stopImmediatePropagation()}function xItemDetalleOpciones(t,a,e){itemSelectSubItem=xdtCAct[t],check_visible_cliente.checked="1"===itemSelectSubItem.is_visible_cliente.toString(),xCompSubItemContet.iditem=itemSelectSubItem.iditem,xCompSubItemContet.loadSubItemIni(),xObjImgDet=a,xIdObjImgDet=itemSelectSubItem.iditem;var t=itemSelectSubItem.detalle,i=itemSelectSubItem.des_item.trim(),i=(dlg_des_item_detalle.textContent=i,xThisCarta.idItemSelected=xIdObjImgDet,$("#dialog_detalle #dlg_det_item").val(t),xObjImgDet=a,xIdObjImgDet=$(a).parents("tr").attr("data-id"),xIdObjCartaLista=$(a).parents("tr").attr("data-idborrar"),$(a).parent().text(),""===(i=$(a).parents("tr").find("#td_img").text())?"":URL_IMG_CARTA+i);$("#dlg_foto_vista_previa img").remove(),$("#dlg_btn_quitar_foto").addClass("xInvisible"),""!==i&&$("#dlg_btn_quitar_foto").removeClass("xInvisible"),compImgItem.resetControl(),compImgItem.setImgPathFile(i),document.getElementById("compItemProductoRelacionado").getProductosRelacionadosItem(),dialog_detalle.open(),e.stopPropagation(),e.stopImmediatePropagation()}function xOpenDialogSubItem(t,a){itemSelectSubItem=xdtCAct[t],xCompSubItemContet.iditem=itemSelectSubItem.iditem,xCompSubItemContet.loadSubItemIni(),dialog_subitem.open(),a.stopPropagation(),a.stopImmediatePropagation()}function xSeleccionarFoto(){$("#ctrl_open_file").click()}function xItemFoto(t,a){xObjImgDet=t,xIdObjImgDet=$(t).parents("tr").attr("data-id");var e=$(t).parent().text(),t=$(t).parents("tr").find("#td_img").text();$("#dlg_foto_vista_previa img").remove(),$("#dlg_btn_quitar_foto").addClass("xInvisible"),""!==t&&(t="<img src=../img/"+t+">",$("#dlg_foto_vista_previa").append(t).trigger("create"),$("#dlg_btn_quitar_foto").removeClass("xInvisible")),$("#dialog_foto #dlg_des_item").text(e),$("#ctrl_open_file").val(""),a.stopImmediatePropagation(),a.stopPropagation()}function xAddRowItem(t){var a=$(t).parents("tr");xTbSeccion=$(t).parents("table"),xValidarInputs(a,function(t){var a,e,i,o,d,r;!1!==t&&(t=$(xTbSeccion).find("#seccion_des").attr("data-value")||$(xTbSeccion).attr("data-idsec"),a=$(xTbSeccion).find("#item_des").attr("data-value"),e=$(xTbSeccion).find("#item_des").val(),i=$(xTbSeccion).find("#item_precio").val(),o=xCeroIzq($(xTbSeccion).find("#item_cantidad").val(),2),d="data-id",""==(r=a)&&(r=e,d="data-nombus"),0!=(d=xBuscarAttrTbData(xTbSeccion,d,r))?(d.find("#td_precio").text(xMoneda(i)),d.find("#td_cant").text(o),d.find("#td_cant_preparado").text(o),$(d).addClass("xBold")):(r='<tr class="row nomarcar" data-id="'+a+'" data-nombus="'+e+'"><td data-id="'+t+'" id="td_des" onclick="xModRow(this,3);"><span class="xIconTr xIcoDelete xIzquierda" title="Borrar" onclick="xxxBorrarItemLocal(this);"></span>'+e+'</td><td align="right" data-ColumName="precio" onclick="xModRow(this,1);" id="td_precio">'+xMoneda(i)+'</td><td align="center" data-ColumName="cantidad" class="cantidad_sum" onclick="xModRow(this,2);" id="td_cant">'+o+'</td><td class="xInvisible" id="td_detalle"></td><td class="xInvisible" id="td_img"></td><td class="xInvisible" data-ColumName="idcarta_lista" id="td_idcarta_lista"></td><td class="xInvisible" data-ColumName="idseccion" id="td_idseccion"></td><td class="xInvisible" data-ColumName="iditem" id="td_iditem">"'+a+'"</td><td class="xInvisible" data-ColumName="cant_preparado" id="td_cant_preparado"></td><td class="xInvisible" data-ColumName="sec_orden" id="td_sec_orden"></td></tr>',xTbSeccion.append(r).trigger("create")),xNewItemNoRow(xTbSeccion))})}function xModRow(t,a){var e=$(t).text(),i=3!=a?"xAlinearDerecha":"";0<$(t).find("input").length||$(t).html('<input type="text" class="xMiInput xPasarEnter2 '+i+'" onblur="xModBlur(this,'+a+')" value="'+e+'" select>').trigger("create"),$(t).find("input").select()}function xModBlur(t,a){var e=$(t).val(),i=$(t).parents("table"),e=1==a?xMoneda(e):xCeroIzq(e,2);$(t).parent().text(e),$(t).remove(),xSumarTotal(i)}function xValidarInputs(t,a){var e=!0;""==$(t).find("#item_des").val()&&($(t).find("#item_des").attr("required",!0),e=!1),""==$(t).find("#item_precio").val()&&($(t).find("#des_item").attr("required",!0),e=!1),""==$(t).find("#item_cantidad").val()&&($(t).find("#des_item").attr("required",!0),e=!1),a(e)}function xNewItemNoRow(t){$(t).find("#item_des").val(""),$(t).find("#item_precio").val(""),$(t).find("#item_cantidad").val(""),$(t).find("#item_des").focus(),xSumarTotal(t)}function xSumarTotal(t){xCantTotal=xSumaCantRow(t,".cantidad_sum"),t.find(".xtotal").remove(),t.append('<tr class="xtotal xSinBorde"><td></td><td></td><td align="center"><b>'+xCeroIzq(xCantTotal,2)+"</b></td></tr>")}function xLoadListadoCartaActual(){xPopupLoad.xopen(),xIdCarta="",$.ajax({type:"POST",url:"../../bdphp/log.php?op=2051",data:{i:xidCategoria}}).done(function(t){var a="",e="",i="",o=new Array,d="",r=0,n="",c="";xdtCAct=(xdtCAct=$.parseJSON(t)).datos,$("#f_uc").text(""),$("#Lista_Carta .xSeccion").remove();for(var s,l=0;l<xdtCAct.length;l++)xFechaUltimaCarta=xdtCAct[0].fecha,$("#f_uc").text(xFechaUltimaCarta),xIdCarta=xdtCAct[0].idcarta,d!=xdtCAct[l].idseccion&&(d=xdtCAct[l].idseccion,s="0"!==xdtCAct[l].is_visible_cliente_seccion.toString(),o[r]={des:xdtCAct[l].des_seccion,id:xdtCAct[l].idseccion,idcarta:xdtCAct[l].idcarta,print:xdtCAct[l].imprimir,img:xdtCAct[l].img_seccion,is_visible_cliente:s},r++);for(var p=0;p<o.length;p++){d=o[p].id;var x=o[p].is_visible_cliente?'checked = "true"':"",n="xImgCheck";1==o[p].print&&(n="xImgNoCheck"),1==o[p].ver_stock_cero&&(c="xImgNoCheck"),imgIcono=""!=o[p].img?o[p].img:p+".png",e=String('<div class="xSeccion" data-modificado="0" data-t="carta_lista" data-idborrar="'+d+'"><br><br><div onclick="openImgIconDialogCarta(this, 0)" class="content-icon-seccion"><img class="img-ico-seccion xCursor" style="width: 24px;" src="'+xRutaIconSeccion+imgIcono+'" alt="img-ico"></div><input type="text" value="'+o[p].des+'" data-dessec="'+o[p].des+'" tabindex="1" data-id="'+d+'" data-print="'+o[p].print+'" style="width:100%" class="xMiInput xfont20 xPasarEnter2 des_seccion txt_modifica_bd_sec" placeholder="SECCION" onChange="conMayusculas(this)" id="seccion_des"><div style="margin-bottom: -35px;"><div><paper-checkbox id="check_visible_cliente_seccion" data-idseccion="'+o[p].id+'" '+x+' onchange="updateVisibleSeccion(this)"><span class="fs-12 text-secondary"><strong>No</strong> visible para el cliente.</span></paper-checkbox><br></div></div><br><div class="xCursor xDerecha xfont12"><img src="../../images/_prit_2.png" style="margin-left:7px; margin-top:3px;" class="'+n+'" onclick="xCheckImgPrint(this)" title="Mostrar en impresion" id="xseccio_print"><img src="../../images/_see_2.png" style="margin-left:7px; margin-top:3px;" class="'+c+'" onclick="xVerSiStockCero(this)" title="Mostrar items si su stock es cero" id="xseccio_ver_si_stock_cero"></div><a class="xfont12 xColorRow_Azul xCursor xDerecha" onclick="xBorrarSeccion(this);">Borrar Seccion</a><br><br><table class="xtable3 xpadingLateralDe tb_item" width="100%" data-TablaName="carta_lista" data-idsec="'+o[p].id+'"><thead><th class="xSinBorde" width="70%"></th><th class="xSinBorde" width="20px" align="right"></th><th class="xSinBorde" width="20px" align="center"></th></thead><tr class="xSinBorde" data-id=""><td><input type="text" tabindex="2" id="item_des" data-id="" class="xMiInput xPasarEnter2 des_item" placeholder="ITEM" onChange="conMayusculas(this)" required></td><td><input type="text" tabindex="3" id="item_precio" class="xMiInput xPasarEnter2 xAlinearDerecha" placeholder="PRECIO" onChange="conMayusculas(this)" onblur="xRetornaMoneda(this)"  placeholder="Precio" id="precio" name="precio" required></td><td class="d-flexx"><input type="text" tabindex="4" id="item_cantidad" class="xMiInput xAlinearCentro xcantidad" placeholder="CANTIDAD" onChange="conMayusculas(this)" required><button class="btn-add-item-carta" title="Agregar Item" onclick="xAddRowItem(this)"><i class="fa fa-plus"></i></button></td></tr>?row</table></div>'),i="";for(var m,l=0;l<xdtCAct.length;l++)d==xdtCAct[l].idseccion&&(m="0"===xdtCAct[l].is_recomendacion?"fa fa-star-o":"fa fa-star text-warning",i=String(i+'<tr class="row nomarcar" data-modificado="0" data-t="carta_lista" data-idborrar="'+xdtCAct[l].idcarta_lista+'" data-id="'+xdtCAct[l].iditem+'" data-idcarta='+xdtCAct[l].idcarta+' data-nombus="'+xdtCAct[l].des_seccion+'"><td data-id="'+d+'" id="td_des" onclick="xModRow(this,3);" class="txt_modifica_bd"><span class="xIconTr xIcoDelete xIzquierda" title="Borrar" onclick="xxxBorrarItemLocalBD(this, event);"></span>'+xdtCAct[l].des_item+'</td><td align="right" data-ColumName="precio" class="txt_modifica_bd" onclick="xModRow(this,1);" id="td_precio">'+xdtCAct[l].precio+'</td><td align="center" data-ColumName="cantidad" class="cantidad_sum txt_modifica_bd" onclick="xModRow(this,2);" id="td_cant">'+xdtCAct[l].cantidad+'<span class="xDerecha xCursor text-secondary" title="Recomendado" onclick="xItemRecomendado('+l+',this, event);"><i class="'+m+'" aria-hidden="true"></i></span><span class="xIconTr xIcoSubItem xDerecha" title="Opciones Adicionales" onclick="xItemDetalleOpciones('+l+',this, event);"></span></td><td class="xInvisible" id="td_detalle">'+xdtCAct[l].detalle+'</td><td class="xInvisible" id="td_img">'+xdtCAct[l].img+'</td><td class="xInvisible" data-ColumName="idcarta_lista" id="td_idcarta_lista">'+xdtCAct[l].idcarta_lista+'</td><td class="xInvisible" data-ColumName="idseccion" id="td_idseccion">'+xdtCAct[l].idseccion+'</td><td class="xInvisible" data-ColumName="iditem" id="td_iditem">"'+xdtCAct[l].iditem+'"</td><td class="xInvisible" data-ColumName="cant_preparado" id="td_cant_preparado">'+xdtCAct[l].cant_preparado+'</td><td class="xInvisible" data-ColumName="sec_orden" id="td_sec_orden">'+xdtCAct[l].sec_orden+"</td></tr>"));a=String(e.replace("?row",i)),$("#Lista_Carta").append(a).trigger("create"),xSumarTotal($(".tb_item:last")),xCargarEnInputItem(),xCargarEnImputSeccion()}""==a?(xPopupLoad.xclose(),xAddNewSeccion()):(xPasaEnterClass(),xPopupLoad.xclose(),xPopupLoad.titulo="Guardando...")})}function xLoadCarta(){$.ajax({type:"POST",url:"../../bdphp/log.php?op=1"}).done(function(t){for(var a="",e=$.parseJSON(t).datos,i=0;i<e.length;i++)0==i&&(xidCategoria=e[i].idcategoria),a=a+'<option value="'+e[i].idcategoria+'">'+e[i].descripcion+"</option>";$("#SelCarta").html(a).trigger("create"),xLoadListadoCartaActual()})}function xLoadItemsCategoria(){xPopupLoad.titulo="Cargando...",xPopupLoad.xopen(),$.ajax({type:"POST",url:"../../bdphp/log.php?op=2"}).done(function(t){t=$.parseJSON(t);xThisCarta.dt_item=t.datos,xCargarEnInputItem()}),$.ajax({type:"POST",url:"../../bdphp/log.php?op=201"}).done(function(t){t=$.parseJSON(t);xThisCarta.dt_seccion=t.datos,xCargarEnImputSeccion()})}function xCargarEnInputItem(){var t=xThisCarta.dt_item,e=$(".des_item:last");e.autocomplete({autoFocus:!0,source:t,select:function(t,a){return e.val(a.item.label),e.attr("data-value",a.item.value),e.parents("tr").find("#item_precio").val(a.item.precio),!1},focus:function(t,a){return!1},change:function(t,a){return null===a.item&&(e.attr("data-value",""),e.parents("tr").find("#item_precio").val("")),!1}})}function xCargarEnImputSeccion(){var t=xThisCarta.dt_seccion,e=$(".des_seccion:last");const i=$(e).parent();e.autocomplete({autoFocus:!0,source:t,select:function(t,a){return e.val(a.item.label),e.attr("data-value",a.item.value),e.attr("data-id",a.item.value),!1},focus:function(t,a){return!1},change:function(t,a){return void 0!==$(i).attr("data-modificado")&&1===parseInt($(i).attr("data-modificado"))||null===a.item&&(e.attr("data-value",""),e.attr("data-id","")),!1}})}function xxxBorrarItemLocal(t){var t=$(t).parent().parent(),a=t.parents("table");$(t).fadeTo(550,0,function(){$(this).remove(),xSumarTotal(a)})}function xxxBorrarItemLocalBD(t,a){var t=t.parentNode.parentNode,e=$(t).attr("data-t"),i=$(t).attr("data-idborrar");xBorrarRegistroFisico(e,i),$(t).fadeTo(550,0,function(){$(this).remove()}),$("#Lista_Carta").trigger("create"),a.stopImmediatePropagation(),a.stopPropagation()}function xBorrarSeccionLocal(t){t=t.parentNode;$(t).fadeTo(550,0,function(){$(this).remove()})}function xBorrarSeccion(t){var t=t.parentNode,a=$(t).attr("data-t"),e=$(t).attr("data-idborrar");xBorrarRegistroFisico2(a,e,"idseccion"),$(t).fadeTo(550,0,function(){$(this).remove()}),$("#Lista_Carta").trigger("create")}function xItemQuitarFoto(){xPopupLoad.xopen(),compImgItem.resetControl(),$.ajax({type:"POST",url:"../../bdphp/log.php?op=207",data:{i:xIdObjImgDet,d:""}}).done(function(t){xPopupLoad.xclose()})}function xItemGuardarFoto(){var t="item"+xIdObjImgDet;uploadImgItem(compImgItem.getImgBase64(),t)}function uploadImgItem(t,a){$.ajax({type:"POST",url:"upload_base64.php?op=1",data:{nomfile:a,img:t}}).done(t=>{console.log("res",t),transferenciaCompleta(t)})}function transferenciaCompleta(a){$.ajax({type:"POST",url:"../../bdphp/log.php?op=207",data:{i:xIdObjImgDet,d:a}}).done(function(t){$(xObjImgDet).parents("tr").find("#td_img").text(a)})}function xCheckImgPrint(t){var a=$(t).parent().parent().find("#seccion_des").attr("data-id"),e=$(t).hasClass("xImgCheck")?($(t).removeClass("xImgCheck"),$(t).addClass("xImgNoCheck"),$(t).attr("title","No mostrar al imprimir"),1):($(t).removeClass("xImgNoCheck"),$(t).addClass("xImgCheck"),$(t).attr("title","Mostrar en impresion"),0);$(t).parent().parent().find("#seccion_des").attr("data-print",e),$.ajax({type:"POST",url:"../../bdphp/log.php?op=2032",data:{i:a,p:e}})}function xVerSiStockCero(t){var a=$(t).parent().parent().find("#seccion_des").attr("data-id"),e=$(t).hasClass("xImgCheck")?($(t).removeClass("xImgCheck"),$(t).addClass("xImgNoCheck"),$(t).attr("title","NO Mostrar items si su stock es cero"),1):($(t).removeClass("xImgNoCheck"),$(t).addClass("xImgCheck"),$(t).attr("title","Mostrar items si su stock es cero"),0);$(t).parent().parent().find("#seccion_des").attr("data-stockcero",e),$.ajax({type:"POST",url:"../../bdphp/log.php?op=2033",data:{i:a,p:e}})}function xloadCartaHistorial(){var t=txt_buscar.value;$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=6",data:{filtro:t}}).done(t=>{t=JSON.parse(t),xThisCarta.ListHistorial=t.datos})}function xfiltrarCartaHistorial(){xe_debounce||(xe_debounce=!0,clearTimeout(xdebounce),xdebounce=setTimeout(()=>{xe_debounce=!1,xloadCartaHistorial()},900))}function updateVisible(){var t=check_visible_cliente.checked?1:0;txt_buscar.value;$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=19",data:{id:xIdObjCartaLista,check:t}}).done(t=>{console.log("ok")})}function updateVisibleSeccion(t){var a=t.checked?1:0,t=$(t).attr("data-idseccion");$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=1901",data:{id:t,check:a}}).done(t=>{console.log("ok")})}function loadIconSeccionCarta(){var t=0,a=[];for(xThisCarta.listIconSeccion=[];t<=244;)a.push({img:xRutaIconSeccion+t+".png"}),t++;xThisCarta.listIconSeccion=a}function openImgIconDialogCarta(t,a){opIcon=a,xidSeccionIcon=t.parentElement.dataset.idborrar,xObjChangeIcon=t,dialog_img_ico_carta.open()}function updateIconSeccionCarta(t){const a=t.dataIndex+".png";xPopupLoad.xopen(),$.ajax({type:"POST",url:"../../bdphp/log_004.php?op=8",data:{i:xidSeccionIcon,img:a,opIcon:opIcon}}).done(function(t){dialog_img_ico_carta.close(),xPopupLoad.xclose(),$(xObjChangeIcon).html('<img class="img-ico-seccion xCursor" style="width: 24px;" src="'+xRutaIconSeccion+a+'" alt="img-ico">')})}Polymer({is:"x-carta",properties:{dt_item:Object,dt_seccion:Object,ListHistorial:[],idItemSelected:Number,medidaImgCarta:[],listIconSeccion:[]},attached:function(){this.selected=0,this.selectedDetalle=0,xThisCarta=this,xInicarta()},displayIndex:function(t){return xCeroIzq(t+1,1)}})</script>