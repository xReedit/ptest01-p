<link rel="import"href="../../x-componentes/x-comp-find-tipo-ingreso/x-comp-find-tipo-ingreso.html"><dom-module id="x-ingresos-otros"><template is="dom"><paper-dialog class="dialog_redondo"id="dialog_borrar"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="xtxtCentro"><img src="../../../images/_dlg_remove.gif"alt=""width="150px"></div><p>Esta seguro de querer borrar este registro?</p><br><div class="buttons"><button class="xBoton2 xPlomo"dialog-dismiss>Cancelar</button> <button class="xBoton2 xRojo"onclick="xDlgBorrar()">Si, borrar</button></div></paper-dialog><paper-dialog class="dialog_redondo"id="dialog_new_ingreso"style="width:345px"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"><div><h4>Registrar otro ingreso.</h4><br><form id="form_new_io"method="POST"><x-comp-find-tipo-ingreso id="compTpIngreso"onchange="_getTipoIngreso(list_tipo_ingreso)"></x-comp-find-tipo-ingreso><input type="date"class="xMiInput xPasarEnter2"id="date_fecha_ingreso"espaciar> <input class="xMiInput xPasarEnter2"placeholder="DESCRIPCION"onchange="conMayusculas(this)"id="descripcion"name="descripcion"espaciar required> <input type="number"class="xMiInput xPasarEnter2"placeholder="IMPORTE"onchange="conMayusculas(this)"id="importe"name="importe"espaciar required><div class="xInvisible"><input id="idsede"name="idsede"value$="[[xt_idsede]]"> <input id="idorg"name="idorg"value$="[[xt_org]]"> <input id="idtipo_ingreso"name="idtipo_ingreso"> <input id="fecha_registro"name="fecha_registro"> <input id="fecha_ingreso"name="fecha_ingreso"></div></form><br><br><button dialog-dismiss id="dlg_sunat_btn"onclick="newIO()"class="xBoton2 xVerde">Listo Guardar</button> <button dialog-dismiss class="xBoton2 xRojo">Cerrar</button></div></paper-dialog><br><br><div class="xMiCard xradius"style="width:90%"><div class="xEncanezadoCard xFondoRowAmarillo2"><h3>Otros Ingresos.</h3><p>Registra todos los ingresos que no provienen de venta directa, es decir servicios prestados dentro o fuera del local, como por ejemplo: Catering, alquiler del local, etc.</div><div class="xContentCard"style="height:100%"><div style="width:200px"class="xIzquierda"><input type="month"class="xMiInput xPasarEnter2 xfont18"id="f_filtro"onchange="_changeDateFiltro(this)"></div><paper-fab icon="add"onclick="openDIalogNewIO()"title="Agregar"tabindex="0"class="xDerecha"></paper-fab><table width="100%"><thead><th>#<th>Tipo Gasto<th>Descripcion<th>F. Registro<th>F. Pago<th>Importe<th><tbody><template is="dom-repeat"items="{{ListIO}}"as="item"><tr data-t="contable_ingreso_otro"data-id="{{item.idcontable_ingreso_otro}}"class="animated fadeIn fast"id="{{index}}"><td data-id="{{index}}"><span>{{displayIndex(index)}}</span><td>{{item.tp_ingreso}}<td>{{item.des_concepto}}<td>{{item.fecha_registro}}<td>{{item.fecha_ingreso}}<td>{{item.total}}<td><span class="xDeleteRow2"title="Anular"onclick="xDialogBorrarObj(this)"></span></template><tr><td><td colspan="4"><p class="xfont15 xBold">Total<td><p class="xfont15 xBold">{{sumList}}<td></table></div></div></template></dom-module><script>var xThisIO,sel_idTipoIngreso,xObjBorrar,_mm,_yy,dateNow,fecha_filtrar=new Date;function xIniIO(){$("body").addClass("loaded");var e=xm_log_get("app3_us"),e=(xThisIO.xt_org=e.ido,xThisIO.xt_idsede=e.idsede,xThisIO.xt_idus=e.idus,(dateNow=new Date).toISOString().split("T")[0]),e=(date_fecha_ingreso.max=e,date_fecha_ingreso.value=e,dateNow.getFullYear()+"-"+xCeroIzq(dateNow.getMonth()+1,2));f_filtro.max=e,f_filtro.value=e,_mm=fecha_filtrar.getMonth()+1,_yy=fecha_filtrar.getFullYear(),getAllListIO(),$(".xPasarEnter2").on("keyup",function(e){e=e.which;if(13==e||186==e){var e=$("input"),o=e.index(document.activeElement);if(null!==e[o+1]){var i=e[o+1];if(void 0===i)return;if(null==(i=i.disabled?e[o+2]:i))return;i.focus(),i.select()}return!1}})}function openDIalogNewIO(){sel_idTipoIngreso=compTpIngreso.getTipoIngreso().idtipo_ingreso,dialog_new_ingreso.open()}function getAllListIO(){$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=2",data:{mm:_mm,yy:_yy}}).done(e=>{var e=JSON.parse(e),o=(console.log(e.datos),0);xThisIO.ListIO=e.datos.map(e=>(o+=parseFloat(e.importe),e)),xThisIO.sumList=numeroConComas(o.toFixed(2))})}function newIO(){xPopupLoad.xopen(),$("#form_new_io #idsede").val(xThisIO.xt_idsede),$("#form_new_io #idorg").val(xThisIO.xt_org),$("#form_new_io #idtipo_ingreso").val(compTpIngreso.getTipoIngreso().idtipo_ingreso),$("#form_new_io #fecha_ingreso").val(xDevolverFechaFormatInputDate(date_fecha_ingreso.value)),$("#form_new_io #fecha_registro").val(xDevolverFecha()),xvalidateForm("form_new_io",function(e){!1!==e&&$.post("../../bdphp/ManejoBD_IUD.php?tb=contable_ingreso_otro",$("#form_new_io").serialize(),function(e){xPopupLoad.xclose(),$("#form_new_io").reset(),xPopupLoad.xclose(),date_fecha_ingreso.value=dateNow.toISOString().split("T")[0],getAllListIO(),dialog_new_ingreso.close()})})}function _changeDateFiltro(e){e=e.value.split("-");_mm=e[1],_yy=e[0],getAllListIO()}function xDialogBorrarObj(e,o){xObjBorrar=e,dialog_borrar.open()}function xDlgBorrar(){xBorrarItem(xObjBorrar),dialog_borrar.close()}function _getTipoIngreso(e){}Polymer({is:"x-ingresos-otros",properties:{xt_org:Number,xt_idsede:Number,sumList:String,ListIO:[],selItemIO:[]},attached:function(){xThisIO=this,xIniIO()},displayIndex:function(e){return xCeroIzq(e+1,1)}})</script>