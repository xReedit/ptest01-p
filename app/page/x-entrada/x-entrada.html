<dom-module id="x-entrada"><script src="../../view/item_pedido_print_comprobante.js"></script><script rel="prefetch"src="../../view/socket.service.p.js"></script><template is="dom-bind"><paper-dialog modal id="dialog_cierre_ticket_venta"class="dialog_redondo"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><p class="fw-600">Al imprimir el resumen se realizara el corte a la fecha y hora actual.<div><button class="btn btn-success"onclick="xCerrarVentaTicketEntrada()">Listo.</button> <button class="btn btn-secondary"dialog-dismiss>Cancelar</button></div><br></paper-dialog><div class="content-ticket-rapido mt-2"><div><paper-tabs selected="{{selected_tab_ticket_venta}}"class="tab-ticket"id="tabs_ticket_venta"><paper-tab>Ticket</paper-tab><paper-tab>Resumen</paper-tab></paper-tabs></div><br><div class="ticket-body"><iron-pages selected="{{selected_tab_ticket_venta}}"><div id="ticketventa"><div class="d-flexx justify-content-between align-items-center"><p class="fw-600 fs-16 text-center">Ticket RÃ¡pido</p><select id="selSeccionesTicket"class="selected-template-1"style="max-width:170px"onchange="xChangeSeccionTicket(this)"><template is="dom-repeat"items="{{listSeccionesTicket}}"as="item"><option value="[[index]]">[[item.descripcion]]</template></select></div><br><div class="xLinea2"></div><br><div><template is="dom-repeat"items="{{listItemsTicketEntrada}}"as="item"><div class="item-ticket"><div data-index="[[index]]"onclick="xAddItemTicket(this,1)"class="w-100"><p class="pl-2 noselect">{{item.descripcion}} | {{item.precio}}</div><div class="cantidad-ticket"><div class="btn-ticket menos noselect"data-index="[[index]]"onclick="xAddItemTicket(this,0)">-</div><div class="pl-1 pr-1 noselect">{{ item.cantidad_seleccionada }}</div><div class="btn-ticket mas noselect"data-index="[[index]]"onclick="xAddItemTicket(this,1)">+</div></div></div></template><div class="total-ticket"><div class="importe-total"><p class="text-secondary mr-2 fs-18 noselect">Total<p class="fw-600 fs-26 noselect">{{importeTotalTicketEntrada}}</div></div><br><div class="xLinea2"></div><br><div class="text-right"><button class="btn btn-success fs-18"disabled$="[[ !isShowBtnTicketEntrada ]]"onclick="xSaveTicketEntrada()">Listo Registrar</button></div></div></div><div id="ticketresumen"><p class="fw-600 fs-18">Resumen de venta:</p><br><div class="xLinea2"></div><table class="w-100"><thead><th align="left">Descripcion<th align="center">Cant.<th align="right">Total<tbody><template is="dom-repeat"items="{{listResumenTicketEntrada}}"as="item"><tr><td>{{ item.descripcion }}<td align="center">{{ item.cantidad }}<td align="right">{{ item.total }}</template><tr><td colspan="3"align="right"><p class="fw-600 fs-18">S/. {{ totalResumenTicketEntrada }}</table><br><br><div class="text-right"><button class="btn btn-info fs-18"disabled$="[[ !isShowBtnResumenTicketEntrada ]]"onclick="dialog_cierre_ticket_venta.open()">Imprimir Resumen</button></div></div></iron-pages></div></div></template><style>.content-ticket-rapido{max-width:450px;margin:0 auto;height:calc(100vh - 80px);background:#e8e8e8}.content-ticket-rapido .ticket-body{padding:10px}.tab-ticket{background:#cbcbcb;padding:0;margin:0;border-radius:5px 5px 0 0;max-width:450px;border-bottom:2px solid #989898;font-size:18px!important}.item-ticket{font-size:14px;display:flex;justify-content:space-between;background:#f6f6f6;border-radius:5px;margin-bottom:8px;font-weight:600;align-items:center;cursor:pointer;height:48px}.item-ticket:hover{background:#fafaa4}.item-ticket .cantidad-ticket{display:flex;justify-content:space-between;font-size:25px;align-items:center}.cantidad-ticket .btn-ticket{padding:12px;border-radius:5px}.cantidad-ticket .btn-ticket.menos:hover{background:#faa}.cantidad-ticket .btn-ticket.mas:hover{background:#9ef3b4}.total-ticket{display:flex;flex-direction:row-reverse;align-items:center}.total-ticket .importe-total{display:flex;padding:10px;background:#d0d0d0;border-radius:5px;margin-top:5px}</style><script>var xThisEntrada;function xIniTicketEntrada(){$("#tabs_ticket_venta").on("iron-select",function(){1===xThisEntrada.selected_tab_ticket_venta&&xLoadResumenTicketEntrada()}),$.ajax({type:"POST",url:"../../bdphp/log_componentes.php?op=2002"}).done(function(t){t=JSON.parse(t),xThisEntrada.listSeccionesTicket=t.datos;let e=0,i=null;xThisEntrada.listSeccionesTicket.map((t,a)=>{"ticket entrada"===t.descripcion.toLowerCase()&&(e=a,i=t)}),xThisEntrada.selected_tab_ticket_venta=0,setTimeout(()=>{i&&(xThisEntrada.seccionSelectedInti=i,selSeccionesTicket.selectedIndex=e,xGetItemsSeccionTicket(i.idseccion))},700)})}function xChangeSeccionTicket(){var t=xThisEntrada.$.selSeccionesTicket.value;xGetItemsSeccionTicket(xThisEntrada.listSeccionesTicket[t].idseccion)}function xGetItemsSeccionTicket(t){$.ajax({type:"POST",url:"../../bdphp/log_componentes.php?op=22",data:{idseccion:t}}).done(t=>{t=JSON.parse(t),xThisEntrada.listItemsTicketEntrada=t.datos,xNewListTicketEntrada()})}function xNewListTicketEntrada(){xThisEntrada.listItemsTicketEntrada.map(t=>{t.cantidad_seleccionada=0,t.total=0}),xThisEntrada.importeTotalTicketEntrada=0,xThisEntrada.isShowBtnTicketEntrada=!1,xThisEntrada.listItemsTicketEntrada=JSON.parse(JSON.stringify(xThisEntrada.listItemsTicketEntrada))}function xAddItemTicket(t,a){t=xThisEntrada.listItemsTicketEntrada[t.dataIndex];1==a?t.cantidad_seleccionada++:t.cantidad_seleccionada=0===t.cantidad_seleccionada?0:t.cantidad_seleccionada-1,xThisEntrada.listItemsTicketEntrada=JSON.parse(JSON.stringify(xThisEntrada.listItemsTicketEntrada)),xSumTotalTicketEntrada()}function xSumTotalTicketEntrada(){xThisEntrada.listItemsTicketEntrada=xThisEntrada.listItemsTicketEntrada.map(t=>(t.total=parseFloat(t.precio)*parseFloat(t.cantidad_seleccionada),t)),xThisEntrada.importeTotalTicketEntrada=parseFloat(xThisEntrada.listItemsTicketEntrada.map(t=>t.total).reduce((t,a)=>t+a,0)).toFixed(2),xThisEntrada.isShowBtnTicketEntrada=0<xThisEntrada.importeTotalTicketEntrada}function xSaveTicketEntrada(){var t=xThisEntrada.listItemsTicketEntrada.filter(t=>0<t.cantidad_seleccionada);xPopupLoad.xopen(),$.ajax({type:"POST",url:"../../bdphp/log_componentes.php?op=2201",data:{items:t,total:xThisEntrada.importeTotalTicketEntrada}}).done(t=>{xCocinarImpresionTicketEntrada((t=JSON.parse(t)).datos[0].correlativo),setTimeout(()=>{xPopupLoad.xclose()},700)})}function xCocinarImpresionTicketEntrada(t){var a=xThisEntrada.listItemsTicketEntrada.filter(t=>0<t.cantidad_seleccionada),e=[{descripcion:"Total",importe:xThisEntrada.importeTotalTicketEntrada}],i=xgetImpresoraById(xThisEntrada.seccionSelectedInti.idimpresora);i&&(a={lista:a,impresora:i,subtotales:e,encabezado:{correlativo_dia:xCeroIzq(t,5)}},xImprimirCualquierLista(a,7,"ticket"),xNewListTicketEntrada())}function xCerrarVentaTicketEntrada(){xPopupLoad.xopen(),$.ajax({type:"POST",url:"../../bdphp/log_componentes.php?op=2203"}).done(t=>{dialog_cierre_ticket_venta.close(),xCocinarImpresionResumenTicketEntrada(),xLoadResumenTicketEntrada(),xPopupLoad.xclose()})}function xCocinarImpresionResumenTicketEntrada(){var a=[],t=(xThisEntrada.listResumenTicketEntrada.map(t=>{a.push({descripcion:t.cantidad+" "+t.descripcion,cantidad:t.total})}),[{descripcion:"Total",importe:xThisEntrada.totalResumenTicketEntrada}]),e=xgetImpresoraById(xThisEntrada.seccionSelectedInti.idimpresora);xm_log_get("ini_us");e&&(e={lista:a,impresora:e,subtotales:t,encabezado:{tipo:"RESUMEN DE TICKETS",titulo:"RESUMEN DE TICKETS",correlativo_lista:"",otro:"",observaciones:"Corresponde a: "+xNomU}},xImprimirCualquierLista(e))}function xLoadResumenTicketEntrada(){xPopupLoad.xopen(),$.ajax({type:"POST",url:"../../bdphp/log_componentes.php?op=2202"}).done(t=>{t=JSON.parse(t),xThisEntrada.listResumenTicketEntrada=t.datos,xThisEntrada.totalResumenTicketEntrada=parseFloat(t.datos.map(t=>parseFloat(t.total)).reduce((t,a)=>t+a,0)).toFixed(2),xThisEntrada.isShowBtnResumenTicketEntrada=0<parseFloat(xThisEntrada.totalResumenTicketEntrada),xPopupLoad.xclose()})}Polymer({is:"x-entrada",properties:{listSeccionesTicket:[],seccionSelectedInti:[],listItemsTicketEntrada:[],listResumenTicketEntrada:[],importeTotalTicketEntrada:Number,isShowBtnTicketEntrada:Boolean,selected_tab_ticket_venta:Number,totalResumenTicketEntrada:Number,isShowBtnResumenTicketEntrada:Boolean},attached:function(){this.selected_tab_ticket_venta=0,this.isShowBtnTicketEntrada=!1,this.isShowBtnResumenTicketEntrada=!1,xThisEntrada=this,xIniTicketEntrada(),_cpSocketOpen()},detached:()=>{_cpSocketClose()}})</script></dom-module>