<dom-module id="x-proveedores-detalle"><template><h4>Detalle de compras a:</h4><p class="fw-600 fs-15">{{objproveedor.descripcion}} <span class="fw-100 fs-13 text-secondary">{{objproveedor.dni}} <i class="fa fa-phone ml-2"></i> {{objproveedor.telefono}}</span><p class="text-secondary fw-100">{{objproveedor.direccion}}<div class="xLinea2"></div><br><div class="grid-container"><div class="column1"><div class="column-title"><p>Compras</div><table class="w-100 fs-12"><thead><th>#<th>Fecha<th align="right">Improte<tbody><template is="dom-repeat"items="{{listCompras}}"as="item"><tr class$="{{item.classRow}}"onclick="listProveedorComprasDetalle(this)"data-id="{{item.idcompra}}"><td>{{displayIndex(index)}}<td><p>{{item.f_compra}}<p class="fw-100 fs-10 text-secondary">{{item.nom_usuario}}<td align="right">{{item.total}}</template><tr><td colspan="3"align="right"><p class="fw-600 fs-15">{{totalCompras}}</table></div><div class="column2"><div class="column-title d-flexx justify-content-between align-items-center"><p>Productos</p><button class="btn btn-sm btn-xsm xBoton_flat_2"onclick="showAllProductos()">Ver todas la compras</button></div><div hidden$="[[!showAllProductos]]"><p class="badge badge-primary ml-2 mt-2 fs-14 fw-100">Lista de las Ãºltimas compras<table class="w-100 fs-12"><thead><th>Producto<th align="right">Cantidad<th align="right">P.Unitario<th align="right">Total<tbody><template is="dom-repeat"items="{{listAllProductos}}"as="item"><tr><td>{{item.nom_producto}}<td align="right">{{item.cantidad}}<td align="right">{{item.punitario}}<td align="right">{{item.total}}</template><tr><td colspan="4"align="right"><p class="fw-600 fs-15">{{totalProductos}}</table></div><div hidden$="[[showAllProductos]]"><div class="fs-12"style="padding:12px"><div class="d-flexx"><div class="mr-2"><p><strong>F. Compra:</strong> {{objCompraSeleted.f_compra}}<p><strong>Forma de pago:</strong> {{objCompraSeleted.des_tipo_pago}}</div><div><p><strong>Almacen que ingresa:</strong> {{objCompraSeleted.nom_almacen}}<p><strong>Usuario:</strong> {{objCompraSeleted.nom_usuario}}</div></div><p><strong>Anotaciones:</strong> {{objCompraSeleted.nota_de_compra}}</div><table class="w-100 fs-12"><thead><th>Producto<th align="right">Cantidad<th align="right">P.Unitario<th align="right">Total<tbody><template is="dom-repeat"items="{{listProductosByCompra}}"as="item"><tr><td>{{item.nom_producto}}<td align="right">{{item.cantidad}}<td align="right">{{item.punitario}}<td align="right">{{item.total}}</template><tr><td colspan="4"align="right"><p class="fw-600 fs-15">{{totalProductos}}</table></div></div></div></template><style>.grid-container{display:grid;grid-template-columns:minmax(270px,350px) auto;gap:10px}.column1{border:1px solid #ccc;border-radius:5px}.column2{border:1px solid #ccc;border-radius:5px}.column-title{border-radius:5px 5px 0 0;color:#fff!important;padding:5px 10px 5px 10px;background:#424242;height:30px;justify-content:space-between;display:flex;align-items:center}@media (max-width:767px){.grid-container{grid-template-columns:1fr}.column2{margin-top:10px}}</style><script>var xThisProveedoresDetalle;async function xInitProveedoresDetalle(){xPopupLoad.xopen();var e=await(new httpFecht).postJson("../../bdphp/log_009.php?op=21");e.success&&(xThisProveedores.listProveedores=e.datos),xPopupLoad.xclose()}function xLoadDataProveedorDetalle(){listProveedorCompras(),listProveedorComprasTodos()}async function listProveedorCompras(){var e=new httpFecht,o={idproveedor:xThisProveedoresDetalle.objproveedor.idproveedor},e=await e.postJson("../../bdphp/log_009.php?op=2101",o);e.success&&(xThisProveedoresDetalle.listCompras=e.datos.map(e=>(e.selected=!1,e.classRow="xCursor",e)),xThisProveedoresDetalle.totalCompras=xThisProveedoresDetalle.listCompras.map(e=>parseFloat(removeComas(e.total))).reduce((e,o)=>e+o,0),xThisProveedoresDetalle.totalCompras=xThisProveedoresDetalle.totalCompras.toFixed(2))}async function listProveedorComprasDetalle(e){xPopupLoad.xopen();const o=e.dataId;xThisProveedoresDetalle.objCompraSeleted=xThisProveedoresDetalle.listCompras.find(e=>e.idcompra==o),rowListCompraSelected(xThisProveedoresDetalle.objCompraSeleted);var e=new httpFecht,s={idcompra:xThisProveedoresDetalle.objCompraSeleted.idcompra},e=await e.postJson("../../bdphp/log_009.php?op=2103",s);e.success&&(xThisProveedoresDetalle.listProductosByCompra=e.datos,xThisProveedoresDetalle.totalProductos=e.datos.map(e=>parseFloat(removeComas(e.total))).reduce((e,o)=>e+o,0),xThisProveedoresDetalle.totalProductos=xThisProveedoresDetalle.totalProductos.toFixed(2)),xPopupLoad.xclose(),xThisProveedoresDetalle.showAllProductos=!1}async function listProveedorComprasTodos(){xPopupLoad.xopen();var e=new httpFecht,o={idproveedor:xThisProveedoresDetalle.objproveedor.idproveedor},e=await e.postJson("../../bdphp/log_009.php?op=2102",o);e.success&&(xThisProveedoresDetalle.listAllProductos=e.datos,showAllProductos()),xPopupLoad.xclose()}function showAllProductos(){xThisProveedoresDetalle.totalProductos=xThisProveedoresDetalle.listAllProductos.map(e=>parseFloat(removeComas(e.total))).reduce((e,o)=>e+o,0),xThisProveedoresDetalle.totalProductos=xThisProveedoresDetalle.totalProductos.toFixed(2),xThisProveedoresDetalle.showAllProductos=!0}function rowListCompraSelected(o){xThisProveedoresDetalle.listCompras.forEach(e=>{e.idcompra==o.idcompra?(e.selected=!0,e.classRow="xCursor selected"):(e.selected=!1,e.classRow="xCursor")}),xThisProveedoresDetalle.listCompras=JSON.parse(JSON.stringify(xThisProveedoresDetalle.listCompras))}Polymer({is:"x-proveedores-detalle",properties:{objproveedor:{type:Object,notify:!0,reflectToAttribute:!0,observer:"proveedorChanged"},listCompras:[],listAllProductos:[],listProductosByCompra:[],totalCompras:Number,totalProductos:Number,objCompraSeleted:[],showAllProductos:Boolean},proveedorChanged:e=>{xLoadDataProveedorDetalle()},attached:function(){this.showAllProductos=!0,xThisProveedoresDetalle=this,xInitProveedoresDetalle()},displayIndex:function(e){return xCeroIzq(e+1,1)}})</script></dom-module>