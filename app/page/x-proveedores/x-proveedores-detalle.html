<dom-module id="x-proveedores-detalle">
<template>
<h4>Detalle de compras a:</h4>
<p class="fw-600 fs-15">{{objproveedor.descripcion}}
<span class="fw-100 fs-13 text-secondary">
{{objproveedor.dni}}
<i class="fa fa-phone ml-2"></i>
{{objproveedor.telefono}}
</span></p>
<p class="text-secondary fw-100">{{objproveedor.direccion}}</p>
<div class="xLinea2"></div><br>
<div class="grid-container">
<div class="column1">
<div class="column-title">
<p>Compras</p>
</div>
<table class="w-100 fs-12">
<thead>
<th>#</th>
<th>Fecha</th>
<th align="right">Improte</th>
</thead>
<tbody>
<template is="dom-repeat" items="{{listCompras}}" as="item">
<tr class$="{{item.classRow}}" onclick="listProveedorComprasDetalle(this)" data-id="{{item.idcompra}}">
<td>{{displayIndex(index)}}</td>
<td>
<p>{{item.f_compra}}</p>
<p class="fw-100 fs-10 text-secondary">{{item.nom_usuario}}</p>
</td>
<td align="right">{{item.total}}</td>
</tr>
</template>
<tr>
<td colspan="3" align="right">
<p class="fw-600 fs-15">{{totalCompras}}</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="column2">
<div class="column-title d-flexx justify-content-between align-items-center">
<p>Productos</p>
<button class="btn btn-sm btn-xsm xBoton_flat_2" onclick="showAllProductos()">Ver todas la compras</button>
</div>
<div hidden$="[[!showAllProductos]]">
<p class="badge badge-primary ml-2 mt-2 fs-14 fw-100">Lista de las Ãºltimas compras</p>
<table class="w-100 fs-12">
<thead>
<th>Producto</th>
<th align="right">Cantidad</th>
<th align="right">P.Unitario</th>
<th align="right">Total</th>
</thead>
<tbody>
<template is="dom-repeat" items="{{listAllProductos}}" as="item">
<tr>
<td>{{item.nom_producto}}</td>
<td align="right">{{item.cantidad}}</td>
<td align="right">{{item.punitario}}</td>
<td align="right">{{item.total}}</td>
</tr>
</template>
<tr>
<td colspan="4" align="right">
<p class="fw-600 fs-15">{{totalProductos}}</p>
</td>
</tr>
</tbody>
</table>
</div>
<div hidden$="[[showAllProductos]]">
<div class="fs-12" style="padding:12px">
<div class="d-flexx">
<div class="mr-2">
<p><strong>F. Compra:</strong> {{objCompraSeleted.f_compra}}</p>
<p><strong>Forma de pago:</strong> {{objCompraSeleted.des_tipo_pago}}</p>
</div>
<div>
<p><strong>Almacen que ingresa:</strong> {{objCompraSeleted.nom_almacen}}</p>
<p><strong>Usuario:</strong> {{objCompraSeleted.nom_usuario}}</p>
</div>
</div>
<p><strong>Anotaciones:</strong> {{objCompraSeleted.nota_de_compra}}</p>
</div>
<table class="w-100 fs-12">
<thead>
<th>Producto</th>
<th align="right">Cantidad</th>
<th align="right">P.Unitario</th>
<th align="right">Total</th>
</thead>
<tbody>
<template is="dom-repeat" items="{{listProductosByCompra}}" as="item">
<tr>
<td>{{item.nom_producto}}</td>
<td align="right">{{item.cantidad}}</td>
<td align="right">{{item.punitario}}</td>
<td align="right">{{item.total}}</td>
</tr>
</template>
<tr>
<td colspan="4" align="right">
<p class="fw-600 fs-15">{{totalProductos}}</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</template>
<style>.grid-container{display:grid;grid-template-columns:minmax(270px,350px) auto;gap:10px}.column1{border:1px solid #ccc;border-radius:5px}.column2{border:1px solid #ccc;border-radius:5px}.column-title{border-radius:5px 5px 0 0;color:#fff!important;padding:5px 10px 5px 10px;background:#424242;height:30px;justify-content:space-between;display:flex;align-items:center}@media(max-width:767px){.grid-container{grid-template-columns:1fr}.column2{margin-top:10px}}</style>
<script>var xThisProveedoresDetalle
async function xInitProveedoresDetalle(){xPopupLoad.xopen();const _httpFecht=new httpFecht();const rpt=await _httpFecht.postJson('../../bdphp/log_009.php?op=21')
console.log('rpt',rpt);if(rpt.success){xThisProveedores.listProveedores=rpt.datos}
xPopupLoad.xclose();}
function xLoadDataProveedorDetalle(){listProveedorCompras()
listProveedorComprasTodos()}
async function listProveedorCompras(){const _httpFecht=new httpFecht();const _data={idproveedor:xThisProveedoresDetalle.objproveedor.idproveedor}
const rpt=await _httpFecht.postJson('../../bdphp/log_009.php?op=2101',_data)
if(rpt.success){xThisProveedoresDetalle.listCompras=rpt.datos.map(x=>{x.selected=false
x.classRow='xCursor'
return x;})
xThisProveedoresDetalle.totalCompras=xThisProveedoresDetalle.listCompras.map(x=>parseFloat(removeComas(x.total))).reduce((a,b)=>a+b,0)
xThisProveedoresDetalle.totalCompras=xThisProveedoresDetalle.totalCompras.toFixed(2)}}
async function listProveedorComprasDetalle(event){xPopupLoad.xopen();const idCompra=event.dataId
xThisProveedoresDetalle.objCompraSeleted=xThisProveedoresDetalle.listCompras.find(x=>x.idcompra==idCompra)
console.log('objCompraSeleted',xThisProveedoresDetalle.objCompraSeleted);rowListCompraSelected(xThisProveedoresDetalle.objCompraSeleted);const _httpFecht=new httpFecht();const _data={idcompra:xThisProveedoresDetalle.objCompraSeleted.idcompra}
const rpt=await _httpFecht.postJson('../../bdphp/log_009.php?op=2103',_data)
if(rpt.success){xThisProveedoresDetalle.listProductosByCompra=rpt.datos
xThisProveedoresDetalle.totalProductos=rpt.datos.map(x=>parseFloat(removeComas(x.total))).reduce((a,b)=>a+b,0)
xThisProveedoresDetalle.totalProductos=xThisProveedoresDetalle.totalProductos.toFixed(2)}
xPopupLoad.xclose();xThisProveedoresDetalle.showAllProductos=false;}
async function listProveedorComprasTodos(){xPopupLoad.xopen();const _httpFecht=new httpFecht();const _data={idproveedor:xThisProveedoresDetalle.objproveedor.idproveedor}
const rpt=await _httpFecht.postJson('../../bdphp/log_009.php?op=2102',_data)
if(rpt.success){xThisProveedoresDetalle.listAllProductos=rpt.datos
showAllProductos();}
xPopupLoad.xclose();}
function showAllProductos(){xThisProveedoresDetalle.totalProductos=xThisProveedoresDetalle.listAllProductos.map(x=>parseFloat(removeComas(x.total))).reduce((a,b)=>a+b,0)
xThisProveedoresDetalle.totalProductos=xThisProveedoresDetalle.totalProductos.toFixed(2)
xThisProveedoresDetalle.showAllProductos=true;}
function rowListCompraSelected(itemSelected){xThisProveedoresDetalle.listCompras.forEach(x=>{if(x.idcompra==itemSelected.idcompra){x.selected=true
x.classRow='xCursor selected'}else{x.selected=false
x.classRow='xCursor'}})
xThisProveedoresDetalle.listCompras=JSON.parse(JSON.stringify(xThisProveedoresDetalle.listCompras))}
Polymer({is:'x-proveedores-detalle',properties:{objproveedor:{type:Object,notify:true,reflectToAttribute:true,observer:'proveedorChanged',},listCompras:[],listAllProductos:[],listProductosByCompra:[],totalCompras:Number,totalProductos:Number,objCompraSeleted:[],showAllProductos:Boolean},proveedorChanged:(obj)=>{xLoadDataProveedorDetalle()},attached:function(){this.showAllProductos=true;xThisProveedoresDetalle=this;xInitProveedoresDetalle();},displayIndex:function(index){return xCeroIzq(index+1,1);},})</script>
</dom-module>