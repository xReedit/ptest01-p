<script src="../../../js/zabuto_calendar.min.js"></script><link rel="import"href="./x-orden-pedido.html"><dom-module id="x-orden-lista"><template is="dom"><br><br><div hidden$="[[showOrden]]"class="xMiCard xradius"style="width:85%;max-width:1100px"><div class="xEncanezadoCard"style="background:#fff0f5;color:#424242"><div class="d-flexx justify-content-between align-items-center"><h3>Ordenes de pedido</h3></div></div><div class="xLinea2"></div><div class="xContentCard"style="padding:20px"><div class="rowx"><div class="col-sm-4 mb-3"><div id="my-calendar"></div><br><br></div><div class="col-sm-7 w-100"><div class="d-flexx justify-content-between align-items-center"><h3>Ordenes {{ titleFilter }}</h3><button class="btn btn-sm btn-success xCursor"onclick="showOrdenGo()">+ Agregar</button></div><hr><div class="w-100"><div hidden$="{{!loadingData}}"><paper-spinner active class="xCentradoVerticalHorizontal"></paper-spinner></div><table width="100%"><thead><th class="xSinBorde"width="15px">#<th class="xSinBorde"width="15px"># Orden<th class="xSinBorde"width="20%">Hora<th class="xSinBorde"width="60%">Cliente<th class="xSinBorde"width="30px"align="right">Importe<th class="xSinBorde"width="30px"align="right">Adelanto<tbody><template is="dom-repeat"items="{{listOrdenes}}"as="item"><tr class="fs-11 xCursor"onclick="openOrden(this)"data-idorden="{{item.idorden_pedido}}"><td data-id="{{index}}"><span>{{displayIndex(index)}}</span><td>{{ item.num }}<td><p>{{ item.hora }}<td><p>{{ item.cliente_nom }}<p>{{ item.nota }}<td align="right">{{ item.total }}<td class$="{{ item.color_importe }}"align="right">{{ item.total_adelanto }}</template></table></div></div></div></div></div><div hidden$="[[!showOrden]]"><x-orden-pedido id="compOrden"></x-orden-pedido></div></template></dom-module><script>var xThisOrdenLista,xPopupLoad,listMasterMonth,compOrden,fechaSelectLista,idOrdenSelect;function xIniOrdenPedidoLista(){$("body").addClass("loaded"),$("#Titulo_page").text("Ordenes de Pedido"),(compOrden=document.getElementById("compOrden")).addEventListener("goBackOrden",function(e){xThisOrdenLista.showOrden=!1}),xThisOrdenLista.loadingData=!0;var e=new Date;xloadOrdenesMMYY(e.getMonth()+1,e.getFullYear())}function xloadOrdenesMMYY(a,n){xThisOrdenLista.titleFilter="del mes "+xMayusculaPrimera(xDesMes(a-1))+" "+n,xThisOrdenLista.loadingData=!0,$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=30",data:{m:a,y:n}}).done(function(e){dataInCalendar(JSON.parse(e).datos,a,n)})}function dataInCalendar(e,a,n){e.map((e,a)=>{e.num=xCeroIzq(e.idorden_pedido,3),e.visible=!0,e.desFecha=xDesDiaSemana(e.dia_semana)+" "+e.dia,e.color_importe=parseFloat(e.total)>parseFloat(e.total_adelanto)?"text-warning fw-600":"text-success fw-600"}),listMasterMonth=e,xThisOrdenLista.listOrdenes=e,xThisOrdenLista.loadingData=!1,xRefreshCalendar(a,n)}function xFilterDataCalendarbyDay(a){xThisOrdenLista.loadingData=!0,fechaSelectLista=a,setTimeout(()=>{xThisOrdenLista.listOrdenes=listMasterMonth.filter(e=>e.fentrega===a),xThisOrdenLista.titleFilter="del dia "+xDesDiaSemana(a,!0)+" "+a,xThisOrdenLista.loadingData=!1},600)}function xRefreshCalendar(e,a){$("#my-calendar").zabuto_calendar({show_next:!0,show_previous:!0,language:"es",nav_icon:{prev:'<span class="xBoton2"><</span>',next:'<span class="xBoton2">></span>'},ajax:{url:"../../bdphp/log_005.php?op=3001",modal:!0},action:function(){xFilterDataCalendarbyDay($(this).data("date"))},action_nav:function(){var e=$(this).data("to");xloadOrdenesMMYY(e.month,e.year)}}),xThisOrdenLista.loadingData=!1}function showOrdenGo(){compOrden.setValuesShowOrden(idOrdenSelect,fechaSelectLista),idOrdenSelect=null,xThisOrdenLista.showOrden=!0}function openOrden(a){idOrdenSelect=xThisOrdenLista.listOrdenes.filter(e=>e.idorden_pedido===a.dataIdorden)[0],showOrdenGo()}Polymer({is:"x-orden-lista",properties:{listOrdenes:[],loadingData:Boolean,titleFilter:String,showOrden:Boolean},attached:function(){this.showOrden=!1,xThisOrdenLista=this,xIniOrdenPedidoLista()},displayIndex:function(e){return xCeroIzq(e+1,1)}})</script>