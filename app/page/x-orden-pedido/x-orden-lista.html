<script src="../../../js/zabuto_calendar.min.js"></script><script src="../../view/export.excel.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js"></script><link rel="import"href="./x-orden-pedido.html"><dom-module id="x-orden-lista"><template is="dom"><br><br><div hidden$="[[showOrden]]"class="xMiCard xradius"style="width:85%;max-width:1100px"><div class="xEncanezadoCard"style="background:#fff0f5;color:#424242"><div class="d-flexx justify-content-between align-items-center"><h3>Ordenes de pedido</h3></div></div><div class="xLinea2"></div><div class="xContentCard"style="padding:20px"><div class="rowx"><div class="col-sm-4 mb-3"><div id="my-calendar"></div><br><br></div><div class="col-sm-7 w-100"id="table-ordenes-mes"><div class="d-flexx justify-content-between align-items-center"><h3>Ordenes {{ titleFilter }}</h3><div id="div-btn-orden-lista"><button class="btn btn-sm btn-danger"title="Exportar PDF"onclick="exportPDFOrdenesMes()"><i class="fa fa-file-pdf-o"></i></button> <button class="btn btn-sm btn-success"title="Exportar Excel"onclick="exportExcelOrdenesMes()"><i class="fa fa-file-excel-o"></i></button> <button class="btn btn-sm btn-primary xCursor"onclick="showOrdenGo()">+ Agregar</button></div></div><hr><div class="w-100"><div hidden$="{{!loadingData}}"><paper-spinner active class="xCentradoVerticalHorizontal"></paper-spinner></div><table width="100%"><thead><th class="xSinBorde"width="15px">#<th class="xSinBorde"width="15px">Orden<th class="xSinBorde"width="20%">Entrega<th class="xSinBorde"width="60%">Cliente<th class="xSinBorde xInvisible"width="60%">Producto<th class="xSinBorde"width="30px"align="right">Importe<th class="xSinBorde"width="30px"align="right">Adelanto<tbody><template is="dom-repeat"items="{{listOrdenes}}"as="item"><tr class="fs-11 xCursor"onclick="openOrden(this)"data-idorden="{{item.idorden_pedido}}"><td data-id="{{index}}"><span>{{displayIndex(index)}}</span><td>{{ item.num }}<td><p>{{ item.desFecha }}</p><span>Hora: {{ item.hora }}</span><td><p>{{ item.cliente_nom }}</p><span>{{ item.nota }}</span><td class="xInvisible"><table><template is="dom-repeat"items="{{ item.detalle_json }}"as="producto"><tr class="xSinBorde"><td>{{ producto.cantidad }}<td>{{ producto.descripcion }}</template></table><td align="right"><p class="fw-600">{{ item.total }}<td class$="{{ item.color_importe }}"align="right">{{ item.total_adelanto }}</template></table></div></div></div></div></div><div hidden$="[[!showOrden]]"><x-orden-pedido id="compOrden"></x-orden-pedido></div></template></dom-module><script>var xThisOrdenLista,xPopupLoad,listMasterMonth,compOrden,fechaSelectLista,idOrdenSelect;function xIniOrdenPedidoLista(){$("body").addClass("loaded"),$("#Titulo_page").text("Ordenes de Pedido"),(compOrden=document.getElementById("compOrden")).addEventListener("goBackOrden",function(e){xThisOrdenLista.showOrden=!1,xloadOrdenesMMYY(t.getMonth()+1,t.getFullYear())}),xThisOrdenLista.loadingData=!0;const t=new Date;xloadOrdenesMMYY(t.getMonth()+1,t.getFullYear())}function xloadOrdenesMMYY(t,a){xThisOrdenLista.nommes=xMayusculaPrimera(xDesMes(t-1))+"-"+a,xThisOrdenLista.titleFilter="de "+xMayusculaPrimera(xDesMes(t-1))+" "+a,xThisOrdenLista.loadingData=!0,$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=30",data:{m:t,y:a}}).done(function(e){dataInCalendar(JSON.parse(e).datos,t,a)})}function dataInCalendar(e,t,a){e.map((e,t)=>{e.num=xCeroIzq(e.idorden_pedido,3),e.visible=!0,e.desFecha=xDesDiaSemana(e.dia_semana)+" "+e.dia,e.color_importe=parseFloat(e.total)>parseFloat(e.total_adelanto)?"text-warning fw-600":"text-success fw-600",e.detalle_json=JSON.parse(e.detalle_json)}),listMasterMonth=e,xThisOrdenLista.listOrdenes=e,xThisOrdenLista.loadingData=!1,xRefreshCalendar(t,a)}function xFilterDataCalendarbyDay(t){xThisOrdenLista.loadingData=!0,fechaSelectLista=t,setTimeout(()=>{xThisOrdenLista.listOrdenes=listMasterMonth.filter(e=>e.fentrega===t),xThisOrdenLista.titleFilter="del dia "+xDesDiaSemana(t,!0)+" "+t,xThisOrdenLista.loadingData=!1},600)}function xRefreshCalendar(e,t){$("#my-calendar").zabuto_calendar({show_next:!0,show_previous:!0,language:"es",nav_icon:{prev:'<span class="xBoton2"><</span>',next:'<span class="xBoton2">></span>'},ajax:{url:"../../bdphp/log_005.php?op=3001",modal:!0},action:function(){xFilterDataCalendarbyDay($(this).data("date"))},action_nav:function(){var e=$(this).data("to");xloadOrdenesMMYY(e.month,e.year)}}),xThisOrdenLista.loadingData=!1}function showOrdenGo(){compOrden.setValuesShowOrden(idOrdenSelect,fechaSelectLista),idOrdenSelect=null,document.getElementById("compOrden").newOrden(),xThisOrdenLista.showOrden=!0}function openOrden(t){idOrdenSelect=xThisOrdenLista.listOrdenes.filter(e=>e.idorden_pedido===t.dataIdorden)[0],compOrden.setValuesShowOrden(idOrdenSelect,fechaSelectLista),idOrdenSelect=null,xThisOrdenLista.showOrden=!0}function exportPDFOrdenesMes(){let e=document.getElementById("div-btn-orden-lista");e.style.display="none";var n=new jsPDF("p","pt","a4"),t=document.getElementById("table-ordenes-mes");html2canvas(t,{onrendered:function(e){var e=e.toDataURL("image/png"),t=n.internal.pageSize.getWidth(),a=n.internal.pageSize.getHeight(),e=(n.addImage(e,"PNG",0,0,t,a),xThisOrdenLista.nommes+".pdf");n.save(e)}}),setTimeout(()=>{e.style.display="block"},1e3)}function exportExcelOrdenesMes(){let e=document.getElementById("div-btn-orden-lista");e.style.display="none";var t=xThisOrdenLista.nommes;tableToExcel("table-ordenes-mes",t),setTimeout(()=>{e.style.display="block"},2e3)}Polymer({is:"x-orden-lista",properties:{listOrdenes:[],loadingData:Boolean,titleFilter:String,showOrden:Boolean,nommes:String},attached:function(){this.showOrden=!1,xThisOrdenLista=this,xIniOrdenPedidoLista()},displayIndex:function(e){return xCeroIzq(e+1,1)}})</script>