<dom-module id="x-recuperar-stock"><template><br><div class="xMiCard xradius"style="width:85%"><div class="xEncanezadoCard xFondoRowAmarillo2"><p>Restablesca el stock de los items borrados el control de pedidos. <strong>Esta lista se borra al cerrar la caja.</strong></div><div class="xContentCard"style="height:100%"><h3>Lista de items borrados desde control de pedidos.</h3><br><button class="xBoton2 xAzul"id="btn_restablecer"onclick="xRestablecerStock()"disabled="[[hayDatosRestaurar]]">Listo, restablecer stock de seleccionados</button><br><table width="100%"id="tb_pedidos_borrados"class="xtable2"><thead><th>#<th class="xNoVisibleMenos720"width="40px">Fecha<th class="xNoVisibleMenos720"width="40px">Hora<th>Borrado por<th>Item<th align="center">Cantidad<th align="right">Importe<tbody><template is="dom-repeat"items="{{ListPedidosBorrados}}"as="item"><tr class="xCursor"><td><paper-checkbox class="check_item_recuperar"id="{{index}}"></paper-checkbox><span class="xNoVisibleMenos720">{{displayIndex(index)}}</span><td class="xNoVisibleMenos720">{{item.fecha}}<td class="xNoVisibleMenos720">{{item.hora}}<td>{{item.usuario}}<td>{{item.dscitem}}<td align="center">01<td align="right"class="ximporte_row">{{item.importe}}</template></table><br><br><br></div></div></template></dom-module><script>var xThisRecuperarStock,xPopupLoad,arrRestaurar=[],hayDatosRestaurar=!0;function xIniRecuperarStock(){xPopupLoad=document.getElementById("xLoad"),xLoadPedidosBorradosData(),$("body").addClass("loaded"),$(document).on("click","#tb_pedidos_borrados tr",function(r){getIndexRow(this,r)}),$(document).on("click",".check_item_recuperar",function(r){getIndexRow(this,r)})}function xLoadPedidosBorradosData(){xThisRecuperarStock.ListPedidosBorrados=[],$.ajax({type:"POST",url:"../../bdphp/log.php?op=2200"}).done(function(r){r=$.parseJSON(r),xThisRecuperarStock.ListPedidosBorrados=r.datos,setTimeout(()=>{xThisRecuperarStock.hayDatosRestaurar=!0,xSumarTotalLista(),$("#tb_pedidos_borrados").trigger("create")},500)})}function xSumarTotalLista(){var r=$("#tb_pedidos_borrados"),o='<tr class="tt_row xSinBorde"><td colspan="6" align="right"><h3>Total</h3></td><td align="right"><h3><strong>'+(xImporte_total_list=xMoneda(xSumaCantRow(r,".ximporte_row")))+'</strong></h3></td><td colspan="2"></td></tr>';r.find(".tt_row").remove(),r.append(o).trigger("create")}function getIndexRow(r,o){var e=r.nodeName,r=("TR"!==e?$(r):$(r).find("paper-checkbox"))[0],e="TR"!==e?r.checked:!r.checked,a=r.id;r.checked=e,xThisRecuperarStock.ListPedidosBorrados[a].restablecer=e,xCheckearArrayRestuarar(),o.stopPropagation(),o.stopImmediatePropagation()}function xCheckearArrayRestuarar(){arrRestaurar=xThisRecuperarStock.ListPedidosBorrados.filter(r=>!0===r.restablecer),xThisRecuperarStock.hayDatosRestaurar=!(0<arrRestaurar.length)}function xRestablecerStock(){0!==arrRestaurar.length&&(xPopupLoad.xopen(),console.log(arrRestaurar),$.ajax({type:"POST",url:"../../bdphp/log.php?op=2201",data:{arr_recuperar:arrRestaurar}}).done(function(r){(r=$.parseJSON(r)).success||alert(r.error),xPopupLoad.xclose(),xLoadPedidosBorradosData()}))}Polymer({is:"x-recuperar-stock",properties:{ListPedidosBorrados:[]},attached:function(){console.log("llega items pedidos borrados"),xThisRecuperarStock=this,xIniRecuperarStock()},displayIndex:function(r){return xCeroIzq(r+1,1)}})</script>