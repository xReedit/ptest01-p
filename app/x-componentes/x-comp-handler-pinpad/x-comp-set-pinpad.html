<dom-module id="x-comp-set-pinpad"><template><style>.pinpad-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border:1px solid #ccc;margin-bottom:5px;border-radius:5px}.pinpad-item button{margin-left:10px}.assigned-pinpad{margin-bottom:10px;padding:10px;border:1px solid #ccc;border-radius:5px;background-color:#f9f9f9}.pinpad-list{display:none}.pinpad-list[visible]{display:block}.xDivCompPinPad{border:1px solid;border-radius:5px;padding:5px;background:#385f72;color:#fff;width:100px;text-align:center;cursor:pointer}</style><paper-dialog id="dialog_comp_printer_local"style="width:280px"class="dialog_redondo animate__animated animate__fadeIn animate__faster"modal="true"entry-animation="scale-up-animation"exit-animation="fade-out-animation"modal><div><div class="d-flexx align-items-center"><p class="fw-600 fs-15">Seleccione su PinPad</p><img src="../../../images/pinpad-min.png"alt="pinpad"></div><hr><table class="w-100"><template is="dom-repeat"items="{{pinpads}}"as="pinpad"><tr><td><div class="text-uppercase p-2 xCursor d-flexx justify-content-between align-items-center"data-id="[[index]]"on-tap="_selectPinpad"><div style="line-height:1.2"><p>{{ pinpad.pinpad_sn }}<p class="m-0 fs-9 text-secondary">{{ pinpad.descripcion }} | {{ pinpad.area }}</div><i hidden$="{{!pinpad.selected}}"class="fa fa-check text-success ml-1"></i></div></template></table><br><paper-progress class="xInvisible"id="dgl_pinpad_loader_progress"indeterminate style="width:100%"></paper-progress><p id="msj_connect_pinpad_error"class="xInvisible text-danger fs-600 fs-12">Pinpad no encontrado. Verifique el SN y si tiene instalado el servicio <a href="https://www.google.com"target="_blank">Descargar Instalador.</a><p id="msj_connect_pinpad_success"class="xInvisible text-success fs-600 fs-12">Pinpad conectado con existo!</p><br><div><button class="btn btn-success mr-1"disabled$="{{!pinpadSelected}}"on-tap="_assignPinpad">{{_getButtonText(assignedPinpad)}}</button> <button class="btn btn-dark"dialog-dismiss>Cerrar</button></div></div></paper-dialog><div class="xDivCompPinPad"on-tap="_openPinpadDialog"><p class="text-warning">Mi PinPad<p class="fw-600 text-uppercase">{{assignedPinpad.pinpad_sn}}</div></template><script>Polymer({is:"x-comp-set-pinpad",properties:{pinpads:{type:Array,value:function(){return[]}},assignedPinpad:{type:Object,value:null},pinpadSelected:{type:Object,value:null},showPinpadList:{type:Boolean,value:!1},showMensajeConnection:{type:Object,value:{success:!1,message:""}}},ready:async function(){await this._getListPinPad(),this._checkAssignedPinpad()},_checkSericesPinPad:async function(s){return checkPinPad(s)},_checkAssignedPinpad:function(){var s,e=localStorage.getItem("::app3_pinpad_sn");e?(s=this.pinpads.find(s=>s.pinpad_sn===e))&&this._markSelectedPinpad(e):s={descripcion:"Ninguno",pinpad_sn:"Ninguno",ischeck:!1},this.set("assignedPinpad",s)},_markSelectedPinpad:function(n){this.pinpads.forEach((s,e)=>{this.set(`pinpads.${e}.selected`,!1),s.pinpad_sn===n&&this.set(`pinpads.${e}.selected`,!0)})},_openPinpadDialog:function(){this.$.dialog_comp_printer_local.open()},_selectPinpad:async function(s){this.pinpadSelected=null,dgl_pinpad_loader_progress.classList.toggle("xInvisible",!1);var e=s.model.pinpad,s=(this.pinpads.forEach((s,e)=>{this.set(`pinpads.${e}.selected`,!1)}),this.set(`pinpads.${s.model.index}.selected`,!0),this.set("selectedPinpad",e),await this._checkSericesPinPad(e.pinpad_sn));msj_connect_pinpad_error.classList.toggle("xInvisible",s.success),msj_connect_pinpad_success.classList.toggle("xInvisible",!0),s.success?this._assignPinpad():(dgl_pinpad_loader_progress.classList.toggle("xInvisible",!0),msj_connect_pinpad_error.innerHTML='El servicio del pinpad no esta instalado. <a href="https://www.google.com" target="_blank">Descargar Instalador.</a>')},_assignPinpad:async function(){var s,e=this.selectedPinpad;e?(s=await this._testConnection(e.pinpad_sn),dgl_pinpad_loader_progress.classList.toggle("xInvisible",!0),msj_connect_pinpad_success.classList.toggle("xInvisible",!s.success),s.success?(this.pinpadSelected=e,this.assignedPinpad=e,this._saveAssignedPinpad()):(msj_connect_pinpad_error.innerHTML="PinPad no encontrado. Verifique la conexion del dispositivo. Verifique que el SN coicida con el dispositivo conectado.",msj_connect_pinpad_error.classList.toggle("xInvisible",!1))):(dgl_pinpad_loader_progress.classList.toggle("xInvisible",!0),alert("Por favor, seleccione un pinpad."))},_getListPinPad:async function(){await $.ajax({url:"../../bdphp/log_010.php?op=get-list-pinpad",type:"GET",success:s=>{s=JSON.parse(s);this.pinpads=s.datos},error:function(s){}})},_testConnection:async function(s,e){return testConnectionPinPad(s,e)},_getButtonText:function(s){return"Ninguno"!=s?.descripcion?"Asignar":"Cambiar"},_saveAssignedPinpad:function(){localStorage.setItem("::app3_pinpad_sn",this.assignedPinpad.pinpad_sn)}})</script></dom-module>