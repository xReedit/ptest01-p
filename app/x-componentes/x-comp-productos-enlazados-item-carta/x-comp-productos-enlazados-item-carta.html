<dom-module id="x-comp-productos-enlazados-item-carta"><template is="dom-bind"><div><p>Productos de almacen enlazados con el item de la carta y con un canal de consumo en especifico. Ejemplo: El lomito saltado "para llevar" descuenta un taper eco.</p><br><div class="xDerecha"><button class="btn btn-sm btn-success"onclick="addEnlazadoProducto()">+ Agregar</button></div><table width="100%"><thead><th style="width:10%"class="fs-11">Canal Consumo<th class="fs-11">Producto<th class="fs-11">Cant. Descuenta<tbody><tr><td><select id="selectTPCE"class="fs-11"><template is="dom-repeat"items="{{listCanalConsumo}}"as="item"><option [value]="item"class="fs-11">{{item.descripcion}}</template></select><td><input class="xMiInput xPasarEnter2 fs-12"id="des_item"onkeyup="xloadProductoItemAlmacen(this)"><td><input type="number"class="xMiInput xPasarEnter2 fs-12 text-center"id="txt_cant"></tr><template is="dom-repeat"items="{{listEnlazados}}"as="item"><tr data-id="{{index}}"><td align="left"class="fs-11">{{ item.des_tipo_consumo }}<td align="left"class="fs-11">{{ item.des_producto }}<td align="center"class="fs-11">{{ item.cantidad }} <span class="xDeleteRow ml-2"title="Anular"onclick="removeEnlazadoProducto(this)"></span></template></table></div></template><script>var xThisComEnlazados,productoSeleted,xNewItemPro=!1,_listEnlazados=[];function xIniCompEnlazadosItemCarta(){var o=xm_log_get("estructura_pedido");xThisComEnlazados.listCanalConsumo=o}function xloadProductoItemAlmacen(o){o=o.value;o.length<3||$.ajax({type:"POST",url:"../../bdphp/log_componentes.php?op=19",data:{search:o}}).done(function(o){o=JSON.parse(o);xThisComEnlazados.dtProItem=o.datos,xCargarProductoItem()})}function xCargarProductoItem(){var t=$("#des_item");t.autocomplete({autoFocus:!0,source:xThisComEnlazados.dtProItem,appendTo:$("#dialog_detalle"),select:function(o,a){return t.val(a.item.label),t.attr("data-id",a.item.value),productoSeleted=a.item,!1},focus:function(o,a){return!1},change:function(o,a){return null===a.item?(t.attr("data-value",""),t.attr("data-id",""),xNewItemPro=!0):(xNewItemPro=!1,$("#frm_item_pro #idproducto").val(a.item.value)),!1}})}function xLoadProductoEnlazadosItem(){$.ajax({type:"POST",url:"../../bdphp/log_componentes.php?op=1902",data:{id:xThisComEnlazados.iditem}}).done(function(o){o=JSON.parse(o),xThisComEnlazados.listEnlazados=JSON.parse(JSON.stringify(o.datos))})}function addEnlazadoProducto(){_listEnlazados=xThisComEnlazados.listEnlazados;var o=selectTPCE.selectedIndex,o=xThisComEnlazados.listCanalConsumo[o],a={idtipo_consumo:o.idtipo_consumo,des_tipo_consumo:o.descripcion,idproducto_stock:productoSeleted.value,des_producto:productoSeleted.label.split(" | ")[1],cantidad:txt_cant.value,iditem:xThisComEnlazados.iditem};$.ajax({type:"POST",url:"../../bdphp/log_componentes.php?op=1901",data:{data:a}}).done(function(o){a.iditem_producto_relacionado=o,_listEnlazados.push(a),xThisComEnlazados.listEnlazados=JSON.parse(JSON.stringify(_listEnlazados))})}function removeEnlazadoProducto(o){var o=o.parentNode.parentNode,a=xThisComEnlazados.listEnlazados[o.dataId].iditem_producto_relacionado;$(o).fadeTo(550,0,function(){$(this).remove()}),xBorrarRegistro("item_producto_relacionado",a)}Polymer({is:"x-comp-productos-enlazados-item-carta",properties:{listCanalConsumo:[],dtProItem:[],listEnlazados:[],iditem:Number},attached:function(){this.listEnlazados=[],xThisComEnlazados=this,xIniCompEnlazadosItemCarta()},getProductosRelacionadosItem:()=>{xThisComEnlazados.listEnlazados=[],xLoadProductoEnlazadosItem()},resetListProductoRelacionadosItem:()=>{xThisComEnlazados.listEnlazados=[]}})</script></dom-module>