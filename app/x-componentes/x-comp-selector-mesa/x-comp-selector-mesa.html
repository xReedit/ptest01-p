<dom-module id="x-comp-selector-mesa"><link rel="import"href="../../web_components/paper-dialog/paper-dialog.html"><template><style>:host{display:block}#dialogSelectorMesa{max-width:900px;width:90%;min-height:480px;max-height:90vh;padding:0!important;margin:0;border-radius:12px;overflow:hidden}#dialogSelectorMesa>*{margin:0}.modal-header{padding:15px 20px;display:flex;justify-content:space-between;align-items:center;background:#483d8b;color:#fff}.modal-header h3{margin:0;font-size:20px;font-weight:600}.btn-close{background:rgba(255,255,255,.2);border:none;color:#fff;font-size:28px;width:36px;height:36px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s;line-height:1}.btn-close:hover{background:rgba(255,255,255,.3);transform:scale(1.1)}.tabs-container{display:flex;overflow-x:auto;background:#f8f9fa;border-bottom:2px solid #e0e0e0;padding:0;-webkit-overflow-scrolling:touch}.tabs-container::-webkit-scrollbar{height:6px}.tabs-container::-webkit-scrollbar-thumb{background:#ccc;border-radius:3px}.tab-btn{flex:0 0 auto;padding:15px 25px;font-size:16px;font-weight:600;background:0 0;border:none;border-bottom:3px solid transparent;cursor:pointer;transition:all .3s;color:#666;white-space:nowrap}.tab-btn:hover{background:rgba(102,126,234,.1);color:#667eea}.tab-btn.active{color:#667eea;border-bottom-color:#667eea;background:#fff}.modal-body{padding:20px;overflow-y:auto;max-height:calc(90vh - 200px)}.mesas-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:10px}.mesa-btn{padding:20px 10px;font-size:18px;font-weight:600;background:#fff;border:2px solid #e0e0e0;border-radius:8px;cursor:pointer;transition:all .2s;text-align:center;color:#333;min-height:70px;display:flex;align-items:center;justify-content:center}.mesa-btn:hover{background:#667eea;color:#fff;border-color:#667eea;transform:translateY(-2px);box-shadow:0 4px 12px rgba(102,126,234,.3)}.mesa-btn:active{transform:translateY(0)}@media (max-width:768px){#dialogSelectorMesa{width:95%;max-height:95vh}.modal-header h3{font-size:18px}.tab-btn{padding:12px 20px;font-size:14px}.mesas-grid{grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:8px}.mesa-btn{padding:15px 8px;font-size:16px;min-height:60px}}@media (max-width:480px){.mesas-grid{grid-template-columns:repeat(auto-fill,minmax(70px,1fr))}.tab-btn{padding:10px 15px;font-size:13px}}</style><paper-dialog id="dialogSelectorMesa"modal entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="modal-header"><h3>Seleccionar Mesa</h3><button class="btn-close"on-click="close">&times;</button></div><div class="tabs-container"><template is="dom-repeat"items="[[areas]]"as="area"index-as="areaIndex"><button class$="tab-btn [[_getTabClass(areaIndex, selectedAreaIndex)]]"on-click="_onSelectArea"data-index$="[[areaIndex]]">[[area.titulo]]</button></template></div><div class="modal-body"><div class="mesas-grid"><template is="dom-repeat"items="[[_getSelectedAreaMesas(areas, selectedAreaIndex)]]"as="mesa"><button class="mesa-btn"on-click="_onSelectMesa"data-codigo$="[[mesa.codigo]]">[[mesa.codigo]]</button></template></div></div></paper-dialog></template><script>Polymer({is:"x-comp-selector-mesa",properties:{areas:{type:Array,value:function(){return[]}},selectedAreaIndex:{type:Number,value:0},esAlfanumerica:{type:Boolean,value:!1}},ready:function(){this._loadAreas()},open:function(){this._loadAreas(),this.selectedAreaIndex=0,this.$.dialogSelectorMesa.open()},close:function(){this.$.dialogSelectorMesa.close()},_loadAreas:async function(){try{var e=xm_log_get("sede_otros_datos");this.esAlfanumerica=e&&e[0]&&"1"===e[0].mesas_alfanumerica;var t,a=await(await fetch("../../bdphp/log_009.php?op=5001",{method:"POST",headers:{"Content-Type":"application/json"}})).json();a&&a.datos&&(t=a.datos.map(a=>{var s=[],e=parseInt(a.desde),r=parseInt(a.hasta);for(let t=e;t<=r;t++){let e="";e=this.esAlfanumerica&&a.prefijo?a.prefijo+this._padLeft(t,2):this._padLeft(t,2),s.push({codigo:e})}return{titulo:a.titulo,idarea_mesa:a.idarea_mesa,mesas:s}}),this.set("areas",t))}catch(e){}},_padLeft:function(e,t){let a=e+"";for(;a.length<t;)a="0"+a;return a},_onSelectArea:function(e){e=parseInt(e.currentTarget.dataset.index);this.selectedAreaIndex=e},_getTabClass:function(e,t){return e===t?"active":""},_getSelectedAreaMesas:function(e,t){return!e||0===e.length||t<0||t>=e.length?[]:e[t].mesas},_onSelectMesa:function(e){var e=e.currentTarget.dataset.codigo,t=this.areas[this.selectedAreaIndex];this.fire("mesa-selected",{codigo:e,area:t.titulo}),this.close()},validarMesaExiste:function(e){var t,a=e.trim().toUpperCase();for(t of this.areas)for(var s of t.mesas)if(s.codigo.toUpperCase()===a)return!0;return!1}})</script></dom-module>