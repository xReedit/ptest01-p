<dom-module id="x-pedido-cuenta-cobrar"><link rel="import"href="../x-comp-descuento/x-comp-descuento.html"><template is="dom"><paper-dialog modal id="dialog_detalle_pcp"class="tall-polys tall xNoScroll"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div><iron-pages selected="0"id="content_page"class="xNoScroll"><div id="div_detalle_pedido"class="xNoScroll"><div class="lh-7"><div class="xDerecha"></div><h3 id="p_mesa">MESA 02</h3><div class="xfont11 pb-3"><span id="p_correlativo">CO: 00112</span><span id="p_referencia"> DR VALDES</span><span id="p_antendido"> | ATENDIDO POR: ORLANDO</span></div><div class="xdiv-info-delivery xInvisible lh-15"id="content-info-delivery"><div id="divRepartidorPropio"class="pb-3"><div id="divRepartidorNom"class="xInvisible"><span class="xfont11">Repartidor: </span><span class="xBold"id="a_nom_repartidor"></span><hr></div><div id="divRepartidorSelect"class="xInvisible"><span class="xfont11">Repartidor: </span><select name=""id="selectRepartidor"onchange="selectRepartidor()"><option value="-1">No Asignado</option><template is="dom-repeat"items="{{listRepartidor}}"as="repartidor"><option value="[[index]]">[[repartidor.nombre]]</template></select><hr></div></div><div class="div-info-pedido"><div class="w-50"><span class="xColorRow_Plomo3 fs-13">Datos del Cliente</span><div id="info-pedido"class="fs-11"></div></div><div class="w-50"><p class="xColorRow_Plomo3 fs-13">Comprobante<div id="info-comprobante"class="fs-11"></div></div></div><div id="div-info-delivery-from-app"class="xInvisible"style="padding:5px 0 5px 0;border-top:1px solid #bbbb;background:#faebd7"><div class="xfont12"id="txt-info-delivery-from-app"></div></div></div></div><div class="xLinea"></div><br><div class="content-pedido"><table width="100%"class="xtable4"><tr class="xSinBorde_tr"valign="top"><td width="40%"class="pd-r-10"><div class="xtd-derecha"><table width="100%"id="tb_pedidos"class="xRowPading4"><thead><th colspan="5"align="left">PEDIDOS</thead><tr class="row selected1 xCursor check_item_p"data-idpedido="1"><td><paper-checkbox checked="checked"class="check_item"></paper-checkbox>1<td>Pedido 00102<td>13:15:02<td align="right"class="td_importe"id="td_importe">120.00<tr class="row selected1 xCursor check_item_p"data-idpedido="2"><td><paper-checkbox checked="checked"class="check_item"></paper-checkbox>2<td>Pedido 00102<td>13:15:02<td align="right"class="td_importe"id="td_importe">120.00<tr class="row selected1 xCursor check_item_p"data-idpedido="3"><td><paper-checkbox checked="checked"class="check_item"></paper-checkbox>3<td>Pedido 00102<td>13:15:02<td align="right"class="td_importe"id="td_importe">120.00</table><br><x-comp-descuento id="component_descuento_pedido"importeventa$="[[ importeTotalPedido ]]"></x-comp-descuento></div><td class="xBordeIzq pd-l-10"><div class="xtd-derecha"id="xBody_pcp"><div><table width="100%"id="tb_det_pedidos"class="xRowPading4"><tr><td colspan="5"class="xFondoRowPlomo">CONSUMIR EN EL LOCAL<tr><td colspan="5"><h4>ENTRADAS</h4><tr class="row xCursor"data-idpedidodetalle="1"data-idpedido="1"data-punitario="1.00"data-idtipoconsumo="1"data-idcategoria="1"data-idcartalista="117422605116"><td width="50px"class="click_row_dt_p"id="td_cant"><paper-checkbox class="check_item"></paper-checkbox>03<td class="click_row_dt_p">COCO RALLADO<td class="click_row_dt_p"align="right"id="td_importe">0.00<td align="center"class="td_op"data-op="cambiar"><img src="../../images/_change.png"title="Cambiar"><td align="center"class="td_op"data-op="borrar"><img src="../../images/_delete3.png"title="Borrar"><tr class="row xCursor"data-idpedidodetalle="2"data-idpedido="1"data-punitario="2.00"data-idtipoconsumo="1"data-idcategoria="1"data-idcartalista="11122605116"><td width="50px"class="click_row_dt_p"id="td_cant"><paper-checkbox class="check_item"></paper-checkbox>02<td class="click_row_dt_p">GELATINA<td class="click_row_dt_p"align="right"id="td_importe">2.00<td align="center"class="td_op"data-op="cambiar"><img src="../../images/_change.png"title="Cambiar"><td align="center"class="td_op"data-op="borrar"><img src="../../images/_delete3.png"title="Borrar"></table></div></div><div class="d-flexx justify-content-end align-items-center"style="position:sticky;width:100%"hidden$="[[ !isAddItemRow ]]"><button class="btn btn-success"style="margin-top:-80px"onclick="xArmarSqlAddLUlI()"><i class="fa fa-check"></i> Confirmar</button></div></table></div><div class="footer_dialog xAlinearce xFondoRowBlanco2"><div class="xLinea"></div><br><div class="xDerecha pos-fotter-btn"><div class="xMiBoton_icon_lateral mg-t-15"onclick="xImprimirPrecuenta()"><img src="../../../images/_pre_cuenta.png"><p class="fs-10">Pre-cuenta</div></div><button class="xBoton2 xAzul"id="btn_registrar_pago_pcp"onclick="xIrPage(1)">F10 | Listo, pagar</button> <button class="xBoton2 xPlomo"dialog-dismiss>Cerrar</button><br></div></div><br><br></iron-pages></div></paper-dialog></template></dom-module><style>#dialog_detalle_pcp.tall{border-radius:5px;width:100%;min-width:300px;position:fixed;top:0;left:2;bottom:0;right:2;margin:2px;min-height:50vh;width:-webkit-fill-available;height:-webkit-fill-available}#dialog_detalle_pcp.tall-polys{width:-webkit-fill-available;height:-webkit-fill-available;border-radius:5px}#dialog_detalle_pcp.normal{border-radius:5px;width:auto 0;min-width:300px}</style><script>var xThisComPedidosCuenta,xCompDescuentoPedido,xtt_pedidos,xRpt_pago_pcp,xDtBdPCC,isPedidoPagadoFromApp=!1;function getIniPedidoCuenta(){(xCompDescuentoPedido=document.getElementById("component_descuento_pedido")).addEventListener("changeDescuento",function(e){var a=e.detail;arrSubtTotalesDescuento=colocarDescuentoSubtotales(a.value,arrSumSubtTotales,a.descripcion,a.isAgregar),xSumarTotalPedidos(null,!0),e.stopPropagation(),e.stopImmediatePropagation()}),$("#dialog_cotent").on("iron-overlay-opened",function(){$("#dialog_cotent #us").focus()})}function xLoadDetallesPedido(e,a=!0){lastDataPedidoInsert=a?null:lastDataPedidoInsert,isPedidoOpenDeliveryCliente=!1,xAgrupar_item_activo=!1,xPopupLoad.titulo="Cargando...",xPopupLoad.xopen(),xIrPage(0),xObj_miPedido=$(e),xLocal_SubTotal_Quitados="";var x=e.dataNummesa,_=e.dataNumpedido,a=e.dataCorrelativo,m=(xp_sel_idcategoria=e.dataIdcat,e.dataIsconfirmarpago),C="",D=xp_sel_idcategoria,C="0"==x?"PEDIDO "+xCeroIzq(a,5):"MESA "+xCeroIzq(x,2);const v=localStorage.getItem("::app3_woLastIdP")||void 0;$.ajax({type:"POST",url:"../../bdphp/log.php?op=507",data:{m:x,p:_,confirmar_pago:m,lastIdPedido:v}}).done(function(e){var a="",t="",d="",o="";isPedidoPagadoFromApp="1"===m.toString(),localStorage.setItem("::app3_papp",m.toString()),xdtDpedido=(xdtDpedido=$.parseJSON(e)).datos,xid_pedido_selected=xdtDpedido[0].idpedido;var i,r,e="ATENDIDO POR: "+(xdtDpedido[0].nom_usuario||"Cliente")+" | ";$("#p_correlativo").text("CO-"+xCeroIzq(xdtDpedido[0].correlativo_dia,5)+" | "),$("#p_referencia").text(xdtDpedido[0].referencia+" | "),$("#p_antendido").text(e),datosDelivery=xdtDpedido[0].json_datos_delivery;try{datosDelivery=""!=datosDelivery&&"{}"!=datosDelivery&&"[]"!=datosDelivery?JSON.parse(datosDelivery):null}catch(e){datosDelivery=JSON.parse(datosDelivery.replace(/(\r\n|\n|\r)/g,""))}e=!!(xdtDpedido[0].json_datos_delivery=datosDelivery),$("#btnLlamarRepartidorP").addClass("xInvisible"),$("#content-info-delivery").addClass("xInvisible"),e&&((e=!!(optionDeliveryCliente=datosDelivery)&&!!optionDeliveryCliente.p_header&&1===optionDeliveryCliente.p_header.delivery)&&(isComercioServicioDeliveryPropio="1"===xDtSede_cm[0].pwa_delivery_servicio_propio,isPedidoOpenDeliveryCliente=e,C="Pedido #"+_,a=optionDeliveryCliente.p_header.arrDatosDelivery.pasoRecoger?"El cliente pasa a recoger. ":xdtDpedido[0].nom_repartidor?"REPARTIDOR: "+xdtDpedido[0].nom_repartidor+" "+xdtDpedido[0].ap_repartidor+". Telefono: "+xdtDpedido[0].tel_repartidor:"Repartidor ... ",e=optionDeliveryCliente.p_header.arrDatosDelivery.tipoComprobante,c=optionDeliveryCliente.p_header.arrDatosDelivery.metodoPago,i=e?e.dni||"Publico en general "+(e.otro_dato||""):"Publico en general",r=2===c.idtipo_pago?"El pedido YA ESTA pagado, solo recogen.":"El pedido DEBE ser pagado",isPedidoPagadoFromApp=2===c.idtipo_pago,t=" | Facturacion: "+e.descripcion+" "+i+"  |  "+r,o="<p>"+e.descripcion+" "+i+"  </p><strong>"+r+"</strong></p>",$("#div-info-delivery-from-app").removeClass("xInvisible"),arrTotalesDeliveryCliente=isComercioServicioDeliveryPropio?optionDeliveryCliente.p_subtotales:darFormatoSubTotalesDelivery(optionDeliveryCliente.p_subtotales),$("#btnLlamarRepartidorP").removeClass("xInvisible"),c="1"===xdtDpedido[0].flag_solicita_repartidor_papaya,isPuedeLLamarRepartdiroPapaya="1"===xDtSede_cm[0].pwa_delivery_habilitar_llamar_repartidor_papaya,c&&!isPuedeLLamarRepartdiroPapaya&&$("#btnLlamarRepartidorP").addClass("xInvisible"),xdtDpedido[0].idrepartidor?($("#divRepartidorNom #a_nom_repartidor").text(xdtDpedido[0].nom_repartidor+" "+xdtDpedido[0].ap_repartidor),$("#divRepartidorNom").removeClass("xInvisible"),$("#divRepartidorSelect").addClass("xInvisible"),$("#btnLlamarRepartidorP").addClass("xInvisible")):isComercioServicioDeliveryPropio&&!c?($("select#selectRepartidor").val(-1),$("#divRepartidorSelect").removeClass("xInvisible"),$("#divRepartidorNom").addClass("xInvisible")):($("#divRepartidorNom").removeClass("xInvisible"),$("#divRepartidorSelect").addClass("xInvisible"),$("#btnLlamarRepartidorP").addClass("xInvisible"),$("#divRepartidorNom #a_nom_repartidor").text("Repartidor no asignado.."))),(datosDelivery="object"==typeof datosDelivery&&datosDelivery.p_header?0===datosDelivery.p_header.delivery?null:datosDelivery.p_header.arrDatosDelivery:datosDelivery)?($("#content-info-delivery").removeClass("xInvisible"),datosDelivery.paga_con=datosDelivery.paga_con.replace("undefined",""),e=datosDelivery.num_doc||" | "+datosDelivery.nombre+" | "+datosDelivery.direccion+" | "+datosDelivery.telefono+" | "+datosDelivery.paga_con,$("#txt-info-delivery").text("DELIVERY: "+e+t),datosDelivery.pasoRecoger?($("#divRepartidorPropio").addClass("xInvisible"),$("#btnLlamarRepartidorP").addClass("xInvisible"),d='<p><i class="fa fa-user"></i> '+xdtDpedido[0].referencia+'</p><p><i class="fa fa-phone"></i> '+datosDelivery.telefono+"</p>",o='<p class="badge badge-warning fs-14"><strong> <i class="fa fa-user"></i> El cliente pasa a recoger. <strong></p>'):($("#divRepartidorPropio").removeClass("xInvisible"),$("#btnLlamarRepartidorP").removeClass("xInvisible"),i=""===xdtDpedido[0].referencia?datosDelivery.nombre:xdtDpedido[0].referencia,r=datosDelivery.referencia?'<p><i class="fa fa-map-marker"></i> '+datosDelivery.referencia+"</p>":"",d='<p><i class="fa fa-user"></i> '+i+'</p><p><i class="fa fa-map-marker"></i> '+datosDelivery.direccion+"</p>"+r+'<p><i class="fa fa-phone"></i> '+datosDelivery.telefono+"</p>"),o+='<p><strong>Metodo de pago: </strong><span class="badge '+(datosDelivery.metodoPago&&2===datosDelivery.metodoPago.idtipo_pago?"fs-14 badge-info":"badge-secondary")+'">'+datosDelivery.paga_con+"</span></p>",$("#txt-info-delivery-from-app").text(a),$("#div-info-delivery-from-app").removeClass("xInvisible"),$("#info-comprobante").html(o),$("#info-pedido").html(d),"0"!==xDtSede_cm[0].pwa_delivery_servicio_propio&&"0"!==xdtDpedido[0].flag_solicita_repartidor_papaya||$("#div-info-delivery-from-app").addClass("xInvisible"),"1"===xdtDpedido[0].flag_solicita_repartidor_papaya&&(arrTotalesDeliveryCliente=darFormatoSubTotalesComisionRepartidor(xDtSede_cm[0],optionDeliveryCliente.p_subtotales,optionDeliveryCliente.p_header.arrDatosDelivery.costoTotalDelivery,!0))):$("#content-info-delivery").addClass("xInvisible"));for(var s="",l=1,p=0;p<xdtDpedido.length;p++){let e="";switch(xdtDpedido[p].val_color_despachado){case"1":e="xColorRow_verde";break;case"2":e="xColorRow_Ambar";break;case"3":e="xColorRow_Rojo"}var n=""===e?"xColorRow_Plomo":e,n=0<xdtDpedido[p].tiempo_atencion.length?'<td class="'+e+'">'+xdtDpedido[p].tiempo_atencion+' <span class="xfont11 '+n+'">min</span></td>':"<td></td>",s=String(s+'<tr class="row selected1 xCursor check_item_p" data-idcategoria="'+D+'" data-idpedido="'+xdtDpedido[p].idpedido+'" data-idcliente="'+xdtDpedido[p].idcliente+'" data-idcat="'+xp_sel_idcategoria+'" data-punitario="'+xdtDpedido[p].punitario+'" data-total="'+xdtDpedido[p].total+'" data-m="'+xdtDpedido[0].nummesa+'" data-idtipoconsumo="'+xdtDpedido[0].idtipo_consumo+'" data-nump="'+xdtDpedido[0].numpedido+'" data-correlativo="'+xdtDpedido[0].correlativo_dia+'" data-ref="'+xdtDpedido[0].referencia+'">" data-subtotales_tachados="'+xdtDpedido[0].subtotales_tachados+'"><td><paper-checkbox checked class="check_item"></paper-checkbox>'+l+"</td><td>"+xdtDpedido[p].des_pedido+' <span class="xfont10 xColorRow_Plomo">'+xdtDpedido[p].referencia+"</span></td><td>"+xdtDpedido[p].min_transcurridos+' <span class="xfont11 xColorRow_Plomo">min</span></td>'+n+'<td align="right" class="td_importe" id="td_importe">'+xMoneda(xdtDpedido[p].total)+"</td></tr>");l++}$("#tb_pedidos .row").remove(),$("#tb_pedidos").append(s).trigger("create"),$("#xBody_pcp div").remove(),$("#xBody_pcp").append('<div><paper-spinner active class="xCentradoVerticalHorizontal"></paper-spinner></div>').trigger("create");var c=lastDataPedidoInsert?lastDataPedidoInsert.idpedido:0,e=lastDataPedidoInsert?0:x;$.ajax({type:"POST",url:"../../bdphp/log.php?op=3051",data:{m:e,p:_,confirmar_pago:m,lastIdPedido:v,idpedido:c}}).done(function(e){e=$.parseJSON(e);lastDataPedidoInsert?e.datos.map(e=>{xArrayDtOrdenFiltro.push(e)}):xArrayDtOrdenFiltro=e.datos,xLoadMipedidoBD(xThisComPedidosCuenta.xdtPedDet=xArrayDtOrdenFiltro),xSumarTotalPedidos()}),xPopupLoad.xclose(),dialog_detalle_pcp.open(),xThisComPedidosCuenta.isAddItemRow=!1,event.stopPropagation()}),$("#p_mesa").text(C),xGeneralDataCarta||xLoadDataUlAdd()}function xLoadMipedidoBD(e){var t,d,o="",r=(xArrayTpC=[],xArraySeccion=[],"");for(a in xDtBdPCC=e)null==xArrayTpC[xDtBdPCC[a].idtipo_consumo]&&(xArrayTpC[xDtBdPCC[a].idtipo_consumo]={id:xDtBdPCC[a].idtipo_consumo,des:xDtBdPCC[a].des_tp});xArraychek_pedido=[];for(b in xArrayTpC){for(i in o="",xArraySeccion=[],xDtBdPCC)xArrayTpC[b].id==xDtBdPCC[i].idtipo_consumo&&1!=xDtBdPCC[i].visible&&(xDtBdPCC[i].procede,1!=xAgrupar_item_activo&&(xAgrupar_item_activo=""),d=xDtBdPCC[i].des_seccion,null==xArraySeccion[xDtBdPCC[i].idseccion_index]&&(xArraySeccion[xDtBdPCC[i].idseccion_index]='<tr><td colspan="5" class="xBold">'+d+"</td></tr>"),d=String('<tr class="row xCursor" data-idpedidodetalle="'+xDtBdPCC[i].idpedido_detalle+'" data-i="'+i+'" data-idpedido="'+xDtBdPCC[i].idpedido+'" data-idcliente="'+xDtBdPCC[i].idcliente+'" data-punitario="'+xDtBdPCC[i].punitario+'" data-idtipoconsumo="'+xDtBdPCC[i].idtipo_consumo+'" data-idcategoria="'+xDtBdPCC[i].idcategoria+'" data-iditem="'+xDtBdPCC[i].iditem+'" data-idcartalista="'+xDtBdPCC[i].idcarta_lista+'" data-procede="'+xDtBdPCC[i].procede+'" data-descontar="'+xDtBdPCC[i].descontar_en+'" data-iddescontar="'+xDtBdPCC[i].iddescontar+'" data-cant_descontar="'+xDtBdPCC[i].cant_descontar+'" data-idpedidodetaller="'+xDtBdPCC[i].idpedido_detalle_r+'" data-cantidadr="'+xDtBdPCC[i].cantidad_r+'" data-totalr="'+xDtBdPCC[i].total_r+'" data-cantidad="'+xDtBdPCC[i].cantidad+'" data-total="'+xDtBdPCC[i].ptotal+'" data-des_seccion="'+d+'" data-subtotales_tachados="'+xDtBdPCC[i].subtotales_tachados+'" data-idbus = "'+xDtBdPCC[i].idseccion+'" data-des_tp = "'+xDtBdPCC[i].des_tp+'" data-descripcion = "'+xDtBdPCC[i].descripcion+'" data-idseccion_index = "'+xDtBdPCC[i].idseccion_index+'" data-isalmacen = "'+xDtBdPCC[i].isalmacen+'" data-precio_default = "'+xDtBdPCC[i].precio_default+'" data-procede_index = "'+xDtBdPCC[i].procede_index+'" data-ptotal = "'+xDtBdPCC[i].ptotal+'" data-total = "'+xDtBdPCC[i].total+'" data-total_r = "'+xDtBdPCC[i].total_r+'" data-totalr = "'+xDtBdPCC[i].totalr+'" data-idseccion="'+xDtBdPCC[i].idseccion+'" ><td width="50px" class="click_row_dt_p" id="cant_descontar"><paper-checkbox class="check_item"></paper-checkbox><span id="td_cant">'+xCeroIzq(xDtBdPCC[i].cantidad,2)+'</span></td><td class="click_row_dt_p" width="50%" id="descripcion_item">'+xDtBdPCC[i].descripcion+'</td><td class="click_row_dt_p" align="right" id="td_importe">'+xDtBdPCC[i].ptotal+"</td></tr>"),xArraySeccion[xDtBdPCC[i].idseccion_index]=xArraySeccion[xDtBdPCC[i].idseccion_index]+d);for(a in t='<tr><td colspan="5" class="xFondoRowBlanco xBold">'+xArrayTpC[b].des+"</td></tr>",xArraySeccion)o=String(o+xArraySeccion[a]);r=String(r+t+o)}r='<div><table width="100%" id="tb_det_pedidos" class="xRowPading4">'+r+"</table></div>",$("#xBody_pcp div").remove(),$("#xBody_pcp").html(r).trigger("create")}function xIrPage(e){switch(e){case 0:$("#dialog_detalle_pcp").removeClass("normal"),$("#dialog_detalle_pcp").addClass("tall");break;case 1:goPagarCuenta()}content_page.selected=e}async function goPagarCuenta(){var e={checkItemsSeleccionados:await getItemsSeleccionados(),arr_subtotal:xarr_subtotal=arrSumSubtTotales,tt_pedido:parseFloat(xtt_pedidos),is_from_client_pwa:xDtBdPCC[0]?.is_from_client_pwa||0,isPedidoPagadoFromApp:isPedidoPagadoFromApp};xThisComPedidosCuenta.fire("total_pagar_cuenta",e),dialog_detalle_pcp.close()}async function xSumarTotalPedidos(e,a){var n=xtt_pedidos=0,t=$("#tb_pedidos"),t=($("#tb_pedidos .total").remove(),xtt_pedidos=xSumaCantRow(t,".td_importe"),t=$("#tb_det_pedidos"),n=xSumaCantRow(t,".td_importe"),(checkItemsSeleccionados=await getItemsSeleccionados()).arrayPedidosSeleccionados),d=xCargarDatosAEstructuraImpresion(t),d=xArmarSubtotalesArray(d,t.importeTotalSubItemSeleccionados),c=(xImporteTotalSeleccionados=checkItemsSeleccionados.esSeleccionTotal?d:xImporteTotalSeleccionados,xImporteTotalSeleccionados=isPedidoOpenDeliveryCliente?getImporteTotalSubTotalesDelivery(arrTotalesDeliveryCliente):xImporteTotalSeleccionados,arrSumSubtTotales=isPedidoOpenDeliveryCliente?arrTotalesDeliveryCliente:xLocal_xDtSubTotales,arrSumSubtTotales=a?arrSubtTotalesDescuento:arrSumSubtTotales,xLocal_xDtSubTotales=arrSumSubtTotales,"");xLocal_xDtSubTotales.forEach((e,a)=>{var t,d,o,i="",r="",s=e.tachado?"xTachar":"",l=e.tachado?"Add":"Quitar",p=e.tachado?e.importe_tachado:parseFloat(e.importe).toFixed(2),a=e.quitar?'<span data-tachado="'+e.tachado+'" class="xCursor xBold xColorRow_Azul xfont11" title="no cobrar" onclick="quitarSubTotal(this, '+a+')"> '+l+" </span>":"";"TOTAL"===e.descripcion.toUpperCase()?(r="tt_importe_pagar_t",d="",t="xfont18 xBold",o="IMPORTE A PAGAR",n=parseFloat(e.importe).toFixed(2)):(t="xfont15",o=e.descripcion.toUpperCase(),i="subtotal-tr-row"),c=c+'<tr class="total '+s+'"><td colspan="4" class="'+i+'"><p class="'+d+'">'+o+" "+a+'</p></td><td align="right" class="'+i+'"><p class="'+t+' xColorRow_Azul" id="'+r+'">'+p+"</p></td></tr>"}),t=String('<tr class="total"><td colspan="4">CONSUMO TOTAL</><td align="right"><P class="xfont18" id="tt_consumo_t"><b>'+xMoneda(xtt_pedidos)+"</b></p></td></tr>"),d=parseFloat(xImporteTotalSeleccionados)-parseFloat(n),ImporteDiferencia=a?0:d,t=String(t+c+'<tr class="total"><td colspan="4">DIFERENCIA</><td align="right"><P class="xfont18 xColorRow_Rojo"><b>'+xMoneda(ImporteDiferencia)+"</b></p></td></tr>"),$("#tb_pedidos").append(t).trigger("create"),xtt_pedidos=n,xThisComPedidosCuenta.importeTotalPedido=xtt_pedidos,0!=parseFloat(xtt_pedidos)||a?$(xObj_miPedido).find(".importe").text(xMoneda(xtt_pedidos)):($(xObj_miPedido).removeClass("xOcupado"),$(xObj_miPedido).removeClass("xDespachado"),$(xObj_miPedido).addClass("xNeutro"),$(xObj_miPedido).find(".show-led-precuenta").addClass("xInvisible"),$(xObj_miPedido).find(".show-led-print").addClass("xInvisible"),$(xObj_miPedido).find(".show-ico-mozo").addClass("xInvisible"),$(xObj_miPedido).find(".show-mozo-pedido").removeClass("pintar"),$(xObj_miPedido).find("#nommozo").text("."),$(xObj_miPedido).find(".importe").text("."),$(xObj_miPedido).find(".tiempo").text("disponible"),$(xObj_miPedido).attr("data-hora",""),$(xObj_miPedido).attr("data-estado","b"),$(xObj_miPedido).attr("data-abrir-detalle","0"),$(".grid").isotope("updateSortData",$(xObj_miPedido)).isotope("layout"),dialog_detalle_pcp.close()),a||xCompDescuentoPedido.reset()}async function getItemsSeleccionados(){var t,e,d="",o=[],i=0,r=0,a=parseFloat($("#tb_pedidos #tt_importe_pagar_t").text()),_=($("#tb_pedidos .row.selected1").each(function(e,a){i++,d=d+$(a).attr("data-idpedido")+",",t=$(a).attr("data-idcliente"),r+=parseFloat(r)+parseFloat($(a).find("#td_importe")),xid_tipo_consumo=$(a).attr("data-idtipoconsumo"),0===o.filter(e=>e===t).length&&o.push(t)}),d=d.slice(0,-1),e=i==xdtDpedido.length,[]),s=$("#tb_det_pedidos"),m=s.find(".row.selected1").length,l=(s.find(".row").length,parseInt(s.find(".row").length)),p=parseInt(s.find(".row.selected1").length),l=!(p<l&&0<p);return s.find(".row").each(function(e,a){var t=$(a).attr("data-idpedido"),d=($(a).attr("data-idcliente"),$(a).attr("data-iditem")),o=$(a).attr("data-idpedidodetaller"),i=$(a).attr("data-totalr"),r=$(a).attr("data-punitario"),s=$(a).attr("data-cantidadr"),l=$(a).attr("data-total"),p=($(a).attr("data-cantidad"),$(a).attr("data-des_seccion")),n=$(a).attr("data-idseccion"),c=$(a).attr("data-subtotales_tachados"),x=$(a).find("#descripcion_item").text();-1!==o.indexOf(",")&&(o=o.slice(0,-1),i=i.slice(0,-1),s=s.slice(0,-1)),xid_tipo_consumo=$(a).attr("data-idtipoconsumo"),0!==m&&!$(a).hasClass("selected1")||_.push({des_seccion:p,idseccion:n,descripcion:x,idpedido:t,idpedido_detalle:o,iditem:d,cantidad:s,precio:r,total:i,ptotal:l,idtipo_consumo:xid_tipo_consumo,subtotales_tachados:c})}),{esSeleccionTodoPeidoLista:e,esSeleccionTotal:l,arrayPedidosSeleccionados:_,arrayIdClienteUsPedido:o,idPedidosSeleccionados:d,tipoConsumo:xid_tipo_consumo,importeTotalSeleccionado:a,importeTotalSubItemSeleccionados:r}}async function xImprimirPrecuenta(){var e=xCargarDatosAEstructuraImpresion(checkItemsSeleccionados.arrayPedidosSeleccionados),a=$("#p_mesa").text().split(" "),t=$("#p_correlativo").text(),a=(t=(t=(t=t.replace("CO-","")).replace("|","")).replace(/\s/g,""),xdtDpedido[0].nummesa),d=datosDelivery?1:0;xArrayPrintEncaLi_pre_cuenta={m:a,r:"",num_pedido:t,reservar:0,solo_llevar:0,correlativo_dia:t,precuenta:!0,delivery:d,arrDatosDelivery:datosDelivery},xMandarImprimirOtroDoc(xArrayPrintEncaLi_pre_cuenta,xDtPrint,e,arrSumSubtTotales,-1),xUpdatePrintPrecuentaPedido(checkItemsSeleccionados.idPedidosSeleccionados),$(xObj_miPedido).find(".show-led-precuenta").removeClass("xInvisible")}Polymer({is:"x-pedido-cuenta-cobrar",properties:{listPedidosPorPagar:[],xdtPedDet:Object,isAddItemRow:Boolean,importeTotalPedido:Number},attached:function(){xThisComPedidosCuenta=this},viewPedidoDetalle:e=>{xLoadDetallesPedido(e)}})</script>