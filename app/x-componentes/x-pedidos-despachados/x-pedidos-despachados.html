<dom-module id="x-pedidos-despachados"><template><style>.container{padding:20px;border:1px solid #ccc;border-radius:5px;background-color:#f9f9f9;max-width:800px;margin:0 auto}.pedido{display:flex;justify-content:space-between;padding:10px}.pedido:last-child{border-bottom:none}.pedido-header{font-weight:700;margin-bottom:10px}.pedido-info{display:flex;flex-direction:column}.pedido-info span{margin-bottom:5px}.pedido-estado{width:50px;height:20px;border-radius:3px;text-align:center}.color-verde{background-color:green;color:#fff}.color-amarillo{background-color:#ff0;color:#000}.color-rojo{background-color:red;color:#fff}</style><paper-dialog id="dlgDetallePedidoDespachado"style="max-width:550px"class="dialog_redondo"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div><table class="w-100 fs-11"><thead><th align="left"style="width:20px">Cant<th align="left"style="max-width:250px">Producto<th align="right">Total<tbody><template is="dom-repeat"items="{{listProductos}}"as="producto"><tr><td align="left"style="width:20px">{{producto.cantidad}}<td align="left"style="max-width:250px">{{producto.descripcion}}<td align="right">{{producto.total}}</template></table><br><button class="btn btn-sm btn-dark"dialog-dismiss>Cerrar</button></div></paper-dialog><div class="container mt-2 mb-5"><div class="pedido-header">Pedidos Despachados</div><div class="d-flexx justify-content-end"><template is="dom-repeat"items="{{resumenPedido}}"as="resumen"><div class="pedido"><div class="fw-600">{{resumen.titulo}}</div><div class$="[[resumen.class]]">{{resumen.cantidad}}</div></div></template></div><hr><table class="w-100"><thead><th>#<th align="center">Despachado<th align="center">Usuario<th align="left">Pedido<th align="center">Canal<th align="right">Total<td><tbody><template is="dom-repeat"items="{{pedidos}}"as="pedido"><tr><td>{{displayIndex(index)}}<td align="center"><div class$="{{_getColorClass(pedido.color_despacho)}}">{{pedido.tiempo_despacho}}</div><p class="fw-600 fs-11">{{pedido.fecha_despacho}}<td align="center">{{pedido.nom_usuario}}<td align="left"><div><span class="fs-11 fw-600">Correlativo:</span> {{pedido.correlativo_dia}}<br><span class="fs-11 fw-600">Nro. Pedido:</span> {{pedido.idpedido}}<br><span class="fs-11 fw-600">Fecha:</span> {{pedido.fecha_pedido}}</div><td align="center"><p>{{pedido.des_tc}}<p class="fw-600 fs-11">{{pedido.referencia}}<td align="right">{{pedido.total}}<td><button class="xBoton_flat_2 xCursor ml-2"on-click="verPedido">Ver</button></template></table></div></template><script>Polymer({is:"x-pedidos-despachados",properties:{pedidos:{type:Array,value:function(){return[]}},listProductos:{type:Array,value:function(){return[]}},resumenPedido:{type:Object,value:function(){return{}}}},showPedidosDespachados:function(e){e={idzona:e};xPopupLoad.xopen(),$.ajax({url:"../../bdphp/log_010.php?op=get-list-pedidos-despachados",method:"POST",data:JSON.stringify(e)}).done(function(e){e=JSON.parse(e);this.pedidos=e.datos,this.getResumen(),xPopupLoad.xclose()}.bind(this))},displayIndex:function(e){return xCeroIzq(e+1,1)},_getColorClass:function(e){switch(e){case"1":return"pedido-estado bg-success text-white";case"2":return"pedido-estado bg-warning";case"3":return"pedido-estado bg-danger text-white";default:return""}},verPedido:function(e){e=e.model.pedido.idpedido;$.ajax({url:"../../bdphp/log_010.php?op=get-pedido-despachado",method:"POST",data:JSON.stringify({idpedido:e})}).done(e=>{e=JSON.parse(e);this.listProductos=e.datos,this.$.dlgDetallePedidoDespachado.open()})},getResumen:function(){let d={verde:0,amarillo:0,rojo:0};this.pedidos.forEach(e=>{switch(e.color_despacho){case"1":d.verde++;break;case"2":d.amarillo++;break;case"3":d.rojo++}}),this.resumenPedido=[{titulo:"A Tiempo",cantidad:d.verde,class:"bg-success text-white text-center pedido-estado ml-2"},{titulo:"A Limite",cantidad:d.amarillo,class:"bg-warning text-center pedido-estado ml-2"},{titulo:"Atrasados",cantidad:d.rojo,class:"bg-danger text-white text-center pedido-estado ml-2"}]}})</script></dom-module>