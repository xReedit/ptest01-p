<dom-module id="x-comp-anular-comprobante"><template><paper-dialog id="dialog_motivo_anular_comprobante"class="dialog_redondo"style="min-width:320px;max-width:600px"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="xContent"><div class="d-flexx align-items-center"><h3>ANULAR COMPROBANTE</h3><span class="ml-2">[[ desDocCpe ]]</span></div><div class="xLinea2"></div><br><p><strong>El plazo para comunicar de baja o anular un comprobante de pago electrónico es de [[NumDaysAnularCpe]] días</strong>, contados desde el día que emites el comprobante. Si no cumples ese plazo, tendrás que generar una Nota de Crédito.<div hidden$="[[isShoOpNotaCredito]]"class="mt-1"><p class="fw-600 text-success">El documento esta en el plazo para dar de baja.</div><div hidden$="[[!isShoOpNotaCredito]]"class="mt-1"><p class="fw-600 text-info">El documento NO cumple con el plazo, debes generar una Nota de Crédito.</div><br><h4>Indique el motivo de anulación</h4><div><input class="xMiInput"placeholder="Motivo..."id="txt_motivo_anular"autofocus></div><br><br><br><div class="xBoton2 xRojo"dialog-dismiss hidden$="[[isShoOpNotaCredito]]"on-click="anularComprobante">Listo, dar de baja</div><div class="xBoton2 xAzul"dialog-dismiss hidden$="[[!isShoOpNotaCredito]]"on-click="generarNotaCredito">Listo, generar nota de crédito</div><div class="xBoton2 xPlomo"dialog-dismiss>Cancelar</div><br><br></div></paper-dialog></template><script>Polymer({is:"x-comp-anular-comprobante",properties:{idcomprobante:{type:Number},desDocCpe:{type:String,value:""},NumDaysAnularCpe:{type:Number,value:0},isShoOpNotaCredito:{type:Boolean,value:!1},dataCpe:{type:Object,value:{}}},open:function(a){this.idcomprobante=a,this.$.dialog_motivo_anular_comprobante.open(),this.searhComprobante()},searhComprobante:function(){(new httpFecht).axiosExecute({type:"GET",url:"../../bdphp/api.php?route=search-comprobante/"+this.idcomprobante},!0,!1).then(a=>{var t,e;a.success&&(e=a.data[0],this.dataCpe=e,t=xm_log_get("app3_sys_const").find(a=>"NUM_DAYS_ANULACION_CPE"===a.llave).value,e=7<=xDiasTranscurridos("",e.fecha),this.desDocCpe=a.data[0].numero,this.NumDaysAnularCpe=t,this.isShoOpNotaCredito=e)})},anularComprobante:async function(){new httpFecht;var a=this.$.txt_motivo_anular.value,t=JSON.parse(this.dataCpe.json_xml),e=this.dataCpe.external_id,t={codsunat:t.codigo_tipo_documento,external_id:e,motivo:a,fecha:this.dataCpe.fecha};xm_all_xToastOpen("Conectando con Sunat..."),await xSoapSunat_AnularComprobante(t);xm_all_xToastClose(),this.$.txt_motivo_anular.value="",this.fire("onAnularComprobante",{success:!0})},generarNotaCredito:async function(){xm_all_xToastOpen("Conectando con Sunat...");await xCocinarJsonNotaCredito(this.dataCpe);xm_all_xToastClose(),this.fire("onAnularComprobante",{success:!0})}})</script></dom-module>