<dom-module id="x-comp-item-subitems-edit"><template><div><iron-pages selected="{{selected}}"><div><p><strong>Seleccionables o Grupos </strong><small>Coloque un titulo para agrupar las opciones o modificadores</small><table width="100%"><thead><th width="80%"><div id="div-list-compartido"><input class="xMiInput xPasarEnter2 w-100"id="txt_content_titulo"placeholder="Titulo"></div><th colspan="2"><paper-fab mini icon="add"onclick="xSaveNewContentSubItem()"class="xDerecha"></paper-fab><tbody><template is="dom-repeat"items="[[listContent]]"as="item"><tr data-index="[[index]]"data-t="item_subitem_content_detalle"data-id="{{item.iditem_subitem_content_detalle}}"data-id-content="{{item.iditem_subitem_content}}"class="xCursor"><td onclick="selectOptionContentItem(this)"><span id="titulo-seleccionable">{{item.titulo}} </span><input class="xMiInput xPasarEnter2 xInvisible"id="text-edit-seleccionable"onblur="xEditItemTituloSeleccionableOnBlur(this)"><td><span class="xEditRow"title="Editar"onclick="xEditItemTituloSeleccionable(this)"></span><td><span class="xDeleteRow"title="Borrar"onclick="xBorrarItem(this)"></span></template></table></div><div><div class="d-flexx mb-2"><button class="btn btn-sm btn-secondary fs-11 mr-2"on-click="goBackTitulos"><i class="fa fa-arrow-left"></i></button><p class="xBold fs-17">{{contentSelect.titulo}}</div><div><p><strong>Stock</strong> <small>Cuando se enlaza una porcion o producto toma el stock de estos.</small><p><strong>Cantidad</strong> <small>El stock que descuenta al momento de hacer la venta</small><table class="table-max-alto mt-2"><thead><th>Enlaze<th>Descripción<th>Stock<th>Cantidad<th>Precio<th></thead><tr width="100%"class="fs-11"><th width="50px"><select name=""id="listTipo"style="width:70px"onchange="onListTipo(this)"><option value="0">Libre<option value="1">Porcion<option value="2">Producto<option value="3">Subreceta</select><th width="40%"><input hidden$="{{inputLibreHidden}}"class="xMiInput xPasarEnter2 w-100"id="txt_sub_des"placeholder="DESCRIPCION"onchange="conMayusculas(this)"><div id="div-input-producto"hidden$="{{inputProductoHidden}}"><input class="xMiInput xPasarEnter2 w-100"placeholder="PRODUCTO"onchange="conMayusculas(this)"id="des_item_producto"></div><div id="div-input-porcion"hidden$="{{inputProcionHidden}}"><input class="xMiInput xPasarEnter2 w-100"placeholder="PORCION"onchange="conMayusculas(this)"id="des_item_porcion"></div><div id="div-input-subreceta"hidden$="{{inputSubrecetaHidden}}"><input class="xMiInput xPasarEnter2 w-100"placeholder="SUBRECETA"onchange="conMayusculas(this)"id="des_item_subreceta"></div><th width="20%"><input class="xMiInput xPasarEnter2"id="txt_sub_cant"placeholder="STOCK"onchange="conMayusculas(this)"><th width="20%"><input type="number"class="xMiInput xPasarEnter2"id="txt_sub_descuenta"placeholder="CANT"onchange="conMayusculas(this)"><th width="30%"><input type="number"class="xMiInput"id="txt_sub_precio"placeholder="PRECIO"onchange="conMayusculas(this)"onkeyup="enterAddSubItem(event)"onblur="xRetornaMoneda(this)"><th><button class="btn btn-sm btn-success fs-11"onclick="addSubItem()"><i class="fa fa-plus"></i></button></tr><tbody><template is="dom-repeat"items="{{listCompSubitems}}"as="item"><tr data-index="{{index}}"data-t="item_subitem"data-id="{{item.iditem_subitem}}"class="xCursor fs-11"><td>{{item.tipo}}<td onclick="xModRow_subitem(this,3)"id="subIDes">{{item.descripcion}}<td onclick="xModRow_subitem(this,2)"id="subICant">{{item.cantidad}}<td onclick="xModRow_subitem(this,2)"id="subIDescuenta">{{item.descuenta}}<td onclick="xModRow_subitem(this,2)"id="subIPrecio">{{item.precio}}<td><span class="xDeleteRow"title="Anular"onclick="xBorrarItem(this)"></span></template><tr><td>.<td class="xBold">Cantidad Total<td>.<td class="xBold">{{cantidadSubItems}}<td>.<td>.</table></div><br><br><h4>Condiciones</h4><hr><div class="d-flexx align-items-center justify-content-between"><label for="txt_sub_condicion_cant">Cuantos subitem u opciones se pueden seleccionar?</label> <input type="number"style="width:100px"onkeyup="addSubItemItem()"class="xMiInput"id="txt_sub_condicion_cant"placeholder="Cant"onchange="conMayusculas(this)"></div><br><br><paper-checkbox id="xcheck_show_cant_item"onchange="addSubItemItem()">Cantidad seleccionable en las opciones? Es decir el cliente podrá seleccionar mas de uno en cada opción.</paper-checkbox><br><br><paper-checkbox id="xcheck_subitem_required"onchange="addSubItemItem()">Es obligatorio que se seleccione?</paper-checkbox><br><br><paper-checkbox id="xcheck_controlable"onchange="addSubItemItem()">Controlabe? -figura en el cierre de caja y promociones.-</paper-checkbox><br><div class="xDerecha"hidden$="{{isCompartido}}"><div class="xBoton2 xVerde"onclick="compartirContenItem()">Compartir</div></div><br><br></div></iron-pages></div></template></dom-module><style></style><script>var xThisComSubItemEdit,iditemSelect,iditemContentSelect,xIdProducto_sel,xIdItemCompartido,xidproducto_porcionado,xNewItemPro,xNewItemPorcion,xNewItemCompartido;function xInitSubItemsEdit(){xloadSubItemsContent(iditemSelect=xThisComSubItemEdit.iditem),xThisComSubItemEdit.inputLibreHidden=!1,xThisComSubItemEdit.inputProductoHidden=!0,xThisComSubItemEdit.inputProcionHidden=!0,xThisComSubItemEdit.inputSubrecetaHidden=!0,xThisComSubItemEdit.isCompartido=!1;var t=document.getElementById("txt_sub_cant"),t=(t&&(t.disabled=!1,t.value=""),document.getElementById("txt_sub_descuenta"));t&&(t.disabled=!0,t.value="1"),xloadProductoItemSub(),xLoadListItemSubContentCompartidos(),xloadSubrecetasItemSub()}function onListTipo(t){var e=document.getElementById("txt_sub_cant"),i=document.getElementById("txt_sub_descuenta");switch(t.value){case"0":xThisComSubItemEdit.inputLibreHidden=!1,xThisComSubItemEdit.inputProductoHidden=!0,xThisComSubItemEdit.inputProcionHidden=!0,xThisComSubItemEdit.inputSubrecetaHidden=!0,e.disabled=!1,e.value="",i.disabled=!0,i.value="1";break;case"1":xThisComSubItemEdit.inputLibreHidden=!0,xThisComSubItemEdit.inputProductoHidden=!0,xThisComSubItemEdit.inputProcionHidden=!1,xThisComSubItemEdit.inputSubrecetaHidden=!0,e.disabled=!0,e.value="ND",i.disabled=!1;break;case"2":xThisComSubItemEdit.inputLibreHidden=!0,xThisComSubItemEdit.inputProductoHidden=!1,xThisComSubItemEdit.inputProcionHidden=!0,xThisComSubItemEdit.inputSubrecetaHidden=!0,e.disabled=!0,e.value="ND",i.disabled=!1;break;case"3":xThisComSubItemEdit.inputLibreHidden=!0,xThisComSubItemEdit.inputProductoHidden=!0,xThisComSubItemEdit.inputProcionHidden=!0,xThisComSubItemEdit.inputSubrecetaHidden=!1,e.disabled=!0,e.value="ND",i.disabled=!1}}function xloadSubItemsContent(t){$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=803",data:{i:t}}).done(function(t){t=(t=JSON.parse(t)).datos,0<(xThisComSubItemEdit.listContent=t).length&&(xThisComSubItemEdit.contentSelect=t[0],xloadSubitems(iditemContentSelect=t[0].iditem_subitem_content))})}function compartirContenItem(){$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=806",data:{i:iditemContentSelect}}).done(t=>{}),xThisComSubItemEdit.isCompartido=!0}function xloadSubitems(t){$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=801",data:{i:t}}).done(function(t){t=JSON.parse(t),xThisComSubItemEdit.listCompSubitems=t.datos,sumCantSubitem()}),xcheck_subitem_required.checked=1===parseInt(xThisComSubItemEdit.contentSelect.subitem_required_select),xcheck_show_cant_item.checked=1===parseInt(xThisComSubItemEdit.contentSelect.show_cant_item),xcheck_controlable.checked=1===parseInt(xThisComSubItemEdit.contentSelect.controlable),txt_sub_condicion_cant.value=xThisComSubItemEdit.contentSelect.subitem_cant_select}function sumCantSubitem(){var t=0<xThisComSubItemEdit.listCompSubitems.filter(t=>"Porcion"===t.tipo).length,e=0<xThisComSubItemEdit.listCompSubitems.filter(t=>"Producto"===t.tipo).length;t||e||(xThisComSubItemEdit.cantidadSubItems=xThisComSubItemEdit.listCompSubitems.map(t=>parseInt(t.cantidad)).reduce((t,e)=>t+e,0),xThisComSubItemEdit.cantidadSubItems=isNaN(xThisComSubItemEdit.cantidadSubItems)?"-":xThisComSubItemEdit.cantidadSubItems,addSubItemItem())}function selectOptionContentItem(t){var e=$(t).find("span")[0];$(e).hasClass("xInvisible")||(e=t.parentElement.dataIndex,xThisComSubItemEdit.contentSelect=xThisComSubItemEdit.listContent[e],iditemContentSelect=xThisComSubItemEdit.contentSelect.iditem_subitem_content,xThisComSubItemEdit.isCompartido="0"!==xThisComSubItemEdit.contentSelect.compartido,xloadSubitems(iditemContentSelect),xThisComSubItemEdit.selected=1)}function enterAddSubItem(t){13===t.keyCode&&addSubItem()}function addSubItem(){const e=!xThisComSubItemEdit.inputProcionHidden,i=!xThisComSubItemEdit.inputProductoHidden,o=!xThisComSubItemEdit.inputLibreHidden,d=!xThisComSubItemEdit.inputSubrecetaHidden;var t=txt_sub_des.value;if(i){if(xNewItemPro)return void alert("Debe seleccionar un producto de lista");t=des_item_producto.value}if(e){if(xNewItemPorcion)return void alert("Debe seleccionar una porcion de lista");t=des_item_porcion.value}if(d){if(xNewItemSubreceta)return void alert("Debe seleccionar una subreceta de lista");t=des_item_subreceta.value}t={isPorcion:e,isProducto:i,isLibre:o,isSubreceta:d,idproducto:xIdProducto_sel,idporcion:xidproducto_porcionado,idsubreceta:xidsubreceta_sel,iditem_subitem_content:iditemContentSelect,iditem:iditemSelect,descripcion:t,cantidad:txt_sub_cant.value,precio:txt_sub_precio.value,cant_select:txt_sub_condicion_cant.value,required_select:xcheck_subitem_required.checked?1:0,controlable:xcheck_controlable.checked?1:0,descuenta:txt_sub_descuenta.value};$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=8",data:{item:t}}).done(function(t){xloadSubitems(iditemContentSelect),o?(txt_sub_des.value="",setTimeout(()=>txt_sub_des.focus(),100)):e?(des_item_porcion.value="",setTimeout(()=>des_item_porcion.focus(),100)):i?(des_item_producto.value="",setTimeout(()=>des_item_producto.focus(),100)):d&&(des_item_subreceta.value="",xNewItemSubreceta=!(xidsubreceta_sel=0),setTimeout(()=>des_item_subreceta.focus(),100))})}function addSubItemItem(){var t=parseInt(xThisComSubItemEdit.cantidadSubItems)?parseInt(xThisComSubItemEdit.cantidadSubItems):null,t={iditem:iditemSelect,iditem_subitem_content:iditemContentSelect,cant_select:txt_sub_condicion_cant.value,required_select:xcheck_subitem_required.checked?1:0,show_cant_item:xcheck_show_cant_item.checked?1:0,controlable:xcheck_controlable.checked?1:0,is_sum_cant_subitems:!!t?1:0,cantidad:t};$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=800",data:{item:t}})}function xModRow_subitem(t,e){var i=$(t).text().trim(),o=3!=e?"xAlinearDerecha":"";0<$(t).find("input").length||$(t).html('<input type="text" class="xMiInput xPasarEnter2 '+o+'" onblur="xModBlur_subitem(this,'+e+')" value="'+i+'" select>').trigger("create"),$(t).find("input").select()}function xModBlur_subitem(t,e){var i=$(t).val(),i=($(t).parents("table"),1==e?xMoneda(i):xCeroIzq(i,2));const o=t.parentElement.parentElement;$(t).parent().text(i),$(t).remove(),setTimeout(()=>{xSaveSubItemMod(o)},200)}function xSaveSubItemMod(t){var e=t.dataIndex,i=$(t).find("#subICant").text().trim(),o=$(t).find("#subIPrecio").text().trim(),d=$(t).find("#subIDes").text().trim(),t=$(t).find("#subIDescuenta").text().trim(),e=xThisComSubItemEdit.listCompSubitems[e];e.cantidad=i,e.precio=o.trim(),e.descripcion=d,e.descuenta=t,sumCantSubitem(),$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=804",data:{item:e}}).done(function(t){sumCantSubitem()}),xThisComSubItemEdit.frommonitor&&((i=xThisComSubItemEdit.contentSelect).opciones=[],i.opciones.push(e),xThisComSubItemEdit.itemselected.subitems=[],xThisComSubItemEdit.itemselected.cantidad=xThisComSubItemEdit.cantidadSubItems,xThisComSubItemEdit.itemselected.subitems.push(i),_monitoreoSocketEmitItemModificadoFromSubItems(xThisComSubItemEdit.itemselected))}function xSaveNewContentSubItem(){var t=txt_content_titulo.value;""!=t&&(t={des:t,iditem:iditemSelect,iditem_subitem_content:xIdItemCompartido,isContentCompartido:xNewItemCompartido?"0":"1"},$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=805",data:{item:t}}).done(function(t){xloadSubItemsContent(iditemSelect)}))}function xloadProductoItemSub(){$.ajax({type:"POST",url:"../../bdphp/log.php?op=160011"}).done(function(t){t=$.parseJSON(t);xThisComSubItemEdit.dtProItem=t.datos,xCargarProductoItemSub()}),$.ajax({type:"POST",url:"../../bdphp/log.php?op=16003"}).done(function(t){t=$.parseJSON(t);xThisComSubItemEdit.dtProItem_porcion=t.datos,xCargarPorcionItemSub()})}function xLoadListItemSubContentCompartidos(){$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=807"}).done(function(t){t=$.parseJSON(t);xThisComSubItemEdit.dtListContentCompartido=t.datos,xCargarCompartidoItemSub()})}function xCargarCompartidoItemSub(){var i=$("#txt_content_titulo");i.autocomplete({autoFocus:!0,source:xThisComSubItemEdit.dtListContentCompartido,appendTo:$("#div-list-compartido"),select:function(t,e){return i.val(e.item.label),xNewItemCompartido=!1,xIdItemCompartido=e.item.value,!1},focus:function(t,e){return!1},change:function(t,e){return xNewItemCompartido=null===e.item,!1}})}function xCargarProductoItemSub(){var o=$("#des_item_producto");o.autocomplete({autoFocus:!0,source:xThisComSubItemEdit.dtProItem,appendTo:$("#div-input-producto"),select:function(t,e){var i=e.item.label.split(" | ")[1];return o.val(i),o.attr("data-id",e.item.value),xNewItemPro=!1,xIdProducto_sel=e.item.value,$("#txt_sub_precio").val(e.item.precio_venta),!1},focus:function(t,e){return!1},change:function(t,e){return xNewItemPro=null===e.item&&(o.attr("data-value",""),o.attr("data-id",""),$("#txt_sub_precio").val(""),!0),!1}})}function xCargarPorcionItemSub(){var i=$("#des_item_porcion");i.autocomplete({autoFocus:!0,source:xThisComSubItemEdit.dtProItem_porcion,appendTo:$("#div-input-porcion"),select:function(t,e){return i.val(e.item.label),xidproducto_porcionado=e.item.value,xNewItemPorcion=!1},focus:function(t,e){return!1},change:function(t,e){return xNewItemPorcion=null===e.item&&!(xidproducto_porcionado=""),!1}})}var xidsubreceta_sel=0,xNewItemSubreceta=!0;function xloadSubrecetasItemSub(){$.ajax({type:"POST",url:"../../bdphp/log_subrecetas.php?op=listar_autocomplete"}).done(function(t){t="string"==typeof t?JSON.parse(t):t;xThisComSubItemEdit.dtSubrecetas=t.datos,xCargarSubrecetaItemSub()})}function xCargarSubrecetaItemSub(){var i=$("#des_item_subreceta");i.autocomplete({autoFocus:!0,source:xThisComSubItemEdit.dtSubrecetas,appendTo:$("#div-input-subreceta"),minLength:0,select:function(t,e){return i.val(e.item.label),i.attr("data-id",e.item.value),xidsubreceta_sel=e.item.value,xNewItemSubreceta=!1,$("#txt_sub_precio").val(e.item.precio_unitario),!1},focus:function(t,e){return!1},change:function(t,e){return null===e.item?(i.attr("data-value",""),i.attr("data-id",""),xNewItemSubreceta=!(xidsubreceta_sel=0),$("#txt_sub_precio").val("")):xNewItemSubreceta=!1,!1}})}function xBorrarItemSubItem(t){xRowObj=t.parentNode.parentNode,xIdROw=$(xRowObj).attr("data-id")||xRowObj.dataId,iditem=$(xRowObj).attr("data-iditem")||xRowObj.iditem}function xEditItemTituloSeleccionable(t){var t=t.parentElement.parentElement,e=$(t).find("#text-edit-seleccionable")[0],t=$(t).find("#titulo-seleccionable")[0];$(e).removeClass("xInvisible"),$(t).addClass("xInvisible"),$(e).val($(t).text().trim()),$(e).focus(),$(e).select()}function xEditItemTituloSeleccionableOnBlur(t){var t=t.parentElement.parentElement,e=$(t).find("#text-edit-seleccionable")[0],i=$(t).find("#titulo-seleccionable")[0],o=($(i).removeClass("xInvisible"),$(e).addClass("xInvisible"),$(e).val().trim()),i=(""!==o&&$(i).text($(e).val().trim()),t.dataIndex,t.dataIdContent);$.ajax({type:"POST",url:"../../bdphp/log_005.php?op=808",data:{item:{iditem_subitem_content:i,titulo:o}}})}Polymer({is:"x-comp-item-subitems-edit",properties:{frommonitor:{type:Object,value:!1},itemselected:Object,iditem:Number,listContent:{type:Object,notify:!0,reflectToAttribute:!0},listCompSubitems:{type:Object,notify:!0,reflectToAttribute:!0},isCompartido:!1,inputLibreHidden:!1,inputProductoHidden:!0,inputProcionHidden:!0,inputSubrecetaHidden:!0,dtProItem:Object,dtProItem_porcion:Object,dtSubrecetas:Object,dtListContentCompartido:Object,contentSelect:Object,cantidadSubItems:0},attached:function(){this.selected=0,xThisComSubItemEdit=this,inputLibreHidden=!1,inputProductoHidden=!0,inputProcionHidden=!0,inputSubrecetaHidden=!0},loadSubItemIni:function(){xThisComSubItemEdit.listCompSubitems=[],xThisComSubItemEdit.listContent=[],xThisComSubItemEdit.contentSelect=[],xThisComSubItemEdit.cantidadSubItems=0,xcheck_subitem_required.checked=!1,xcheck_show_cant_item.checked=!1,xcheck_controlable.checked=!1,txt_sub_condicion_cant.value="",this.selected=0,xInitSubItemsEdit()},goBackTitulos:function(){this.selected=0}})</script>