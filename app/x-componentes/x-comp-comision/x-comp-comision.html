<dom-module id="x-comp-comision"><template><style>:host{display:block}.comision-container{position:relative;display:inline-block}.comision-container{display:flex;align-items:stretch}.comision-button{background-color:#f3f3f3;border-radius:4px 0 0 4px;padding:5px 6px;cursor:pointer;display:flex;align-items:center;justify-content:space-between;min-width:150px;font-weight:500;border:1px solid #bdbdbd;border-radius:3px}.comision-button iron-icon{margin-left:8px}.cancel-button{background-color:#dc3545;color:#fff;border-radius:0 4px 4px 0;width:28px;display:flex;align-items:center;justify-content:center;cursor:pointer;margin-left:-5px;border:1px solid #bdbdbd}.comision-input{margin-top:40px;display:none;position:absolute;top:0;left:0;width:100%;max-width:300px;z-index:101;background:#fff;border:1px solid #ddd;border-radius:4px;box-shadow:0 2px 5px rgba(0,0,0,.2)}.comision-input.visible{display:block}paper-input{width:100%;--paper-input-container-input:{padding:8px};--paper-input-container:{padding:0};}.suggestions{border-radius:4px;position:absolute;width:100%;max-width:300px;max-height:200px;overflow-y:auto;background:#fff;border:1px solid #ddd;border-top:none;z-index:100;box-shadow:0 2px 5px rgba(0,0,0,.2);display:none}.suggestions.visible{display:block}.suggestion-item{padding:8px 16px;cursor:pointer;display:flex;justify-content:space-between}.suggestion-item:hover{background-color:#f5f5f5}iron-icon[suffix]{color:#5f6368;cursor:pointer}.suggestion-porcentaje{color:#4285f4;font-weight:700}paper-dialog{width:300px;max-width:300px;padding:16px;border-radius:8px}.dialog-buttons{display:flex;justify-content:flex-end;margin-top:16px}.dialog-buttons paper-button{margin-left:8px}.save-button{background-color:#4285f4;color:#fff}.cancel-button{color:#fff}</style><div hidden$="{{!isShowComponent}}"class="comision-container"on-tap="handleContainerClick"><div class="comision-button"on-tap="toggleInput"><span>{{buttonText}}</span><iron-icon icon="arrow-drop-down"></iron-icon></div><template is="dom-if"if="{{selectedComision}}"><div class="cancel-button"on-tap="cancelComision"><i class="fa fa-times style-scope x-comp-descuento text-white"></i></div></template><div class="comision-input"id="comisionInputContainer"><div class="suggestions"id="suggestions"><template is="dom-repeat"items="{{filteredComisiones}}"><div class="suggestion-item"on-tap="selectComision"data-index$="{{index}}"><span>{{item.descripcion}}</span> <span class="suggestion-porcentaje">{{item.porcentaje}}%</span></div></template></div></div></div></template><script>Polymer({is:"x-comp-comision",properties:{comisiones:{type:Array,value:function(){return[]},notify:!0},filteredComisiones:{type:Array,value:function(){return[]}},searchText:{type:String,value:""},selectedComision:{type:Object,notify:!0,value:null},_forceShowSuggestions:{type:Boolean,value:!1},buttonText:{type:String,computed:"_computeButtonText(selectedComision)"},isShowComponent:{type:Boolean,value:!1}},_computeButtonText:function(i){return i?i.descripcion+" "+i.porcentaje+"%":"Aplicar ComisiÃ³n"},ready:function(){this._loadComisiones(),document.addEventListener("click",function(i){i.target===this.$.comisionInput||"IRON-ICON"===i.target.tagName&&"arrow-drop-down"===i.target.icon||this.contains(i.target)||(this.$.suggestions.classList.remove("visible"),this.$.comisionInputContainer.classList.remove("visible"))}.bind(this))},toggleInput:function(i){i&&i.stopPropagation(),this.$.comisionInputContainer.classList.toggle("visible"),this.$.comisionInputContainer.classList.contains("visible")&&(this.showAllOptions(),setTimeout(()=>{this.$.comisionInput&&this.$.comisionInput.focus()},100))},handleContainerClick:function(){this.$.suggestions.classList.contains("visible")&&(this.$.suggestions.classList.remove("visible"),this.$.comisionInputContainer.classList.remove("visible"))},_loadComisiones:function(){var s=this;$.ajax({url:"../../bdphp/log_componentes.php?op=25",success:function(i){i=JSON.parse(i);s.comisiones=i.datos,s.isShowComponent=0<s.comisiones.length},error:function(i,s,t){}})},handleSearchInput:function(i){var s=this.searchText.toLowerCase().trim();this.filteredComisiones=""===s?this.comisiones.slice():this.comisiones.filter(function(i){return i.descripcion.toLowerCase().includes(s)}),0<this.filteredComisiones.length||this._forceShowSuggestions?this.$.suggestions.classList.add("visible"):this.$.suggestions.classList.remove("visible")},showAllOptions:function(i){i&&i.stopPropagation(),this._forceShowSuggestions=!0,this.filteredComisiones=this.comisiones.slice(),this.$.suggestions.classList.add("visible")},selectComision:function(i){i&&i.stopPropagation();i=i.currentTarget.dataset.index,i=this.filteredComisiones[i];this.searchTimeout&&clearTimeout(this.searchTimeout),this.selectedComision=i,this.searchText=i.descripcion,this.$.suggestions.classList.remove("visible"),this.$.comisionInputContainer.classList.remove("visible"),this._forceShowSuggestions=!1,this.fire("comision-selected",this.selectedComision)},cancelComision:function(i){i&&i.stopPropagation(),this.selectedComision=null,this.searchText="",this.fire("comision-canceled",{})}})</script></dom-module>