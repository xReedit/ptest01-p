<dom-module id="x-comp-dialog-permiso"><template><style>.dialog_redondo{border-radius:10px}.p-3{padding:16px}.fs-18{font-size:18px}.fw-600{font-weight:600}.fs-11{font-size:11px}.fs-10{font-size:10px}.fs-12{font-size:12px}.btn{padding:8px 16px;border:none;border-radius:5px;cursor:pointer}.btn-primary{background-color:#007bff;color:#fff}.btn-secondary{background-color:#6c757d;color:#fff}.btn-sm{font-size:12px}.badge{display:inline-block;padding:.25em .4em;font-size:75%;font-weight:700;line-height:1;text-align:center;white-space:nowrap;vertical-align:baseline;border-radius:.25rem}.badge-info{background-color:#17a2b8;color:#fff}.badge-danger{background-color:#dc3545;color:#fff}</style><paper-dialog id="com_dialog_solicitud_remota_permiso"class="dialog_redondo"style="max-width:295px"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="p-3"><div><p class="fs-18 fw-600">Solicitar Permiso Remoto</p><span class="fw-600 fs-11">Las solicitudes se envian al numero de WhatsApp</span></div><br><p>Quien dará el permiso?</p><select class="selected-template-1"id="selAdmin"on-change="_selectedUsAdmin"><template is="dom-repeat"items="{{listUsAdmin}}"as="item"><option value="{{item.idusuario}}">{{item.nombres}}</template></select><br><p hidden$="[[!isUsAdminHaveTelefono]]"class="fs-10 badge badge-info">Telefono de notificación: [[usAdminSelected.telefono]]<p hidden$="[[isUsAdminHaveTelefono]]"class="fs-10 badge badge-danger">No tiene un telefono registrado</p><br><br><p class="fw-600">Solicitud:<p class="fs-12"id="comp_dialog_permiso_titulo_solicitud"></p><textarea class="selected-template-1"id="text_motivo_solicitud_remoto"placeholder="Indique el motivo de su solicitud"cols="30"rows="3"on-input="_checkFormValidity"></textarea><br><br><button disabled$="[[!canSend]]"class="btn btn-sm btn-primary"on-click="_sendSolicitud">Enviar</button> <button class="btn btn-sm btn-secondary"dialog-dismiss>Cancelar</button></div></paper-dialog></template><script>Polymer({is:"x-comp-dialog-permiso",properties:{listUsAdmin:{type:Array,value:function(){return[]}},usAdminSelected:{type:Object,value:function(){return{}}},isUsAdminHaveTelefono:{type:Boolean,value:!1},canSend:{type:Boolean,computed:"_computeCanSend(isUsAdminHaveTelefono, motivoSolicitud)"},motivoSolicitud:{type:String,value:""}},attached:function(){this.isUsAdminHaveTelefono=!1,this._loadUsAdminPermiso()},_loadUsAdminPermiso:function(){this.$.text_motivo_solicitud_remoto.value="",$.ajax({type:"POST",url:"../../bdphp/log.php?op=70112"}).done(o=>{this.listUsAdmin=JSON.parse(o).datos,this._selectedUsAdmin(null,0)})},_selectedUsAdmin:function(o,e=null){null!==e?this.usAdminSelected=this.listUsAdmin[e]:(e=this.$.selAdmin.selectedIndex,this.usAdminSelected=this.listUsAdmin[e]),this.isUsAdminHaveTelefono=null!==this.usAdminSelected.telefono&&""!==this.usAdminSelected.telefono,this._checkFormValidity()},_checkFormValidity:function(){this.motivoSolicitud=this.$.text_motivo_solicitud_remoto.value.trim()},_computeCanSend:function(o,e){return o&&""!==e},_sendSolicitud:async function(){var o={motivo:this.$.text_motivo_solicitud_remoto.value,idusuario_solicita:xIdUsuario,idusuario_admin:this.usAdminSelected.idusuario,telefono_admin:this.usAdminSelected.telefono,nomusuario_solicita:xNomUsario,nomusuario_admin:primeraConMayusculas(this.usAdminSelected.nombres),nomsede:xm_log_get("datos_org_sede")[0].sedenombre,data:xCompArraySolitaPermiso.obj,solicitud:xCompArraySolitaPermiso.solicitud,tipo_permiso:xCompArraySolitaPermiso.tipo_permiso},e=await(new httpFecht).postJson("../../bdphp/log_009.php?op=40",o);e.success&&(this.$.com_dialog_solicitud_remota_permiso.close(),this.$.text_motivo_solicitud_remoto.value="",o.link=e.link,_cpSocketSendWhatAppPermisoAdmin(o),(e=paramsSwalAlert).html=`<div class="p-1">
                        <i class="fa fa-check fa-2x text-success"></i>
                        <p class="fw-600 fs-20">Solicitud enviada</p>
                        <p class="fw-100 fs-14">
                            Se envio la solicitud a <strong>${o.nomusuario_admin}</strong> al WhatsApp <strong>${o.telefono_admin}</strong>. Se le notificara cuando la solicitud sea atendida.
                        </p>
                    </div>`,showAlertSwalHtml(e),this.fire("xSend",o))},openDialog:function(){this._loadUsAdminPermiso(),this._loadSolicitudData(),this.$.com_dialog_solicitud_remota_permiso.open()},_loadSolicitudData:function(){var o,e,i=xCompArraySolitaPermiso;let t="",s="";1===i.tipo_permiso?(o="0"===i.mesa?"del pedido "+i.numpedido:"de la mesa "+i.mesa,t=`<span class="fw-600 text-danger">Eliminar</span> <strong>${"0"===i.mesa?"del pedido "+i.numpedido:"de la mesa "+i.mesa}</strong> el producto <strong>${i.obj.descripcion.toLowerCase()} (${i.obj.precio_unitario}).</strong>`,s=`Eliminar ${o} el producto ${i.obj.descripcion.toLowerCase()} (${i.obj.precio_unitario}).`):2===i.tipo_permiso?(o=1<i.obj.length?"los pedidos":"el pedido",e=i.importe_total.toFixed(2),t=`<span class="fw-600 text-danger">Eliminar</span> <strong>${"0"===i.mesa?"del pedido "+i.numpedido:"de la mesa "+i.mesa}</strong> ${o} <strong>${i.obj[0].idpedidos}</strong> por un importe de <strong>${e}</strong>`,s=`Eliminar ${o} ${i.obj[0].idpedidos} por un importe de `+e):3===i.tipo_permiso?(o=i.obj.importe,e=i.obj.descripcion_before,i.obj.descripcion_afeter,t=`<span class="fw-600 text-danger">Cambiar metodo de pago</span> <strong>${e}</strong> de un importe de: <strong>${o}</strong>`,s=`Cambiar metodo de pago ${e} de un importe de: `+o):4===i.tipo_permiso?(((e=i.obj.importe_1.toFixed(2))-parseFloat(i.obj.importe_2)).toFixed(2),t=`<span class="fw-600 text-danger">Cerrar caja</span> hay una diferencia en el efectivo de caja. Tengo <strong>${e}</strong>`,s="Cerrar caja hay una diferencia en el efectivo de caja. Tengo "+e):5===i.tipo_permiso&&(i.obj.importe,t=`<span class="fw-900 text-danger">Anular</span> el <strong>registro de pago de pago </strong> que contiene <strong>${i.numpedidos} pedido(s)</strong> del canal de consumo <strong>${i.tipoconsumo}</strong> por un importe de <strong>${i.obj.importe}</strong>`,s=`Anular el registro de pago que contiene ${i.numpedidos} pedido(s) del canal de consumo ${i.tipoconsumo} por un importe de `+i.obj.importe),xCompArraySolitaPermiso.solicitud=s,this.$.comp_dialog_permiso_titulo_solicitud.innerHTML=t}})</script></dom-module>