<dom-module id="x-comp-dialog-permiso"><script src="../../view/httpFech.js"></script><template><paper-dialog id="com_dialog_solicitud_remota_permiso"class="dialog_redondo"style="max-width:295px"entry-animation="scale-up-animation"exit-animation="fade-out-animation"with-backdrop><div class="p-3"><div><div><p class="fs-18 fw-600">Solicitar Permiso Remoto</p><span class="fw-600 fs-11">Las solicitudes se envian al numero de WhatsApp</span></div></div><br><p>Quien dará el permiso?</p><select class="selected-template-1"id="selAdmin"onchange="xCompDialogSPselectedUsAdmin(this)"><template is="dom-repeat"items="{{listUsAdmin}}"as="item"><option value="{{item.idusario}}">{{ item.nombres }}</template></select><br><p hidden$="[[!isUsAdminHaveTelefono]]"class="fs-10 badge badge-info">Telefono de notificación: [[usAdminSelected.telefono]]<p hidden$="[[isUsAdminHaveTelefono]]"class="fs-10 badge badge-danger">No tiene un telefono registrado</p><br><br><p class="fw-600">Solicitud:<p class="fs-12"id="comp_dialog_permiso_titulo_solicitud"></p><textarea class="selected-template-1"id="text_motivo_solicitud_remoto"placeholder="Indique el motivo de su solicitud"cols="30"rows="3"value="">
            </textarea><br><br><button disabled$="[[!isUsAdminHaveTelefono]]"class="btn btn-sm btn-primary"onclick="xCompDialogSP_SendSolicitud()">Enviar</button> <button class="btn btn-sm btn-secondary"dialog-dismiss>Cancelar</button></div></paper-dialog></template><style>#comp_dialog_permiso_titulo_solicitud{width:250px}</style><script>var xThisCompDialogPermiso,idUsAdminPermisoRemoto,xCompArraySolitaPermiso={tipo_permiso:0,motivo:"",idusuario_admin:0,idusuario_solicita:0,nomusuario_solicita:"",nomusuario_admin:"",nomsede:"",data:{},solicitud:"",solicitudHtml:"",link:""};async function xCompDialogSP_SendSolicitud(){xCompArraySolitaPermiso.motivo=xThisCompDialogPermiso.$.text_motivo_solicitud_remoto.value,xCompArraySolitaPermiso.idusuario_solicita=xIdUsuario,xCompArraySolitaPermiso.idusuario_admin=xThisCompDialogPermiso.usAdminSelected.idusuario,xCompArraySolitaPermiso.telefono_admin=xThisCompDialogPermiso.usAdminSelected.telefono,xCompArraySolitaPermiso.nomusuario_solicita=xNomUsario,xCompArraySolitaPermiso.nomusuario_admin=primeraConMayusculas(xThisCompDialogPermiso.usAdminSelected.nombres),xCompArraySolitaPermiso.nomsede=xm_log_get("datos_org_sede")[0].sedenombre,xCompArraySolitaPermiso.data=xCompArraySolitaPermiso.obj,delete xCompArraySolitaPermiso.obj;var o=await(new httpFecht).postJson("../../bdphp/log_009.php?op=40",xCompArraySolitaPermiso);o.success&&(xThisCompDialogPermiso.$.com_dialog_solicitud_remota_permiso.close(),xThisCompDialogPermiso.$.text_motivo_solicitud_remoto.value="",xCompArraySolitaPermiso.link=o.link,_cpSocketSendWhatAppPermisoAdmin(xCompArraySolitaPermiso),(o=paramsSwalAlert).html=`<div class="p-1">                    
												<i class="fa fa-check fa-2x text-success"></i>												
												<p class="fw-600 fs-20">Solicitud enviada</p>
												<p class="fw-100 fs-14">
													Se envio la solicitud a <strong>${xCompArraySolitaPermiso.nomusuario_admin}</strong> al WhatsApp <strong>${xCompArraySolitaPermiso.telefono_admin}</strong>. Se le notificara cuando la solicitud sea atendida.
												</p>
											</div>`,showAlertSwalHtml(o),xThisCompDialogPermiso.fire("xSend",xCompArraySolitaPermiso))}function xCompDialogSPLoadUsAdminPermiso(){$("#com_dialog_solicitud_remota_permiso").on("iron-overlay-opened",function(){let o="",i="";var e,r,a="0"==xCompArraySolitaPermiso.mesa?"del pedido "+xCompArraySolitaPermiso.numpedido:"de la mesa "+xCompArraySolitaPermiso.mesa;1==xCompArraySolitaPermiso.tipo_permiso&&(o=`<span class="fw-600 text-danger">Eliminar</span> <strong>${a}</strong> el producto <strong>${xCompArraySolitaPermiso.obj.descripcion.toLowerCase()} (${xCompArraySolitaPermiso.obj.precio_unitario}).</strong>`,i=`Eliminar ${a} el producto ${xCompArraySolitaPermiso.obj.descripcion.toLowerCase()} por un importe de ${xCompArraySolitaPermiso.obj.precio_unitario}.`),2==xCompArraySolitaPermiso.tipo_permiso&&(r=1<xCompArraySolitaPermiso.obj.length?"los pedidos":"el pedido",e=xCompArraySolitaPermiso.importe_total.toFixed(2),o=`<span class="fw-600 text-danger">Eliminar</span> <strong>${a}</strong> ${r} <strong>${xCompArraySolitaPermiso.obj[0].idpedidos}</strong> por un importe de <strong>${e}</strong>`,i=`Eliminar ${a} ${r} ${xCompArraySolitaPermiso.obj[0].idpedidos} por un importe de `+e),3==xCompArraySolitaPermiso.tipo_permiso&&(a=xCompArraySolitaPermiso.obj.importe,r=xCompArraySolitaPermiso.obj.descripcion_before,xCompArraySolitaPermiso.obj.descripcion_afeter,o=`<span class="fw-600 text-danger">Cambiar metodo de pago</span> <strong>${r}</strong> de un importe de: <strong>${a}</strong>`,i=`Cambiar metodo de pago ${r} de un importe de `+a),4==xCompArraySolitaPermiso.tipo_permiso&&(a=((e=xCompArraySolitaPermiso.obj.importe_1.toFixed(2))-(r=parseFloat(xCompArraySolitaPermiso.obj.importe_2))).toFixed(2),o=`<span class="fw-600 text-danger">Cerrar caja</span> hay una diferencia en el efectivo de caja. Tengo <strong>${e}</strong>`,i=`Ver monto registrado en caja para realizar el cuadre de caja. Hay una diferencia en el efectivo de caja. Tiene ${e} y deberia tener ${r}. La diferencia es de `+a),xCompArraySolitaPermiso.solicitud=i,xThisCompDialogPermiso.$.comp_dialog_permiso_titulo_solicitud.innerHTML=o,xThisCompDialogPermiso.$.com_dialog_solicitud_remota_permiso.center()}),xThisCompDialogPermiso.$.text_motivo_solicitud_remoto.value="",$.ajax({type:"POST",url:"../../bdphp/log.php?op=70112"}).done(function(o){xThisCompDialogPermiso.listUsAdmin=JSON.parse(o).datos,xCompDialogSPselectedUsAdmin(null,0)})}function xCompDialogSPselectedUsAdmin(o,i=null){null!==i?xThisCompDialogPermiso.usAdminSelected=xThisCompDialogPermiso.listUsAdmin[i]:(xThisCompDialogPermiso.usAdminSelected=xThisCompDialogPermiso.listUsAdmin[o.selectedIndex],idUsAdminPermisoRemoto=xThisCompDialogPermiso.usAdminSelected.idusuario),xThisCompDialogPermiso.isUsAdminHaveTelefono=null!==xThisCompDialogPermiso.usAdminSelected.telefono}Polymer({is:"x-comp-dialog-permiso",properties:{listUsAdmin:[],usAdminSelected:{},descripcionEliminar:String,isUsAdminHaveTelefono:Boolean},attached:function(){this.isUsAdminHaveTelefono=!1,xThisCompDialogPermiso=this,xCompDialogSPLoadUsAdminPermiso()}})</script></dom-module>