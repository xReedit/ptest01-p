<dom-module id="x-comp-descuento"><template><div><div class="animate__animated animate__fadeIn animate__faster"hidden$="[[ showDetalle ]]"><div class="d-flexx btn-descuento"onclick="xVerificarPermisoDscUsuario()"><div class="p-2 bg-warning"><i class="fa fa-sort-numeric-desc"></i></div><p class="pl-2 fs-13">Aplicar Descuento</div></div><div class="animate__animated animate__fadeIn animate__faster"hidden$="[[ !showDetalle ]]"><div class="d-flexx align-content-center justify-content-end"><div class="pr-1"><select class$="[[classselect]]"onchange="selectedDsc(this)"><template is="dom-repeat"items="{{listTipoConceptos}}"as="item"><option value="{{ item.idtipo_descuento }}">{{ item.descripcion }}</template></select></div><div class="content-text-improte pr-1"><input class="text_importe fs-16"id="txt_imp_dsc"autocomplete="off"onblur="xFocusInputDescuento(!1)"onfocus="xFocusInputDescuento(!0)"onkeyup="xCalcImporteDsc()"></div><div class="pl-1"><button class="btn btn-sm btn-danger"onclick="xShowDetalleDsc()"><i class="fa fa-times"></i></button></div></div></div></div></template></dom-module><style>.btn-descuento{border:1px solid #bdbdbd;border-radius:3px;align-items:center;width:160px;display:flex;cursor:pointer}.btn-descuento:hover{background:#eee}.content-text-improte{border:1px solid #bdbdbd;border-radius:3px;display:flex;align-items:center;max-width:100px}.content-text-improte:hover{background:#eee}.text_importe{border:0;text-align:end!important;max-width:90px}.text_importe:focus{outline:0}</style><script>var xThisCompDesc,datauSPerDsc,tipoDscSelected,xPermisoSupervisorDsc,paseAccPer=!1,keyDscStorage="::app3_sys_tpdsc",importeInicial=0,lastValCalc=0;function xShowDetalleDsc(){xThisCompDesc.showDetalle=!xThisCompDesc.showDetalle,xThisCompDesc.showDetalle?(xThisCompDesc.$.txt_imp_dsc.value="",xThisCompDesc.$.txt_imp_dsc.focus()):xThisCompDesc.fire("changeDescuento",{value:0,descripcion:"",isAgregar:!1})}function xVerificarPermisoDscUsuario(){(paseAccPer=-1<datauSPerDsc.per.indexOf("Pe5"))?xShowDetalleDsc():(xPSupervisor.setVal("Pe5"),xPSupervisor.addEventListener("xSendPe5",function(e){1===e.detail.xRpts[0].p&&(xPermisoSupervisorDsc=e.detail.xRpts[0].us,xShowDetalleDsc())}),pass_us.open())}function xResetCompDsc(){xThisCompDesc.showDetalle=!1,xThisCompDesc.$.txt_imp_dsc.value="",lastValCalc=0}function xLoadTipoDsc(){var s=!1,e=localStorage.getItem(keyDscStorage);if(xThisCompDesc.$.txt_imp_dsc.value,e)try{xThisCompDesc.listTipoConceptos=JSON.parse(e),s=!0,tipoDscSelected=xThisCompDesc.listTipoConceptos[0]}catch(e){s=!1}s||$.ajax({type:"GET",url:"../../bdphp/log_componentes.php?op=14"}).done(function(e){(e=JSON.parse(e)).success&&(xThisCompDesc.listTipoConceptos=e.datos,tipoDscSelected=xThisCompDesc.listTipoConceptos[0],localStorage.setItem(keyDscStorage,JSON.stringify(e.datos)))})}function selectedDsc(e){tipoDscSelected=xThisCompDesc.listTipoConceptos[e.selectedIndex],xCalcImporteDsc(),xThisCompDesc.$.txt_imp_dsc.focus();try{xThisCompDesc.$.txt_imp_dsc.selected()}catch(e){}}function xCalcImporteDsc(){var e="2"===tipoDscSelected.idtipo_descuento,s=0,t="",c=xThisCompDesc.importeventa,c=(0===(importeInicial=""===xThisCompDesc.$.txt_imp_dsc.value?0:importeInicial)&&(importeInicial=c+lastValCalc),e?100:importeInicial),o=parseFloat(xThisCompDesc.$.txt_imp_dsc.value)||0;o!==lastValCalc&&(c<o&&(xThisCompDesc.$.txt_imp_dsc.value=o=c),e?(s=Math.round(importeInicial*(o/100),2),s=importeInicial<s?importeInicial:s,t=o+"%"):s=o,lastValCalc=s,xThisCompDesc.fire("changeDescuento",{value:s,descripcion:t,isAgregar:!0}))}function xFocusInputDescuento(e){xThisCompDesc.fire("focus-input",e)}Polymer({is:"x-comp-descuento",properties:{showDetalle:Boolean,listTipoConceptos:[],importeventa:{type:Number,notify:!0,reflectToAttribute:!0,value:0},classselect:{type:String,value:"selected-template-1 fs-15"}},attached:function(){this.showDetalle=!1,xThisCompDesc=this,datauSPerDsc=xm_log_get("app3_us"),xLoadTipoDsc()},reset:()=>{xResetCompDsc()},setVisible:e=>{xThisCompDesc.showDetalle=e}})</script>