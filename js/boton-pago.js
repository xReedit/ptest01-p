var importe,purchasenumber,dataCliente,cargando_transaction=!1,user="macraze.info@gmail.com",password="j34Oz!nB",merchantId="650149801",urlApiSeguridad="https://apiprod.vnforapps.com/api.security/v1/security",urlApiSesion="https://apiprod.vnforapps.com/api.ecommerce/v2/ecommerce/token/session/",urlApiAutorization="https://apiprod.vnforapps.com/api.authorization/v3/authorization/ecommerce/",urlJs="https://static-content.vnforapps.com/v2/js/checkout.js",logo="https://papaya.com.pe/images/l-pay-2.png";function pagar(e,t,a){importe=parseFloat(e).toFixed(2).toString(),purchasenumber=t,(dataCliente=a).email_token=dataCliente.email,getIpCliente()}function getIpCliente(){dataCliente.antifraud={clientIp:dataCliente.ip,merchantDefineData:{MDD4:dataCliente.email,MDD32:dataCliente.idcliente,MDD75:"Invitado",MDD77:dataCliente.diasRegistrado,MDD89:"1"}},generarToken()}function generarToken(){$.ajax({async:!0,crossDomain:!0,url:urlApiSeguridad,method:"POST",headers:{Authorization:"Basic bWFjcmF6ZS5pbmZvQGdtYWlsLmNvbTpqMzRPeiFuQg==",Accept:"*/*"}}).done(function(e){generarSesion(e),localStorage.setItem("token",e)})}function generarSesion(e){var t={amount:importe,antifraud:null,channel:"web",recurrenceMaxAmount:null},e={async:!0,crossDomain:!0,url:urlApiSesion+merchantId,method:"POST",headers:{Authorization:e,"Content-Type":"application/json"},dataMap:{userToken:dataCliente.email},processData:!1,data:JSON.stringify(t)};$.ajax(e).done(function(e){generarBoton(e.sessionKey)})}function generarBoton(e){var t=dataCliente.nombre,a=dataCliente.apellido,n=dataCliente.email,r={merchantId:merchantId,moneda:"PEN",nombre:t,apellido:a,importe:importe,email:n},r=(localStorage.setItem("data",JSON.stringify(r)),document.createElement("form")),r=(r.setAttribute("method","post"),r.setAttribute("action","javascript:responseForm(self)"),r.setAttribute("id","boton_pago"),document.getElementById("btn_pago").appendChild(r),document.createElement("script"));r.setAttribute("src",urlJs),r.setAttribute("data-sessiontoken",e),r.setAttribute("data-channel","web"),r.setAttribute("data-merchantid",merchantId),r.setAttribute("data-purchasenumber",purchasenumber),r.setAttribute("data-amount",importe),r.setAttribute("data-merchantlogo",logo),r.setAttribute("data-expirationminutes",8),r.setAttribute("data-timeouturl","javascript:responseForm(self)"),r.setAttribute("data-cardholdername",t),r.setAttribute("data-cardholderlastname",a),r.setAttribute("data-cardholderemail",n),r.setAttribute("data-usertoken",n),document.getElementById("boton_pago").appendChild(r),document.getElementById("loader_btn_pago").classList.add("xInvisible")}function responseForm(e){loaderTransaction(!0);var t=this.message.args[0];generateAutorizacion(transactionToken=t.token)}function generateAutorizacion(e){cargando_transaction=!0;var t=localStorage.getItem("token"),e={antifraud:dataCliente.antifraud,captureType:"manual",channel:"web",countable:!1,order:{amount:importe,currency:"PEN",purchaseNumber:purchasenumber,tokenId:e}};fetch(urlApiAutorization+merchantId,{method:"POST",headers:{Authorization:t,"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{var t=!!e.errorCode;loaderTransaction(!1),loaderTransactionResponse(e,t),loaderTransactionResponseOut(e,t)}).catch(e=>{loaderTransaction(!1),loaderTransactionResponse(e,!0),loaderTransactionResponseOut(res,hayError)})}function loaderTransaction(e){localStorage.setItem("sys::transaction-load",e)}function loaderTransactionResponse(e,t){e&&(e.error=t,(t=document.querySelector("#visaNetWrapper")).parentNode.removeChild(t)),localStorage.setItem("sys::transaction-response",JSON.stringify(e))}